{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"2024/11/14/container-network.html","title":"\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc-veth","text":"<p>\u672c\u6587\u5c06\u7b80\u5355\u4ecb\u7ecd\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc\u901a\u4fe1\u3002</p> <p>\u672c\u7bc7\u6587\u7ae0\u6240\u4f7f\u7528\u7684\u73af\u5883\u4e3a\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# hostnamectl\n Static hostname: ubuntu\n       Icon name: computer-vm\n         Chassis: vm \ud83d\uddb4\n    Product UUID: d7a79327-c7b6-4c40-a8d2-abf3244c3abc\n  Virtualization: oracle\nOperating System: Ubuntu 24.10\n          Kernel: Linux 6.11.0-9-generic\n    Architecture: x86-64\n Hardware Vendor: innotek GmbH\n  Hardware Model: VirtualBox\n Hardware Serial: 0\nFirmware Version: VirtualBox\n   Firmware Date: Fri 2006-12-01\n    Firmware Age: 17y 11month 2w\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/14/container-network.html#_1","title":"\u524d\u7f6e\u94fa\u57ab","text":"<p>\u4e0a\u7bc7\u6587\u7ae0\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u5bb9\u5668\u662f\u5982\u4f55\u6302\u8f7d<code>rootfs</code>\u7684\uff0c\u672c\u7bc7\u5c06\u6765\u4ecb\u7ecd\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc\u901a\u4fe1\u3002</p> <p>\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc\u9694\u79bb\uff0c\u5f97\u76ca\u4e8e<code>network namespace</code>\uff0c\u8bf7\u770b\u4e0b\u9762\u7684<code>unshare</code>\u4f8b\u5b50\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:25:86:57 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.141/24 metric 100 brd 192.168.1.255 scope global dynamic enp0s3\n       valid_lft 7178sec preferred_lft 7178sec\n    inet6 fe80::a00:27ff:fe24:8657/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:0]#\n[root@ubuntu]:[~][tty:0]# unshare -n --fork /bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5f53\u524d\u673a\u5668\u662f\u5b9e\u9645\u7f51\u5361\u4fe1\u606f\u662f\u6709<code>lo</code>\u548c<code>enp0s3</code>\u7684\uff0c\u4e14\u5206\u914d\u4e86<code>ip</code>\u5730\u5740\uff0c\u4f46\u662f\u4f7f\u7528<code>unshare</code>\u5c06<code>bash</code>\u653e\u5165\u5230\u72ec\u7acb\u7684<code>network namespace</code>\u4e2d\u540e\uff0c\u7f51\u7edc\u5c31\u88ab\u9694\u79bb\u4e86\uff0c\u6240\u4ee5\u53ea\u80fd\u770b\u5230\u4e00\u4e2a\u56de\u73af\u5730\u5740\uff0c\u4e14\u72b6\u6001\u8fd8\u662f\u5173\u95ed\u7684(<code>DOWN</code>)\u3002</p>"},{"location":"2024/11/14/container-network.html#_2","title":"\u542f\u7528\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc","text":""},{"location":"2024/11/14/container-network.html#lo","title":"\u542f\u7528lo\u7f51\u5361","text":"<p>\u5728\u4f7f\u7528\u4e86<code>network namespace</code>\u7684\u5bb9\u5668\u4e2d\uff0c\u7f51\u7edc\u6709\u4e14\u53ea\u6709\u4e00\u4e2a\uff0c\u5c31\u662f<code>lo</code>\u7f51\u5361\uff0c\u5148\u6682\u65f6\u5c06\u5176\u542f\u7528\uff0c\u5e76\u4e14\u5c1d\u8bd5<code>ping</code>\u672c\u5730\u56de\u73af\u5730\u5740\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# unshare -m -p -i -u -n --fork /bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ping 127.0.0.1\nping: connect: Network is unreachable\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>lo</code>\u7f51\u5361\u662f\u5173\u95ed\u72b6\u6001\u7684\uff0c\u6240\u4ee5<code>ping</code>\u56de\u73af\u5730\u5740\u5e76\u4e0d\u53ef\u884c\uff0c\u8981\u60f3<code>ping</code>\u901a\uff0c\u9996\u5148\u9700\u8981\u7ed9\u542f\u52a8\u8d77\u6765\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip link set lo up\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host proto kernel_lo\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ping 127.0.0.1 -c 4\nPING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.016 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.024 ms\n64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.025 ms\n64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.024 ms\n\n--- 127.0.0.1 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3052ms\nrtt min/avg/max/mdev = 0.016/0.022/0.0\n</code></pre> <p>\u4f7f\u7528<code>ip link set lo up</code>\u53ef\u4ee5\u5c06\u7f51\u5361\u7ed9\u542f\u52a8\u8d77\u6765\uff0c\u542f\u52a8\u540e\uff0c\u72b6\u6001\u7531<code>DOWN</code>\u53d8\u4e3a\u4e86<code>UNKNOWN</code>\uff0c\u4e14\u4e5f\u80fd\u770b\u5230<code>ip</code>\u5730\u5740\u4e86\uff0c\u5c1d\u8bd5<code>ping 127.0.0.1</code>\uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c<code>ping</code>\u901a\u3002</p>"},{"location":"2024/11/14/container-network.html#veth","title":"\u6dfb\u52a0<code>veth</code>\u865a\u62df\u7f51\u5361","text":""},{"location":"2024/11/14/container-network.html#veth_1","title":"\u4ec0\u4e48\u662f<code>veth</code>\u865a\u62df\u7f51\u5361","text":"<p><code>veth</code>\u662f<code>linux</code>\u4e2d\u7684\u865a\u62df\u7f51\u5361\uff08<code>Virtual Ethernet Device</code>\uff09\uff0c<code>veth</code>\u8bbe\u5907\u603b\u662f\u6210\u5bf9\u51fa\u73b0\u7684\uff0c\u5f53\u4f7f\u7528<code>veth</code>\u7684\u4e24\u7aef\u5206\u522b\u8fde\u63a52\u4e2a\u8bbe\u5907\u540e\uff0c\u5728\u5bf9\u4e2d\u7684\u4e00\u4e2a\u8bbe\u5907\u4f20\u8f93\u6570\u636e\u5305\u65f6\uff0c\u53e6\u4e00\u4e2a\u8bbe\u5907\u4f1a\u7acb\u5373\u6536\u5230\u3002<code>veth</code> \u6700\u5927\u7684\u4f5c\u7528\u4fbf\u662f\u4f5c\u4e3a\u7f51\u7edc\u547d\u540d\u7a7a\u95f4\uff08<code>network namespace</code>\uff09\u4e4b\u95f4\u7684\u96a7\u9053\u4f20\u8f93\u3002</p> <p><code>veth</code>\u7684\u521b\u5efa\u65b9\u6cd5\u4e3a\uff1a</p> <pre><code># ip link add &lt;p1-name&gt; type veth peer name &lt;p2-name&gt;\n</code></pre> <p>\u5176\u4e2d<code>p1-name</code> \u548c<code>p2-name</code>\u5206\u522b\u662f<code>veth</code>2\u7aef\u7684\u540d\u79f0\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u521b\u5efa\u4e00\u5bf9<code>veth</code>\u7f51\u5361\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:1]# ip link add veth0 type veth peer name veth1\n[root@ubuntu]:[~][tty:1]#\n[root@ubuntu]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:25:86:57 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.141/24 metric 100 brd 192.168.1.255 scope global dynamic enp0s3\n       valid_lft 7178sec preferred_lft 7178sec\n    inet6 fe80::a00:27ff:fe24:8657/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n3: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff\n4: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff\n[root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u4e0a\u9762\u4f7f\u7528<code>ip link add veth0 type veth peer name veth1</code>\u521b\u5efa\u4e86\u4e00\u5bf9<code>veth</code>\u7f51\u5361\uff0c\u5206\u522b\u4e3a<code>veth0</code>\u548c<code>veth1</code>\uff0c\u518d\u6b21\u67e5\u770b\u7f51\u5361\u4fe1\u606f\uff0c\u589e\u52a0\u4e86<code>veth0</code>\u548c<code>veth1</code>\uff0c\u53ea\u4e0d\u8fc7\u9ed8\u8ba4\u72b6\u6001\u90fd\u662f\u5173\u95ed\u7684\uff08<code>DOWN</code>\uff09\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u7684\u786e\u521b\u5efa\u4e862\u4e2a\u7f51\u5361\uff0c\u4f46\u662f\u5728\u5bb9\u5668\u4e2d\u6ca1\u6709\uff0c\u6240\u4ee5\u9700\u8981\u5c06\u521b\u5efa\u7684<code>veth</code>\u5176\u4e2d\u4e00\u4e2a\u79fb\u5230\u5bb9\u5668\u4e2d\u53bb\uff0c\u9996\u5148\uff0c\u9700\u8981\u67e5\u8be2\u9700\u8981\u8f6c\u79fb\u5230\u7684\u5bb9\u5668\u771f\u5b9e\u7684<code>pid</code>\uff08\u9488\u5bf9\u4f7f\u7528\u4e86<code>pid namespace</code>\u800c\u8a00\uff09\u3002</p>"},{"location":"2024/11/14/container-network.html#_3","title":"\u5c06\u865a\u62df\u7f51\u5361\u79fb\u5230\u5bb9\u5668\u4e2d","text":"<p>\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u67e5\u8be2<code>unshare</code>\u542f\u52a8\u7684\u5b50\u547d\u4ee4\u7684<code>pid</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ps axjf | head -n 1 ;ps axjf | grep unshare -A 1 | grep -v grep\n   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND\n   1083    1128    1128    1071 pts/0       1129 S        0   0:00  |                   \\_ unshare -m -p -i -u -n --fork /bin/bash\n   1128    1129    1129    1071 pts/0       1129 S+       0   0:00  |                       \\_ /bin/bash\n--\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7<code>unshare</code>\u521b\u5efa\u7684<code>bash</code>\u8fdb\u7a0b\u7684<code>pid</code>\u4e3a<code>1129</code>\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u5c06<code>veth1</code>\u79fb\u5165\u5230<code>pid</code>\u4e3a<code>1129</code>\u6240\u5728\u7684<code>network namespace</code>\u4e2d\uff0c\u5373\u8be5\u5bb9\u5668\u4e2d\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip link set veth0 netns 1129\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u6b64\u65f6\uff0c\u518d\u6b21\u67e5\u8be2\u5bbf\u4e3b\u673a\u7f51\u5361\uff0c\u4f1a\u53d1\u73b0<code>veth0</code>\u5df2\u7ecf\u6ca1\u4e86\uff0c\u53ea\u6709<code>veth1</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:25:86:57 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.141/24 metric 100 brd 192.168.1.255 scope global dynamic enp0s3\n       valid_lft 7178sec preferred_lft 7178sec\n    inet6 fe80::a00:27ff:fe24:8657/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n3: veth1@if4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u518d\u6b21\u56de\u5230\u5bb9\u5668\u4e2d\uff0c\u67e5\u770b\u7f51\u5361\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host proto kernel_lo\n       valid_lft forever preferred_lft forever\n4: veth0@if3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u4f1a\u53d1\u73b0<code>veth0</code>\u5df2\u7ecf\u6210\u529f\u632a\u5230\u4e86\u5bb9\u5668\u4e2d\uff0c\u4f46\u662f\u6b64\u65f6\u56e0\u4e3a2\u4e2a\u7f51\u5361\u8fd8\u6ca1\u6709<code>ip</code>\u5730\u5740\uff0c\u6240\u4ee5\u65e0\u6cd5\u8fdb\u884c\u901a\u4fe1\uff0c\u6211\u4eec\u53ef\u4ee5\u4e3a\u5176\u8bbe\u7f6e\u4e00\u4e2a<code>ip</code>\u5730\u5740\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u901a\u4fe1\u4e86\u3002</p>"},{"location":"2024/11/14/container-network.html#ip","title":"\u4e3a\u865a\u62df\u7f51\u5361\u5206\u914d<code>IP</code>\u5730\u5740","text":"<p>\u89c4\u5212\u5982\u4e0b\uff1a</p> <ul> <li>\u5bbf\u4e3b\u673a<code>veth1</code>\uff1a<code>10.0.3.1/24</code></li> <li>\u5bb9\u5668<code>veth0</code>\uff1a<code>10.0.3.3/24</code></li> </ul> <p>\u5728\u5bbf\u4e3b\u673a\u8bbe\u7f6e<code>veth1</code>\u7f51\u5361<code>ip</code>\u5730\u5740\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip addr add 10.0.3.1/24 dev veth1\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u67e5\u770b\u7f51\u5361\u4fe1\u606f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip a show veth1\n3: veth1@if4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u6b64\u65f6\u7f51\u5361\u8fd8\u662f\u5173\u95ed\u72b6\u6001\u7684\uff0c\u9700\u8981\u5c06\u5176\u7ed9\u6253\u5f00\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip link set veth1 up\n[root@ubuntu]:[~][tty:2]# ip a show veth1\n3: veth1@if4: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u72b6\u6001\u4ece<code>DOWN</code>\u53d8\u66f4\u4e3a\u4e86<code>LOWERLAYERDOWN</code>\uff0c\u8fd9\u662f\u7531\u4e8e\u5bb9\u5668\u4e2d\u7684<code>veth0</code>\u7f51\u5361\u5e76\u672a\u6253\u5f00\u800c\u5f15\u8d77\u7684\u3002</p> <p>\u63a5\u7740\uff0c\u9700\u8981\u5728\u5bb9\u5668\u4e2d\u5bf9<code>veth0</code>\u7f51\u5361\u505a\u540c\u6837\u7684\u64cd\u4f5c\u3002</p> <p>\u5728\u5bb9\u5668\u4e2d\u8bbe\u7f6e<code>veth0</code>\u7f51\u5361\u7684<code>ip</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip addr add 10.0.3.3/24 dev veth0\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b\u7f51\u5361\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip a show veth0\n4: veth0@if3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth0\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u8fd8\u662f\u5c06\u7f51\u5361\u7ed9\u6253\u5f00\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip link set veth0 up\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ip a show veth0\n4: veth0@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6477:10ff:fe54:810e/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5f53<code>veth0</code>\u7684\u7f51\u5361\u5f00\u542f\u540e\uff0c\u5176\u72b6\u6001\u5df2\u7ecf\u53d8\u66f4\u4e3a\u4e86<code>UP</code>\u3002\u6b64\u65f6\u82e5\u518d\u6b21\u67e5\u770b\u5bbf\u4e3b\u673a<code>veth1</code>\u72b6\u6001\uff0c\u5176\u72b6\u6001\u4e5f\u5e94\u8be5\u4e3a<code>UP</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip a show veth1\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::acdd:f7ff:fe9d:9bf8/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/14/container-network.html#_4","title":"\u68c0\u9a8c\u865a\u62df\u7f51\u5361\u8fde\u901a\u6027","text":"<p>\u5982\u679c<code>veth</code>\u865a\u62df\u7f51\u5361\u90fd\u5206\u914d\u4e86<code>ip</code>\u5730\u5740\uff0c\u4e14\u90fd\u5f00\u542f\uff0c\u72b6\u6001\u90fd\u4e3a<code>UP</code>\u7684\u60c5\u51b5\u4e0b\uff0c\u6b64\u65f6\u7f51\u5361\u5c31\u521b\u5efa\u597d\u4e86\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u5728\u5404\u81ea\u7684\u73af\u5883\u4e2d<code>ping</code>\u4e00\u4e0b\u5bf9\u65b9\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u4e2d<code>ping</code>\u5bb9\u5668<code>veth0</code>\u7684<code>ip</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# ip a show veth1\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.1/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::acdd:f7ff:fe9d:9bf8/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:2]#\n[root@ubuntu]:[~][tty:2]# ping -c 4 10.0.3.3\nPING 10.0.3.3 (10.0.3.3) 56(84) bytes of data.\n64 bytes from 10.0.3.3: icmp_seq=1 ttl=64 time=0.030 ms\n64 bytes from 10.0.3.3: icmp_seq=2 ttl=64 time=0.028 ms\n64 bytes from 10.0.3.3: icmp_seq=3 ttl=64 time=0.028 ms\n64 bytes from 10.0.3.3: icmp_seq=4 ttl=64 time=0.032 ms\n\n--- 10.0.3.3 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3057ms\nrtt min/avg/max/mdev = 0.028/0.029/0.032/0.001 ms\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u5728\u5bb9\u5668\u4e2d<code>ping</code>\u5bbf\u4e3b\u673a<code>veth1</code>\u7684<code>ip</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip a show veth0\n4: veth0@if3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6477:10ff:fe54:810e/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ping -c 4 10.0.3.1\nPING 10.0.3.1 (10.0.3.1) 56(84) bytes of data.\n64 bytes from 10.0.3.1: icmp_seq=1 ttl=64 time=0.019 ms\n64 bytes from 10.0.3.1: icmp_seq=2 ttl=64 time=0.029 ms\n64 bytes from 10.0.3.1: icmp_seq=3 ttl=64 time=0.032 ms\n64 bytes from 10.0.3.1: icmp_seq=4 ttl=64 time=0.033 ms\n\n--- 10.0.3.1 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3099ms\nrtt min/avg/max/mdev = 0.019/0.028/0.033/0.005 ms\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5982\u679c\u80fd\u591f\u50cf\u4e0a\u8ff0\u4e00\u6837\uff0c\u80fd\u591f\u4e92\u76f8<code>ping</code>\u901a\uff0c\u5c31\u8bf4\u660e<code>veth</code>\u521b\u5efa\u5206\u914d\u6b63\u5e38\u4e86\u3002</p>"},{"location":"2024/11/14/container-network.html#_5","title":"\u8ba9\u5bb9\u5668\u8fde\u4e0a\u5916\u7f51","text":""},{"location":"2024/11/14/container-network.html#veth_2","title":"\u4f7f\u7528veth\u8fdb\u884c\u7b80\u5355\u7684\u8054\u7f51","text":"<p>\u867d\u7136\u4e0a\u9762\u4f8b\u5b50\u5df2\u7ecf\u4f7f\u5bbf\u4e3b\u673a\u548c\u5bb9\u5668\u80fd\u591f\u4e92\u76f8\u901a\u4fe1\u4e86\uff0c\u4f46\u662f\u5bb9\u5668\u5185\u8fd8\u662f\u65e0\u6cd5\u4e0a\u7f51\uff0c\u4f8b\u5982<code>ping 8.8.8.8</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ping 8.8.8.8\nping: connect: Network is unreachable\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u53d1\u73b0\u662f\u65e0\u6cd5<code>ping</code>\u901a\u7684\uff0c\u4f46\u662f\u5728\u5bbf\u4e3b\u673a\u662f\u53ef\u4ee5<code>ping</code>\u901a\u7684\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:1]# ping -c 4 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=34.3 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=33.8 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=55 time=45.7 ms\n64 bytes from 8.8.8.8: icmp_seq=4 ttl=55 time=33.8 ms\n\n--- 8.8.8.8 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3004ms\nrtt min/avg/max/mdev = 33.774/36.884/45.674/5.078 ms\n[root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u56e0\u4e3a\u5bbf\u4e3b\u673a\u4e0a\u7684<code>veth1</code>\u662f\u53ef\u4ee5\u4e0a\u7f51\u7684\uff0c\u90a3\u60f3\u8981\u5bb9\u5668\u5b9e\u73b0\u4e0a\u7f51\uff0c\u53ef\u4ee5\u73b0\u5c06\u6d41\u91cf\u53d1\u9001\u5230<code>veth1</code>\u4e0a\uff0c\u518d\u7531<code>veth1</code>\u8f6c\u53d1\u51fa\u53bb\uff0c\u5f53\u6709\u6570\u636e\u56de\u6765\u7684\u65f6\u5019\uff0c\u518d\u8fd4\u7ed9\u5bb9\u5668\u4e2d\u7684<code>veth0</code>\u4e0d\u5c31\u53ef\u4ee5\u4e86\u5417\uff1f</p> <p>\u57fa\u4e8e\u6b64\uff0c\u53ef\u4ee5\u6765\u505a\u4e0b\u5982\u4e0b\u5b9e\u9a8c\u3002</p> <p>\u9996\u5148\u6765\u67e5\u770b\u5bb9\u5668\u7684\u8def\u7531\u4fe1\u606f\u8868\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip route\n10.0.3.0/24 dev veth0 proto kernel scope link src 10.0.3.3\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u8fd9\u53ea\u6709\u4e00\u6761\u5185\u7f51\u7684\u8def\u7531\u4fe1\u606f\uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u5c1d\u8bd5<code>ping 8.8.8.8</code>\u7684\u65f6\u5019\uff0c\u4f1a\u63d0\u793a\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3002</p> <p>\u6dfb\u52a0\u4e00\u6761\u9ed8\u8ba4\u7684\u8def\u7531\u4fe1\u606f\uff0c\u5c06\u8def\u7531\u6d41\u91cf\u6307\u5411\u5bbf\u4e3b\u673a\u7684<code>veth1</code>\uff0c\u5373<code>10.0.3.1</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ip route add default via 10.0.3.1 dev veth0\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ip route\ndefault via 10.0.3.1 dev veth0\n10.0.3.0/24 dev veth0 proto kernel scope link src 10.0.3.3\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5728\u6dfb\u52a0\u5b8c\u6bd5\u540e\uff0c\u5c1d\u8bd5\u5728\u5bb9\u5668\u4e2d<code>ping</code>\u4e00\u4e0b<code>10.0.3.1</code>\u548c<code>8.8.8.8</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ping 10.0.3.1 -c 4\nPING 10.0.3.1 (10.0.3.1) 56(84) bytes of data.\n64 bytes from 10.0.3.1: icmp_seq=1 ttl=64 time=0.018 ms\n64 bytes from 10.0.3.1: icmp_seq=2 ttl=64 time=0.030 ms\n64 bytes from 10.0.3.1: icmp_seq=3 ttl=64 time=0.053 ms\n64 bytes from 10.0.3.1: icmp_seq=4 ttl=64 time=0.033 ms\n\n--- 10.0.3.1 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3079ms\nrtt min/avg/max/mdev = 0.018/0.033/0.053/0.012 ms\n(unshare) [root@ubuntu]:[~][tty:0]# ping 8.8.8.8 -c 3\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2082ms\n\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5728<code>ping 8.8.8.8</code>\u7684\u65f6\u5019\u53d1\u73b0\u4e0d\u4f1a\u63d0\u793a\u7f51\u7edc\u4e0d\u53ef\u8fbe\u4e86\uff0c\u800c\u662f\u6709\u5728\u5c1d\u8bd5\u7684\u53d1\u9001<code>ping</code>\u6570\u636e\u5305\uff0c\u53ea\u662f\u90fd\u6ca1\u56de\u6765\u800c\u5df2\u3002</p> <p>\u6b64\u65f6\uff0c\u82e5\u5728\u5bbf\u4e3b\u673a\u6293\u53d6<code>veth1</code>\u7684\u62a5\u6587\u5305\uff0c\u53ea\u80fd\u6536\u5230\u51fa\u53bb\u7684\u5305\uff0c\u6536\u4e0d\u5230\u56de\u590d\u7684\u5305\uff0c\u62a5\u6587\u5982\u4e0b\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:1]# tcpdump -i veth1 -S -s0\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on veth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n07:50:05.432638 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 33, seq 1, length 64\n07:50:06.445881 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 33, seq 2, length 64\n07:50:07.469864 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 33, seq 3, length 64\n\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a\u5bbf\u4e3b\u673a\u5e76\u672a\u5f00\u542f\u8f6c\u53d1\uff0c\u9700\u8981\u6765\u8bbe\u7f6e\u4e00\u4e0b\u5bbf\u4e3b\u673a\u8f6c\u53d1\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u5148\u5141\u8bb8\u5185\u6838\u8fdb\u884c<code>IP</code>\u8f6c\u53d1\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:2]# sysctl net.ipv4.conf.all.forwarding=1\nnet.ipv4.conf.all.forwarding = 1\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u800c\u540e\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a<code>nat</code>\u89c4\u5219\uff0c\u5c06\u5bb9\u5668\u4e0a\u6765\u7684\u6570\u636e\u5305\uff0c\u4fee\u6539\u4e3a\u5bbf\u4e3b\u673a\u81ea\u8eab\u7684\uff0c\u4ece\u800c\u8fdb\u884c\u8bf7\u6c42\uff0c\u62a5\u6587\u56de\u590d\u540e\uff0c\u518d\u8fdb\u884c<code>nat</code>\u8f6c\u53d1\uff0c\u5e76\u4e14\u53d1\u9001\u7ed9\u5bb9\u5668\uff0c\u89c4\u5219\u5982\u4e0b\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:2]# iptables -t nat -A POSTROUTING -s 10.0.3.0/24 -j MASQUERADE\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u4e0a\u9762\u89c4\u5219\u7684\u542b\u4e49\u662f\u5c06\u5730\u5740\u8303\u56f4\u4e3a<code>10.0.3.0/24</code>\u4e14\u4e3a\u51fa\u7ad9\u6d41\u91cf\u8fdb\u884c\u8f6c\u53d1\uff0c\u5e76\u4e14\u8fdb\u884c\u5730\u5740\u8f6c\u6362\u3002</p> <p>\u6dfb\u52a0\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# iptables -t nat -L -n\nChain PREROUTING (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain INPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination\n\nChain POSTROUTING (policy ACCEPT)\ntarget     prot opt source               destination\nMASQUERADE  0    --  10.0.3.0/24          0.0.0.0/0\n[root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u518d\u6b21\u5207\u6362\u5230\u5bb9\u5668\u4e2d\uff0c\u5c1d\u8bd5<code>ping 8.8.8.8</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:0]# ping 8.8.8.8 -c 3\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=54 time=34.1 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=54 time=33.6 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=54 time=33.7 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2002ms\nrtt min/avg/max/mdev = 33.565/33.763/34.075/0.222 ms\n(unshare) [root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u82e5\u5728\u5bbf\u4e3b\u673a\u5bf9<code>veth1</code>\u8fdb\u884c\u6293\u5305\u7684\u8bdd\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u62a5\u6587\u3002</p> <pre><code>[root@ubuntu]:[~][tty:1]# tcpdump -i veth1 -S -s0\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on veth1, link-type EN10MB (Ethernet), snapshot length 262144 bytes\n08:14:59.339542 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 34, seq 1, length 64\n08:14:59.373604 IP dns.google &gt; 10.0.3.3: ICMP echo reply, id 34, seq 1, length 64\n08:15:00.340879 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 34, seq 2, length 64\n08:15:00.374420 IP dns.google &gt; 10.0.3.3: ICMP echo reply, id 34, seq 2, length 64\n08:15:01.341874 IP 10.0.3.3 &gt; dns.google: ICMP echo request, id 34, seq 3, length 64\n08:15:01.375502 IP dns.google &gt; 10.0.3.3: ICMP echo reply, id 34, seq 3, length 64\n</code></pre> <p>\u81f3\u6b64\uff0c\u8ba9\u5bb9\u5668\u8fde\u4e0a\u7f51\u5c31\u8fbe\u6210\u4e86\u3002</p>"},{"location":"2024/11/14/container-network.html#_6","title":"\u603b\u7ed3","text":"<p><code>veth</code>\u662f<code>Linux</code>\u4e2d\u7684\u865a\u62df\u7f51\u5361\uff0c\u662f\u6210\u5bf9\u51fa\u73b0\u7684\uff0c\u4f60\u53ef\u4ee5\u5c06\u5176\u7406\u89e3\u4e3a\u201c\u7f51\u7ebf\u201d\uff0c\u5c06<code>veth</code>\u76842\u7aef\u5206\u522b\u63a5\u51652\u4e2a\u5bb9\u5668\u7684\u8bdd\uff0c\u5f53\u524d\u53ef\u4ee5\u5b9e\u73b0\u5bb9\u5668\u7684\u4e92\u76f8\u901a\u4fe1\uff0c\u4e5f\u53ef\u4ee5\u5c06\u5176\u4e00\u7aef\u653e\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u4e00\u7aef\u63a5\u5165\u4e00\u4e2a\u5bb9\u5668\u4e2d\uff0c\u5728\u5bbf\u4e3b\u673a\u4e0a\u8fdb\u884c<code>nat</code>\u8f6c\u53d1\u8bbe\u7f6e\uff0c\u8ba9\u5bb9\u5668\u80fd\u591f\u548c\u5916\u90e8\u7f51\u7edc\u8fdb\u884c\u901a\u4fe1\u3002</p> <p><code>veth</code>\u7684\u5f0a\u7aef\u4e5f\u6709\uff0c\u53ea\u80fd\u7b80\u5355\u7684\u8fde\u63a52\u4e2a\u8bbe\u5907\uff0c\u5f53\u9700\u8981\u4e00\u4e2a\u591a\u8bbe\u5907\u7684\u7f51\u7edc\u7684\u65f6\u5019\uff0c<code>veth</code>\u5904\u7406\u8d77\u6765\u4f1a\u53d8\u5f97\u5f02\u5e38\u68d8\uff0c\u597d\u5728<code>Linux</code>\u63d0\u4f9b\u4e86\u865a\u62df\u7f51\u6865<code>bridge</code>\uff0c\u5f53\u7136\u8fd9\u662f\u540e\u8bdd\u4e86\u3002</p> <p>\u60f3\u8981\u7ee7\u7eed\u5199<code>bridge</code>\uff0c\u4f46\u662f\u5b9e\u73b0\u592a\u665a\u4e86\uff0c\u5c31\u8fd9\u6837\u5427\uff0c\u4ee5\u540e\u6709\u65f6\u95f4\u518d\u8bf4\u3002</p>"},{"location":"2024/11/17/gpg_usage.html","title":"<code>gpg</code>\u7b80\u5355\u7528\u6cd5","text":"<p>\u672c\u6587\u5c06\u7b80\u5355\u4ecb\u7ecd<code>gpg</code>\u7b80\u5355\u7528\u6cd5\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#gpg_1","title":"\u4ec0\u4e48\u662f<code>GPG</code>","text":"<p>\u7528\u4e00\u53e5\u8bdd\u603b\u7ed3\u7684\u8bdd\uff0c\u5c31\u662f<code>GPG</code>\u662f<code>GNU</code>\u4f17\u591a\u9879\u76ee\u4e2d\u7684\u4e00\u9879\uff0c\u4f5c\u7528\u662f\u4e3a<code>PGP</code>\u63d0\u4f9b\u4e00\u4e2a\u514d\u8d39\u7684\u5f00\u6e90\u66ff\u4ee3\uff0c\u5e76\u4e14\u5b8c\u5168\u517c\u5bb9<code>PGP</code>\uff08<code>PGP</code>\u662f\u4e00\u6b3e\u5546\u4e1a\u8f6f\u4ef6\uff09\u3002</p> <p><code>GPG</code>\u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u52a0\u5bc6\u8f6f\u4ef6\uff0c\u63d0\u4f9b\u4e86\u52a0\u5bc6\u3001\u89e3\u5bc6\u3001\u7b7e\u540d\u7b49\u4f17\u591a\u529f\u80fd\uff0c\u7528\u4e8e\u786e\u4fdd\u6570\u636e\u5b89\u5168\u3001\u5b8c\u6574\u6027\u4ee5\u53ca\u8eab\u4efd\u8ba4\u8bc1\u3002</p> <p>\u5728<code>GPG</code>\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u9700\u8981\u751f\u6210\u4e00\u5bf9\u79d8\u94a5\uff0c\u5206\u522b\u662f\u516c\u94a5\u548c\u79c1\u94a5\u3002</p> <ul> <li>\u516c\u94a5\u7528\u4e8e \u52a0\u5bc6\u6570\u636e \u4ee5\u53ca \u7b7e\u540d\u9a8c\u8bc1\uff0c\u516c\u94a5\u53ef\u4ee5\u516c\u5f00\uff0c\u5e76\u4e14\u5206\u53d1\u51fa\u53bb\u3002</li> <li>\u79c1\u94a5\u7528\u4e8e \u89e3\u5bc6\u6570\u636e \u4ee5\u53ca \u7b7e\u540d\uff0c\u79c1\u94a5\u9700\u8981\u59a5\u5584\u4fdd\u7ba1\u3002</li> </ul> <p>\u5bf9\u4e8e\u52a0\u5bc6\u548c\u89e3\u5bc6\u7684\u60c5\u51b5\uff0c\u4f7f\u7528\u5bf9\u5e94\u7684\u516c\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u5bf9\u4e8e\u52a0\u5bc6\u540e\u7684\u6570\u636e\uff0c\u53ea\u80fd\u4f7f\u7528\u5bf9\u5e94\u79c1\u94a5\u8fdb\u884c\u89e3\u5bc6\u3002</p> <p>\u5bf9\u4e8e\u7b7e\u540d\u548c\u9a8c\u8bc1\uff0c\u4f7f\u7528\u79c1\u94a5\u6765\u8fdb\u884c\u7b7e\u540d\uff0c\u4f7f\u7528\u516c\u94a5\u6765\u8fdb\u884c\u7b7e\u540d\u9a8c\u8bc1\uff0c\u786e\u4fdd\u6d88\u606f\u5e76\u65e0\u4fee\u6539\u3002</p> <p>\u76ee\u524d<code>gpg</code>\u5df2\u7ecf\u6709\u4e86<code>2.*</code>\u7248\u672c\uff0c\u5728<code>1.*</code>\u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u91cd\u5927\u6539\u8fdb\uff0c\u4f46\u662f\u5b8c\u5168\u5efa\u8bae<code>1.*</code>\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#gpg2","title":"\u5b89\u88c5<code>gpg2</code>","text":"<p>\u5728<code>ubuntu</code>\u7cfb\u7edf\u4e2d\uff0c\u76f4\u63a5\u4f7f\u7528<code>apt</code>\u5b89\u88c5\u5373\u53ef\u3002</p> <pre><code>[root@ubuntu]:[~][tty:1]# apt-get install gnupg2\n</code></pre> <p>\u5728<code>centos</code>\u7cfb\u7edf\u91cd\uff0c\u76f4\u63a5\u4f7f\u7528<code>yum</code>\u6216\u8005<code>dnf</code>\u5b89\u88c5\u5373\u53ef\u3002</p> <pre><code>[root@centosServer ~]# yum install gnupg2\n</code></pre>"},{"location":"2024/11/17/gpg_usage.html#_1","title":"\u79d8\u94a5\u7684\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"2024/11/17/gpg_usage.html#_2","title":"\u751f\u6210\u79d8\u94a5","text":"<p>\u4f7f\u7528<code>gpg2 --full-generate-key</code>\u5373\u53ef\u5f00\u59cb\u751f\u6210<code>key</code></p> <pre><code>[root@debian]:[~][tty:0]#  gpg2 --full-generate-key\ngpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbH\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\nPlease select what kind of key you want:\n   (1) RSA and RSA (default)\n   (2) DSA and Elgamal\n   (3) DSA (sign only)\n   (4) RSA (sign only)\n  (14) Existing key from card\nYour selection? 1\nRSA keys may be between 1024 and 4096 bits long.\nWhat keysize do you want? (3072) 4096\nRequested keysize is 4096 bits\nPlease specify how long the key should be valid.\n         0 = key does not expire\n      &lt;n&gt;  = key expires in n days\n      &lt;n&gt;w = key expires in n weeks\n      &lt;n&gt;m = key expires in n months\n      &lt;n&gt;y = key expires in n years\nKey is valid for? (0) 1y\nKey expires at Sun 16 Nov 2025 08:03:27 PM CST\nIs this correct? (y/N) y\n\nGnuPG needs to construct a user ID to identify your key.\n\nReal name: gpguser\nEmail address: gpguser@localhost.com\nComment: gpg test \nYou selected this USER-ID:\n    \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\"\n\nChange (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? o\n</code></pre> <p>\u5177\u4f53\u751f\u6210\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li><code>gpg</code>\u63d0\u4f9b\u4e86\u591a\u79cd\u79d8\u94a5\u7c7b\u578b\uff0c\u9009\u62e9\u9009\u62e9\uff0c\u9ed8\u8ba4\u4e3a<code>RSA and RSA</code>\uff0c\u5982\u679c\u9700\u8981\u9009\u62e9\u5176\u4ed6\u7684\uff0c\u76f4\u63a5\u8f93\u5165\u5bf9\u5e94\u7684\u5e8f\u53f7\u5373\u53ef\u3002</li> <li>\u9009\u62e9\u79d8\u94a5\u5927\u5c0f\uff0c\u79d8\u94a5\u8d8a\u957f\uff0c\u4f1a\u8d8a\u5b89\u5168\uff0c\u76f8\u5e94\u7684\uff0c\u89e3\u5bc6\u65f6\u95f4\u4e5f\u4f1a\u8d8a\u957f\uff0c\u63a8\u8350\u9009\u62e9<code>4096</code>\u4f4d\u3002</li> <li>\u9009\u62e9\u8fc7\u671f\u7684\u65f6\u95f4\uff0c\u5982\u679c\u6c38\u4e0d\u8fc7\u671f\uff0c\u5219\u8f93\u51650\uff0c\u53cd\u6b63\u53ef\u4ee5\u8f93\u5165 \u5929\u3001\u5468\u3001\u6708\u3001\u5e74 \u7b49\u3002\u8fd9\u91cc\u8f93\u5165\u7684\u662f1\u5e74\uff0c\u5373\uff0c<code>1y</code>\uff0c\u8f93\u5165\u5b8c\u6bd5\u540e\uff0c\u9700\u8981\u8fdb\u884c\u4e8c\u6b21\u786e\u8ba4\u3002</li> <li>\u8f93\u5165\u7528\u6237\u7684\u4fe1\u606f\uff0c\u5305\u62ec\u540d\u5b57\u3001\u90ae\u7bb1 \u5df2\u7ecf\u5907\u6ce8\u7b49\u540c\u6837\u9700\u8981\u4e8c\u6b21\u786e\u8ba4\u3002</li> <li>\u6700\u540e\u4f1a\u63d0\u793a\u8f93\u5165\u79d8\u94a5\u7684\u5bc6\u7801\uff0c\u8be5\u5bc6\u7801\u662f\u7528\u4e8e\u4fdd\u62a4\u79d8\u94a5\u7684\u5b89\u5168\u6027\u7684\u3002</li> </ul> <p>\u5982\u679c\u8f93\u5165\u5bc6\u7801\u540e\uff0c\u7ec8\u7aef\u6709\u95ee\u9898\uff0c\u53ef\u4ee5\u4f7f\u7528<code>reset</code>\u547d\u4ee4\u8fdb\u884c\u91cd\u7f6e\u3002</p> <p>\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u4f1a\u8f93\u51fa\u7c7b\u4f3c\u5982\u4e0b\u521b\u5efa\u6210\u529f\u7684\u4fe1\u606f\u63d0\u793a\uff0c\u5e76\u4e14\u4f1a\u6807\u6ce8\u521b\u5efa\u7684<code>key</code>\u3002</p> <pre><code>We need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\nWe need to generate a lot of random bytes. It is a good idea to perform\nsome other action (type on the keyboard, move the mouse, utilize the\ndisks) during the prime generation; this gives the random number\ngenerator a better chance to gain enough entropy.\ngpg: revocation certificate stored as '/root/.gnupg/openpgp-revocs.d/3678F2332D0A0475A47125050ABA3F7577773A8F.rev'\npublic and secret key created and signed.\n\npub   rsa4096 2024-11-16 [SC] [expires: 2025-11-16]\n      3678F2332D0A0475A47125050ABA3F7577773A8F\nuid                      gpguser (gpg test) &lt;gpguser@localhost.com&gt;\nsub   rsa4096 2024-11-16 [E] [expires: 2025-11-16]\n</code></pre> <p>\u5982\u4f55\uff0c\u8be5<code>gpg</code>\u7b7e\u540d\u4e3a<code>3678F2332D0A0475A47125050ABA3F7577773A8F</code>\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_3","title":"\u67e5\u770b\u79d8\u94a5","text":"<p>\u4f7f\u7528<code>--list-keys</code>\u53c2\u6570\u53ef\u4ee5\u67e5\u770b\u516c\u94a5\u7684\u4fe1\u606f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# gpg2 --list-keys\ngpg: checking the trustdb\ngpg: marginals needed: 3  completes needed: 1  trust model: pgp\ngpg: depth: 0  valid:   1  signed:   0  trust: 0-, 0q, 0n, 0m, 0f, 1u\ngpg: next trustdb check due at 2025-11-16\n/root/.gnupg/pubring.kbx\n------------------------\npub   rsa2048 2024-11-16 [SC] [expires: 2025-11-16]\n      3678F2332D0A0475A47125050ABA3F7577773A8F\nuid           [ultimate] gpguser (gpg test) &lt;gpguser@localhost.com&gt;\nsub   rsa2048 2024-11-16 [E] [expires: 2025-11-16]\n\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u5176\u4e2d<code>C57CF88588C503F6B6BFD0802A75FE471D0D8313</code>\u5c31\u662f\u6211\u4eec\u7684\u7b7e\u540d\u3002</p> <p>\u540c\u6837\u7684\uff0c\u4f7f\u7528<code>--list-secert-keys</code>\u53c2\u6570\u4e5f\u53ef\u4ee5\u67e5\u770b\u79c1\u94a5\u7684\u4fe1\u606f\u3002</p> <p>\u5176\u4e2d\uff0c<code>3678F2332D0A0475A47125050ABA3F7577773A8F</code>\u4e5f\u662f\u79c1\u94a5\u7684\u7b7e\u540d\u54e6\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_4","title":"\u5bfc\u51fa\u79d8\u94a5","text":"<p>\u5bfc\u51fa\u516c\u94a5\uff1a</p> <p>\u5728\u67e5\u8be2\u5230\u79d8\u94a5\u7684<code>id</code>\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>--export</code>\u5bfc\u51fa\u516c\u94a5\uff0c\u5176\u4e2d<code>--armor</code>\u662f\u4ee5<code>ascii</code>\u683c\u5f0f\u5bfc\u51fa\uff0c\u65b9\u4fbf\u5171\u4eab\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --armor --export 3678F2332D0A0475A47125050ABA3F7577773A8F &gt; public.key\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u5982\u4e0a\uff0c\u4f1a\u5c06<code>3678F2332D0A0475A47125050ABA3F7577773A8F</code>\u7684\u516c\u94a5\u91cd\u5b9a\u5411\u5230<code>public.key</code>\u6587\u4ef6\u4e2d\u3002</p> <p>\u5bfc\u51fa\u79c1\u94a5\uff1a</p> <p>\u5728\u67e5\u8be2\u5230\u79d8\u94a5<code>id</code>\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>--export-secret-keys</code>\u5bfc\u51fa\u79c1\u94a5\uff0c\u5bfc\u51fa\u65f6\u4f1a\u8981\u6c42\u8f93\u5165\u5bc6\u7801\uff0c\u79c1\u94a5\u8981\u975e\u5e38\u59a5\u5584\u4fdd\u7ba1\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --armor --export-secret-keys 3678F2332D0A0475A47125050ABA3F7577773A8F &gt; private.key\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u5982\u4e0a\uff0c\u4f1a\u5c06<code>3678F2332D0A0475A47125050ABA3F7577773A8F</code>\u7684\u79c1\u94a5\u5bfc\u51fa\u5230<code>private.key</code>\u6587\u4ef6\u4e2d\uff0c\u5982\u679c\u79c1\u94a5\u8bbe\u7f6e\u6709\u5bc6\u7801\uff0c\u518d\u5bfc\u5165\u7684\u65f6\u5019\u4f1a\u63d0\u793a\u9a8c\u8bc1\u5bc6\u7801\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_5","title":"\u5bfc\u5165\u79d8\u94a5","text":"<p>\u5bfc\u5165\u516c\u94a5 \u548c \u5bfc\u5165\u79c1\u94a5 \u7684\u65b9\u6cd5\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u4f7f\u7528<code>gpg2 --import</code>\u8fdb\u884c\u5bfc\u5165\u5373\u53ef\u3002</p> <p>\u9996\u5148\u67e5\u770b\u672c\u5730\u7684\u516c\u94a5\u3002</p> <pre><code># gpg2 --list-keys\n#\n</code></pre> <p>\u5bfc\u5165\u516c\u94a5\uff0c\u516c\u94a5\u8bb0\u5f55\u5728\u672c\u5730\u7684<code>public-key.asc</code>\u4e2d\u3002</p> <pre><code># gpg2 --import public.key \ngpg: key 0ABA3F7577773A8F: public key \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\" imported\ngpg: Total number processed: 1\ngpg:               imported: 1\n# \n</code></pre> <p>\u6b64\u65f6\u518d\u67e5\u8be2\u4e00\u4e0b\u672c\u5730\u7684\u516c\u94a5\u3002</p> <pre><code># gpg2 --list-keys\ngpg: checking the trustdb\ngpg: no ultimately trusted keys found\n/root/.gnupg/pubring.kbx\n------------------------\npub   rsa4096 2024-11-16 [SC] [expires: 2025-11-16]\n      3678F2332D0A0475A47125050ABA3F7577773A8F\nuid           [ unknown] gpguser (gpg test) &lt;gpguser@localhost.com&gt;\nsub   rsa4096 2024-11-16 [E] [expires: 2025-11-16]\n\n# \n</code></pre> <p>\u518d\u6765\u67e5\u770b\u4e0b\u672c\u5730\u7684\u79c1\u94a5\u3002</p> <pre><code>root@DESKTOP-CU66GL1:~# gpg2 --list-secret-keys\nroot@DESKTOP-CU66GL1:~#\n</code></pre> <p>\u5bfc\u5165\u79c1\u94a5\uff0c\u79c1\u94a5\u8bb0\u5f55\u5728\u672c\u5730\u7684<code>private-key.asc</code>\u4e2d\u3002</p> <pre><code># gpg2 --import private.key \ngpg: key 0ABA3F7577773A8F: \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\" not changed\ngpg: key 0ABA3F7577773A8F: secret key imported\ngpg: Total number processed: 1\ngpg:              unchanged: 1\ngpg:       secret keys read: 1\ngpg:   secret keys imported: 1\n# \n</code></pre> <p>\u540c\u6837\u7684\uff0c\u5728\u5bfc\u5165\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u8ba9\u6211\u4eec\u9a8c\u8bc1\u79c1\u94a5\u7684\u5bc6\u7801\uff0c\u5bc6\u7801\u6b63\u786e\u540e\uff0c\u624d\u53ef\u88ab\u5bfc\u5165\u3002</p> <p>\u518d\u6b21\u67e5\u770b\u79c1\u94a5\u3002</p> <pre><code># gpg2 --list-secret-keys\n/root/.gnupg/pubring.kbx\n------------------------\nsec   rsa4096 2024-11-16 [SC] [expires: 2025-11-16]\n      3678F2332D0A0475A47125050ABA3F7577773A8F\nuid           [ unknown] gpguser (gpg test) &lt;gpguser@localhost.com&gt;\nssb   rsa4096 2024-11-16 [E] [expires: 2025-11-16]\n\n# \n</code></pre>"},{"location":"2024/11/17/gpg_usage.html#_6","title":"\u5220\u9664\u5bc6\u94a5","text":"<p>\u4f7f\u7528<code>--delete-keys</code>\u53ef\u4ee5\u5220\u9664\u516c\u94a5\uff0c\u8bf7\u6ce8\u610f\uff0c\u5f53\u4f60\u89c6\u56fe\u5220\u9664\u6389\u7684\u516c\u94a5\u4ecd\u6709\u5bf9\u5e94\u7684\u79c1\u94a5\u7684\u65f6\u5019\uff0c\u9700\u8981\u5148\u5220\u9664\u79c1\u94a5\uff0c\u624d\u80fd\u5220\u9664\u516c\u94a5\u3002</p> <p>\u5220\u9664\u516c\u94a5\u62a5\u9519\uff0c\u63d0\u793a\u6709\u5bf9\u5e94\u7684\u79c1\u94a5\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --delete-keys 3678F2332D0A0475A47125050ABA3F7577773A8F\ngpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbH\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\ngpg: there is a secret key for public key \"3678F2332D0A0475A47125050ABA3F7577773A8F\"!\ngpg: use option \"--delete-secret-keys\" to delete it first.\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u5220\u9664\u79c1\u94a5\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528<code>--delete-secret-keys</code>\u5220\u9664\u79c1\u94a5\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --delete-secret-keys 3678F2332D0A0475A47125050ABA3F7577773A8F\ngpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbH\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\n\nsec  rsa4096/0ABA3F7577773A8F 2024-11-16 gpguser (gpg test) &lt;gpguser@localhost.com&gt;\n\nDelete this key from the keyring? (y/N) y\nThis is a secret key! - really delete? (y/N) y\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u5728\u5220\u9664\u79c1\u94a5\u7684\u65f6\u5019\uff0c\u4f1a\u4e8c\u6b21\u786e\u8ba4\u662f\u5426\u8fdb\u884c\u5220\u9664\u3002</p> <p>\u5728\u5220\u9664\u79c1\u94a5\u540e\uff0c\u5c31\u53ef\u4ee5\u5220\u9664\u516c\u94a5\u4e86\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --delete-keys 3678F2332D0A0475A47125050ABA3F7577773A8F\ngpg (GnuPG) 2.2.40; Copyright (C) 2022 g10 Code GmbH\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n\n\npub  rsa4096/0ABA3F7577773A8F 2024-11-16 gpguser (gpg test) &lt;gpguser@localhost.com&gt;\n\nDelete this key from the keyring? (y/N) y\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u6b64\u65f6\uff0c\u518d\u6765\u67e5\u770b\u516c\u94a5\u548c\u79c1\u94a5\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --list-keys\n[root@debian]:[~][tty:0]# \n[root@debian]:[~][tty:0]# gpg2 --list-secret-keys\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u5f53\u7136\uff0c\u4e3a\u4e86\u4e0b\u9762\u7684\u6d4b\u8bd5\uff0c\u6700\u597d\u662f\u5c06\u79d8\u94a5\u91cd\u65b0\u5bfc\u5165\u56de\u53bb\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_7","title":"\u5185\u5bb9\u7684\u52a0\u5bc6\u548c\u89e3\u5bc6","text":""},{"location":"2024/11/17/gpg_usage.html#_8","title":"\u4f7f\u7528\u516c\u94a5\u8fdb\u884c\u52a0\u5bc6\u6587\u4ef6","text":"<p>\u4f7f\u7528\u516c\u94a5\u52a0\u5bc6\u6587\u4ef6\u6216\u8005\u5185\u5bb9\u3002</p> <p>\u76f4\u63a5\u52a0\u5bc6\u5b57\u7b26\u3002</p> <pre><code>[root@debian]:[~][tty:0]# echo \"hello world\" | gpg2 --armor --encrypt --recipient 3678F2332D0A0475A47125050ABA3F7577773A8F &gt; encrypt_msg.asc\ngpg: D67F66F29079D8A1: There is no assurance this key belongs to the named user\n\nsub  rsa4096/D67F66F29079D8A1 2024-11-16 gpguser (gpg test) &lt;gpguser@localhost.com&gt;\n Primary key fingerprint: 3678 F233 2D0A 0475 A471  2505 0ABA 3F75 7777 3A8F\n      Subkey fingerprint: CFBD 3066 E074 10FC EBA1  FF50 D67F 66F2 9079 D8A1\n\nIt is NOT certain that the key belongs to the person named\nin the user ID.  If you *really* know what you are doing,\nyou may answer the next question with yes.\n\nUse this key anyway? (y/N) y\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\uff0c\u4f7f\u7528<code>echo</code>\u8f93\u51fa<code>hello world</code>\uff0c\u5e76\u4e14\u901a\u8fc7\u7ba1\u9053\uff0c\u4f7f\u7528<code>gpg2</code>\u8fdb\u884c\u52a0\u5bc6\uff0c\u5176\u4e2d<code>--armor</code>\u8868\u793a\u4f7f\u7528<code>ascii</code>\u7801\u8f93\u51fa\u3001<code>--encrypt</code>\u8868\u793a\u52a0\u5bc6\u64cd\u4f5c\uff0c<code>--recipient keyid</code>\u8868\u793a\u4f7f\u7528\u54ea\u516c\u94a5\u8fdb\u884c\u52a0\u5bc6\uff0c\u6700\u540e\u91cd\u5b9a\u5411\u5230<code>encrypt_msg.asc</code>\u4e2d\u3002</p> <p>\u540c\u6837\u7684\uff0c\u5982\u679c\u662f\u6587\u4ef6\u7684\u8bdd\uff0c\u76f4\u63a5\u5728\u540e\u9762\u8ddf\u6587\u4ef6\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@debian]:[~][tty:0]# echo \"hello world2\" &gt;&gt; file.txt\n[root@debian]:[~][tty:0]# gpg2 --armor --encrypt --recipient 3678F2332D0A0475A47125050ABA3F7577773A8F file.txt\ngpg: D67F66F29079D8A1: There is no assurance this key belongs to the named user\n\nsub  rsa4096/D67F66F29079D8A1 2024-11-16 gpguser (gpg test) &lt;gpguser@localhost.com&gt;\n Primary key fingerprint: 3678 F233 2D0A 0475 A471  2505 0ABA 3F75 7777 3A8F\n      Subkey fingerprint: CFBD 3066 E074 10FC EBA1  FF50 D67F 66F2 9079 D8A1\n\nIt is NOT certain that the key belongs to the person named\nin the user ID.  If you *really* know what you are doing,\nyou may answer the next question with yes.\n\nUse this key anyway? (y/N) y\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u52a0\u5bc6\u7684\u6587\u4ef6\u4f1a\u4ee5<code>&lt;filename&gt;.asc</code>\u5b58\u5728\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_9","title":"\u4f7f\u7528\u79c1\u94a5\u8fdb\u884c\u89e3\u5bc6\u6587\u4ef6","text":"<p>\u4f7f\u7528<code>--decrypt</code>\u9009\u9879\u5373\u53ef\u89e3\u5bc6\u6587\u4ef6\uff0c\u8fd8\u53ef\u4ee5\u8f93\u51fa\u5230\u76f8\u5e94\u7684\u6587\u4ef6\u4e2d\u3002</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --output file.out --decrypt file.txt.asc\ngpg: encrypted with 4096-bit RSA key, ID D67F66F29079D8A1, created 2024-11-16\n      \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\"\n[root@debian]:[~][tty:0]# \n[root@debian]:[~][tty:0]# cat file.out\nhello world2\n[root@debian]:[~][tty:0]# \n</code></pre> <p>\u4f7f\u7528<code>--decrypt \u52a0\u5bc6\u5185\u5bb9</code>\u53ef\u4ee5\u89e3\u5bc6\u6587\u4ef6\uff0c\u4f7f\u7528<code>--output</code>\u53ef\u4ee5\u5c06\u6587\u4ef6\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_10","title":"\u7b7e\u540d\u4e0e\u9a8c\u8bc1","text":"<p><code>gpg</code>\u53ef\u4ee5\u5bf9\u6587\u4ef6\u548c\u6d88\u606f\u8fdb\u884c\u7b7e\u540d\uff0c\u4ee5\u786e\u4fdd\u6587\u4ef6\u6216\u8005\u6d88\u606f\u7684\u5b8c\u6574\u6027\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_11","title":"\u5bf9\u6587\u4ef6\u8fdb\u884c\u7b7e\u540d","text":"<p>\u5bf9\u6587\u4ef6\u8fdb\u884c\u7b7e\u540d\uff0c\u4f7f\u7528<code>sign</code>\u5373\u53ef\u3002</p> <pre><code>[root@debian]:[~][tty:0]# echo 'sign_message' &gt; siginMessage\n[root@debian]:[~][tty:0]# gpg2 --armor --detach-sign siginMessage\n[root@debian]:[~][tty:0]# \n</code></pre> <p><code>--detach-sign</code>\uff1a\u8868\u793a\u5bf9\u6587\u4ef6\u5206\u79bb\u524d\u9762\u3002<code>--armor</code>\uff1a\u8868\u793a\u751f\u6210<code>ascii</code>\u5b57\u7b26\u3002</p> <p>\u9ed8\u8ba4\u751f\u6210\u7684\u7b7e\u540d\u6587\u4ef6\u4f1a\u88ab\u8bb0\u5f55\u5230<code>&lt;filename&gt;.asc</code>\u4e2d\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_12","title":"\u5bf9\u6d88\u606f\u8fdb\u884c\u7b7e\u540d","text":"<p>\u5982\u679c\u76f8\u5bf9\u6d88\u606f\u8fdb\u884c\u7b7e\u540d\uff0c\u4f7f\u7528<code>--clearsign</code>\u5373\u53ef\u3002</p> <pre><code>[root@debian]:[~][tty:0]# echo \"hello sign_message\" | gpg2 --armor --clearsign &gt; siginMessageHello.txt\n[root@debian]:[~][tty:0]# \n</code></pre> <p><code>--clearsign</code>\u8868\u793a\u5728\u4e0d\u52a0\u5bc6\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u7b7e\u540d\u5d4c\u5165\u5230\u6d88\u606f\u5185\u5bb9\u4e2d\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_13","title":"\u5bf9\u6587\u4ef6\u8fdb\u884c\u7b7e\u540d\u9a8c\u8bc1","text":"<p>\u5bf9\u4e8e\u5206\u79bb\u7b7e\u540d\uff0c\u4f7f\u7528<code>--verify \u7b7e\u540d\u6587\u4ef6 \u539f\u59cb\u6587\u4ef6</code> \u8fdb\u884c\u6821\u9a8c\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --verify siginMessage.asc siginMessage\ngpg: Signature made Sat 16 Nov 2024 08:17:54 PM CST\ngpg:                using RSA key 3678F2332D0A0475A47125050ABA3F7577773A8F\ngpg: Good signature from \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\" [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: 3678 F233 2D0A 0475 A471  2505 0ABA 3F75 7777 3A8F\n[root@debian]:[~][tty:0]# \n</code></pre>"},{"location":"2024/11/17/gpg_usage.html#_14","title":"\u5bf9\u6d88\u606f\u8fdb\u884c\u7b7e\u540d\u9a8c\u8bc1","text":"<p>\u5bf9\u4e8e\u6d88\u606f\u7b7e\u540d\uff0c\u76f4\u63a5\u8fdb\u884c\u6821\u9a8c\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@debian]:[~][tty:0]# gpg2 --verify siginMessageHello.txt\ngpg: Signature made Sat 16 Nov 2024 08:19:08 PM CST\ngpg:                using RSA key 3678F2332D0A0475A47125050ABA3F7577773A8F\ngpg: Good signature from \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\" [unknown]\ngpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\nPrimary key fingerprint: 3678 F233 2D0A 0475 A471  2505 0ABA 3F75 7777 3A8F\n[root@debian]:[~][tty:0]# \n</code></pre>"},{"location":"2024/11/17/gpg_usage.html#_15","title":"\u5bf9\u7b7e\u540d\u8f93\u51fa\u7684\u89e3\u8bfb","text":"<p>\u4e0a\u9762\u524d\u9762\u7684\u610f\u601d\u5206\u89e3\u4e00\u4e0b\uff0c\u53ef\u4ee5\u6574\u7406\u4e3a\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>gpg: Signature made Sat 16 Nov 2024 08:19:08 PM CST\ngpg:                using RSA key 3678F2332D0A0475A47125050ABA3F7577773A8F\n</code></pre> <p>\u8868\u660e\u662f\u5728\u4ec0\u4e48\u65f6\u5019\u8fdb\u884c\u7b7e\u540d\uff0c\u5e76\u4e14\u901a\u8fc7\u54ea\u4e2a\u79d8\u94a5\u8fdb\u884c\u7b7e\u540d\u7684\u3002</p> <pre><code>gpg: Good signature from \"gpguser (gpg test) &lt;gpguser@localhost.com&gt;\" [unknown]\n</code></pre> <p>\u8868\u660e\u8bc6\u522b\u5230\u4e86\u7b7e\u540d\u8005\u7684\u4fe1\u606f\uff0c\u540e\u9762\u7684<code>unknown</code>\u8868\u793a<code>GPG</code>\u4e0d\u77e5\u9053\u662f\u5426\u4fe1\u4efb\u8fd9\u4e2a\u516c\u94a5\u3002</p> <pre><code>gpg: WARNING: This key is not certified with a trusted signature!\ngpg:          There is no indication that the signature belongs to the owner.\n</code></pre> <p>\u8fd9\u662f\u4e00\u6761\u8b66\u544a\u4fe1\u606f\uff0c\u8868\u793a<code>GPG</code>\u6ca1\u6709\u6536\u5230\u5173\u4e8e\u5982\u4e0a\u516c\u94a5\u7684\u4fe1\u4efb\u8ba4\u8bc1\uff0c</p> <pre><code>Primary key fingerprint: 3678 F233 2D0A 0475 A471  2505 0ABA 3F75 7777 3A8F\n</code></pre> <p>\u8868\u793a\u7b7e\u540d\u8005\u7684\u79d8\u94a5\u6307\u7eb9\u3002</p>"},{"location":"2024/11/17/gpg_usage.html#_16","title":"\u603b\u7ed3","text":"<p><code>gpg2</code>\u662f<code>gpg</code>\u7684\u5347\u7ea7\u7248\u672c\uff0c\u662f<code>pgp</code>\u7684\u5f00\u6e90\u66ff\u4ee3\u3002\u63d0\u4f9b\u4e86\u52a0\u5bc6\u3001\u7b7e\u540d\u7b49\u529f\u80fd\u3002\u5728\u4f7f\u7528<code>gpg</code>\u7684\u65f6\u5019\uff0c\u9700\u8981\u5148\u751f\u6210\u516c\u94a5\u548c\u79c1\u94a5\uff0c\u5c06\u516c\u94a5\u5f00\u653e\u51fa\u53bb\uff0c\u7528\u4e8e\u6570\u636e\u52a0\u5bc6\uff0c\u79c1\u94a5\u5219\u9700\u8981\u59a5\u5584\u4fdd\u7ba1\uff0c\u7528\u4ee5\u6570\u636e\u89e3\u5bc6\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html","title":"\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc-bridge","text":"<p>\u672c\u6587\u5c06\u7b80\u5355\u4e86\u89e3<code>Linux bridge</code>\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#linux-bridge","title":"\u4ec0\u4e48\u662f<code>Linux bridge</code>","text":"<p><code>Linux bridge</code>\u4e5f\u79f0\u4e3a<code>Linux</code>\u865a\u62df\u7f51\u6865\uff0c\u4e5f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u53f0\u865a\u62df\u7684\u7f51\u7edc\u4ea4\u6362\u673a\uff0c\u5b83\u662f\u4e00\u79cd\u94fe\u8def\u5c42\u8bbe\u5907\uff0c\u5141\u8bb8\u6839\u636e<code>MAC</code>\u5730\u5740\u5728\u7f51\u7edc\u4e4b\u95f4\u8f6c\u53d1\u6d41\u91cf\u3002\u6240\u4ee5\u5728<code>Linux</code>\u4e2d\u53ef\u4ee5\u7528\u5b83\u6765\u6a21\u62df\u7f51\u6865\u3002<code>bridge</code>\u4e0d\u4ec5\u5141\u8bb8\u865a\u62df\u8bbe\u5907\u63a5\u5165\uff0c\u8fd8\u652f\u6301\u7269\u7406\u8bbe\u5907\u63a5\u5165\u3002</p> <p>\u6b64\u524d\u5df2\u7ecf\u7b80\u5355\u4e86\u89e3\u4e86<code>veth</code>\u865a\u62df\u63a5\u53e3\u662f\u5982\u4f55\u901a\u4fe1\u7684\uff0c\u8fd9\u6b21\u6765\u4e86\u89e3\u4e0b<code>bridge</code>\u548c<code>veth</code>\u5982\u4f55\u914d\u5408\u4f7f\u7528\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#_1","title":"\u5b9e\u9a8c\u51c6\u5907","text":"<p>\u51c6\u59071\u4e2a<code>bridge</code>\u4fe1\u606f\u5206\u522b\u4e3a\uff1a</p> <p>bridge\u4fe1\u606f</p> <p><code>bridge</code>\uff1a<code>192.168.1.250/24</code></p> <p>\u51c6\u59073\u4e2a<code>veth</code>\uff0c\u4fe1\u606f\u5206\u522b\u4e3a\uff1a</p> <p>\u7b2c\u4e00\u5bf9<code>veth</code></p> <ul> <li><code>veth0</code>\u3001<code>veth1</code></li> <li><code>veth0</code>\uff1a<code>192.168.1.245/24</code></li> <li><code>veth1</code>\uff1a \u63a5\u5165<code>br0</code></li> </ul> <p>\u7b2c\u4e8c\u5bf9<code>veth</code></p> <ul> <li><code>veth2</code>\u3001<code>veth3</code></li> <li><code>veth2</code>\uff1a<code>192.168.1.246/24</code></li> <li><code>veth3</code>\uff1a \u63a5\u5165<code>br0</code></li> </ul> <p>\u7b2c\u4e09\u5bf9<code>veth</code></p> <ul> <li><code>veth4</code>\u3001<code>veth5</code></li> <li><code>veth4</code>\uff1a<code>192.168.1.247/24</code></li> <li><code>veth5</code>\uff1a \u63a5\u5165<code>br0</code></li> </ul> <p>\u800c\u540e\u518d\u5c06<code>veth0</code>\u3001<code>veth2</code>\u3001<code>veth4</code>\u5206\u522b\u653e\u5165\u4e0d\u540c\u7684<code>network namespace</code>\u4e2d\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#_2","title":"\u865a\u62df\u8bbe\u5907\u521b\u5efa","text":""},{"location":"2024/11/19/docker_network_bridge.html#bridge","title":"bridge\u521b\u5efa","text":"<p>\u4f7f\u7528<code>ip</code>\u547d\u4ee4\u6dfb\u52a0\u4e00\u4e2a<code>bridge</code>\u865a\u62df\u8bbe\u5907\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link add name br0 type bridge\n</code></pre> <p>\u5982\u4e0a\u6dfb\u52a0\u4e86<code>bridge</code>\uff0c\u540d\u79f0\u4e3a<code>br0</code>\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u67e5\u770b\u6240\u6709\u7684<code>bridge</code>\u865a\u62df\u8bbe\u5907\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.72cfbe81fc62       no\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth","title":"\u521b\u5efaveth","text":"<p>\u9996\u5148\u5728\u5bbf\u4e3b\u673a\u4e0a\u521b\u5efa3\u6761<code>veth</code>\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link add name veth0 type veth peer name veth1\n[root@ubuntu]:[~][tty:0]# ip link add name veth2 type veth peer name veth3\n[root@ubuntu]:[~][tty:0]# ip link add name veth4 type veth peer name veth5\n</code></pre> <p>\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u4f7f\u7528<code>ip link</code>\u53ef\u4ee5\u67e5\u8be2\u5230\u6240\u6709\u7684\u7f51\u5361\u4fe1\u606f\uff0c\u53ea\u9700\u8981\u5173\u6ce8<code>veth</code>\u7684\u5373\u53ef\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link\n......\n4: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 72:cf:be:81:fc:62 brd ff:ff:ff:ff:ff:ff\n5: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff\n6: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff\n7: veth3@veth2: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 52:6c:7b:57:b2:7b brd ff:ff:ff:ff:ff:ff\n8: veth2@veth3: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 9a:c0:ed:69:8c:4e brd ff:ff:ff:ff:ff:ff\n9: veth5@veth4: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether a2:c7:ea:83:fc:91 brd ff:ff:ff:ff:ff:ff\n10: veth4@veth5: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d2:a0:6a:c1:fe:80 brd ff:ff:ff:ff:ff:ff\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#3","title":"\u521b\u5efa3\u4e2a\u5bb9\u5668","text":"<p>\u4f7f\u7528<code>unshare</code>\u521b\u5efa\u4e09\u4e2a\u7b80\u5355\u7684\u5bb9\u5668\uff0c\u672c\u6b21\u521b\u5efa\u5c31\u4e0d\u6dfb\u52a0<code>pid namespace</code>\u4e86\uff0c\u514d\u5f97\u83b7\u53d6\u8fdb\u7a0b\u81ea\u8eab\u7684<code>pid</code>\u9ebb\u70e6\u3002</p> <p>\u521b\u5efa\u7b2c\u4e00\u4e2a\u5bb9\u5668\u3002</p> <pre><code>[root@ubuntu]:[~][tty:1]# unshare -m -u -n -i -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:1]# echo $$\n1349\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u8be5\u8fdb\u7a0b\u7684<code>pid</code>\u4e3a<code>1349</code>\u3002</p> <p>\u521b\u5efa\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u3002</p> <pre><code>[root@ubuntu]:[~][tty:2]# unshare -m -u -i -n -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:2]# echo $$\n1357\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u8be5\u8fdb\u7a0b\u7684<code>pid</code>\u4e3a<code>1357</code>\u3002</p> <p>\u521b\u5efa\u7b2c\u4e09\u4e2a\u5bb9\u5668\u3002</p> <pre><code>[root@ubuntu]:[~][tty:3]# unshare -m -u -i -n -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:3]# echo $$\n1365\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre> <p>\u8be5\u8fdb\u7a0b\u7684<code>pid</code>\u4e3a<code>1365</code>\u3002</p> <p>\u5982\u4e0a\u4f7f\u7528<code>unshare</code>\u521b\u5efa\u4e863\u4e2a\u201c\u5bb9\u5668\u201d\uff0c\u4f46\u662f\u6ca1\u6709\u4f7f\u7528<code>pid namespace</code>\uff0c\u4f5c\u7528\u662f\u4e3a\u4e86\u65b9\u4fbf\u67e5\u770b\u5176\u8fdb\u7a0b\u771f\u5b9e\u7684<code>pid</code>\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#veth_1","title":"\u5c06veth\u4e32\u8054\u8d77\u6765","text":"<p>\u4e0b\u9762\u5c06\u4f7f\u7528<code>veth</code>\u4e32\u8054\u8d77\u6765<code>bridge</code>\u8bbe\u5907\u548c\u5bb9\u5668\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#veth0","title":"\u5c06<code>veth0</code>\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u521b\u5efa\u5bb9\u5668\u7684\u547d\u4ee4\u53ef\u5f97\uff0c\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7684<code>pid</code>\u4e3a<code>1349</code>\uff0c\u4e0b\u9762\u547d\u4ee4\u5c06<code>veth0</code>\u8bbe\u5907\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth0 netns 1349\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u7684\u76f8\u5173\u7f51\u5361\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip link\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n6: veth0@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth1br0","title":"\u5c06<code>veth1</code>\u8fde\u63a5\u5230<code>br0</code>\u4e2d","text":"<pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth1 master br0\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b<code>br0</code>\u8fde\u63a5\u7684\u4fe1\u606f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.72cfbe81fc62       no              veth1\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth2","title":"\u5c06<code>veth2</code>\u79fb\u52a8\u5230\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u4e2d","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u521b\u5efa\u5bb9\u5668\u7684\u547d\u4ee4\u53ef\u5f97\uff0c\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u7684<code>pid</code>\u4e3a<code>1357</code>\uff0c\u4e0b\u9762\u547d\u4ee4\u5c06<code>veth2</code>\u8bbe\u5907\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth2 netns 1357\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u4e2d\u7684\u76f8\u5173\u7f51\u5361\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:2]# ip link\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n8: veth2@if7: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 9a:c0:ed:69:8c:4e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth3br0","title":"\u5c06<code>veth3</code>\u8fde\u63a5\u5230<code>br0</code>\u4e2d","text":"<pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth3 master br0\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b<code>br0</code>\u8fde\u63a5\u7684\u4fe1\u606f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.72cfbe81fc62       no              veth1\n                                                        veth3\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth4","title":"\u5c06<code>veth4</code>\u79fb\u52a8\u5230\u7b2c\u4e09\u4e2a\u5bb9\u5668\u4e2d","text":"<p>\u901a\u8fc7\u4e0a\u8ff0\u521b\u5efa\u5bb9\u5668\u7684\u547d\u4ee4\u53ef\u5f97\uff0c\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u7684<code>pid</code>\u4e3a<code>1365</code>\uff0c\u4e0b\u9762\u547d\u4ee4\u5c06<code>veth4</code>\u8bbe\u5907\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth4 netns 1365\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b\u7b2c\u4e09\u4e2a\u5bb9\u5668\u4e2d\u7684\u7f51\u5361\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip link\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n10: veth4@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether d2:a0:6a:c1:fe:80 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth5br0","title":"\u5c06<code>veth5</code>\u8fde\u63a5\u5230<code>br0</code>\u4e2d","text":"<pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth5 master br0\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b<code>br0</code>\u8fde\u63a5\u4fe1\u606f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# brctl show\nbridge name     bridge id               STP enabled     interfaces\nbr0             8000.72cfbe81fc62       no              veth1\n                                                        veth3\n                                                        veth5\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#_3","title":"\u67e5\u770b\u5bbf\u4e3b\u673a\u73b0\u6709\u7684\u7f51\u7edc\u4fe1\u606f","text":"<pre><code>[root@ubuntu]:[~][tty:0]# ip link\n......\n4: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 72:cf:be:81:fc:62 brd ff:ff:ff:ff:ff:ff\n5: veth1@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop master br0 state DOWN mode DEFAULT group default qlen 1000\n    link/ether ae:dd:f7:9d:9b:f8 brd ff:ff:ff:ff:ff:ff link-netnsid 1\n7: veth3@if8: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop master br0 state DOWN mode DEFAULT group default qlen 1000\n    link/ether 52:6c:7b:57:b2:7b brd ff:ff:ff:ff:ff:ff link-netnsid 0\n9: veth5@if10: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop master br0 state DOWN mode DEFAULT group default qlen 1000\n    link/ether a2:c7:ea:83:fc:91 brd ff:ff:ff:ff:ff:ff link-netnsid 2\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5bbf\u4e3b\u673a\u4e2d\u5c31\u53ea\u80fd\u770b\u5230<code>br0</code>\u548c<code>veth1</code>\u3001<code>veth3</code>\u3001<code>veth5</code>\u8bbe\u5907\u4e86\uff0c\u5176\u4ed6\u7684<code>veth0</code>\u3001<code>veth2</code>\u3001<code>veth4</code>\u5df2\u7ecf\u88ab\u79fb\u52a8\u5230\u76f8\u5e94\u7684\u5bb9\u5668\u4e2d\u53bb\u4e86\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#ip","title":"\u7ed9\u865a\u62df\u8bbe\u5907\u914d\u7f6eIP\u5730\u5740","text":""},{"location":"2024/11/19/docker_network_bridge.html#br0","title":"\u914d\u7f6e\u8bbe\u5907<code>br0</code>\u7684\u5730\u5740","text":"<p>\u7531\u4e8e<code>br0</code>\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u6240\u4ee5\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u6267\u884c\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip addr add 192.168.1.250/24 dev br0\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b<code>br0</code>\u5730\u5740</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip addr show br0\n4: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 72:cf:be:81:fc:62 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.250/24 scope global br0\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth0ip","title":"\u914d\u7f6e<code>veth0</code>\u7684<code>ip</code>\u5730\u5740","text":"<p>\u7531\u4e8e<code>veth0</code>\u5df2\u7ecf\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u53bb\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u5230\u8be5\u5bb9\u5668\u4e2d\u6267\u884c\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip addr add 192.168.1.245/24 dev veth0\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u67e5\u770b<code>veth0</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip addr show veth0\n6: veth0@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.245/24 scope global veth0\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth2ip","title":"\u914d\u7f6e<code>veth2</code>\u7684<code>ip</code>\u5730\u5740","text":"<p>\u7531\u4e8e<code>veth2</code>\u5df2\u7ecf\u79fb\u52a8\u5230\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u4e2d\u53bb\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u5230\u8be5\u5bb9\u5668\u4e2d\u6267\u884c\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:2]# ip addr add 192.168.1.246/24 dev veth2\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u67e5\u770b<code>veth2</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:2]# ip addr show veth2\n8: veth2@if7: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 9a:c0:ed:69:8c:4e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.246/24 scope global veth2\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth4ip","title":"\u914d\u7f6e<code>veth4</code>\u7684<code>ip</code>\u5730\u5740","text":"<p>\u7531\u4e8e<code>veth4</code>\u5df2\u7ecf\u79fb\u52a8\u5230\u7b2c\u4e09\u4e2a\u5bb9\u5668\u4e2d\u53bb\u4e86\uff0c\u6240\u4ee5\u9700\u8981\u5230\u8be5\u5bb9\u5668\u4e2d\u6267\u884c\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip addr add 192.168.1.247/24 dev veth4\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre> <p>\u67e5\u770b<code>veth4</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip addr show veth4\n10: veth4@if9: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether d2:a0:6a:c1:fe:80 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.247/24 scope global veth4\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#_4","title":"\u542f\u7528\u865a\u62df\u8bbe\u5907","text":"<p>\u865a\u62df\u8bbe\u5907\u521b\u5efa\u6210\u529f\u540e\uff0c\u53ca\u65f6\u5df2\u7ecf\u914d\u7f6e\u4e86<code>ip</code>\u5730\u5740\uff0c\u5176\u7f51\u5361\u72b6\u6001\u4f9d\u7136\u662f\u5173\u95ed\u7684\uff08<code>DOWN</code>\uff09\uff0c\u9700\u8981\u624b\u52a8\u542f\u52a8\u624d\u884c\u3002\u63a5\u4e0b\u6765\uff0c\u5f00\u59cb\u9010\u4e2a\u542f\u52a8\u7f51\u7edc\u8bbe\u5907\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#br0_1","title":"\u542f\u52a8<code>br0</code>","text":"<p><code>br0</code>\u5728\u5bbf\u4e3b\u673a\uff0c\u6240\u4ee5\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u64cd\u4f5c\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link set br0 up\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u518d\u67e5\u770b<code>br0</code>\u7684<code>ip</code>\u5730\u5740\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip addr show br0\n4: br0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 72:cf:be:81:fc:62 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.250/24 scope global br0\n       valid_lft forever preferred_lft forever\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u867d\u7136\u6b64\u65f6\u7684\u72b6\u6001\u8fd8\u662f<code>DOWN</code>\uff0c\u4f46\u662f\u4e5f\u5df2\u7ecf\u53ef\u4ee5<code>ping</code>\u901a\u4e86\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ping -c 4 192.168.1.250\nPING 192.168.1.250 (192.168.1.250) 56(84) bytes of data.\n64 bytes from 192.168.1.250: icmp_seq=1 ttl=64 time=0.018 ms\n64 bytes from 192.168.1.250: icmp_seq=2 ttl=64 time=0.027 ms\n64 bytes from 192.168.1.250: icmp_seq=3 ttl=64 time=0.025 ms\n64 bytes from 192.168.1.250: icmp_seq=4 ttl=64 time=0.026 ms\n\n--- 192.168.1.250 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3110ms\nrtt min/avg/max/mdev = 0.018/0.024/0.027/0.003 ms\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth_2","title":"\u542f\u52a8\u5bbf\u4e3b\u673a\u4e0a\u7684<code>veth</code>\u8bbe\u5907","text":"<p><code>veth1</code>\u3001<code>veth3</code>\u3001<code>veth5</code>\u90fd\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u9700\u8981\u5c06\u5176\u542f\u52a8\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# ip link set veth1 up\n[root@ubuntu]:[~][tty:0]# ip link set veth3 up\n[root@ubuntu]:[~][tty:0]# ip link set veth5 up\n[root@ubuntu]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth0_1","title":"\u542f\u52a8<code>veth0</code>\u8bbe\u5907","text":"<p><code>veth0</code>\u5728\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e0a\uff08<code>pid:1349</code>\uff09\uff0c\u9700\u8981\u5c06\u5176\u542f\u52a8\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip link set veth0 up\n(unshare) [root@ubuntu]:[~][tty:1]#\n(unshare) [root@ubuntu]:[~][tty:1]# ip addr show veth0\n6: veth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.245/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6477:10ff:fe54:810e/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth2_1","title":"\u542f\u52a8<code>veth2</code>\u8bbe\u5907","text":"<p><code>veth2</code>\u5728\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u4e0a\uff08<code>pid:1357</code>\uff09\uff0c\u9700\u8981\u5c06\u5176\u542f\u52a8\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:2]# ip link set veth2 up\n(unshare) [root@ubuntu]:[~][tty:2]#\n(unshare) [root@ubuntu]:[~][tty:2]# ip addr show veth2\n8: veth2@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 9a:c0:ed:69:8c:4e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.246/24 scope global veth2\n       valid_lft forever preferred_lft forever\n    inet6 fe80::98c0:edff:fe69:8c4e/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#veth4_1","title":"\u542f\u52a8<code>veth4</code>\u8bbe\u5907","text":"<p><code>veth4</code>\u5728\u7b2c\u4e09\u4e2a\u5bb9\u5668\u4e0a\uff08<code>pid:1365</code>\uff09\uff0c\u9700\u8981\u5c06\u5176\u542f\u52a8\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip link set veth4 up\n(unshare) [root@ubuntu]:[~][tty:3]#\n(unshare) [root@ubuntu]:[~][tty:3]# ip addr show veth4\n10: veth4@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether d2:a0:6a:c1:fe:80 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.247/24 scope global veth4\n       valid_lft forever preferred_lft forever\n    inet6 fe80::d0a0:6aff:fec1:fe80/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#_5","title":"\u5bb9\u5668\u4e4b\u95f4\u4e92\u76f8\u901a\u4fe1","text":"<p>\u6709\u4e86<code>bridge</code>\u7684\u52a0\u6301\uff0c\u8fde\u63a5\u4e0a\u7684\u8bbe\u5907\u90fd\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\uff0c\u6b64\u65f6\u5bb9\u5668\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u4e86\u3002</p> <p>\u6bd4\u5982\u5728\u7b2c\u4e09\u4e2a\u5bb9\u5668\u4e0a\uff0c\u53ef\u4ee5<code>ping</code>\u901a\u7b2c\u4e00\u4e2a\u5bb9\u5668\u548c\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n10: veth4@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether d2:a0:6a:c1:fe:80 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.247/24 scope global veth4\n       valid_lft forever preferred_lft forever\n    inet6 fe80::d0a0:6aff:fec1:fe80/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:3]#\n(unshare) [root@ubuntu]:[~][tty:3]# # ping \u5bb9\u56681\n(unshare) [root@ubuntu]:[~][tty:3]# ping 192.168.1.245 -c 4\nPING 192.168.1.245 (192.168.1.245) 56(84) bytes of data.\n64 bytes from 192.168.1.245: icmp_seq=1 ttl=64 time=0.021 ms\n64 bytes from 192.168.1.245: icmp_seq=2 ttl=64 time=0.035 ms\n64 bytes from 192.168.1.245: icmp_seq=3 ttl=64 time=0.037 ms\n64 bytes from 192.168.1.245: icmp_seq=4 ttl=64 time=0.039 ms\n\n--- 192.168.1.245 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3101ms\nrtt min/avg/max/mdev = 0.021/0.033/0.039/0.007 ms\n(unshare) [root@ubuntu]:[~][tty:3]#\n(unshare) [root@ubuntu]:[~][tty:3]#\n(unshare) [root@ubuntu]:[~][tty:3]# # ping \u5bb9\u56682\n(unshare) [root@ubuntu]:[~][tty:3]# ping 192.168.1.246 -c 4\nPING 192.168.1.246 (192.168.1.246) 56(84) bytes of data.\n64 bytes from 192.168.1.246: icmp_seq=1 ttl=64 time=0.049 ms\n64 bytes from 192.168.1.246: icmp_seq=2 ttl=64 time=0.036 ms\n64 bytes from 192.168.1.246: icmp_seq=3 ttl=64 time=0.035 ms\n64 bytes from 192.168.1.246: icmp_seq=4 ttl=64 time=0.038 ms\n\n--- 192.168.1.246 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3061ms\nrtt min/avg/max/mdev = 0.035/0.039/0.049/0.005 ms\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u5728\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e0a\uff0c\u4e5f\u53ef\u4ee5<code>ping</code>\u901a\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u548c\u7b2c\u4e09\u4e2a\u5bb9\u5668\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n6: veth0@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 66:77:10:54:81:0e brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.1.245/24 scope global veth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::6477:10ff:fe54:810e/64 scope link proto kernel_ll\n       valid_lft forever preferred_lft forever\n(unshare) [root@ubuntu]:[~][tty:1]#\n(unshare) [root@ubuntu]:[~][tty:1]# # ping \u5bb9\u56682\n(unshare) [root@ubuntu]:[~][tty:1]# ping -c 4  192.168.1.246\nPING 192.168.1.246 (192.168.1.246) 56(84) bytes of data.\n64 bytes from 192.168.1.246: icmp_seq=1 ttl=64 time=0.045 ms\n64 bytes from 192.168.1.246: icmp_seq=2 ttl=64 time=0.035 ms\n64 bytes from 192.168.1.246: icmp_seq=3 ttl=64 time=0.061 ms\n64 bytes from 192.168.1.246: icmp_seq=4 ttl=64 time=0.037 ms\n\n--- 192.168.1.246 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3091ms\nrtt min/avg/max/mdev = 0.035/0.044/0.061/0.010 ms\n(unshare) [root@ubuntu]:[~][tty:1]# # ping \u5bb9\u56683\n(unshare) [root@ubuntu]:[~][tty:1]# ping -c 4  192.168.1.247\nPING 192.168.1.247 (192.168.1.247) 56(84) bytes of data.\n64 bytes from 192.168.1.247: icmp_seq=1 ttl=64 time=0.022 ms\n64 bytes from 192.168.1.247: icmp_seq=2 ttl=64 time=0.059 ms\n64 bytes from 192.168.1.247: icmp_seq=3 ttl=64 time=0.037 ms\n64 bytes from 192.168.1.247: icmp_seq=4 ttl=64 time=0.036 ms\n\n--- 192.168.1.247 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3054ms\nrtt min/avg/max/mdev = 0.022/0.038/0.059/0.013 ms\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#_6","title":"\u8ba9\u5bb9\u5668\u8fde\u4e0a\u5916\u7f51","text":"<p>\u73b0\u5728\u7684\u5bb9\u5668\u4e4b\u95f4\u80fd\u591f\u4e92\u76f8\u901a\u4fe1\u4e86\uff0c\u4f46\u662f\u8fd8\u662f\u4e0d\u80fd\u4e0a\u5916\u7f51\uff0c\u4f8b\u5982<code>ping 8.8.8.8</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ping 8.8.8.8\nping: connect: Network is unreachable\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u663e\u793a\u7684\u8fd8\u662f\u7f51\u7edc\u4e0d\u53ef\u8fbe\uff0c\u4f46\u662f\u5bbf\u4e3b\u673a\u662f\u53ef\u4ee5\u4e0a\u7f51\u7684\uff0c\u53ef\u4ee5\u5c06\u6d41\u91cf\u53d1\u9001\u5230\u5bbf\u4e3b\u673a\u4e0a\uff0c\u518d\u7531\u5bbf\u4e3b\u673a\u8f6c\u53d1\u51fa\u53bb\u5373\u53ef\uff0c</p> <p>\u9996\u5148\u8981\u5b9a\u4e49\u8def\u7531\u8868\uff0c\u589e\u52a0\u4e00\u6761\u9ed8\u8ba4\u8def\u7531\uff0c\u5c06\u6d41\u91cf\u6307\u5411<code>br0</code>\uff0c\u5373<code>192.168.1.250</code>\u3002</p> <p>\u5148\u67e5\u770b\u5176\u8def\u7531\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip route\n192.168.1.0/24 dev veth0 proto kernel scope link src 192.168.1.245\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u6dfb\u52a0\u4e00\u6761\u9ed8\u8ba4\u8def\u7531\uff0c\u5c06\u6d41\u91cf\u90fd\u6307\u5411<code>br0</code>\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ip route add default via 192.168.1.250\n(unshare) [root@ubuntu]:[~][tty:1]#\n(unshare) [root@ubuntu]:[~][tty:1]# ip route\ndefault via 192.168.1.250 dev veth0\n192.168.1.0/24 dev veth0 proto kernel scope link src 192.168.1.245\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u5b9a\u4e49\u5b8c\u8def\u7531\u540e\uff0c\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u4e0a\u505a\u8f6c\u53d1\u3002</p> <p>\u9996\u5148\u9700\u8981\u5141\u8bb8\u5185\u6838\u8fdb\u884c<code>ip</code>\u8f6c\u53d1\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# sysctl net.ipv4.conf.all.forwarding=1\nnet.ipv4.conf.all.forwarding = 1\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u800c\u540e\u518d\u5b9a\u4e00\u4e2a<code>nat</code>\u89c4\u5219\uff0c\u5c06\u5bb9\u5668\u4e0a\u6765\u7684\u6570\u636e\u5305\uff0c\u4fee\u6539\u4e3a\u5bbf\u4e3b\u673a\u5431\u58f0\u7684\uff0c\u4ece\u800c\u8bf7\u6c42\uff0c\u62a5\u6587\u56de\u590d\u540e\uff0c\u518d\u8fdb\u884c<code>nat</code>\u8f6c\u53d1\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j MASQUERADE\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u6b64\u65f6\u518d\u5728\u5bb9\u5668\u4e2d\uff0c\u5c31\u53ef\u4ee5\u8fde\u63a5\u4e0a\u5916\u7f51\u4e86\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# ping 8.8.8.8 -c 4\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=54 time=34.1 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=54 time=33.8 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=54 time=33.7 ms\n64 bytes from 8.8.8.8: icmp_seq=4 ttl=54 time=34.0 ms\n\n--- 8.8.8.8 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3004ms\nrtt min/avg/max/mdev = 33.705/33.907/34.094/0.165 ms\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u5176\u4ed62\u4e2a\u5bb9\u5668\uff0c\u4ec5\u9700\u6dfb\u52a0\u9ed8\u8ba4\u8def\u7531\u4e3a<code>192.168.1.250</code>\uff0c\u5373\u53ef\u4e0a\u7f51\u3002</p> <p>\u9996\u5148\u64cd\u4f5c\u7b2c\u4e8c\u4e2a\u5bb9\u5668\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:2]# ip route add default via 192.168.1.250\n(unshare) [root@ubuntu]:[~][tty:2]# ping 8.8.8.8 -c 4\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=54 time=34.0 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=54 time=34.1 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=54 time=34.2 ms\n64 bytes from 8.8.8.8: icmp_seq=4 ttl=54 time=34.1 ms\n\n--- 8.8.8.8 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3003ms\nrtt min/avg/max/mdev = 34.047/34.110/34.172/0.044 ms\n(unshare) [root@ubuntu]:[~][tty:2]#\n</code></pre> <p>\u6700\u540e\u64cd\u4f5c\u7b2c\u4e09\u4e2a\u5bb9\u5668\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:3]# ip route add default via 192.168.1.250\n(unshare) [root@ubuntu]:[~][tty:3]# ping 8.8.8.8 -c 4\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=54 time=35.5 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=54 time=34.0 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=54 time=34.3 ms\n64 bytes from 8.8.8.8: icmp_seq=4 ttl=54 time=33.7 ms\n\n--- 8.8.8.8 ping statistics ---\n4 packets transmitted, 4 received, 0% packet loss, time 3003ms\nrtt min/avg/max/mdev = 33.713/34.397/35.524/0.683 ms\n(unshare) [root@ubuntu]:[~][tty:3]#\n</code></pre>"},{"location":"2024/11/19/docker_network_bridge.html#_7","title":"\u5c06\u5bb9\u5668\u7684\u7aef\u53e3\u6620\u5c04\u8fdb\u51fa\u53bb","text":""},{"location":"2024/11/19/docker_network_bridge.html#iptables","title":"\u4f7f\u7528iptables\u8fdb\u884c\u7aef\u53e3\u6620\u5c04","text":"<p>\u8fd9\u4e2a\u548c<code>bridge</code>\u6ca1\u6709\u4ec0\u4e48\u5173\u7cfb\uff0c\u53ea\u662f\u8ba9\u5bb9\u5668\u53ef\u4ee5\u4e0a\u7f51\u4e86\uff0c\u8fd8\u6709\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u9700\u6c42\u662f\uff0c\u5c06\u5bb9\u5668\u7684\u67d0\u4e2a\u7aef\u53e3\u6620\u5c04\u51fa\u53bb\u3002\u6bd4\u5982\uff0c\u5c06\u5bbf\u4e3b\u673a\u7684<code>8080</code>\u7aef\u53e3\uff0c\u6620\u5c04\u5230\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7684<code>80</code>\u7aef\u53e3\u4e0a\uff0c\u5373\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684<code>8080</code>\u7aef\u53e3\uff0c\u5b9e\u9645\u4e0a\u662f\u8bbf\u95ee\u7684\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7684<code>80</code>\u7aef\u53e3\u3002</p> <p>\u6b64\u7c7b\u4e5f\u662f\u9700\u8981<code>iptables</code>\u505a<code>nat</code>\u8f6c\u53d1\u3002</p> <p>\u6bd4\u5982\uff0c\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7684<code>ip</code>\u5730\u5740\u4e3a<code>192.168.1.245</code>\uff0c\u53ef\u4ee5\u5c06\u5bbf\u4e3b\u673a\u7684<code>8080</code>\u7aef\u53e3\uff0c\u8f6c\u53d1\u5230<code>192.168.1.245</code>\u7684<code>80</code>\u7aef\u53e3\u4e0a\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# iptables -t nat -A OUTPUT -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.245:80\n[root@ubuntu]:[~][tty:0]# iptables -t nat -A PREROUTING -p tcp --dport 8080 -j DNAT --to-destination 192.168.1.245:80\n</code></pre> <p>\u6dfb\u52a0\u4e86\u8fd92\u6761\u89c4\u5219\uff0c\u5176\u4e2d<code>OUTPUT</code>\u662f\u6307\u5728\u672c\u5730\u53d1\u51fa\u7684\u6d41\u91cf\uff0c\u800c<code>PREROUTING</code>\u662f\u6307\u5916\u90e8\u8fdb\u5165\u672c\u673a\u7684\u6d41\u91cf\u3002<code>DNAT</code>\u662f\u4fee\u6539\u6d41\u91cf\u7684\u76ee\u6807\u5730\u5740\uff0c\u5c06\u6d41\u91cf\u5b9a\u5411\u5230<code>192.168.1.245:80</code>\u3002</p> <p>\u6dfb\u52a0\u4e86\u4e4b\u540e\uff0c\u5728\u5916\u90e8\u548c\u5185\u90e8\u90fd\u8bbf\u95ee\u5bbf\u4e3b\u673a\u7684<code>8080</code>\u5373\u53ef\u3002</p> <p>\u9996\u5148\uff0c\u5728\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\uff08<code>ip:192.168.1.245</code>\uff09\u4f7f\u7528<code>nc</code>\u76d1\u542c<code>80</code>\u7aef\u53e3\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# nc -lp 80\n</code></pre> <p>\u5728\u5916\u90e8\u673a\u5668\uff0c\u4f7f\u7528<code>telnet</code>\u8fdb\u884c\u8bf7\u6c42\u3002</p> <pre><code>$ telnet 192.168.100.102 8080\nTrying 192.168.100.141...\nConnected to 192.168.100.102.\nEscape character is '^]'.\nhello world namespace 1\n^]\n\ntelnet&gt; quit\nConnection closed.\n$\n</code></pre> <p>\u6b64\u65f6\uff0c\u5728\u7b2c\u4e00\u4e2a\u5bb9\u5668\u4e2d\u7684<code>nc</code>\u4e5f\u6709\u4e86\u76f8\u540c\u7684\u6d88\u606f\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# nc -lp 80\nhello world namespace 1\n(unshare) [root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\u540c\u6837\u7684\u8bf7\u6c42<code>192.168.100.102 8080</code>\u4e5f\u662f\u53ef\u4ee5\u8fdb\u884c\u901a\u4fe1\u7684\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#_8","title":"\u4f7f\u7528\u7a0b\u5e8f\u8fdb\u884c\u7aef\u53e3\u6620\u5c04","text":"<p>\u8fd9\u6837\u64cd\u4f5c\u592a\u8fc7\u9ebb\u70e6\uff0c\u4e14\u5728<code>iptables</code>\u4f7f\u7528\u4e86\u7aef\u53e3\u8f6c\u53d1\uff0c\u4f7f\u7528<code>ss</code>\u4e5f\u67e5\u770b\u4e0d\u5230\uff0c\u6240\u4ee5\uff0c\u6700\u597d\u8fd8\u662f\u76f4\u63a5\u4f7f\u7528\u7a0b\u5e8f\u7684\u65b9\u6cd5\u8fdb\u884c\u8f6c\u53d1\uff0c\u4f8b\u5982\uff0c\u4f7f\u7528<code>go</code>\u5199\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u8f6c\u53d1\u547d\u4ee4\u3002</p> <pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"net\"\n)\n\nvar (\n    tcpPort string\n    target  string\n)\n\nfunc init() {\n    flag.StringVar(&amp;tcpPort, \"tcpPort\", \"\", \"Specify TCP port\")\n    flag.StringVar(&amp;target, \"target\", \"\", \"Specify the target address\")\n}\n\nfunc main() {\n\n    flag.Parse()\n\n    if tcpPort == \"\" &amp;&amp; target == \"\" {\n        fmt.Println(\"No specified tcpPort or destination address\")\n        return\n    }\n\n    l, err := net.Listen(\"tcp\", fmt.Sprintf(\"0.0.0.0:%s\", tcpPort))\n    if err != nil {\n        fmt.Println(\"Listening to TCP error \", err)\n        return\n    }\n\n    for {\n        conn, err := l.Accept()\n        if err != nil {\n            fmt.Println(\"accept error\", err)\n            continue\n        }\n        go handleConn(conn, target)\n    }\n}\n\nfunc handleConn(conn net.Conn, targetAddr string) {\n    defer conn.Close()\n\n    fmt.Println(conn.RemoteAddr().String(), \"is connected.\")\n\n    remoteConn, err := net.Dial(\"tcp\", targetAddr)\n    if err != nil {\n        fmt.Println(\"connet tcp \", targetAddr, \" error\", err)\n        return\n    }\n    defer remoteConn.Close()\n\n    go io.Copy(remoteConn, conn)\n    io.Copy(conn, remoteConn)\n}\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u662f\u4e00\u4e2a\u53ca\u5176\u7b80\u5355\u7684<code>tcp</code>\u8f6c\u53d1\u7a0b\u5e8f\uff0c\u9700\u8981\u8f93\u5165\u7684\u53c2\u6570\u67092\u4e2a\u3002</p> <ul> <li><code>--tcpPort</code>\uff1a\u7528\u4e8e\u76d1\u542c\u5bbf\u4e3b\u673a\u7684\u7aef\u53e3\u3002</li> <li><code>--target</code>\uff1a\u7528\u4e8e\u8f6c\u53d1\u7684\u5bb9\u5668\u5730\u5740\uff08\u4e5f\u53ef\u4ee5\u662f\u4efb\u4f55\u7f51\u7edc\u5730\u5740\uff09\u3002</li> </ul> <p>\u5148\u8fdb\u884c\u7f16\u8bd1\u3002</p> <pre><code>[root@ubuntu]:[~][tty:4]# go build -o portForward \n[root@ubuntu]:[~][tty:4]# \n</code></pre> <p>\u8fd0\u884c\u7a0b\u5e8f\u3002</p> <pre><code>[root@ubuntu]:[~][tty:4]# ./portForward --tcpPort 8081 --target 192.168.1.245:80\n</code></pre> <p>\u8868\u793a\u5c06\u5bbf\u4e3b\u673a\u7684<code>8081</code>\u7aef\u53e3\uff0c\u6620\u5c04\u5230<code>192.168.1.245</code>\u7684<code>80</code>\u7aef\u53e3\u4e0a\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u73b0\u5728\u672c\u5730\u5c1d\u8bd5<code>telnet</code>\u4e0b\u3002</p> <pre><code>[root@ubuntu]:[~][tty:5]# telnet 127.0.0.1 8081\nTrying 127.0.0.1...\nConnected to 127.0.0.1.\nEscape character is '^]'.\nhello world ,test portForward\n^]\ntelnet&gt;\n^]\ntelnet&gt; quit\nConnection closed.\n[root@ubuntu]:[~][tty:5]#\n</code></pre> <p>\u67e5\u770b\u7b2c\u4e00\u4e2a\u5bb9\u5668\u7684<code>nc</code>\u65e5\u5fd7\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# nc -lp 80\nhello world ,test portForward\n</code></pre> <p>\u4f7f\u7528\u5916\u7f51\u518d\u6d4b\u8bd5\u4e0b\u3002</p> <pre><code>liwang@DESKTOP-CU66GL1:~$ telnet 192.168.100.102 8081\nTrying 192.168.100.102...\nConnected to 192.168.100.102.\nEscape character is '^]'.\nhello world port forward out\n^]\n\ntelnet&gt; quit\nConnection closed.\nliwang@DESKTOP-CU66GL1:~$\n</code></pre> <p>\u540c\u6837\u7684\u67e5\u770b<code>nc</code>\u65e5\u5fd7\u3002</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:1]# nc -lp 80\nhello world port forward out\n</code></pre> <p>\u67e5\u770b<code>portForward</code>\u7a0b\u5e8f\u7684\u65e5\u5fd7\u3002</p> <pre><code>[root@ubuntu]:[~][tty:4]# ./portForward --tcpPort 8081 --target 192.168.1.245:80\n127.0.0.1:54988 is connected.\n192.168.100.101:63441 is connected.\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u4f8b\u5b50\uff0c\u53ef\u89c1\uff0c\u76f4\u63a5\u4f7f\u7528\u7a0b\u5e8f\u76d1\u542c\u7aef\u53e3\uff0c\u6bd4\u8bbe\u7f6e<code>iptables</code>\u66f4\u52a0\u5bb9\u6613\u7684\u591a\u3002</p>"},{"location":"2024/11/19/docker_network_bridge.html#_9","title":"\u603b\u7ed3","text":"<p><code>linux bridge</code>\u662f\u865a\u62df\u7f51\u6865\uff0c\u53ef\u4ee5\u5c06\u591a\u4e2a\u7f51\u7edc\u63a5\u53e3\u8fde\u63a5\u5728\u4e00\u8d77\u7684\u865a\u62df\u8bbe\u5907\uff0c\u4e0a\u8ff0\u6848\u4f8b\uff0c\u521b\u5efa\u591a\u4e2a\u5bb9\u5668\uff0c\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u90fd\u5206\u914d\u4e86<code>veth</code>\uff0c\u53e6\u4e00\u7aef\u5219\u76f4\u63a5\u63a5\u5165\u5230\u4e86<code>bridge</code>\u4e2d\uff0c\u8fd9\u6837\u53ef\u4ee5\u5b9e\u73b0\u5bb9\u5668\u95f4\u901a\u4fe1\uff0c\u5bb9\u5668\u95f4\u548c\u5bbf\u4e3b\u673a\u7684\u901a\u4fe1\u3002\u60f3\u8ba9\u5bb9\u5668\u80fd\u591f\u4e0a\u7f51\u7684\u8bdd\uff0c\u9700\u8981\u73b0\u5c06\u5bb9\u5668\u7684\u9ed8\u8ba4\u8def\u7531\u6307\u5411<code>bridge</code>\uff0c\u518d\u5728\u5bbf\u4e3b\u673a\u4e0a\u8bbe\u7f6e<code>iptables</code>\u8f6c\u53d1\u89c4\u5219\u5373\u53ef\u3002</p>"},{"location":"2024/11/21/vmware-install-tools.html","title":"debian 12.7 \u5b89\u88c5vmware-tools\u8bb0\u5f55","text":"<p>\u672c\u6587\u8bb0\u5f55<code>debian 12.7</code>\u5b89\u88c5<code>vmware-tools</code>\u8fc7\u7a0b\u4e2d\u627e\u4e0d\u5230<code>depmod</code>\u4e4b\u7c7b\u6587\u4ef6\u7684\u95ee\u9898\u3002</p> <p><code>debian</code>\u4f7f\u7528\u7684\u73af\u5883\u5982\u4e0b\uff1a</p> <pre><code>root@debian:~# hostnamectl\n Static hostname: debian\n       Icon name: computer-vm\n         Chassis: vm \ud83d\uddb4\n  Virtualization: vmware\nOperating System: Debian GNU/Linux 12 (bookworm)\n          Kernel: Linux 6.1.0-25-amd64\n    Architecture: x86-64\n Hardware Vendor: VMware, Inc.\n  Hardware Model: VMware Virtual Platform\nFirmware Version: 6.00\nroot@debian:~# cat /etc/debian_version\n12.7\nroot@debian:~#\n</code></pre> <p><code>vmware</code> \u4f7f\u7528\u7684\u73af\u5883\u5982\u4e0b\uff1a</p> <pre><code>VMware\u00ae Workstation 16 Pro\n16.2.4 build-20089737\n</code></pre> <p><code>vmware tools</code>\u53c2\u8003\u7684\u5b89\u88c5\u6587\u6863\uff1a</p> <p>https://docs.vmware.com/cn/VMware-Workstation-Pro/16.0/com.vmware.ws.using.doc/GUID-08BB9465-D40A-4E16-9E15-8C016CC8166F.html</p>"},{"location":"2024/11/21/vmware-install-tools.html#_1","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u5728\u4f7f\u7528<code>root</code>\u6743\u9650\u6267\u884c<code>./vmware-install.pl</code>\u7684\u65f6\u5019\uff0c\u63d0\u793a\u627e\u4e0d\u5230\u5404\u79cd\u8f6f\u4ef6\uff0c\u5982<code>depmod</code>\u3001<code>modprobe</code>\u3001<code>rmmod</code>\u7b49\u3002</p> <pre><code># ./vmware-install.pl\nSetup is unable to find the \"depmod\" program on your machine. Please make sure\nit is installed. Do you want to specify the location of this program by hand?\n[yes] Use of uninitialized value $gOption{\"default\"} in numeric eq (==) at ./vmware-install.pl line 866.\nyes\n\nWhat is the location of the \"depmod\" program on your\nmachine? Use of uninitialized value $gOption{\"default\"} in numeric eq (==) at ./vmware-install.pl line 866, &lt;STDIN&gt; line 1.\n\nSetup is unable to find the \"modprobe\" program on your machine. Please make\nsure it is installed. Do you want to specify the location of this program by\nhand? [yes] Use of uninitialized value $gOption{\"default\"} in numeric eq (==) at ./vmware-install.pl line 866, &lt;STDIN&gt; line 4.\n\nSetup is unable to find the \"rmmod\" program on your machine. Please make sure\nit is installed. Do you want to specify the location of this program by hand?\n[yes] Use of uninitialized value $gOption{\"default\"} in numeric eq (==) at ./vmware-install.pl line 866, &lt;STDIN&gt; line 6.\n...\n</code></pre>"},{"location":"2024/11/21/vmware-install-tools.html#_2","title":"\u89e3\u51b3","text":"<p>\u9996\u5148\u4f7f\u7528<code>find</code>\u641c\u7d22\u6240\u6709\u76ee\u5f55\uff0c\u662f\u5426\u5305\u542b<code>depmod</code>\u6587\u4ef6\u3002</p> <pre><code># find / -name depmod\n/usr/sbin/depmod\n#\n</code></pre> <p>\u8be5\u6587\u4ef6\u5728<code>/usr/sbin</code>\u4e0b\uff0c\u6000\u7591\u662f<code>PATH</code>\u53d8\u91cf\u672a\u52a0\u5165<code>/usr/sbin/</code>\uff0c\u518d\u6b21\u67e5\u770b<code>PATH</code>\u53d8\u91cf\u5185\u5bb9\u3002</p> <pre><code>root@debian:/home/wangli/vmware-tools-distrib# echo $PATH\n/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games\nroot@debian:/home/wangli/vmware-tools-distrib#\n</code></pre> <p><code>PATH</code>\u53d8\u91cf\u786e\u5b9e\u6ca1\u6709\u8be5\u5185\u5bb9\u3002</p> <p>\u624b\u52a8\u6dfb\u52a0<code>PATH</code>\u53d8\u91cf\u3002</p> <pre><code># PATH=$PATH:/usr/sbin/\n# export PATH\n#\n</code></pre> <p>\u518d\u6b21\u6267\u884c<code>./vmware-install.pl</code>\u811a\u672c\uff0c\u6309\u7167\u63d0\u793a\uff0c\u5373\u53ef\u5b89\u88c5\u6210\u529f\u3002</p>"},{"location":"2024/11/22/linux_network_bridge-2.html","title":"linux\u865a\u62df\u7f51\u6865\u63a5\u5165\u5b9e\u4f53\u7f51\u5361","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd\u865a\u62df\u7f51\u6865\uff08<code>bridge</code>\uff09\u63a5\u5165\u5b9e\u4f53\u7f51\u5361\u3002</p> <p>\u6b64\u524d\u5df2\u7ecf\u4ecb\u7ecd\u8fc7<code>linux</code>\u865a\u62df\u7f51\u6865\uff08<code>bridge</code>\uff09\u5728\u5bb9\u5668\u4e2d\u7684\u4f5c\u7528\uff0c\u672c\u6b21\u5c06\u6765\u4ecb\u7ecd\u5c06\u7f51\u6865\u63a5\u5165\u5b9e\u4f53\u7f51\u5361\u3002</p> <p>\u672c\u6587\u6240\u4f9d\u8d56\u7684\u73af\u5883\u4e3a\uff1a</p> <pre><code>root@debian:~# hostnamectl\n Static hostname: windows11pro\n       Icon name: windowsBooks\n         Chassis: laptop \ud83d\udcbb\nOperating System: Debian GNU/Linux 12 (bookworm)  \n          Kernel: Linux 6.1.0-26-amd64\n    Architecture: x86-64\n Hardware Vendor: ASUSTeK COMPUTER INC.\n  Hardware Model: X441UVK\nFirmware Version: X441UVK.314\nroot@debian:~#\n</code></pre> <p>\u64cd\u4f5c\u7684\u662f\u5207\u8bb0\u4e0d\u8981\u4f7f\u7528\u865a\u62df\u673a\u5982\uff0c<code>vmware</code>\u548c<code>virtualbox</code>\u7b49\u3002</p> <p>\u9ed8\u8ba4\u7f51\u5361\u6df7\u6742\u6a21\u5f0f\uff0c\u5728\u865a\u62df\u673a\u4e2d\u662f\u6ca1\u6709\u5f00\u542f\u7684\uff1ahttps://docs.vmware.com/cn/VMware-vSphere/6.7/com.vmware.vsphere.security.doc/GUID-92F3AB1F-B4C5-4F25-A010-8820D7250350.html</p>"},{"location":"2024/11/22/linux_network_bridge-2.html#_1","title":"\u5173\u95ed\u7f51\u7edc\u670d\u52a1","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>NetworkManager.service</code>\u662f<code>Linux</code>\u7cfb\u7edf\u4e2d\u7684\u7f51\u7edc\u7ba1\u7406\u5de5\u5177\uff0c\u8d1f\u8d23\u81ea\u52a8\u5206\u914d<code>ip</code>\u5730\u5740\u7b49\u3002\u7531\u4e8e\u8981\u64cd\u4f5c<code>bridge</code>\uff0c\u6240\u4ee5\u9700\u8981\u6682\u65f6\u5c06\u5176\u7ed9\u5173\u95ed\u6389\u3002\u5426\u5219\uff0c\u540e\u7eed\u5355\u72ec\u5f00\u542f\u7f51\u5361\uff0c\u53c8\u4f1a\u62c9\u53d6\u5230<code>ip</code>\u5730\u5740\u7b49\u3002</p> <p>\u5c06<code>NetworkManager.service</code>\u7ed9\u505c\u7528\u6389\uff0c\u5e76\u4e14\u7981\u6b62\u5f00\u673a\u81ea\u542f\u3002\u7136\u540e\u91cd\u542f\u673a\u5668\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# systemctl disable NetworkManager.service\n[root@localhost]:[~][tty:0]# systemctl stop NetworkManager.service\n[root@localhost]:[~][tty:0]# reboot\n</code></pre> <p>\u91cd\u542f\u5b8c\u6bd5\u540e\uff0c\u67e5\u770b\u7f51\u7edc\uff0c\u5e94\u8be5\u662f\u65e0<code>ip</code>\u5730\u5740\uff0c\u4e14\u7f51\u5361\u72b6\u6001\u4e3a<code>DOWN</code>\u7684\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp4s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u7f51\u5361\u5173\u95ed\u540e\uff0c\u6211\u4eec\u9700\u8981\u624b\u52a8\u914d\u7f6e\u4e00\u4e0b<code>ip</code>\uff0c\u786e\u4fdd\u673a\u5668\u80fd\u591f\u4e0a\u7f51\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip addr add 192.168.100.136/24 dev enp4s0\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip link set enp4s0 up\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ping 192.168.100.1 -c 3\nPING 192.168.100.1 (192.168.100.1) 56(84) bytes of data.\n64 bytes from 192.168.100.1: icmp_seq=1 ttl=64 time=1.06 ms\n64 bytes from 192.168.100.1: icmp_seq=2 ttl=64 time=0.651 ms\n64 bytes from 192.168.100.1: icmp_seq=3 ttl=64 time=0.654 ms\n\n--- 192.168.100.1 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2023ms\nrtt min/avg/max/mdev = 0.651/0.789/1.062/0.193 ms\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u914d\u7f6e<code>ip</code>\u540e\uff0c\u5e76\u4e14\u624b\u52a8\u542f\u52a8\u7f51\u5361\uff0c<code>ping</code>\u7f51\u5173\u6ca1\u95ee\u9898\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ping 8.8.8.8 -c 3\nping: connect: Network is unreachable\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u4f46\u662f<code>ping</code>\u5916\u7f51\u4f1a\u663e\u793a\u7f51\u7edc\u4e0d\u53ef\u8fbe\uff0c\u8fd9\u662f\u56e0\u4e3a\u662f\u624b\u52a8\u6dfb\u52a0\u7684<code>ip</code>\u5730\u5740\uff0c\u8def\u7531\u4fe1\u606f\u9700\u8981\u914d\u7f6e\uff0c\u9700\u8981\u6dfb\u52a0\u4e00\u6761\u9ed8\u8ba4\u8def\u7531\uff0c\u6307\u5411\u7f51\u5173\u5373\u53ef\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip route\n192.168.100.0/24 dev enp4s0 proto kernel scope link src 192.168.100.136\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip route add default via 192.168.100.1\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ping -c 3 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=33.7 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=34.0 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=55 time=34.7 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 33.735/34.158/34.742/0.426 ms\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u5982\u4e0a\uff0c\u624b\u52a8\u914d\u7f6e\u7684<code>ip</code>\u4e5f\u53ef\u4ee5\u8fdb\u884c\u4e0a\u7f51\u3002\u9700\u8981\u6e05\u9664\u8be5\u7f51\u5361\u4e0a\u7684<code>ip</code>\u4fe1\u606f\uff0c\u5e76\u4e14\u7ed9\u5173\u95ed\u6389\u7f51\u7edc\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link set enp4s0 down\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip addr flush dev enp4s0\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp4s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n[root@localhost]:[~][tty:0]#\n</code></pre>"},{"location":"2024/11/22/linux_network_bridge-2.html#_2","title":"\u521b\u5efa\u865a\u62df\u6865\u63a5","text":"<p>\u521b\u5efa\u4e00\u4e2a\u6865\u63a5<code>bridge</code>\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link add name br0 type bridge\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip link\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: enp4s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel state DOWN mode DEFAULT group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/ether 0a:27:75:b4:30:69 brd ff:ff:ff:ff:ff:ff\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u5c06<code>enp4s0</code>\u5b9e\u4f53\u7f51\u5361\u52a0\u5165\u5230\u8be5\u865a\u62df\u6865\u63a5\u8bbe\u5907<code>br0</code>\u4e2d\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link set enp4s0 master br0\n</code></pre> <p>\u4e3a<code>br0</code>\u914d\u7f6e<code>ip</code>\u5730\u5740\uff0c\u6ce8\u610f\u8fd9\u91cc\u662f\u4e3a\u6865\u63a5\u914d\u7f6e<code>ip</code>\u5730\u5740\uff0c\u800c\u975e<code>enp4s0</code>\u5b9e\u4f53\u7f51\u7edc\u54e6\uff0c\u56e0\u4e3a\u63a5\u5165\u5230\u4e86<code>bridge</code>\u4e2d\uff0c\u53ef\u4ee5\u5c06<code>enp4s0</code>\u770b\u505a\u662f\u4e00\u6839\u7f51\u7ebf\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip addr add 192.168.100.136/24 dev br0\n[root@localhost]:[~][tty:0]#\n[root@localhost]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp4s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc fq_codel master br0 state DOWN group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 0a:27:75:b4:30:69 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.136/24 scope global br0\n       valid_lft forever preferred_lft forever\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u9700\u8981\u542f\u52a8<code>br0</code>\u548c<code>enp4s0</code>\u7f51\u5361\uff0c</p> <pre><code>[root@localhost]:[~][tty:0]# ip link set br0 up\n[root@localhost]:[~][tty:0]# ip link set enp4s0 up\n[root@localhost]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master br0 state UP group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::56e1:adff:fee7:de8d/64 scope link\n       valid_lft forever preferred_lft forever\n3: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 0a:27:75:b4:30:69 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.136/24 scope global br0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::827:75ff:feb4:3069/64 scope link\n       valid_lft forever preferred_lft forever\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6b64\u65f62\u4e2a\u7f51\u5361\u7684\u72b6\u6001\u90fd\u662f<code>UP</code>\u3002</p> <p>\u5c1d\u8bd5<code>ping</code>\u4e00\u4e0b\u7f51\u5173\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ping -c 3 192.168.100.1\nPING 192.168.100.1 (192.168.100.1) 56(84) bytes of data.\n64 bytes from 192.168.100.1: icmp_seq=1 ttl=64 time=1.53 ms\n64 bytes from 192.168.100.1: icmp_seq=2 ttl=64 time=0.663 ms\n64 bytes from 192.168.100.1: icmp_seq=3 ttl=64 time=0.666 ms\n\n--- 192.168.100.1 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2009ms\nrtt min/avg/max/mdev = 0.663/0.954/1.534/0.409 ms\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u518d\u6b21\u6dfb\u52a0\u9ed8\u8ba4\u8def\u7531\u540e\uff0c<code>ping</code>\u5916\u7f51\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip route add default via 192.168.100.1\n[root@localhost]:[~][tty:0]# ping -c 3 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=40.6 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=36.2 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=55 time=40.2 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2005ms\nrtt min/avg/max/mdev = 36.152/38.988/40.643/2.014 ms\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u53ef\u89c1\uff0c\u5c06\u5b9e\u4f53\u7f51\u5361\u7ed9\u5230\u865a\u62df\u7f51\u6865\uff0c\u662f\u884c\u5f97\u901a\u7684\u3002</p>"},{"location":"2024/11/22/linux_network_bridge-2.html#_3","title":"\u521b\u5efa\u865a\u62df\u7f51\u5361","text":"<p>\u73b0\u5728\u9700\u8981\u64cd\u4f5c\u7684\u662f\uff0c\u521b\u5efa\u4e00\u5bf9\u865a\u62df\u7f51\u5361\uff0c\u5e76\u4e14\u5c06\u5176\u4e2d\u4e00\u7aef\u653e\u5165<code>net namespace</code>\u4e2d\uff0c\u53e6\u5916\u4e00\u7aef\u52a0\u5165\u521a\u521a\u521b\u5efa\u597d\u7684<code>bridge</code>\uff0c\u5e76\u4e14\u4e3a<code>net namespace</code>\u4e2d\u7684\u7f51\u5361\u914d\u7f6e<code>ip</code>\u5730\u5740\uff0c\u770b\u662f\u5426\u80fd\u591f\u548c\u5916\u90e8\u76f4\u63a5\u901a\u4fe1\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link add name veth0 type veth peer name veth1\n[root@localhost]:[~][tty:0]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp4s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master br0 state UP group default qlen 1000\n    link/ether 02:42:ac:11:65:bd brd ff:ff:ff:ff:ff:ff\n    inet6 fe80::56e1:adff:fee7:de8d/64 scope link\n       valid_lft forever preferred_lft forever\n3: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 0a:27:75:b4:30:69 brd ff:ff:ff:ff:ff:ff\n    inet 192.168.100.136/24 scope global br0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::827:75ff:feb4:3069/64 scope link\n       valid_lft forever preferred_lft forever\n4: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ba:00:10:0e:f2:df brd ff:ff:ff:ff:ff:ff\n5: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether a6:27:b0:61:da:eb brd ff:ff:ff:ff:ff:ff\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u5982\u4e0a\uff0c\u521b\u5efa\u4e86\u4e00\u5bf9\u865a\u62df\u7f51\u5361\uff0c\u540d\u79f0\u5206\u522b\u4e3a<code>veth0</code>\u548c<code>veth1</code>\u3002</p> <p>\u73b0\u5728\u9700\u8981\u65b0\u5f00\u4e00\u4e2a\u7ec8\u7aef\uff0c\u521b\u5efa\u4e00\u4e2a\u5168\u65b0\u7684<code>net namespace</code>\u3002</p> <pre><code>[root@localhost]:[~][tty:1]# unshare -m -i -u -n -f /bin/bash\n(unshare) [root@localhost]:[~][tty:1]#\n(unshare) [root@localhost]:[~][tty:1]# echo $$\n1283\n(unshare) [root@localhost]:[~][tty:1]#\n(unshare) [root@localhost]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre> <p>\u5982\u4e0a\uff0c\u521b\u5efa\u4e86\u4e00\u4e2a\u4e00\u4e2a<code>net namespace</code>\uff0c\u67e5\u770b<code>ip</code>\uff0c\u53ea\u6709\u672c\u5730\u56de\u73af\u5730\u5740<code>lo</code>\u3002</p> <p>\u5207\u56de\u539f\u6765\u7684\u7ec8\u7aef\uff0c\u5c06<code>veth1</code>\u79fb\u5165\u5230\u521a\u521a\u521b\u5efa\u7684<code>net namespace</code>\u4e2d\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link set veth1 netns 1283\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u56de\u5230<code>net namespace</code>\u540e\uff0c\u53ef\u4ee5\u770b\u5230\u5df2\u7ecf\u79fb\u5165\u8fc7\u6765\u7684\u7f51\u5361\u5730\u5740\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n4: veth1@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ba:00:10:0e:f2:df brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/22/linux_network_bridge-2.html#_4","title":"\u914d\u7f6e\u865a\u62df\u7f51\u5361\u5730\u5740","text":"<p>\u4e0a\u8ff0\u5df2\u7ecf\u5c06<code>veth1</code>\u79fb\u5165\u5230\u4e86<code>net namespace</code>\u4e2d\uff0c\u73b0\u5728\u9700\u8981\u5c06\u5916\u9762\u7684<code>veth0</code>\u7ed9\u52a0\u5165\u5230<code>bridge</code>\u865a\u62df\u8bbe\u5907<code>br0</code>\u4e2d\uff0c\u5e76\u4e14\u5c06\u7f51\u5361\u7ed9\u6253\u5f00\u3002</p> <pre><code>[root@localhost]:[~][tty:0]# ip link set veth0 master br0\n[root@localhost]:[~][tty:0]# ip link set veth0 up\n[root@localhost]:[~][tty:0]#\n</code></pre> <p>\u5728<code>net namespace</code>\u4e2d\uff0c\u9700\u8981\u4e3a\u521a\u521a\u79fb\u5165\u7684<code>veth1</code>\u914d\u7f6e<code>ip</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ip addr add 192.168.100.137/24 dev veth1\n(unshare) [root@localhost]:[~][tty:1]#\n(unshare) [root@localhost]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n4: veth1@if6: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ba:00:10:0e:f2:df brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.100.137/24 scope global veth1\n       valid_lft forever preferred_lft forever\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre> <p>\u5e76\u4e14\u5c06\u7f51\u5361\u7ed9\u6253\u5f00\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ip link set veth1 up\n(unshare) [root@localhost]:[~][tty:1]#\n(unshare) [root@localhost]:[~][tty:1]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n5: veth1@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ba:00:10:0e:f2:df brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 192.168.100.137/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::b800:10ff:fe0e:f2df/64 scope link tentative\n       valid_lft forever preferred_lft forever\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre> <p>\u5c1d\u8bd5<code>ping</code>\u4e00\u4e0b\u7f51\u5173\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ping 192.168.100.1 -c 3\nPING 192.168.100.1 (192.168.100.1) 56(84) bytes of data.\n64 bytes from 192.168.100.1: icmp_seq=1 ttl=64 time=1.28 ms\n64 bytes from 192.168.100.1: icmp_seq=2 ttl=64 time=0.704 ms\n64 bytes from 192.168.100.1: icmp_seq=3 ttl=64 time=0.690 ms\n\n--- 192.168.100.1 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2030ms\nrtt min/avg/max/mdev = 0.690/0.890/1.278/0.273 ms\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre> <p>\u4f46\u662f<code>ping</code>\u5916\u7f51\uff0c\u4f9d\u7136\u4f1a\u62a5\u9519\u7f51\u7edc\u4e0d\u53ef\u8fbe\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ping 8.8.8.8 -c 3\nping: connect: Network is unreachable\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a\u5728<code>net namespace</code>\u4e2d\uff0c\u6ca1\u6709\u6dfb\u52a0\u9ed8\u8ba4\u8def\u7531\uff0c\u9700\u8981\u6dfb\u52a0\u4e0a\u53bb\u5373\u53ef\u3002</p> <pre><code>(unshare) [root@localhost]:[~][tty:1]# ip route add default via 192.168.100.1\n(unshare) [root@localhost]:[~][tty:1]#\n(unshare) [root@localhost]:[~][tty:1]# ping 8.8.8.8 -c 3\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=36.9 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=34.6 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=55 time=33.5 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2004ms\nrtt min/avg/max/mdev = 33.493/35.014/36.908/1.418 ms\n(unshare) [root@localhost]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/22/linux_network_bridge-2.html#_5","title":"\u603b\u7ed3","text":"<p>\u5982\u679c\u662f\u6865\u63a5\u7684\u771f\u5b9e\u7f51\u5361\uff0c\u4e14\u4e0d\u505a<code>nat</code>\u7684\u8bdd\uff0c\u5219\u4e0d\u9700\u8981\u8fdb\u884c<code>ip</code>\u8f6c\u53d1\uff0c<code>ip</code>\u8f6c\u53d1\u4e00\u822c\u5728\u4e0d\u540c\u7f51\u7edc\u4e4b\u95f4\u901a\u4fe1\u624d\u9700\u8981\u5f00\u542f\uff0c\u6bd4\u5982\uff0c\u8fd9\u53f0\u673a\u5668\u7684\u8f6c\u53d1\u5c31\u6ca1\u6709\u5f00\uff0c\u4e0d\u5f71\u54cd\u5b83\u6865\u63a5\u865a\u62df\u7f51\u5361\uff0c\u548c\u5916\u90e8\u8fdb\u884c\u901a\u4fe1\u3002</p> <pre><code>[root@localhost]:[~][tty:3]# cat /proc/sys/net/ipv4/ip_forward\n0\n[root@localhost]:[~][tty:3]#\n</code></pre> <p>\u8fd8\u6709\uff0c\u4e00\u5b9a\u5728\u771f\u5b9e\u7684\u673a\u5668\u4e0b\u64cd\u4f5c\uff0c\u6211\u64cd\u4f5c\u4e86<code>vmware</code>\u7b49\u865a\u62df\u673a\uff0c\u5373\u4f7f\u5728<code>linux</code>\u4e2d\uff0c\u5f00\u542f\u4e86\u6df7\u5408\u6a21\u5f0f\u7684\u60c5\u51b5\u4e0b\uff0c\u5916\u90e8<code>ping veth</code>\u7684\u6570\u636e\u5305\u6700\u591a\u53ea\u80fd\u8fbe\u5230<code>br0</code>\uff0c\u5c31\u4e22\u4e86\uff0c\u5e94\u8be5\u662f\u548c\u865a\u62df\u673a\u6709\u5173\u7cfb\u3002</p>"},{"location":"2024/11/25/docker_network.html","title":"docker\u7684\u51e0\u79cd\u7f51\u7edc\u6a21\u5f0f","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd<code>docker</code>\u7684\u51e0\u79cd\u7f51\u7edc\u6a21\u5f0f\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff0c\u53ea\u4ecb\u7ecd\u5982\u4f55\u5b9e\u73b0\uff0c\u4e0d\u4f1a\u6d89\u53ca\u5230\u4efb\u4f55\u7684<code>docker</code>\u64cd\u4f5c\u3002</p> <p>\u672c\u6587\u6240\u4f9d\u8d56\u7684\u73af\u5883\u4e3a\uff1a</p> <pre><code>root@debian:~# hostnamectl \n Static hostname: windows11pro\n       Icon name: windowsBooks\n         Chassis: laptop \ud83d\udcbb\nOperating System: Debian GNU/Linux 12 (bookworm)  \n          Kernel: Linux 6.1.0-26-amd64\n    Architecture: x86-64\n Hardware Vendor: ASUSTeK COMPUTER INC.\n  Hardware Model: X441UVK\nFirmware Version: X441UVK.314\nroot@debian:~#\n\n</code></pre> <p><code>docker</code>\u7684\u7f51\u7edc\u6a21\u5f0f\u53ef\u4ee5\u5206\u4e3a\u5982\u4e0b\u56db\u7c7b\u3002</p> <ul> <li><code>bridge</code>\u6a21\u5f0f\uff0c\u6b64\u6a21\u5f0f\u662f<code>docker</code>\u7684\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u901a\u8fc7\u521b\u5efa\u865a\u62df\u7f51\u6865<code>bridge</code>\u3001<code>veth</code>\u7684\u65b9\u5f0f\u914d\u5408<code>iptables nat</code>\u505a\u7f51\u7edc\u8f6c\u53d1\u3002</li> <li><code>Host</code>\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4f7f\u7528\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u914d\u7f6e\u3002</li> <li><code>Container</code>\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4f7f\u7528\u5176\u4ed6\u5bb9\u5668\u7684\u7f51\u7edc\u914d\u7f6e\u3002</li> <li><code>None</code>\u6a21\u5f0f\uff0c\u8be5\u6a21\u5f0f\u4e0d\u4f7f\u7528\u4efb\u4f55\u7f51\u7edc\u529f\u80fd\u3002</li> </ul>"},{"location":"2024/11/25/docker_network.html#none","title":"<code>None</code>\u6a21\u5f0f","text":"<p>\u6240\u8c13\u7684<code>None</code>\u6a21\u5f0f\uff0c\u4e5f\u662f\u6700\u7b80\u5355\u7684\u6a21\u5f0f\uff0c\u5b83\u5728\u521b\u5efa\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u5176\u5206\u914d<code>net namespace</code>\uff0c\u4f46\u662f\u5728<code>net namespace</code>\u4e2d\uff0c\u4e0d\u4f1a\u4e3a\u5176\u5206\u914d<code>ip</code>\u5730\u5740\uff0c\u8ba9\u5176\u5b8c\u5168\u4e0d\u5177\u5907\u7f51\u7edc\u4e92\u901a\u80fd\u529b\u3002</p> <p>\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a</p> <pre><code>[root@debian]:[~][tty:2]# unshare --mount --ipc --pid --net --uts --fork /bin/bash\n(unshare) [root@debian]:[~][tty:2]# mount -t proc proc /proc\n(unshare) [root@debian]:[~][tty:2]# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.1   7196  3780 pts/2    S    22:06   0:00 /bin/bash\nroot           3  0.0  0.2  11084  4456 pts/2    R+   22:06   0:00 ps aux\n(unshare) [root@debian]:[~][tty:2]#\n(unshare) [root@debian]:[~][tty:2]# echo $$\n1\n(unshare) [root@debian]:[~][tty:2]#\n(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@debian]:[~][tty:2]#\n(unshare) [root@debian]:[~][tty:2]# ping 127.0.0.1 -c 4\nping: connect: Network is unreachable\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u4f7f\u7528<code>unshare</code>\u5c06<code>/bin/bash</code>\u653e\u5165\u65b0\u7684<code>namespace</code>\u4e2d\u6267\u884c\uff0c\u5176\u4e2d\u5c31\u6307\u5b9a\u4e86<code>net namespace</code>\uff0c\u4f46\u662f\u5e76\u672a\u4e3a\u5176\u5206\u914d<code>ip</code>\u5730\u5740\uff0c\u6240\u4ee5\u8be5\u5bb9\u5668\u4e0b\u64cd\u4f5c\u4e0d\u4e86\u4efb\u4f55\u7f51\u7edc\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u672c\u5730\u56de\u73af\u5730\u5740\u4e5f\u662f\u5173\u95ed\u7684\uff0c\u751a\u81f3<code>ping</code>\u4e0d\u901a<code>127.0.0.1</code>\u3002\u8fd9\u5c31\u662f\u5bb9\u5668\u7684<code>None</code>\u6a21\u5f0f\u3002</p> <p>\u8fd9\u91cc\u518d\u6b21\u4ecb\u7ecd\u4e0b<code>unshare</code>\u547d\u4ee4\u7684\u542b\u4e49\uff1a</p> <ul> <li><code>--mount</code>\uff1a\u542f\u7528<code>mount namespace</code>\u3002</li> <li><code>--ipc</code>\uff1a\u542f\u7528<code>ipc namespace</code>\u3002</li> <li><code>--pid</code>\uff1a\u542f\u7528<code>pid namespace</code>\u3002</li> <li><code>--net</code>\uff1a\u542f\u7528<code>net namespace</code>\u3002</li> <li><code>--uts</code>\uff1a\u542f\u7528<code>uts namespace</code>\u3002</li> <li><code>--fork</code>\uff1a<code>unshare</code>\u5c06\u4f1a<code>fork</code>\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u542f\u52a8\u8fdb\u7a0b\u3002</li> <li><code>/bin/bash</code>\uff1a\u5f85\u542f\u52a8\u7684\u8fdb\u7a0b\u3002</li> </ul> <p>\u5177\u4f53<code>namespace</code>\u76f8\u5173\u4fe1\u606f\uff0c\u53ef\u4ee5\u67e5\u770b\u8fd9\u91cc\u5173\u4e8e<code>namespace</code>\u7684\u7b80\u5355\u4ecb\u7ecd\u3002</p> <p>https://wangli2025.github.io/2024/11/05/Linux-Namespace.html</p>"},{"location":"2024/11/25/docker_network.html#host","title":"<code>Host</code>\u6a21\u5f0f","text":"<p>\u6240\u8c13\u7684<code>host</code>\u6a21\u5f0f\uff0c\u5373\u521b\u5efa\u8fdb\u7a0b\u7684\u65f6\u5019\u4e0d\u4f7f\u7528<code>net namespace</code>\uff0c\u4e0d\u505a\u7f51\u7edc\u9694\u79bb\uff0c\u8ba9\u5176\u548c\u5bbf\u4e3b\u673a\u7684\u4e00\u81f4\uff0c\u5373\u4f7f\u7528\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u4fe1\u606f\u3002</p> <p>\u8bf7\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\u3002</p> <p>\u9996\u5148\u67e5\u770b\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u4fe1\u606f\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:0c:29:36:bb:82 brd ff:ff:ff:ff:ff:ff\n    altname enp2s1\n    inet 192.168.11.135/24 scope global ens33\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe36:bb82/64 scope link\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:2]#\n[root@debian]:[~][tty:2]# ping 8.8.8.8 -c 2\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=34.0 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=34.5 ms\n\n--- 8.8.8.8 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1003ms\nrtt min/avg/max/mdev = 33.992/34.226/34.461/0.234 ms\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u5176\u6b21\u4f7f\u7528<code>unshare</code>\u542f\u52a8<code>bash</code>\u8fdb\u7a0b\u5e76\u4e14\u4e3a\u5176\u5206\u914d\u76f8\u5173\u7684<code>namespace</code>\uff0c\u4f46\u662f\u4e0d\u8981\u914d\u7f6e<code>net namespace</code>\uff0c\u56e0\u4e3a\u4e0d\u9700\u8981\u505a\u7f51\u7edc\u9694\u79bb\u3002</p> <pre><code>[root@debian]:[~][tty:2]# unshare --mount --ipc --pid --uts --fork /bin/bash\n(unshare) [root@debian]:[~][tty:2]# mount -t proc proc /proc\n(unshare) [root@debian]:[~][tty:2]# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.1   7196  3868 pts/2    S    22:19   0:00 /bin/bash\nroot           3  0.0  0.2  11084  4412 pts/2    R+   22:20   0:00 ps aux\n(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 00:0c:29:36:bb:82 brd ff:ff:ff:ff:ff:ff\n    altname enp2s1\n    inet 192.168.11.135/24 scope global ens33\n       valid_lft forever preferred_lft forever\n    inet6 fe80::20c:29ff:fe36:bb82/64 scope link\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]# ping -c 2 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=55 time=33.8 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=55 time=34.5 ms\n\n--- 8.8.8.8 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 33.767/34.149/34.531/0.382 ms\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u4e0a\u8ff0\u5bb9\u5668\u521b\u5efa\u5b8c\u6210\u540e\uff0c\u4f7f\u7528<code>mount</code>\u6302\u8f7d<code>proc</code>\uff0c\u4f7f\u7528<code>ps aux</code>\u67e5\u770b\u5176\u8fd0\u884c\u7684\u8fdb\u7a0b\u4fe1\u606f\uff0c\u8bc1\u660e\u8be5\u5bb9\u5668\u5df2\u7ecf\u751f\u6548\u4e86\uff0c\u800c\u540e\u67e5\u8be2\u7f51\u7edc\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5bb9\u5668\u4e2d\u7684\u7f51\u7edc\u548c\u5bbf\u4e3b\u673a\u7684\u7f51\u7edc\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c</p>"},{"location":"2024/11/25/docker_network.html#bridge","title":"<code>bridge</code>\u6a21\u5f0f","text":"<p><code>bridge</code>\u4e5f\u662f<code>Docker</code>\u9ed8\u8ba4\u7684\u6a21\u5f0f\uff0c\u5b9e\u9645\u4e0a\u5e95\u5c42\u7684\u903b\u8f91\u662f\u865a\u62df\u7f51\u6865<code>bridge</code>\u914d\u5408<code>veth</code>\u865a\u62df\u8bbe\u5907\uff0c\u7136\u540e\u518d\u5bbf\u4e3b\u673a\u4e0a\u505a<code>nat</code>\u8c03\u6574\u6765\u5b9e\u73b0\u7684\uff0c\u5373\u53ea\u8981\u591a\u4e2a\u5bb9\u5668\u7684<code>veth</code>\u7684\u4e00\u7aef\u8fde\u63a5\u5728\u4e00\u4e2a\u865a\u62df\u7f51\u6865<code>bridge</code>\u4e0a\uff0c\u8fd9\u4e9b\u5bb9\u5668\u5c31\u662f\u4e92\u76f8\u901a\u4fe1\u7684\u3002</p> <p><code>bridge</code>\u6a21\u5f0f\u7684\u7f51\u7edc\u76f8\u5bf9\u800c\u8a00\u8f83\u4e3a\u590d\u6742\uff0c\u9700\u8981\u5148\u5728\u5bbf\u4e3b\u673a\u4e0a\u521b\u5efa\u865a\u62df\u7f51\u6865<code>bridge</code>\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip link add name br0 type bridge\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u5176\u7f51\u7edc\u8bbe\u5907\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip addr show br0\n3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ee:8c:54:c2:94:34 brd ff:ff:ff:ff:ff:ff\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u7136\u540e\u518d\u4e3a\u6bcf\u4e00\u4e2a\u5bb9\u5668\u90fd\u521b\u5efa\u4e00\u5bf9<code>veth</code>\u865a\u62df\u63a5\u53e3\uff0c\u5c06\u5176\u4e00\u7aef\u63a5\u5165\u5230\u9700\u8981\u52a0\u5165\u7684\u865a\u62df\u7f51\u6865\u4e2d<code>bridge</code>\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip link add name veth0 type veth peer name veth1\n[root@debian]:[~][tty:2]# ip link set veth0 master br0\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u5176<code>veth</code>\u8bbe\u5907\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip addr show veth0\n5: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop master br0 state DOWN group default qlen 1000\n    link/ether 06:71:18:de:a8:97 brd ff:ff:ff:ff:ff:ff\n[root@debian]:[~][tty:2]# ip addr show veth1\n4: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bb9\u5668\uff0c\u5e76\u4e14\u5c06<code>veth1</code>\u79fb\u5165\u8fdb\u53bb\u3002</p> <pre><code>[root@debian]:[~][tty:2]# unshare --mount --uts --ipc --net --fork /bin/bash\n(unshare) [root@debian]:[~][tty:2]# echo $$\n2945\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u521b\u5efa\u5bb9\u5668\u540e\uff0c\u53ef\u4ee5\u67e5\u770b\u5176\u9ed8\u8ba4\u7684\u7f51\u5361\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\u5c06<code>veth1</code>\u7f51\u5361\u79fb\u5165\u5230<code>2945</code>\u8fdb\u7a0b\u4e2d\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip link set veth1 netns 2945\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u79fb\u5165\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u5728\u5bb9\u5668\u4e2d\u67e5\u770b\u5176<code>ip</code>\u4fe1\u606f\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n4: veth1@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5f53\u94fe\u8def\u90fd\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u9700\u8981\u4e3a\u5176\u5206\u914d<code>ip</code>\u5730\u5740\uff0c\u5728\u5bb9\u5668\u5185\u6307\u5b9a\u9ed8\u8ba4\u8def\u7531\uff0c\u914d\u7f6e<code>ip</code>\u8f6c\u53d1\u7b49\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u914d\u7f6e<code>br0</code>\u5730\u5740\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip addr add 10.0.3.2/24 dev br0\n[root@debian]:[~][tty:3]# ip addr show br0\n3: br0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ee:8c:54:c2:94:34 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.3.2/24 scope global br0\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5728\u5bb9\u5668\u5185\u4e3a<code>veth1</code>\u5206\u914d<code>ip</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip addr add 10.0.3.3/24 dev veth1\n(unshare) [root@debian]:[~][tty:2]# ip addr\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n4: veth1@if5: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth1\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u542f\u52a8<code>br0</code>\u3001<code>veth0</code>\u4ee5\u53ca<code>veth1</code>\u7f51\u5361\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u542f\u52a8<code>br0</code>\u548c<code>veth0</code>\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip link set br0 up\n[root@debian]:[~][tty:3]# ip link set veth0 up\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# ip addr show br0\n3: br0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether ee:8c:54:c2:94:34 brd ff:ff:ff:ff:ff:ff\n    inet 10.0.3.2/24 scope global br0\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# ip addr show veth0\n5: veth0@if4: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue master br0 state LOWERLAYERDOWN group default qlen 1000\n    link/ether 06:71:18:de:a8:97 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\uff0c<code>veth0</code>\u5df2\u7ecf\u63a5\u5165\u4e86\u865a\u62df\u7f51\u6865<code>br0</code>\u4e2d\uff0c\u6240\u4ee5\u5c31\u4e0d\u9700\u8981\u518d\u4e3a\u5176\u5206\u914d<code>ip</code>\u5730\u5740\u4e86\u3002</p> <p>\u5728\u5bb9\u5668\u4e2d\u542f\u52a8<code>veth1</code>\u7f51\u5361\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip link set veth1 up\n(unshare) [root@debian]:[~][tty:2]# ip addr\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n4: veth1@if5: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5728\u5bb9\u5668\u4e2d\u6dfb\u52a0\u9ed8\u8ba4\u8def\u7531\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip route\n10.0.3.0/24 dev veth1 proto kernel scope link src 10.0.3.3\n(unshare) [root@debian]:[~][tty:2]# ip route add default via 10.0.3.2\n(unshare) [root@debian]:[~][tty:2]# ip route\ndefault via 10.0.3.2 dev veth1\n10.0.3.0/24 dev veth1 proto kernel scope link src 10.0.3.3\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a\u76f8\u4e92<code>ping</code>\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a<code>ping</code>\u5bb9\u5668\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ping 10.0.3.3 -c 3\nPING 10.0.3.3 (10.0.3.3) 56(84) bytes of data.\n64 bytes from 10.0.3.3: icmp_seq=1 ttl=64 time=0.035 ms\n64 bytes from 10.0.3.3: icmp_seq=2 ttl=64 time=0.049 ms\n64 bytes from 10.0.3.3: icmp_seq=3 ttl=64 time=0.043 ms\n\n--- 10.0.3.3 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2036ms\nrtt min/avg/max/mdev = 0.035/0.042/0.049/0.005 ms\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5728\u5bb9\u5668<code>ping</code>\u5bbf\u4e3b\u673a\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ping -c 3 10.0.3.2\nPING 10.0.3.2 (10.0.3.2) 56(84) bytes of data.\n64 bytes from 10.0.3.2: icmp_seq=1 ttl=64 time=0.019 ms\n64 bytes from 10.0.3.2: icmp_seq=2 ttl=64 time=0.031 ms\n64 bytes from 10.0.3.2: icmp_seq=3 ttl=64 time=0.044 ms\n\n--- 10.0.3.2 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2045ms\nrtt min/avg/max/mdev = 0.019/0.031/0.044/0.010 ms\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u6b64\u65f6\u5728\u5bb9\u5668\u4e2d\u662f\u65e0\u6cd5\u4e0a\u7f51\u7684\uff0c\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u4e0a\u8bbe\u7f6e<code>ip</code>\u8f6c\u53d1\u624d\u884c\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ping -c 3 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 0 received, 100% packet loss, time 2041ms\n\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\u5f00\u542f<code>ip</code>\u8f6c\u53d1\u3002</p> <pre><code>[root@debian]:[~][tty:3]# /usr/sbin/sysctl net.ipv4.conf.all.forwarding=1\nnet.ipv4.conf.all.forwarding = 1\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5e76\u4e14\u4f7f\u7528<code>iptables</code>\u505a\u4e00\u4e2a<code>nat</code>\u8f6c\u53d1\u89c4\u5219\u3002</p> <pre><code>[root@debian]:[~][tty:3]# /usr/sbin/iptables -t nat -A POSTROUTING -s 10.0.3.0/24 -j MASQUERADE\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u6b64\u65f6\u5728\u5bb9\u5668\u4e2d\uff0c\u5c31\u53ef\u4ee5<code>ping</code>\u901a\u5916\u7f51\u4e86\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ping -c 3 8.8.8.8\nPING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.\n64 bytes from 8.8.8.8: icmp_seq=1 ttl=54 time=34.1 ms\n64 bytes from 8.8.8.8: icmp_seq=2 ttl=54 time=33.9 ms\n64 bytes from 8.8.8.8: icmp_seq=3 ttl=54 time=34.3 ms\n\n--- 8.8.8.8 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2006ms\nrtt min/avg/max/mdev = 33.945/34.125/34.321/0.153 ms\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/25/docker_network.html#container","title":"<code>Container</code>\u6a21\u5f0f","text":"<p>\u6240\u8c13\u7684<code>Container</code>\u6a21\u5f0f\uff0c\u5176\u5b9e\u662f\u63072\u4e2a\u5bb9\u5668\u7684\u90fd\u4f7f\u7528\u540c\u4e00\u4e2a<code>net namespace</code>\u5373\u53ef\u3002</p> <p>\u8fd9\u91cc\u6765\u5b9e\u64cd\u4e00\u4e0b\uff0c\u5148\u4f7f\u7528<code>unshare</code>\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u3002</p> <p>\u9996\u5148\uff0c\u5148\u5728\u5bbf\u4e3b\u673a\u521b\u5efa\u4e00\u5bf9<code>veth</code>\u3002</p> <pre><code>[root@debian]:[~][tty:2]# ip link add name veth0 type veth peer name veth1\n[root@debian]:[~][tty:2]# ip addr show veth0\n4: veth0@veth1: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether 06:71:18:de:a8:97 brd ff:ff:ff:ff:ff:ff\n[root@debian]:[~][tty:2]#\n[root@debian]:[~][tty:2]# ip addr show veth1\n3: veth1@veth0: &lt;BROADCAST,MULTICAST,M-DOWN&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff\n[root@debian]:[~][tty:2]#\n[root@debian]:[~][tty:2]#\n</code></pre> <p>\u63a5\u7740\uff0c\u4fbf\u4f7f\u7528<code>unshare</code>\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u3002</p> <pre><code>[root@debian]:[~][tty:2]# unshare --mount --ipc --uts --net --fork /bin/bash\n(unshare) [root@debian]:[~][tty:2]#\n(unshare) [root@debian]:[~][tty:2]# echo $$\n2942\n(unshare) [root@debian]:[~][tty:2]#\n(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u4e0a\u8ff0\u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u6307\u5b9a<code>pid namespace</code>\uff0c\u662f\u4e3a\u4e86\u66f4\u52a0\u65b9\u4fbf\u7684\u67e5\u770b\u5176<code>pid</code>\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\uff0c\u5c06<code>veth1</code>\u79fb\u5982\u5230\u5bb9\u5668\u4e2d\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip link set veth1 netns 2942\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u56de\u5230\u5bb9\u5668\uff0c\u67e5\u770b\u5176<code>ip</code>\u5730\u5740\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5e76\u4e14\u5728\u5bb9\u5668\u4e2d\u8bbe\u7f6e<code>veth1</code>\u7684\u5730\u5740\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip addr add 10.0.3.2/24 dev veth1\n(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u5728\u5bbf\u4e3b\u673a\u8bbe\u7f6e<code>veth0</code>\u7684\u5730\u5740\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip addr add 10.0.3.3/24 dev veth0\n[root@debian]:[~][tty:3]# ip addr show veth0\n4: veth0@if3: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noqueue state DOWN group default qlen 1000\n    link/ether 06:71:18:de:a8:97 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.3/24 scope global veth0\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5206\u522b\u542f\u52a82\u4e2a\u7f51\u5361\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip link set veth1 up\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <pre><code>[root@debian]:[~][tty:3]# ip link set veth0 up\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5c1d\u8bd5\u76f8\u4e92<code>ping</code>\u3002</p> <p>\u5bbf\u4e3b\u673a<code>ping</code>\u5bb9\u5668\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ping -c 2 10.0.3.2\nPING 10.0.3.2 (10.0.3.2) 56(84) bytes of data.\n64 bytes from 10.0.3.2: icmp_seq=1 ttl=64 time=0.029 ms\n64 bytes from 10.0.3.2: icmp_seq=2 ttl=64 time=0.042 ms\n\n--- 10.0.3.2 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1021ms\nrtt min/avg/max/mdev = 0.029/0.035/0.042/0.006 ms\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u5bb9\u5668<code>ping</code>\u5bbf\u4e3b\u673a</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ping -c 2 10.0.3.3\nPING 10.0.3.3 (10.0.3.3) 56(84) bytes of data.\n64 bytes from 10.0.3.3: icmp_seq=1 ttl=64 time=0.015 ms\n64 bytes from 10.0.3.3: icmp_seq=2 ttl=64 time=0.076 ms\n\n--- 10.0.3.3 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1024ms\nrtt min/avg/max/mdev = 0.015/0.045/0.076/0.030 ms\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u57fa\u7840\u73af\u5883\u5df2\u7ecf\u642d\u5efa\u597d\u4e86\uff0c\u73b0\u5728\u8981\u989d\u5916\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5e76\u4e14\u8be5\u8fdb\u7a0b\u53ea\u6709<code>net namesapce</code>\u4f7f\u7528\u4e0a\u8ff0<code>pid</code>\u4e3a<code>2942</code>\u8fdb\u7a0b\u7684\u3002</p> <p>\u4e3a\u6b64\uff0c\u6211\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u4e2a\u7b80\u5355\u7684<code>c</code>\u7a0b\u5e8f\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code># define _GNU_SOURCE\n# include &lt;stdio.h&gt;\n# include &lt;stdlib.h&gt;\n# include &lt;sched.h&gt;\n# include &lt;fcntl.h&gt;\n# include &lt;unistd.h&gt;\n\n// \u8fdb\u5165\u6307\u5b9aPID\u7684net namespace\nint enterNetworkNamespace(char *pid) {\n    char buffer[1024];\n\n    // net namespace\u6587\u4ef6\u8def\u5f84\n    snprintf(buffer,1024,\"/proc/%s/ns/net\",pid);\n\n    int fd = open(buffer,O_RDONLY);\n    if (-1 == fd) {\n        printf(\"open net namespace fd error\\n\");\n        fflush(stdout);\n        return -1;\n    }\n\n    // \u4f7f\u7528setns\u8fdb\u5165namespace\n    if (-1 == setns(fd,0)){\n        printf(\"enter net namespace error\\n\");\n        fflush(stdout);\n        return -1;\n    }\n\n    printf(\"enter net namespace successful...\\n\");\n    fflush(stdout);\n    close(fd);\n    return 0;\n}\n\nint main() {\n\n    // mount namespace\n    // ipc namespace\n    // pid namespace\n    // uts namespace\n    int cloneFlags = CLONE_NEWNS | CLONE_NEWIPC | CLONE_NEWPID | CLONE_NEWUTS;\n\n    // \u521b\u5efa\u65b0\u7684namesapce\n    if (unshare(cloneFlags) &lt; 0) {\n        perror(\"unshare\");\n        exit(EXIT_FAILURE);\n    }\n\n    // \u8fdb\u5165\u5df2\u6709\u7684net namespace\n    if ( -1 == enterNetworkNamespace(\"2942\")){\n        printf(\"enter namesapce error\");\n    }\n\n    system(\"/bin/bash\");\n\n    return 0;\n}\n</code></pre> <p>\u4e0a\u8ff0\u4ee3\u7801\u975e\u5e38\u7b80\u5355\uff0c\u9996\u5148\u4f7f\u7528<code>unshare</code>\u521b\u5efa<code>mount namespace</code>\u3001<code>ipc namespace</code>\u3001<code>pid namespace</code>\u4ee5\u53ca<code>uts namespace</code>\u3002</p> <p>\u7136\u540e\u8bfb\u53d6\u8fdb\u7a0b\u4e3a<code>2942</code>\u7684<code>net namespace</code>\u63cf\u8ff0\u7b26\uff0c</p> <p>\u7f16\u8bd1\u8be5<code>c</code>\u7a0b\u5e8f\uff0c\u5e76\u4e14\u6267\u884c\uff0c\u67e5\u770b\u5176<code>ip</code>\u5730\u5740\u3002</p> <pre><code>[root@debian]:[~][tty:3]# gcc testNetNamespace.c\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# ./a.out\nenter net namespace successful...\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# mount -t proc proc /proc\n[root@debian]:[~][tty:3]#\n[root@debian]:[~][tty:3]# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.0   2576   900 pts/3    S    02:36   0:00 sh -c /bin/bash\nroot           2  0.0  0.1   7196  3896 pts/3    S    02:36   0:00 /bin/bash\nroot           5  0.0  0.2  11084  4408 pts/3    R+   02:37   0:00 ps aux\n[root@debian]:[~][tty:3]#\n</code></pre> <p>\u73b0\u57282\u4e2a\u5bb9\u5668\uff0c\u90fd\u4f7f\u7528\u540c\u4e00\u4e2a<code>net namespace</code>\uff0c\u90a3\u5982\u679c2\u4e2a\u5bb9\u5668\u90fd\u76d1\u542c\u5404\u81ea\u7684<code>80</code>\u7aef\u53e3\uff0c\u90a3\u4e48\u5f53\u8bf7\u6c42\u6765\u7684\u65f6\u5019\uff0c\u662f\u54262\u8005\u90fd\u53ef\u4ee5\u6536\u5230\u5462\uff1f</p> <p>\u5148\u57282\u4e2a\u5bb9\u5668\u4e2d\u4f7f\u7528<code>nc</code>\u76d1\u542c<code>tcp</code>\u7684<code>80</code>\u7aef\u53e3\u3002</p> <p>\u4f7f\u7528<code>unshare</code>\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u76d1\u542c<code>80</code>\u7aef\u53e3\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]# nc -lp 80\n\n</code></pre> <p>\u4f7f\u7528<code>c</code>\u7a0b\u5e8f\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u76d1\u542c<code>80</code>\u7aef\u53e3\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]# nc -lp 80\n\n</code></pre> <p>\u6b64\u65f6\uff0c\u518d\u542f\u52a8\u4e00\u4e2a\u7ec8\u7aef\uff0c\u6267\u884c <code>telnet 10.0.3.2 80</code>\u3002</p> <pre><code>[root@debian]:[~][tty:4]# telnet 10.0.3.2 80\nTrying 10.0.3.2...\nConnected to 10.0.3.2.\nEscape character is '^]'.\nhello namespaces;\n^]\ntelnet&gt; quit\nConnection closed.\n[root@debian]:[~][tty:4]#\n</code></pre> <p>\u6b64\u65f6\uff0c\u5728\u89c2\u5bdf2\u4e2a\u5bb9\u5668\u7684\u65e5\u5fd7\uff0c\u53ea\u6709\u4e00\u4e2a\u5bb9\u5668\u6536\u5230\u4e86\u6570\u636e\u3002</p> <p>\u4f7f\u7528<code>c</code>\u7a0b\u5e8f\u542f\u52a8\u7684\u5bb9\u5668\u3002</p> <pre><code>[root@debian]:[~][tty:3]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n[root@debian]:[~][tty:3]# nc -lp 80\n------------------------------------------\nhello namespaces;\n[root@debian]:[~][tty:3]#\n</code></pre> <p><code>unshare</code>\u7a0b\u5e8f\u542f\u52a8\u7684\u7a0b\u5e8f\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]# nc -lp 80\n\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a<code>tcp</code>\u662f\u6570\u636e\u6d41\uff0c\u6d88\u8d391\u6b21\u5c31\u6ca1\u4e86\u3002\u82e5\u6b64\u65f6\uff0c\u518d\u8bf7\u6c42\u4e00\u6b21\uff0c\u6d41\u91cf\u5c31\u5fc5\u7136\u4f1a\u6253\u5230<code>unshare</code>\u542f\u52a8\u7684\u8fdb\u7a0b\u4e86\uff0c\u56e0\u4e3a<code>c</code>\u5199\u7684\u8fdb\u7a0b\u7531\u4e8e\u5df2\u7ecf\u6536\u5230\u4e86\u6570\u636e\uff0c<code>nc</code>\u7a0b\u5e8f\u5df2\u7ecf\u7ec8\u6b62\u4e86\u3002</p> <pre><code>[root@debian]:[~][tty:4]# telnet 10.0.3.2 80\nTrying 10.0.3.2...\nConnected to 10.0.3.2.\nEscape character is '^]'.\nhello ;\n^]\ntelnet&gt; quit\nConnection closed.\n[root@debian]:[~][tty:4]#\n</code></pre> <p>\u6b64\u65f6\u6d41\u91cf\uff0c\u5c31\u5728<code>c</code>\u5199\u7684\u7a0b\u5e8f\u4e0a\u4e86\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n3: veth1@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether ce:57:9d:8f:3d:49 brd ff:ff:ff:ff:ff:ff link-netnsid 0\n    inet 10.0.3.2/24 scope global veth1\n       valid_lft forever preferred_lft forever\n    inet6 fe80::cc57:9dff:fe8f:3d49/64 scope link\n       valid_lft forever preferred_lft forever\n(unshare) [root@debian]:[~][tty:2]# nc -lp 80\nhello ;\n(unshare) [root@debian]:[~][tty:2]#\n</code></pre>"},{"location":"2024/11/25/docker_network.html#_1","title":"\u603b\u7ed3","text":"<p>\u6240\u8c13\u7684<code>docker</code>\u51e0\u79cd\u7f51\u7edc\u6a21\u5f0f\uff0c\u5e95\u5c42\u662f\u53d8\u7740\u82b1\u7684\u73a9<code>net namespace</code>\u3002</p> <p><code>Host</code>\u6a21\u5f0f\uff0c\u5176\u5b9e\u662f\u5728\u521b\u5efa\u5bb9\u5668\u7684\u65f6\u5019\uff0c\u4e0d\u6307\u5b9a<code>net namespace</code>\uff0c\u8ba9\u5176\u548c\u5bbf\u4e3b\u673a\u4f7f\u7528\u540c\u4e00<code>namespace</code>\u3002</p> <p><code>bridge</code>\u6a21\u5f0f\uff0c\u5176\u5b9e\u662f\u5728\u5bbf\u4e3b\u673a\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u7f51\u6865<code>bridge</code>\uff0c\u5e76\u4e14\u521b\u5efa\u4e00\u5bf9<code>veth</code>\uff0c\u5206\u522b\u8fde\u63a5\u5bb9\u5668\u548c<code>bridge</code>\uff0c\u4e14\u4f7f\u7528<code>iptables</code>\u505a<code>nat</code>\u8f6c\u53d1\uff0c\u8ba9\u5bb9\u5668\u53ef\u4ee5\u4e0a\u5916\u7f51\u3002</p> <p><code>Conrainer</code>\u6a21\u5f0f\uff0c\u5176\u5b9e\u662f2\u4e2a\u5bb9\u5668\u4ec5\u4f7f\u7528\u540c\u4e00\u4e2a<code>net namespace</code>\uff0c\u5176\u4ed6<code>namespace</code>\u4f9d\u65e7\u4f7f\u7528\u5404\u81ea\u81ea\u5df1\u7684\uff0c\u8fd9\u6837\u770b\u8d77\u6765\uff0c2\u4e2a\u5bb9\u5668\u53ea\u6709\u7f51\u7edc\u662f\u4e00\u6837\u7684\uff0c\u5176\u4f59\u90fd\u8fd8\u662f\u9694\u79bb\u9694\u79bb\u72b6\u6001\u7684\u3002</p> <p>\u6700\u540e\u5c31\u662f<code>None</code>\u6a21\u5f0f\uff0c\u8fd9\u4e2a\u5c31\u66f4\u52a0\u7b80\u5355\u4e86\uff0c\u5b83\u4f7f\u7528\u4e86<code>net namespace</code>\uff0c\u4f46\u662f\u4e0d\u5206\u914d\u4efb\u4f55\u7684\u7f51\u5361\u7ed9\u5b83\uff0c\u8fd9\u6837\u5728\u5bb9\u5668\u4e2d\u5c31\u65e0\u6cd5\u8fdb\u884c\u4e0a\u7f51\u4e86\uff0c\u5f53\u7136\u7f51\u7edc\u4e5f\u662f\u88ab\u9694\u79bb\u4e86\u7684\u3002</p> <p>\u5f53\u4e86\u89e3\u4e86<code>namespace</code>\u4e4b\u540e\uff0c\u4f1a\u610f\u8bc6\u5230\uff0c\u539f\u6765\u7684\u5404\u79cd\u5404\u6837\u7684\u6a21\u5f0f\uff0c\u65b9\u6cd5\uff0c\u5176\u5e95\u5c42\u903b\u8f91\u662f\u5982\u6b64\u7684\u7b80\u5355\u3002</p>"},{"location":"2024/12/09/Vim_closes_the_mouse.html","title":"vim\u5173\u95ed\u9f20\u6807\u53ef\u89c6\u6a21\u5f0f","text":"<p>\u672c\u7bc7\u6587\u7ae0\u5c06\u4ecb\u7ecd<code>vim</code>\u5982\u4f55\u5173\u95ed\u9f20\u6807\u53ef\u89c6\u6a21\u5f0f\u3002</p> <p>\u5982\u679c\u4f60\u4e0d\u4e60\u60efvim\u9f20\u6807\u53ef\u89c6\u6a21\u5f0f\u7684\u8bdd\uff0c\u4e0d\u59a8\u5c1d\u8bd5\u6765\u7981\u7528\u5b83\uff0c\u9996\u5148\u9700\u8981\u786e\u8ba4<code>vim</code>\u7684\u7248\u672c\u53f7\u3002\u4f7f\u7528<code>vim --version</code>\u5373\u53ef\u67e5\u8be2\u3002</p> <pre><code># vim --version\nVIM - Vi IMproved 9.0 (2022 Jun 28, \u7f16\u8bd1\u4e8e May 04 2023 10:24:44)\n\u5305\u542b\u8865\u4e01: 1-1378, 1499\n\u4fee\u6539\u8005 team+vim@tracker.debian.org\n\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u8be5<code>vim</code>\u7248\u672c\u4e3a<code>9.0</code>\uff0c\u9700\u8981\u7f16\u8f91<code>vim</code>\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\uff0c\u5373\uff1a<code>/usr/share/vim/vim90/defaults.vim</code>\uff0c\u6ce8\u610f\uff0c<code>9.0</code>\u7248\u672c\u7684<code>vim</code>\u662f<code>vim90</code>\uff0c\u5982\u679c\u662f\u5176\u4ed6\u7248\u672c\u7684\uff0c\u76f4\u63a5\u66ff\u6362\u8def\u5f84\u5373\u53ef\u3002</p> <p>\u4f7f\u7528<code>mouse</code>\u4f5c\u4e3a\u5173\u952e\u5b57\uff0c\u627e\u5230\u5982\u4e0b\u914d\u7f6e\uff0c<code>9.0</code>\u7248\u672c\uff0c\u5927\u6982\u4f4d\u7f6e\u572877\u884c\u523088\u884c\u4e4b\u95f4\u3002</p> <pre><code># sed -n '77,88p' /usr/share/vim/vim90/defaults.vim\n\" In many terminal emulators the mouse works just fine.  By enabling it you\n\" can position the cursor, Visually select and scroll with the mouse.\n\" Only xterm can grab the mouse events when using the shift key, for other\n\" terminals use \":\", select text and press Esc.\nif has('mouse')\n  if &amp;term =~ 'xterm'\n    set mouse=a\n  else\n    set mouse=nvi\n  endif\nendif\n\n#\n</code></pre> <p>\u7136\u540e\u53ea\u9700\u8981\u5c06\u8fd9\u4e9b\u914d\u7f6e\u7ed9\u6ce8\u91ca\u6389\u5373\u53ef\uff0c\u6ce8\u610f\uff0c\u6ce8\u91ca\u6389\u7684\u8bed\u6cd5\u662f<code>\"</code>\uff0c\u6ce8\u91ca\u540e\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a</p> <pre><code># sed -n '77,88p' /usr/share/vim/vim90/defaults.vim\n\" In many terminal emulators the mouse works just fine.  By enabling it you\n\" can position the cursor, Visually select and scroll with the mouse.\n\" Only xterm can grab the mouse events when using the shift key, for other\n\" terminals use \":\", select text and press Esc.\n\"if has('mouse')\n\"  if &amp;term =~ 'xterm'\n\"    set mouse=a\n\"  else\n\"    set mouse=nvi\n\"  endif\n\"endif\n\n#\n</code></pre> <p>\u90fd\u5c4f\u853d\u540e\uff0c\u518d\u6b21\u6253\u5f00\u6587\u4ef6\uff0c\u5219\u4e0d\u4f1a\u9ed8\u8ba4\u8fdb\u5165\u5230\u9f20\u6807\u53ef\u89c6\u6a21\u5f0f\u4e86\u3002</p>"},{"location":"2024/12/20/internal_network_port_mapping.html","title":"\u5185\u7f51\u7aef\u53e3\u6620\u5c04\u5e94\u8be5\u5982\u4f55\u5b9e\u73b0","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd\u5185\u7f51\u7aef\u53e3\u6620\u5c04\u5e94\u8be5\u5982\u4f55\u5b9e\u73b0\u3002</p>"},{"location":"2024/12/20/internal_network_port_mapping.html#_2","title":"\u524d\u63d0","text":"<p>\u5f88\u591a\u4eba\u6216\u591a\u6216\u5c11\u90fd\u9047\u5230\u8fc7\u8fd9\u6837\u7684\u95ee\u9898\uff1a\u9700\u8981\u5c06\u5185\u7f51\u5f00\u53d1\u4e2d\u7684\u9879\u76ee\u6216\u7f51\u7ad9\u5c55\u793a\u7ed9\u8fdc\u7a0b\u5ba2\u6237\uff0c\u6216\u8005\u7528\u4e8e\u6c47\u62a5\u8fdb\u5ea6\u3002\u7531\u4e8e\u8d44\u6e90\u90fd\u5728\u5185\u7f51\uff0c\u6bcf\u6b21\u64cd\u4f5c\u90fd\u9700\u8981\u8d39\u65f6\u8d39\u529b\u3002\u6240\u4ee5\uff0c\u66f4\u52a0\u5e38\u89c4\u7684\u505a\u6cd5\u662f\u8d2d\u4e70\u4e00\u53f0\u4e91\u670d\u52a1\u5668\uff0c\u4e13\u95e8\u7528\u4e8e\u5ba2\u6237\u6d4f\u89c8\u3002\u4f46\u662f\uff0c\u8fd9\u6837\u7684\u505a\u6cd5\u975e\u5e38\u9ebb\u70e6\uff0c\u5f00\u53d1\u4eba\u5458\u4e0d\u4ec5\u9700\u8981\u517c\u987e\u672c\u5730\u5f00\u53d1\u5de5\u4f5c\uff0c\u8fd8\u8981\u628a\u8d44\u6e90\u63a8\u9001\u5230\u4e13\u7528\u7684\u670d\u52a1\u5668\u4e0a\u4f9b\u5ba2\u6237\u67e5\u770b\u3002</p> <p>\u5982\u679c\u6709\u8fd9\u6837\u4e00\u6b3e\u8f6f\u4ef6\uff0c\u80fd\u591f\u5c06\u5185\u7f51\u7684\u670d\u52a1\u6620\u5c04\u5230\u516c\u7f51\u4e0a\uff0c\u751a\u81f3\u76f4\u63a5\u6620\u5c04\u5230\u5bf9\u65b9\u7684\u5185\u7f51\u4e2d\uff0c\u90a3\u5c82\u4e0d\u662f\u592a\u65b9\u4fbf\u4e86\uff1f\u4e8e\u662f\uff0c\u6211\u82b1\u4e86\u4e00\u4e9b\u65f6\u95f4\u64b8\u4e86\u4e00\u4e2a\u8fd9\u6837\u4e00\u4e2a\u5de5\u5177\uff0c\u5730\u5740\u5728\u8fd9\u91cc\uff1agoRelay\u3002</p>"},{"location":"2024/12/20/internal_network_port_mapping.html#_3","title":"\u89e3\u51b3\u601d\u8def","text":"<p>\u5047\u8bbe\u6709\u8fd9\u6837\u4e00\u79cd\u60c5\u5f62\uff0c\u5185\u7f511\u60f3\u8981\u8bbf\u95ee\u5185\u7f512\u4e2d\u7684\u67d0\u4e2a\u8d44\u6e90\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7531\u4e8e\u5185\u7f511\u548c\u5185\u7f512\u662f\u7269\u7406\u9694\u79bb\u7684\uff0c\u6240\u4ee5\u65e0\u8bba\u5982\u4f55\uff0c\u5b83\u4eec\u65e0\u6cd5\u76f4\u63a5\u4e92\u76f8\u8bbf\u95ee\u3002\u552f\u4e00\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u5728\u4e24\u8005\u4e4b\u95f4\u589e\u52a0\u4e00\u5c42\u4e2d\u95f4\u5c42\uff0c\u4ece\u800c\u5b9e\u73b0\u5185\u7f511\u80fd\u591f\u8bbf\u95ee\u5185\u7f512\u4e2d\u7684\u771f\u5b9e\u670d\u52a1\u7684\u6570\u636e\u3002</p> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u501f\u52a9\u6709\u516c\u7f51<code>IP</code>\u7684\u670d\u52a1\u5668\uff0c\u540e\u9762\u7b80\u79f0\u516c\u7f51\u3002\u5728\u5185\u7f511\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u987a\u5229\u5730\u8fde\u63a5\u5230\u516c\u7f51\u7684\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\uff0c\u4f46\u95ee\u9898\u662f\uff0c\u6620\u5c04\u7a0b\u5e8f\u5982\u4f55\u8fde\u63a5\u5230\u5185\u7f512\u4e2d\u7684\u771f\u5b9e\u670d\u52a1\u5462\uff1f\u5177\u4f53\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u9700\u8981\u5728\u5185\u7f512\u4e2d\u4e5f\u5b9a\u4e49\u4e00\u4e2a\u670d\u52a1\uff0c\u59d1\u4e14\u79f0\u4e3a\u6620\u5c04\u5ba2\u6237\u7aef\uff0c\u7531\u5b83\u6765\u4f5c\u4e3a\u5185\u7f51\u6620\u5c04\u7a0b\u5e8f\u548c\u771f\u5b9e\u670d\u52a1\u7684\u6865\u6881\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u6620\u5c04\u5ba2\u6237\u7aef\u8fde\u63a5\u516c\u7f51\u4e0a\u7684\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\u548c\u771f\u5b9e\u7684\u670d\u52a1\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5728\u5185\u7f511\u548c\u5185\u7f512\u4e2d\u7684\u670d\u52a1\u5728\u201c\u94fe\u8def\u4e0a\u201d\u786e\u5b9e\u662f\u901a\u4e86\u3002</p> <p>\u53ef\u662f\uff0c\u53c8\u4f1a\u5b58\u5728\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\uff1a\u7531\u4e8e\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\u662f\u670d\u52a1\u5668\uff0c\u800c\u6620\u5c04\u5ba2\u6237\u7aef\u662f\u4e00\u4e2a\u5ba2\u6237\u7aef\uff0c\u90a3\u4e48\uff0c\u5ba2\u6237\u7aef\u5e94\u8be5\u63d0\u524d\u53d1\u9001\u591a\u5c11\u4e2a\u8bf7\u6c42\u5230\u5185\u7f51\u6620\u5c04\u7a0b\u5e8f\u670d\u52a1\u5668\u4e0a\u5462\uff1f</p> <p>\u6240\u4ee5\u8bf4\uff0c\u6700\u7b80\u5355\u7684\u529e\u6cd5\u662f\u76f4\u63a5\u5efa\u7acb\u4e00\u6761\u201c\u771f\u5b9e\u7684\u94fe\u8def\u201d\u3002\u4f8b\u5982\uff0c\u5f53\u5185\u7f511\u4e2d\u76843\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u8bf7\u6c42\u670d\u52a1\u65f6\uff0c\u6700\u76f4\u63a5\u7684\u505a\u6cd5\u662f\u8ba9\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\u4e0e\u6620\u5c04\u5ba2\u6237\u7aef\u4e4b\u95f4\u4fdd\u63013\u6761\u72ec\u7acb\u7684\u8fde\u63a5 \u4e14 \u6620\u5c04\u5ba2\u6237\u7aef\u4e0e\u771f\u5b9e\u670d\u52a1\u4e4b\u95f4\u4e5f\u4fdd\u63013\u6761\u8fde\u63a5\u3002\u8fd9\u6837\uff0c\u6620\u5c04\u670d\u52a1\u5668\u80fd\u591f\u6e05\u6670\u5730\u77e5\u9053\u54ea\u4e2a\u8bf7\u6c42\u6765\u81ea\u54ea\u4e2a\u5ba2\u6237\u7aef\uff0c\u54cd\u5e94\u4e5f\u80fd\u7cbe\u786e\u5730\u8fd4\u56de\u7ed9\u6b63\u786e\u7684\u7528\u6237\u3002\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5f53\u589e\u52a0\u4e00\u4e2a\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u518d\u76f8\u5e94\u7684\u589e\u52a0\u4e00\u6761\u94fe\u63a5\u5373\u53ef\uff0c\u8fd9\u6837\u662f\u6700\u7b80\u5355\u7684\uff0c\u4e5f\u662f\u6700\u65b9\u4fbf\u7684\uff0c\u53ea\u9700\u8981\u505a\u597d\u94fe\u63a5\u7ef4\u6301\u4ee5\u53ca\u6570\u636e\u8f6c\u53d1\u5373\u53ef\uff0c\u4f46\u662f\u60f3\u8981\u6b63\u786e\u7ef4\u62a4\u597d\u8fd9\u4e2a\u94fe\u8def\u662f\u975e\u5e38\u56f0\u96be\u7684\uff0c\u6709\u592a\u591a\u7684\u4e0d\u786e\u5b9a\u7684\u56e0\u7d20\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\u548c\u6620\u5c04\u5ba2\u6237\u7aef\u4ec5\u8d1f\u8d23\u6570\u636e\u7684\u4f20\u8f93\u5c31\u597d\u3002\u4e3a\u4e86\u66f4\u597d\u5730\u5904\u7406\u5ba2\u6237\u7aef\u9274\u522b\u548c\u6570\u636e\u4f20\u8f93\uff0c\u6211\u4eec\u53ef\u4ee5\u518d\u542f\u52a8\u4e24\u4e2a\u7a0b\u5e8f\uff0c\u5206\u522b\u7528\u4e8e\u5ba2\u6237\u7aef\u533a\u5206\u548c\u6570\u636e\u4f20\u8f93\u3002\u56fe\u793a\u6240\u793a\uff1a</p> <p></p> <p>\u5728\u4e0a\u56fe\u4e2d\uff0c\u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668 \u548c \u6620\u5c04\u5ba2\u6237\u7aef \u4ec5\u8d1f\u8d23\u6570\u636e\u7684\u4f20\u9001\u3002\u800c\u8f6c\u53d1\u670d\u52a1\u5668\u5219\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u670d\u52a1\uff0c\u4e3b\u8981\u8d1f\u8d23\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u8bf7\u6c42\u8f6c\u53d1\u81f3 \u5185\u7f51\u6620\u5c04\u670d\u52a1\u5668\uff0c\u8f6c\u53d1\u8fc7\u7a0b\u81f3\u6b64\u7ed3\u675f\u3002\u5f53\u6d41\u91cf\u6765\u5230\u5728\u8f6c\u53d1\u5ba2\u6237\u7aef\u4e2d\uff0c\u5b83\u9700\u8981\u89e3\u6790\u7528\u6237\u7684\u8bf7\u6c42\u4fe1\u606f\uff0c\u5411\u771f\u5b9e\u670d\u52a1\u53d1\u8d77\u8bf7\u6c42\uff0c\u5e76\u5c06\u8fd4\u56de\u7684\u7ed3\u679c\u4f20\u9012\u56de\u771f\u5b9e\u7684\u5ba2\u6237\u7aef\u3002</p>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html","title":"goRelay\u7684\u57fa\u672c\u4f7f\u7528","text":"<p>\u672c\u6587\u7ae0\u5c06\u4ecb\u7ecd<code>goRelay</code>\u7684\u57fa\u672c\u4f7f\u7528\u3002</p> <p><code>goRelay</code>\u662f\u4f7f\u7528<code>go</code>\u7f16\u5199\u7684\u57fa\u4e8eTCP\u7684\u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff0c\u9879\u76ee\u5730\u5740\u4e3a\uff1agoRelay\u3002</p> <p>\u4f7f\u7528\u80cc\u666f\uff1a\u5f53\u9700\u8981\u5c06\u5185\u7f51\u67d0\u53f0\u673a\u5668\u7684\u7aef\u53e3\u6620\u5c04\u5230\u516c\u7f51\u8fdb\u884c\u8bbf\u95ee\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u6b64\u5de5\u5177\uff0c\u8be5\u5de5\u5177\u63d0\u4f9b\u7aef\u5230\u7aef\u7684\u901a\u4fe1\u529f\u80fd\u3002</p> <p>\u4f7f\u7528\u9650\u5236\uff1a\u4f7f\u7528\u8be5\u5de5\u5177\u81f3\u5c11\u9700\u8981\u4e00\u53f0\u62e5\u6709\u516c\u7f51IP\u7684\u673a\u5668\u3002</p> <p>\u6700\u65b0\u529f\u80fd\uff1a\u652f\u6301\u7aef\u53e3\u590d\u7528\u3002</p>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_1","title":"\u90e8\u7f72\u56fe","text":""},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_2","title":"\u5982\u4f55\u83b7\u53d6\u53ef\u6267\u884c\u6587\u4ef6","text":""},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_3","title":"\u4ece\u5df2\u53d1\u5e03\u7684\u7248\u672c\u4e2d\u83b7\u53d6","text":"<p>\u53ef\u4ee5\u4ece\u5df2\u53d1\u5e03\u7248\u672c\u4e2d\u5f97\u5230\u4ee5\u4e0b\u53ef\u6267\u884c\u6587\u4ef6\uff1a</p> <p><code>goRelay</code>\u662f\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u901a\u8fc7\u6dfb\u52a0<code>--type</code>\u7684\u65b9\u5f0f\u6765\u533a\u5206\u670d\u52a1\u5668\u7c7b\u578b\u3002\u5177\u4f53\u7684\u7c7b\u578b\u53ef\u4ee5\u5206\u4e3a\uff1a - <code>relayServer</code>\uff1a\u4e2d\u8f6c\u670d\u52a1\u5668\u7528\u4e8e\u63a5\u6536\u548c\u53d1\u9001\u6570\u636e\uff0c\u9700\u90e8\u7f72\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u5185\u7f51\u73af\u5883\u4e2d\uff0c\u53ef\u4ee5\u90e8\u7f72\u591a\u4e2a\uff0c\u7528\u4e8e\u652f\u6301\u7aef\u53e3\u590d\u7528\u3002 - <code>pipeServer</code>\uff1a\u7ba1\u9053\u670d\u52a1\u5668\u7528\u4e8e\u6570\u636e\u4f20\u8f93\uff0c\u9700\u90e8\u7f72\u5177\u6709\u516c\u7f51<code>IP</code>\u7684\u670d\u52a1\u5668\u4e0a\u3002 - <code>pipeClient</code>\uff1a\u7ba1\u9053\u5ba2\u6237\u7aef\u7528\u4e8e\u7528\u6237\u6570\u636e\u4f20\u8f93\uff0c\u9700\u90e8\u7f72\u5728\u771f\u5b9e\u670d\u52a1\u6240\u5728\u7684\u5185\u7f51\u73af\u5883\u4e2d\u3002 - <code>relayClient</code>\uff1a\u4e2d\u8f6c\u5ba2\u6237\u7aef\u7528\u4e8e\u63a5\u6536\u548c\u53d1\u9001\u6570\u636e\uff0c\u9700\u90e8\u7f72\u5728\u771f\u5b9e\u670d\u52a1\u6240\u5728\u7684\u5185\u7f51\u73af\u5883\u4e2d\uff0c\u9700\u8981\u914d\u7f6e<code>relayServer</code>\u4fe1\u606f\uff0c\u4ee5\u652f\u6301\u7aef\u53e3\u590d\u7528\u3002</p>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_4","title":"\u7f16\u8bd1\u83b7\u53d6","text":"<p>\u5c06\u8be5\u4ed3\u5e93<code>clone</code>\u4e0b\u6765\u540e\uff0c\u4f7f\u7528<code>bash build.sh</code> + \u7248\u672c\u53f7 \u8fdb\u884c\u7f16\u8bd1\uff0c\u4f8b\u5982\uff1a</p> <pre><code>\u279c  goRelay git:(main) \u2717 bash build.sh v0.0.1\nbuild project\ngo build -ldflags \"-X goRelay/pkg.Version=v0.0.1 -X goRelay/pkg.BuildAt=2025-01-04 -X goRelay/pkg.GitCommit=9002ae53fff26c433cdcde76abed1781c3cc218a\" -o ./bin/goRelay \ntar zcvf pipeSourcev0.0.1.tar.gz ./bin\n./bin/\n./bin/goRelay\n\u279c  goRelay git:(main) \u2717 \n</code></pre> <p>\u7f16\u8bd1\u5b8c\u6210\u4e4b\u540e\uff0c\u4f1a\u5728<code>./bin/</code>\u4e0b\u751f\u6210\u5bf9\u5e94\u7684\u4e8c\u8fdb\u5236\u6587\u4ef6\u3002</p> <pre><code>\u279c  goRelay git:(main) \u2717 ls bin/\ngoRelay\n\u279c  goRelay git:(main) \u2717 \n</code></pre>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_5","title":"\u5982\u4f55\u6267\u884c","text":""},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#pipeserver","title":"<code>pipeServer</code>","text":"<p><code>pipeServer</code>\u662f\u7ba1\u9053\u670d\u52a1\u5668\uff0c\u7528\u4e8e\u6570\u636e\u4f20\u8f93\uff0c\u9700\u8981\u90e8\u7f72\u5230\u5177\u6709\u516c\u7f51<code>IP</code>\u7684\u670d\u52a1\u5668\u4e0a\u3002</p> <p>\u542f\u52a8\u8be5\u670d\u52a1\uff0c\u9700\u8981\u5148\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u8be5\u6587\u4ef6\u540d\u79f0\u4e3a\uff1a<code>conf_pipeServer.json</code>\uff1a</p> <pre><code>{\n    \"listen_pipe_server_addr\":\":8888\",\n    \"black_ip_list\":[\n        \"127.0.0.3\"\n    ],\n    \"white_ip_list\":[\n        \"127.0.0.1\"\n    ],\n    \"debug_log\":true\n}\n</code></pre> <p>\u5176\u4e2d\uff0c<code>listen_pipe_server_addr</code>\u662f\u5bf9\u5916\u76d1\u542c\u7684\u5730\u5740\uff0c\u82e5\u60f3\u76d1\u542c\u67d0\u4e2a\u7f51\u5361\uff0c\u5219\u6307\u5b9a\u7f51\u5361\u5730\u5740\u5373\u53ef\uff0c\u6bd4\u5982\uff1a<code>192.168.2.3:8888</code>\u3002 <code>white_ip_list</code>\u662f\u8bbe\u7f6e\u7684\u767d\u540d\u5355\uff0c\u53ea\u5141\u8bb8\u540d\u5355\u5185\u7684\u8fde\u63a5\u4e0a\u6765\uff0c\u4e3a\u7a7a\uff0c\u5219\u4e0d\u8bbe\u7f6e\u767d\u540d\u5355\uff0c\u5747\u53ef\u4ee5\u8fde\u63a5\u3002\u540e\u7eed\u914d\u7f6e\u4e5f\u662f\u5982\u6b64\uff0c <code>black_ip_list</code>\u662f\u8bbe\u7f6e\u7684\u9ed1\u540d\u5355\uff0c\u7981\u6b62\u540d\u5355\u5185\u7684IP\u8fde\u63a5\u4e0a\u6765\uff0c\u82e5\u4e3a\u7a7a\uff0c\u5219\u4e0d\u8bbe\u7f6e\u9ed1\u540d\u5355\uff0c\u82e5\u9ed1\u540d\u5355\u548c\u767d\u540d\u5355\u90fd\u7528\u76f8\u540c\u7684\u503c\uff0c\u5219\u9ed1\u540d\u5355\u4f18\u5148\u7ea7\u9ad8\u4e8e\u767d\u540d\u5355\u3002 <code>debug_log</code>\u4e3a<code>true</code>\u662f\u5426\u8f93\u51fa<code>debug</code>\u65e5\u5fd7\u3002\u540e\u7eed\u914d\u7f6e\u4e5f\u662f\u5982\u6b64\uff0c</p> <p>\u542f\u52a8<code>pipeServer</code>\uff0c\u53ea\u9700\u8981\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>\u279c  bin git:(main) \u2717 ./goRelay --type pipeServer --config conf/conf_pipeServer.json \n</code></pre>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#relayserver","title":"<code>relayServer</code>","text":"<p><code>relayServer</code>\u662f\u4e2d\u8f6c\u670d\u52a1\u5668\uff0c\u7528\u4e8e\u63a5\u6536\u548c\u53d1\u9001\u7528\u6237\u7684\u6570\u636e\uff0c\u9700\u8981\u90e8\u7f72\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u5185\u7f51\u73af\u5883\u4e2d\u3002</p> <p><code>relayServer</code>\u53ef\u4ee5\u5f00\u542f\u591a\u4e2a\uff0c\u4ee5\u4fbf\u652f\u6301\u7aef\u53e3\u590d\u7528\uff0c\u9700\u8981\u4e3a\u6bcf\u4e2a<code>relayServer</code>\u8bbe\u7f6e\u4e0d\u540c\u7684<code>id</code>\u3002</p> <p>\u540c\u6837\u7684\uff0c\u5982\u679c\u9700\u8981\u542f\u52a8\u8be5\u670d\u52a1\uff0c\u9700\u8981\u5148\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\u8be5\u6587\u4ef6\u540d\u79f0\u4e3a\uff1a<code>conf_relayServer.json</code>\uff1a</p> <pre><code>{\n    \"id\": \"client1\",\n    \"pipe_server_addr\":\"127.0.0.1:8888\",\n    \"listen_relay_server_addr\":\":10010\",\n    \"white_ip_list\":[\n        \"127.0.0.1\"\n    ],\n    \"debug_log\":true\n}\n</code></pre> <p>\u5176\u4e2d\uff0c<code>id</code>\u662f<code>relayServer</code>\u7684\u552f\u4e00\u6807\u8bc6\u7b26\uff0c\u5bf9\u5176\u591a\u5f00\u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f<code>id</code>\u4e0d\u80fd\u91cd\u590d\uff0c\u8be5<code>id</code>\u662f\u5b57\u7b26\u4e32\uff0c\u5141\u8bb8\u81ea\u8bbe\u5b9a\uff0c\u5efa\u8bae\u8bbe\u7f6e\u590d\u6742\u4e00\u70b9\u3002 <code>pipe_server_addr</code>\u662f<code>pipeServer</code>\u7684\u5730\u5740\u3002 <code>listen_relay_server_addr</code>\u662f<code>relayServer</code>\u76d1\u542c\u7684\u5730\u5740\u3002 <code>white_ip_list</code>\u662f\u8bbe\u7f6e\u7684\u767d\u540d\u5355\u3002</p> <p>\u540c\u6837\u7684\uff0c\u53ef\u4ee5\u521b\u5efa\u7b2c\u4e8c\u4e2a\u914d\u7f6e\u6587\u4ef6<code>conf_relayServer2.json</code>\uff1a</p> <pre><code>{\n    \"id\": \"client2\",\n    \"pipe_server_addr\":\"127.0.0.1:8888\",\n    \"listen_relay_server_addr\":\":10012\",\n    \"white_ip_list\":[\n        \"127.0.0.1\"\n    ],\n    \"debug_log\":true\n}\n</code></pre> <p>\u6ce8\u610f\uff0c<code>id</code>\u4e0d\u80fd\u91cd\u590d\uff0c\u5982\u679c\u662f\u5728\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u5219<code>listen_relay_server_addr</code>\u5bf9\u5916\u76d1\u542c\u7684\u5730\u5740\u4e5f\u4e0d\u80fd\u91cd\u590d\u3002</p> <p>\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u542f\u52a8\u8be5\u670d\u52a1\u3002</p> <pre><code>\u279c  bin git:(main) \u2717 ./goRelay --type relayServer --config conf/conf_relayServer.json \n</code></pre>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#relayclient","title":"<code>relayClient</code>","text":"<p><code>relayClient</code>\u662f\u4e2d\u8f6c\u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u63a5\u6536/\u53d1\u9001\u6765\u81ea\u7ba1\u9053\u5ba2\u6237\u7aef\u3001\u771f\u5b9e\u670d\u52a1\u7684\u6570\u636e\uff0c\u9700\u8981\u90e8\u7f72\u5728\u771f\u5b9e\u670d\u52a1\u6240\u5728\u7684\u5185\u7f51\u73af\u5883\u4e2d\u3002</p> <p>\u542f\u52a8\u8be5\u670d\u52a1\uff0c\u9700\u8981\u914d\u7f6e<code>relayServer</code>\u968f\u6307\u5b9a\u7684<code>id</code>,\u6839\u636e<code>id</code>\u7684\u4e0d\u540c\uff0c\u6765\u6307\u5b9a\u76f8\u5e94\u7684\u771f\u5b9e\u670d\u52a1\u7684\u5730\u5740\uff0c\u5e76\u4e14\u9700\u8981\u8bbe\u7f6e\u76d1\u542c\u7684\u7aef\u53e3\uff0c\u7528\u4e8e\u7ba1\u9053\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002</p> <p>\u8981\u60f3\u542f\u52a8\u8be5\u670d\u52a1\uff0c\u9700\u8981\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\uff1a<code>conf_relayClient.json</code>\uff1a</p> <pre><code>{\n    \"listen_relay_client_addr\": \":10011\",\n    \"white_ip_list\":[\n        \"127.0.0.1\"\n    ],\n    \"debug_log\": true,\n    \"realServerInfo\": [\n        {\n            \"id\": \"client1\",\n            \"real_Server_Addr\": \"127.0.0.1:80\"\n        },\n        {\n            \"id\": \"client2\",\n            \"real_Server_Addr\": \"127.0.0.1:22\"\n        }\n    ]\n}\n</code></pre> <p>\u5176\u4e2d<code>listen_relay_client_addr</code>\u662f\u5bf9\u5916\u76d1\u542c\u7684\u7aef\u53e3\uff0c\u7528\u4e8e<code>pipeClient</code>\u7a0b\u5e8f\u7684\u8fde\u63a5\u3002 <code>realServerInfo</code>\u5219\u662f\u771f\u5b9e\u670d\u52a1\u5668\u4fe1\u606f\uff0c\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u8be5\u6570\u7ec4\u4ee5<code>id</code>\u548c<code>real_Server_Addr</code>\u6210\u5bf9\u51fa\u73b0\uff0c\u7528\u4e8e\u5206\u8fa8\u54ea\u4e9b<code>id</code>\u548c\u54ea\u4e9b\u540e\u7aef\u670d\u52a1\u8fdb\u884c\u7ed1\u5b9a\u3002\u8be5<code>id</code>\u548c<code>relayServer</code>\u7684<code>id</code>\u5fc5\u987b\u4e00\u81f4\uff0c\u8bf7\u6ce8\u610f<code>id</code>\u4e0d\u8981\u91cd\u590d\uff0c\u5426\u5219\u4f1a\u4ee5\u6700\u540e\u4e00\u4e2a<code>id</code>\u7684\u4fe1\u606f\u4e3a\u51c6\u3002</p> <p>\u542f\u52a8\u8be5\u670d\u52a1\u53ea\u9700\u8981\u6307\u5b9a\u76f8\u5e94\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u3002</p> <pre><code>\u279c  bin git:(main) \u2717 ./goRelay --type relayClient --config conf/conf_relayClient.json \n</code></pre>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#pipeclient","title":"<code>pipeClient</code>","text":"<p><code>pipeClient</code>\u662f\u7ba1\u9053\u5ba2\u6237\u7aef\uff0c\u7528\u4e8e\u4f20\u8f93\u6765\u81ea\u7ba1\u9053\u670d\u52a1\u5668\u7684\u6570\u636e\uff0c\u4ee5\u53ca\u4e2d\u8f6c\u5ba2\u6237\u7aef\u7684\u6570\u636e\uff0c\u8be5\u670d\u52a1\u9700\u8981\u90e8\u7f72\u5728\u771f\u5b9e\u670d\u52a1\u6240\u5728\u7684\u5185\u7f51\u73af\u5883\u4e2d\u3002</p> <p>\u542f\u52a8\u8be5\u670d\u52a1\uff0c\u9700\u8981\u521b\u5efa\u914d\u7f6e\u6587\u4ef6\uff0c\u6bd4\u5982\uff1a<code>conf_pipeClient.json</code>\uff1a</p> <pre><code>{\n    \"pipe_server_addr\":\"127.0.0.1:8888\",\n    \"relay_client_addr\":\"127.0.0.1:10011\",\n    \"debug_log\": true\n}\n</code></pre> <p>\u5176\u4e2d<code>pipe_server_addr</code>\u8868\u793a<code>pipeServer</code>\u670d\u52a1\u5668\u7684\u5730\u5740\u3002 <code>relay_client_addr</code>\u8868\u793a<code>relayClient</code>\u670d\u52a1\u5668\u7684\u5730\u5740\u3002</p> <p>\u53ea\u9700\u8981\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u5373\u53ef\u542f\u52a8\u8be5\u670d\u52a1\u3002</p> <pre><code>\u279c  bin git:(main) \u2717 ./goRelay --type pipeClient --config conf/conf_pipeClient.json \n</code></pre>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_6","title":"\u6570\u636e\u52a0\u5bc6","text":"<p>\u5f53\u4f60\u4e0d\u662f\u8be5\u516c\u7f51\u670d\u52a1\u5668\u7684\u6240\u6709\u8005\u65f6\uff0c\u5c31\u5fc5\u987b\u8981\u8003\u8651\u5230\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u98ce\u9669\u3002\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u5b89\u5168\uff0c\u5efa\u8bae\u4f7f\u7528\u6570\u636e\u52a0\u5bc6\uff0c\u5982\u90e8\u7f72\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\u6240\u793a\uff0c\u6570\u636e\u4f20\u8f93\u53ef\u4ee5\u52a0\u5bc6\u3002\u7136\u800c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u76ee\u524d\u7248\u672c\u5e76\u672a\u5b9e\u73b0\u6570\u636e\u52a0\u5bc6\u529f\u80fd\uff0c\u4f46\u5df2\u4e3a\u6b64\u9884\u7559\u4e86\u63a5\u53e3\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539<code>pipeProtocol/enDecode.go</code>\u6587\u4ef6\u4e2d\u7684<code>Encode</code>\u548c<code>Decode</code>\u51fd\u6570\uff0c\u6765\u5b9e\u73b0\u6570\u636e\u52a0\u5bc6\u3002</p> <p>\u51fd\u6570\u5982\u4e0b\uff1a</p> <pre><code>func Encode(s []byte) []byte {\n    return s\n}\n\nfunc Decode(s []byte) []byte {\n    return s\n}\n</code></pre> <p>\u5176\u4e2d\uff0c<code>Encode</code>\u5c06\u7528\u505a\u52a0\u5bc6\u64cd\u4f5c\uff0c<code>Decode</code>\u5c06\u7528\u4f5c\u89e3\u5bc6\u64cd\u4f5c\u3002</p>"},{"location":"2025/01/04/tcp-intranet-penetration-tool.html#_7","title":"\u5176\u4ed6","text":"<p>\u8be5\u9879\u76ee\u4e0d\u63a5\u53d7\u4efb\u4f55\u9700\u6c42\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html","title":"linux tun \u865a\u62df\u8bbe\u5907\u7684\u7b80\u5355\u63a2\u5bfb","text":"<p>\u672c\u7bc7\u6587\u7ae0\u5c06\u7b80\u5355\u4ecb\u7ecd<code>tun</code>\u865a\u62df\u8bbe\u5907\u7684\u7b80\u5355\u63a2\u5bfb\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#tun","title":"\u4ec0\u4e48\u662f<code>tun</code>\u865a\u62df\u8bbe\u5907","text":"<p>\u5728<code>Linux</code>\u4e2d\uff0c\u8c08\u5230 <code>tun</code> \u65f6\uff0c\u901a\u5e38\u4f1a\u5c06\u5176\u4e0e <code>tun/tap</code> \u4e00\u8d77\u8ba8\u8bba\u3002\u8fd9\u4e24\u8005\u90fd\u662f<code>Linux</code>\u7684\u865a\u62df\u7f51\u7edc\u8bbe\u5907\uff0c\u4f46 <code>tun</code> \u662f\u4e00\u79cd\u70b9\u5bf9\u70b9\uff08<code>PPP</code>\uff09\u8bbe\u5907\uff0c\u4e0e <code>tap</code> \u7684\u5de5\u4f5c\u6a21\u5f0f\u7565\u6709\u4e0d\u540c\u3002\u672c\u6587\u5c06\u91cd\u70b9\u4ecb\u7ecd<code>tun</code>\u865a\u62df\u8bbe\u5907\u3002</p> <p><code>tun</code> \u865a\u62df\u8bbe\u5907\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\u4e00\u5757\u8fd0\u884c\u5728<code>L3</code>\u5c42\uff08\u7f51\u7edc\u5c42\uff09\u7684\u865a\u62df\u7f51\u5361\u3002\u5b83\u7684\u4e00\u7aef\u8fde\u63a5\u5230\u5185\u6838\u7684\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u53e6\u4e00\u7aef\u5219\u8fde\u63a5\u5230\u7528\u6237\u6001\u7a0b\u5e8f\u3002\u5728\u5b9e\u9645\u4f7f\u7528\u8fc7\u7a0b\u4e2d\uff0c\u7f51\u7edc\u534f\u8bae\u6808\u751f\u6210\u7684\u7f51\u7edc\u5305\u53ef\u4ee5\u901a\u8fc7 <code>tun</code> \u8bbe\u5907\u53d1\u9001\u5230\u7528\u6237\u6001\u8fdb\u7a0b\uff0c\u7531\u8be5\u8fdb\u7a0b\u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5982\u52a0\u5bc6\u3001\u6570\u636e\u538b\u7f29\u7b49\u64cd\u4f5c\u3002\u5904\u7406\u5b8c\u6210\u540e\uff0c\u6570\u636e\u53ef\u4ee5\u518d\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\u53d1\u9001\u51fa\u53bb\u3002\u5176\u5de5\u4f5c\u6d41\u7a0b\u53ef\u4ee5\u7b80\u5355\u7528\u4e0b\u56fe\u8868\u793a\uff1a</p> <p></p> <p><code>tun</code> \u8bbe\u5907\u53ef\u4ee5\u770b\u4f5c\u662f<code>Linux</code>\u4e0b\u7684\u4e00\u4e2a\u7279\u6b8a\u6587\u4ef6\uff0c\u540c\u65f6\u4e5f\u662f\u4e00\u5757\u201c\u865a\u62df\u7f51\u5361\u201d\u3002\u5b83\u5177\u6709\u72ec\u7acb\u7684<code>IP</code>\u5730\u5740\uff0c\u5e76\u901a\u8fc7\u8def\u7531\u89c4\u5219\u5c06 <code>app1</code> \u53d1\u9001\u7684\u8bf7\u6c42\u5b9a\u5411\u5230 <code>tun0</code>\u3002<code>tun0</code> \u7684\u53e6\u4e00\u7aef\u5219\u8fde\u63a5\u5230\u5e94\u7528\u5c42\u7a0b\u5e8f <code>tunApp1</code>\u3002\u8be5\u7a0b\u5e8f\u53ef\u4ee5\u63a5\u6536\u6765\u81ea\u7f51\u7edc\u5c42\u7684\u62a5\u6587\uff0c\u8fdb\u884c\u52a0\u5bc6\u3001\u538b\u7f29\u6216\u5e94\u7528\u5c42\u5c01\u88c5\u7b49\u64cd\u4f5c\uff0c\u7136\u540e\u901a\u8fc7 <code>tunApp1</code> \u5c06\u5904\u7406\u540e\u7684\u6570\u636e\u518d\u6b21\u901a\u8fc7\u5e94\u7528\u5c42\u8c03\u7528\u7f51\u7edc\u534f\u8bae\u6808\u518d\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u8bf4 <code>tun</code> \u5b9e\u73b0\u4e86\u5bf9\u7f51\u7edc\u5c42\u6570\u636e\u5305\u7684\u52ab\u6301\u3002\u8fd9\u4e9b\u6570\u636e\u5305\u4f1a\u88ab\u53d1\u9001\u5230\u4e0e <code>tun</code> \u76f8\u8fde\u7684\u5e94\u7528\u5c42\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5982\u52a0\u5bc6\u3001\u538b\u7f29\u6216\u5176\u4ed6\u81ea\u5b9a\u4e49\u64cd\u4f5c\u3002\u5904\u7406\u5b8c\u6210\u540e\uff0c\u6570\u636e\u5305\u518d\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\u53d1\u9001\u51fa\u53bb\uff0c\u5b8c\u6210\u6574\u4e2a\u6d41\u7a0b\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#tun_1","title":"<code>tun</code>\u57fa\u672c\u64cd\u4f5c","text":"<p>\u5728\u4f7f\u7528<code>tun</code>\u865a\u62df\u8bbe\u5907\u4e4b\u524d\uff0c\u9700\u8981\u5148\u8bbe\u7f6e<code>IP</code>\u8f6c\u53d1\u3002</p> <pre><code>root@3114:~# sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\nroot@3114:~#\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528 <code>ip</code> \u547d\u4ee4\u6765\u521b\u5efa <code>tun</code> \u865a\u62df\u7f51\u5361\u3002\u4f8b\u5982\uff0c\u521b\u5efa\u4e00\u4e2a\u540d\u4e3a <code>tun0</code> \u7684 <code>tun</code> \u865a\u62df\u8bbe\u5907\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>root@3114:~# ip tuntap add dev tun0 mode tun\n</code></pre> <p>\u8981\u67e5\u770b\u5df2\u7ecf\u521b\u5efa\u597d\u7684 <code>tun</code> \u8bbe\u5907\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff1a</p> <pre><code>root@3114:~# ip link show tun0\n3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 500\n    link/none\nroot@3114:~#\nroot@3114:~# ip addr show tun0\n3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP&gt; mtu 1500 qdisc noop state DOWN group default qlen 500\n    link/none\nroot@3114:~#\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u4e3a <code>tun</code> \u865a\u62df\u8bbe\u5907\u5206\u914d<code>ip</code>\u5730\u5740\uff0c\u4f8b\u5982\u4e3a\u8bbe\u5907 <code>tun0</code> \u5206\u914d <code>10.0.0.3/24</code>\uff1a</p> <pre><code>root@3114:~# ip addr add 10.0.0.3/24 dev tun0\nroot@3114:~#\n</code></pre> <p>\u518d\u6b21\u67e5\u770b\uff0c\u5c31\u6709\u4e86\u5176<code>ip</code>\u5730\u5740\u3002</p> <pre><code>root@3114:~# ip addr show dev tun0\n3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP&gt; mtu 1500 qdisc noop state DOWN group default qlen 500\n    link/none\n    inet 10.0.0.3/24 scope global tun0\n       valid_lft forever preferred_lft forever\nroot@3114:~#\n</code></pre> <p>\u8be5\u865a\u62df\u7f51\u5361\uff0c\u9ed8\u8ba4\u4e3a\u5173\u95ed\u72b6\u6001\uff0c\u53ef\u4ee5\u5c06\u8be5\u865a\u62df\u7f51\u5361\u5f00\u542f\u3002</p> <pre><code>root@3114:~# ip link set tun0 up\nroot@3114:~#\n</code></pre> <p>\u5f53\u865a\u62df\u7f51\u5361<code>tun0</code>\u521b\u5efa\u5b8c\u6bd5\u540e\uff0c\u7cfb\u7edf\u4f1a\u9ed8\u8ba4\u4e3a\u5176\u521b\u5efa\u4e00\u6761\u8def\u7531\uff0c\u53ef\u4ee5\u4f7f\u7528<code>ip route</code>\u67e5\u770b\u3002</p> <pre><code>root@3114:~# ip route\ndefault via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n1.2.4.8 via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n10.0.0.0/24 dev tun0 proto kernel scope link src 10.0.0.3 linkdown\n114.114.114.114 via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n192.168.3.0/24 dev eth0 proto kernel scope link src 192.168.3.114 metric 100\n192.168.3.1 dev eth0 proto dhcp scope link src 192.168.3.114 metric 100\nroot@3114:~#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8bbe\u5907\u7684\u72b6\u6001\u4e3a <code>linkdown</code>\uff0c\u5b9e\u9645\u4e0a\u8fd9\u662f\u56e0\u4e3a <code>tunApp</code> \u5c1a\u672a\u542f\u52a8\u3002\u5f53 <code>tunApp</code> \u6ca1\u6709\u542f\u52a8\u65f6\uff0c<code>tun</code> \u8bbe\u5907\u7684\u53e5\u67c4\u65e0\u6cd5\u88ab\u6253\u5f00\uff0c\u56e0\u6b64\u8def\u7531\u4e2d\u624d\u4f1a\u663e\u793a\u4e3a <code>linkdown</code> \u72b6\u6001\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#tun_2","title":"\u5b9e\u9645\u4f53\u9a8c\u4f7f\u7528<code>tun</code>\u4f20\u8f93\u6570\u636e","text":"<p>\u5728\u8fdb\u884c\u5177\u4f53\u64cd\u4f5c\u4e4b\u524d\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u56fe\u7ed9\u753b\u597d\u4e86\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>\u6211\u4eec\u5c06 <code>3.115</code> \u7684\u673a\u5668\u79f0\u4e3a\u670d\u52a1\u7aef\uff0c<code>3.114</code> \u7684\u673a\u5668\u79f0\u4e3a\u5ba2\u6237\u7aef\u3002\u8fd9\u4e24\u53f0\u673a\u5668\u4e0a\u5206\u522b\u6709\u4e00\u4e2a <code>tun</code> \u865a\u62df\u8bbe\u5907\uff0c\u5e76\u4e14\u5404\u81ea\u8fd0\u884c\u7740 <code>tunApp</code> \u7a0b\u5e8f\u3002\u5b9e\u73b0\u7684\u529f\u80fd\u662f\uff0c\u5728 <code>3.114</code> \u4e0a\u6267\u884c <code>ping 10.0.0.5</code> \u64cd\u4f5c\uff0c\u901a\u8fc7 <code>tun</code> \u8bbe\u5907\u8ba9\u8bf7\u6c42\u5728 <code>3.115</code> \u4e0a\u6267\u884c\uff0c\u5e76\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9 <code>3.114</code>\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#_1","title":"\u670d\u52a1\u5668\u64cd\u4f5c","text":"<p>\u9996\u5148\uff0c\u9700\u8981\u5728<code>3.115</code>\u4e0a\u64cd\u4f5c\u521b\u5efa<code>tun</code>\u865a\u62df\u8bbe\u5907\uff0c\u5e76\u4e14\u5206\u4e3a\u5730\u5740\u3002</p> <pre><code>root@3115:~# ip tuntap add name tun0 mode tun\nroot@3115:~#\nroot@3115:~# ip link show tun0\n4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP&gt; mtu 1500 qdisc noop state DOWN mode DEFAULT group default qlen 500\n    link/none\nroot@3115:~#\nroot@3115:~# ip addr add 10.0.0.5/24 dev tun0\nroot@3115:~#\nroot@3115:~# ip link set tun0 up\nroot@3115:~#\nroot@3115:~# sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\nroot@3115:~#\nroot@3115:~# ip addr show tun0\n4: tun0: &lt;NO-CARRIER,POINTOPOINT,MULTICAST,NOARP,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 500\n    link/none\n    inet 10.0.0.5/24 scope global tun0\n       valid_lft forever preferred_lft forever\nroot@3115:~#\n</code></pre> <p>\u6211\u4eec\u9700\u8981\u4e3a\u6b64\u7f16\u5199\u4e00\u4e2a<code>tunapp2</code>\uff0c\u5e76\u4e14\u76d1\u542c<code>udp</code>\u7684<code>10010</code>\u7aef\u53e3\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"syscall\"\n    \"time\"\n    \"unsafe\"\n)\n\nfunc main() {\n    fmt.Println(\"start server\")\n    tun, err := os.OpenFile(\"/dev/net/tun\", os.O_RDWR, 0)\n    if err != nil {\n        log.Println(\"open tun devices error\", err)\n    }\n\n    var ifr [18]byte\n    copy(ifr[:], \"tun0\")\n    *(*uint16)(unsafe.Pointer(&amp;ifr[16])) = uint16(syscall.IFF_TUN) | uint16(syscall.IFF_NO_PI)\n\n    syscall.Syscall(syscall.SYS_IOCTL, tun.Fd(), uintptr(syscall.TUNSETIFF), uintptr(unsafe.Pointer(&amp;ifr)))\n\n    serverAddr, err := net.ResolveUDPAddr(\"udp\", \":10010\")\n    if err != nil {\n        log.Println(\"failed resolve udp addr\", err)\n        return\n    }\n    conn, err := net.ListenUDP(\"udp\", serverAddr)\n    if err != nil {\n        log.Println(\"listen udp error\", err)\n        return\n    }\n\n    buf := make([]byte, 1500)\n    for {\n        un, udpAddr, err := conn.ReadFromUDP(buf)\n        if err != nil {\n            log.Println(\"read from udp error\", err)\n            continue\n        }\n\n        fmt.Println(\"\u5df2\u7ecf\u6536\u5230\u5ba2\u6237\u7aefudp\u8bf7\u6c42\u4e86\", len(buf[:un]))\n\n        tun.SetReadDeadline(time.Now().Add(1 * time.Second))\n\n        _, err = tun.Write(buf[:un])\n        if err != nil {\n            log.Println(\"tun write error\", err)\n        }\n\n        fmt.Println(\"\u5df2\u7ecf\u5c06\u8bf7\u6c42\u5199\u5165\u5230\u4e86tun\u865a\u62df\u8bbe\u5907\u4e2d\", len(buf[:un]))\n\n        n, err := tun.Read(buf)\n        if err != nil {\n            if os.IsTimeout(err) {\n                continue\n            }\n            log.Fatalf(\"Failed to read from device: %v\", err)\n        }\n        fmt.Println(\"\u5df2\u7ecf\u6536\u5230tun\u6536\u5230\u4e86\u4fe1\u606f\", len(buf[:n]))\n        conn.WriteToUDP(buf[:n], udpAddr)\n        fmt.Println(\"\u5c06\u6570\u636e\u56de\u590d\u5230udp\u5ba2\u6237\u7aef\u4e2d\", len(buf[:n]))\n    }\n}\n</code></pre> <p>\u5728\u8fd0\u884c <code>tunApp2</code> \u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u67e5\u770b <code>tun0</code> \u7684\u72b6\u6001\uff1a</p> <pre><code>root@3115:~# ./server\nstart server\n</code></pre> <p>\u67e5\u770b<code>tun0</code>\u72b6\u6001\u3002</p> <pre><code>root@3115:~# ip addr show tun0\n4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 500\n    link/none\n    inet 10.0.0.5/24 scope global tun0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::f4d3:cccd:e9e2:3be6/64 scope link stable-privacy\n       valid_lft forever preferred_lft forever\nroot@3115:~#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u5ba2\u6237\u7aef\u8fde\u63a5\u5e76\u542f\u52a8\u65f6\uff0c<code>tun</code> \u865a\u62df\u8bbe\u5907\u7684\u72b6\u6001\u4f1a\u4ece <code>DOWN</code> \u53d8\u4e3a <code>UP</code>\u3002\u8fd9\u8868\u660e\u8bbe\u5907\u5df2\u6210\u529f\u542f\u7528\uff0c\u5e76\u4e14\u53ef\u4ee5\u5f00\u59cb\u63a5\u6536\u548c\u53d1\u9001\u7f51\u7edc\u6570\u636e\u3002\u6b64\u65f6\uff0c\u7528\u6237\u6001\u7a0b\u5e8f<code>tunApp2</code>\u4e5f\u4e0e\u8bbe\u5907\u5efa\u7acb\u4e86\u8fde\u63a5\u3002</p>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#_2","title":"\u5ba2\u6237\u7aef\u64cd\u4f5c","text":"<p>\u540c\u6837\u7684\uff0c\u4e5f\u9700\u8981\u5728\u5ba2\u6237\u7aef\u4e0a\u521b\u5efa<code>tun</code>\u865a\u62df\u8bbe\u5907\uff0c\u914d\u7f6e<code>IP</code>\u4fe1\u606f\u7b49\uff0c\u5177\u4f53\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code>root@3114:~# ip tuntap add name tun0 mode tun\nroot@3114:~# ip addr add 10.0.0.3/24 dev tun0\nroot@3114:~# ip link set tun0 up\nroot@3114:~# sysctl -w net.ipv4.ip_forward=1\nnet.ipv4.ip_forward = 1\nroot@3114:~# ip addr show tun0\n3: tun0: &lt;NO-CARRIER,POINTOPOINT,MULTICAST,NOARP,UP&gt; mtu 1500 qdisc fq_codel state DOWN group default qlen 500\n    link/none\n    inet 10.0.0.3/24 scope global tun0\n       valid_lft forever preferred_lft forever\nroot@3114:~#\nroot@3114:~#\n</code></pre> <p>\u5e76\u4e14\uff0c\u4e3a\u6b64\u7f16\u5199\u4e00\u4e2a<code>tunApp1</code>\u7a0b\u5e8f\uff0c\u5c06\u4f5c\u4e3a\u5ba2\u6237\u7aef\u4f7f\u7528\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    fmt.Println(\"client start...\")\n    tun, err := os.OpenFile(\"/dev/net/tun\", os.O_RDWR, 0)\n    if err != nil {\n        log.Println(\"open tun devices error\", err)\n    }\n\n    var ifr [18]byte\n    copy(ifr[:], \"tun0\")\n    *(*uint16)(unsafe.Pointer(&amp;ifr[16])) = uint16(syscall.IFF_TUN) | uint16(syscall.IFF_NO_PI)\n\n    syscall.Syscall(syscall.SYS_IOCTL, tun.Fd(), uintptr(syscall.TUNSETIFF), uintptr(unsafe.Pointer(&amp;ifr)))\n\n    serverAddr, err := net.ResolveUDPAddr(\"udp\", \"192.168.3.115:10010\")\n    if err != nil {\n        log.Println(\"resolve udp error\", err)\n        return\n    }\n\n    conn, err := net.DialUDP(\"udp\", nil, serverAddr)\n    if err != nil {\n        log.Println(\"dial udp error\", err)\n        return\n    }\n\n    go func() {\n        buf := make([]byte, 1500)\n        for {\n            tn, err := tun.Read(buf)\n            if err != nil {\n                log.Fatalf(\"Failed to read from device: %v\", err)\n            }\n            fmt.Println(\"\u4ecetun\u865a\u62df\u8bbe\u5907\u4e2d\u6536\u5230\u4e86\u8bf7\u6c42\", len(buf[:tn]))\n\n            _, err = conn.Write(buf[:tn])\n            if err != nil {\n                log.Println(\"conn write error\", err)\n                continue\n            }\n            fmt.Println(\"\u5c06\u8bf7\u6c42\u53d1\u9001\u5230udp\u670d\u52a1\u5668\u4e2d\", len(buf[:tn]))\n        }\n    }()\n    buf := make([]byte, 1500)\n    for {\n        cn, _, err := conn.ReadFromUDP(buf)\n        if err != nil {\n            log.Println(\"read from udp error\", err)\n            continue\n        }\n        fmt.Println(\"\u5df2\u7ecf\u4eceudp\u670d\u52a1\u5668\u4e2d\u83b7\u53d6\u5230\u6570\u636e\")\n        _, err = tun.Write(buf[:cn])\n        if err != nil {\n            log.Println(\"tn write error\", err)\n        }\n        fmt.Println(\"\u5c06\u6570\u636e\u5199\u5165\u5230tun\u8bbe\u5907\u4e2d\")\n    }\n}\n</code></pre>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#ping","title":"\u5c1d\u8bd5ping","text":"<p>\u9996\u5148\uff0c\u5728\u6ca1\u6709\u542f\u52a8 <code>tunApp</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u5ba2\u6237\u7aef\u5c1d\u8bd5 <code>ping</code> <code>10.0.0.5</code> \u65f6\uff0c\u5f53\u7136\u662f\u65e0\u6cd5\u6210\u529f\u7684\u3002\u8fd9\u662f\u56e0\u4e3a <code>tun</code> \u8bbe\u5907\u7684\u53e5\u67c4\u6ca1\u6709\u88ab\u6253\u5f00\uff0c\u65e0\u6cd5\u5904\u7406\u4ece\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u5bfc\u81f4\u6570\u636e\u5305\u65e0\u6cd5\u4f20\u8f93\u3002\u5177\u4f53\u8868\u73b0\u4e3a\u65e0\u6cd5\u63a5\u6536\u5230\u54cd\u5e94\u3002</p> <pre><code>root@3114:~# ping 10.0.0.5 -c 2\nPING 10.0.0.5 (10.0.0.5) 56(84) bytes of data.\n\n--- 10.0.0.5 ping statistics ---\n2 packets transmitted, 0 received, 100% packet loss, time 1015ms\n\nroot@3114:~#\n</code></pre> <p>\u5f53\u542f\u52a8 <code>tunApp</code> \u540e\uff0c\u5ba2\u6237\u7aef\u518d\u6b21\u6267\u884c <code>ping 10.0.0.5</code> \u65f6\uff0c\u6839\u636e\u7cfb\u7edf\u9884\u8bbe\u7684\u8def\u7531\u89c4\u5219\uff0c\u6d41\u91cf\u5c06\u4f1a\u901a\u8fc7 <code>tun0</code> \u8bbe\u5907\u53d1\u9001\u51fa\u53bb\u3002\u4f8b\u5982\uff0c\u5ba2\u6237\u7aef\u7684\u8def\u7531\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>root@3114:~# ip route\ndefault via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n1.2.4.8 via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n10.0.0.0/24 dev tun0 proto kernel scope link src 10.0.0.3\n114.114.114.114 via 192.168.3.1 dev eth0 proto dhcp src 192.168.3.114 metric 100\n192.168.3.0/24 dev eth0 proto kernel scope link src 192.168.3.114 metric 100\n192.168.3.1 dev eth0 proto dhcp scope link src 192.168.3.114 metric 100\nroot@3114:~#\n</code></pre> <p>\u4e0a\u9762\u6709\u4e00\u6761\u89c4\u5219\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code>10.0.0.0/24 dev tun0 proto kernel scope link src 10.0.0.3\n</code></pre> <p>\u8fd9\u5c06\u8868\u793a\uff0c\u5f53\u8bf7\u6c42 <code>10.0.0.0/24</code> \u7f51\u7edc\u8303\u56f4\u5185\u7684\u5730\u5740\u65f6\uff0c\u6d41\u91cf\u5c06\u88ab\u5b9a\u5411\u5230 <code>10.0.0.3</code> \u7f51\u5361\uff0c\u800c\u8be5\u7f51\u5361\u6b63\u662f\u6211\u4eec <code>tun0</code> \u8bbe\u5907\u7684\u5730\u5740\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u5ba2\u6237\u7aef\u673a\u5668\u4e0a\u76f4\u63a5<code>ping 10.0.0.5</code>\u5730\u5740\uff0c\u4f1a\u6536\u5230\u56de\u590d\u62a5\u6587\uff0c\u5982\u4e0b\uff1a</p> <pre><code>root@3114:~# ping 10.0.0.5 -c 2\nPING 10.0.0.5 (10.0.0.5) 56(84) bytes of data.\n64 bytes from 10.0.0.5: icmp_seq=1 ttl=64 time=2.40 ms\n64 bytes from 10.0.0.5: icmp_seq=2 ttl=64 time=1.62 ms\n\n--- 10.0.0.5 ping statistics ---\n2 packets transmitted, 2 received, 0% packet loss, time 1002ms\nrtt min/avg/max/mdev = 1.622/2.011/2.400/0.389 ms\nroot@3114:~#\n</code></pre> <p>\u540c\u6837\u7684\uff0c<code>client</code>\u65e5\u5fd7\u4f1a\u663e\u793a\u5982\u4e0b\uff1a</p> <pre><code>root@3114:~# ./client\nclient start...\n\u4ecetun\u865a\u62df\u8bbe\u5907\u4e2d\u6536\u5230\u4e86\u8bf7\u6c42 84\n\u5c06\u8bf7\u6c42\u53d1\u9001\u5230udp\u670d\u52a1\u5668\u4e2d 84\n\u5df2\u7ecf\u4eceudp\u670d\u52a1\u5668\u4e2d\u83b7\u53d6\u5230\u6570\u636e\n\u5c06\u6570\u636e\u5199\u5165\u5230tun\u8bbe\u5907\u4e2d\n\u4ecetun\u865a\u62df\u8bbe\u5907\u4e2d\u6536\u5230\u4e86\u8bf7\u6c42 84\n\u5c06\u8bf7\u6c42\u53d1\u9001\u5230udp\u670d\u52a1\u5668\u4e2d 84\n\u5df2\u7ecf\u4eceudp\u670d\u52a1\u5668\u4e2d\u83b7\u53d6\u5230\u6570\u636e\n\u5c06\u6570\u636e\u5199\u5165\u5230tun\u8bbe\u5907\u4e2d\n\n</code></pre> <p>\u5bf9\u4e8e<code>client</code>\u7684\u62a5\u6587\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>root@3114:~# tcpdump -i tun0\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes\n07:50:37.061239 IP 3114 &gt; 10.0.0.5: ICMP echo request, id 24, seq 1, length 64\n07:50:37.064101 IP 10.0.0.5 &gt; 3114: ICMP echo reply, id 24, seq 1, length 64\n07:50:38.062797 IP 3114 &gt; 10.0.0.5: ICMP echo request, id 24, seq 2, length 64\n07:50:38.065070 IP 10.0.0.5 &gt; 3114: ICMP echo reply, id 24, seq 2, length 64\n^C\n4 packets captured\n4 packets received by filter\n0 packets dropped by kernel\nroot@3114:~#\n</code></pre> <p><code>server</code>\u65e5\u5fd7\u4f1a\u663e\u793a\u5982\u4e0b\uff1a</p> <pre><code>root@3115:~# ./server\nstart server\n\u5df2\u7ecf\u6536\u5230\u5ba2\u6237\u7aefudp\u8bf7\u6c42\u4e86 84\n\u5df2\u7ecf\u5c06\u8bf7\u6c42\u5199\u5165\u5230\u4e86tun\u865a\u62df\u8bbe\u5907\u4e2d 84\n\u5df2\u7ecf\u6536\u5230tun\u6536\u5230\u4e86\u4fe1\u606f 84\n\u5c06\u6570\u636e\u56de\u590d\u5230udp\u5ba2\u6237\u7aef\u4e2d 84\n\u5df2\u7ecf\u6536\u5230\u5ba2\u6237\u7aefudp\u8bf7\u6c42\u4e86 84\n\u5df2\u7ecf\u5c06\u8bf7\u6c42\u5199\u5165\u5230\u4e86tun\u865a\u62df\u8bbe\u5907\u4e2d 84\n\u5df2\u7ecf\u6536\u5230tun\u6536\u5230\u4e86\u4fe1\u606f 84\n\u5c06\u6570\u636e\u56de\u590d\u5230udp\u5ba2\u6237\u7aef\u4e2d 84\n\n</code></pre> <p>\u5bf9\u4e8e<code>server</code>\u7684\u62a5\u6587\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>root@3115:~# tcpdump -i tun0\ntcpdump: verbose output suppressed, use -v[v]... for full protocol decode\nlistening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes\n07:50:37.053759 IP 10.0.0.3 &gt; 10.0.0.5: ICMP echo request, id 24, seq 1, length 64\n07:50:37.053831 IP 10.0.0.5 &gt; 10.0.0.3: ICMP echo reply, id 24, seq 1, length 64\n07:50:38.054582 IP 10.0.0.3 &gt; 10.0.0.5: ICMP echo request, id 24, seq 2, length 64\n07:50:38.054651 IP 10.0.0.5 &gt; 10.0.0.3: ICMP echo reply, id 24, seq 2, length 64\n^C\n4 packets captured\n4 packets received by filter\n0 packets dropped by kernel\nroot@3115:~#\n</code></pre>"},{"location":"2025/01/10/Linux_Tun_Virtual_Devices.html#_3","title":"\u603b\u7ed3","text":"<p>\u5bf9\u4e8e <code>tun</code> \u865a\u62df\u8bbe\u5907\uff0c\u53ef\u4ee5\u5c06\u5176\u7b80\u5355\u7406\u89e3\u4e3a\uff1a\u5c06 <code>A</code> \u4ea7\u751f\u7684\u62a5\u6587\u539f\u5c01\u4e0d\u52a8\u5730\u4f20\u8f93\u5230 <code>B</code> \u8fdb\u884c\u5904\u7406\uff0c\u5f85 <code>B</code> \u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u518d\u5c06\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u7ed9 <code>A</code>\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html","title":"\u4f7f\u7528mkdocs\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u535a\u5ba2\u7cfb\u7edf","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528<code>mkdocs</code>\u521b\u5efa\u9759\u6001\u535a\u5ba2\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_1","title":"\u524d\u8a00","text":"<p>\u6bcf\u4e2a\u505a\u6280\u672f\u7684\u90fd\u5e0c\u671b\u6709\u4e00\u4e2a\u5c5e\u4e8e\u4e2a\u4eba\u7684\u5c0f\u7ad9\u70b9\uff0c\u4e0d\u7ba1\u662f\u5199\u4e00\u4e9b\u968f\u7b14\uff0c\u8fd8\u662f\u8bb0\u5f55\u6280\u672f\u603b\u7ed3\uff0c\u4f46\u662f\u53c8\u4e0d\u60f3\u5f04\u5f97\u5f88\u590d\u6742\u3002\u8fd9\u7bc7\u6587\u7ae0\u4e5f\u8bb8\u4f1a\u5e2e\u5230\u4f60\u3002</p> <p>\u672c\u535a\u5ba2\u4f7f\u7528\u7684\u6280\u672f\u6808\u4e3a<code>mkdocs</code> + <code>material</code> \u4e3b\u9898\uff0c\u914d\u5408 <code>giscus</code> \u8bc4\u8bba\u7cfb\u7edf\u642d\u914d\u800c\u6210\uff0c\u542c\u8d77\u6765\u662f\u4e0d\u662f\u611f\u89c9\u975e\u5e38\u590d\u6742\uff0c\u653e\u5fc3\uff0c\u53ea\u4f1a\u6d89\u53ca\u4e00\u4e9b\u7b80\u5355\u7684\u547d\u4ee4\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#mkdocs_1","title":"\u5b89\u88c5<code>mkdocs</code>","text":"<p>\u9996\u5148\u662f\u5b89\u88c5<code>mkdocs</code> \uff0c\u5b83\u662f<code>python</code> \u7f16\u5199\u7684\u4e00\u4e2a\u57fa\u4e8e<code>Markdown</code> \u6587\u6863\u7684\u9759\u6001\u7ad9\u70b9\u751f\u6210\u5668\u3002</p> <p>\u4f7f\u7528<code>pip</code> \u8fdb\u884c\u5b89\u88c5\u5373\u53ef</p> <pre><code># pip3 install mkdocs\n</code></pre> <p>\u9996\u5148\u9700\u8981\u5b89\u88c5<code>python</code> \uff1a  https://www.python.org/</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_2","title":"\u521b\u5efa\u65b0\u9879\u76ee","text":"<p>\u4f7f\u7528<code>mkdocs new new-project</code> \uff0c\u5373\u53ef\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684<code>new-project</code> \u9879\u76ee \u3002</p> <pre><code># mkdocs new new-project\nINFO    -  Creating project directory: new-project\nINFO    -  Writing config file: new-project/mkdocs.yml\nINFO    -  Writing initial docs: new-project/docs/index.md\n#\n</code></pre> <p>\u521b\u5efa<code>new-project</code> \u65b0\u9879\u76ee\u540e\uff0c\u76ee\u5f55\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code># tree new-project/\nnew-project/\n\u251c\u2500\u2500 docs\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.md\n\u2514\u2500\u2500 mkdocs.yml\n\n1 directory, 2 files\n#\n</code></pre> <p>\u5176\u4e2d</p> <ul> <li><code>mkdocs.yml</code> \uff1a\u4e3b\u914d\u7f6e\u6587\u4ef6</li> <li><code>docs</code>\uff1a\u9759\u6001\u6587\u6863\u76ee\u5f55</li> </ul>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_3","title":"\u5b9e\u65f6\u9884\u89c8","text":"<p><code>mkdocs</code> \u63d0\u4f9b\u4e86\u5185\u7f6e<code>web</code> \u670d\u52a1\u5668\uff0c\u4ee5\u4fbf\u5728\u7f16\u5199\u6587\u6863\u7684\u65f6\u5019\u53ef\u4ee5\u5b9e\u65f6\u6d4f\u89c8\u6587\u6863\uff0c\u5728\u65b0\u9879\u76ee\u76ee\u5f55\u4e0b\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u542f\u52a8\u8be5<code>web</code> \u670d\u52a1\u5668\uff1a</p> <pre><code>$ cd new-project/\n$ mkdocs serve\nINFO    -  Building documentation...\nINFO    -  Cleaning site directory\nINFO    -  Documentation built in 0.14 seconds\nINFO    -  [15:14:07] Watching paths for changes: 'docs', 'mkdocs.yml'\nINFO    -  [15:14:07] Serving on http://127.0.0.1:8000/\n</code></pre> <p>\u6b64\u65f6\u82e5\u6253\u5f00\u8be5\u7f51\u9875\uff0c\u4f1a\u770b\u5230\u9ed8\u8ba4\u7684\u4e3b\u9875\uff1a</p> <p></p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_4","title":"\u751f\u6210\u7f51\u9875\u6587\u4ef6","text":"<p>\u82e5\u6587\u6863\u7f16\u5199\u5b8c\u540e\uff0c\u60f3\u8981\u90e8\u7f72\u5230\u9759\u6001\u670d\u52a1\u5668\u4e0a\uff0c\u53ef\u4ee5\u5c06\u5176\u751f\u6210\u9759\u6001\u7ad9\u70b9\uff0c\u800c\u540e\u90e8\u7f72\u5230\u9759\u6001\u670d\u52a1\u5668\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code># cd ..\n# cd new-project/\n# mkdocs build\nINFO    -  Cleaning site directory\nINFO    -  Building documentation to directory: /mnt/j/new-project/site\nINFO    -  Documentation built in 0.09 seconds\n#\n</code></pre> <p>\u6b64\u65f6\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\uff0c\u751f\u6210<code>site</code> \u76ee\u5f55\uff0c\u800c\u8be5\u5728\u76ee\u5f55\u4e0b\uff0c\u662f\u751f\u6210\u4e00\u7cfb\u5217\u7684\u9759\u6001\u6587\u4ef6\u3002</p> <pre><code># tree site\nsite\n\u251c\u2500\u2500 404.html\n\u251c\u2500\u2500 css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 base.css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bootstrap.min.css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bootstrap.min.css.map\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 brands.min.css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 fontawesome.min.css\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 solid.min.css\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 v4-font-face.min.css\n\u251c\u2500\u2500 img\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 favicon.ico\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 grid.png\n\u251c\u2500\u2500 index.html\n\u251c\u2500\u2500 js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 base.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bootstrap.bundle.min.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 bootstrap.bundle.min.js.map\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 darkmode.js\n\u251c\u2500\u2500 search\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 lunr.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.js\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 search_index.json\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 worker.js\n\u251c\u2500\u2500 sitemap.xml\n\u251c\u2500\u2500 sitemap.xml.gz\n\u2514\u2500\u2500 webfonts\n    \u251c\u2500\u2500 fa-brands-400.ttf\n    \u251c\u2500\u2500 fa-brands-400.woff2\n    \u251c\u2500\u2500 fa-regular-400.ttf\n    \u251c\u2500\u2500 fa-regular-400.woff2\n    \u251c\u2500\u2500 fa-solid-900.ttf\n    \u251c\u2500\u2500 fa-solid-900.woff2\n    \u251c\u2500\u2500 fa-v4compatibility.ttf\n    \u2514\u2500\u2500 fa-v4compatibility.woff2\n\n5 directories, 29 files\n#\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#blog","title":"\u914d\u7f6eblog\u4e3b\u9898","text":"<p><code>mkdocs-material</code> \u662f<code>mkdocs</code> \u4f7f\u7528\u6700\u591a\u7684\u7b2c\u4e09\u65b9\u4e3b\u9898\uff0c\u5176\u5185\u7f6e\u4e86<code>blog</code> \u63d2\u4ef6\u53ef\u4f9b\u76f4\u63a5\u8c03\u7528\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#mkdocs-material","title":"\u5b89\u88c5<code>mkdocs-material</code>","text":"<p>\u4f7f\u7528<code>pip</code> \u5373\u53ef\u5b89\u88c5\u8be5\u4e3b\u9898</p> <pre><code># pip3 install mkdocs-material\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#blog_1","title":"\u521b\u5efablog\u5fc5\u8981\u7684\u76ee\u5f55","text":"<p>\u4f7f\u7528<code>mkdocs-material</code>\u7684\u535a\u5ba2\u63d2\u4ef6\uff0c\u9700\u8981\u65b0\u5efa<code>docs/posts</code> \u76ee\u5f55\uff0c\u4ee5\u4fbf\u63d2\u4ef6\u80fd\u591f\u626b\u63cf\u8be5\u76ee\u5f55\u4e0b\u6240\u6709\u7684<code>Markdown</code> \u6587\u4ef6\u3002</p> <pre><code># cd ..\n# cd new-project/\n# mkdir -p docs/posts/\n# tree docs/\ndocs/\n\u251c\u2500\u2500 index.md\n\u2514\u2500\u2500 posts\n\n1 directory, 1 file\n#\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#mkdocsyml","title":"\u914d\u7f6emkdocs.yml","text":"<p>\u8be5\u914d\u7f6e\u6587\u4ef6\u9ed8\u8ba4\u53ea\u6709\u4e00\u9879\u914d\u7f6e\uff1a<code>site_name</code>\uff0c\u4e5f\u662f\u552f\u4e00\u5fc5\u987b\u8981\u6709\u7684\u4e00\u9879\u3002</p> <pre><code># cat mkdocs.yml\nsite_name: My Docs\n#\n</code></pre> <p>\u5728\u6b64\u57fa\u7840\u4e0a\uff0c\u65b0\u589e<code>theme</code> \u548c<code>plugins</code> \u914d\u7f6e\u4e3a<code>blog</code> \u7c7b\u578b</p> <p>\u914d\u7f6e\u5982\u4e0b</p> <pre><code># cat mkdocs.yml\nsite_name: My Blog\n\ntheme:\n  name: material\n\nplugins:\n  - blog:\n      blog_dir: .\n#\n</code></pre> <p>\u4e0a\u8ff0\u5185\u5bb9\u662f\u4e00\u4e2a\u6700\u57fa\u672c\u7684<code>blog</code> \u914d\u7f6e\uff0c\u542b\u4e49\u662f<code>mkdocs</code> \u4f7f\u7528\u4e86<code>mkdocs-material</code> \u4e3b\u9898\uff0c\u5e76\u4e14\u542f\u7528\u4e86<code>blog</code>\u63d2\u4ef6\uff0c<code>blog</code> \u7684\u6839\u76ee\u5f55\u4e3a\u5f53\u524d\u76ee\u5f55\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_5","title":"\u7f16\u5199\u7b2c\u4e00\u7bc7\u535a\u5ba2","text":"<p>\u5173\u4e8e\u66f4\u591a\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003\uff1a mkdocs-material-setting-up-a-blog</p> <p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u9700\u8981\u5148\u6e05\u7406\u6389<code>docs/index.md</code> \u7684\u5185\u5bb9\uff0c\u4ee5\u514d\u9020\u6210\u5e72\u6270\u3002</p> <pre><code># &gt; docs/index.md\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_6","title":"\u65b0\u589e\u7b2c\u4e00\u7bc7\u535a\u5ba2","text":"<p>\u5728<code>/docs/posts/</code> \u4e2d\u53ef\u4ee5\u7f16\u5199\u7b2c\u4e00\u7bc7\u6587\u6863\u4e86\u3002</p> <pre><code># cat &gt;&gt; docs/posts/hello_mkdocs.md &lt;&lt; EOF\n&gt; ---\n&gt; date: 2024-10-18\n&gt; categories:\n&gt;   - hello\n&gt; draft: false\n&gt; ---\n&gt;\n&gt; # Hello Mkdocs\n&gt;\n&gt; \u8fd9\u662f\u7f16\u5199\u7684\u7b2c\u4e00\u7bc7\u6587\u6863\n&gt;\n&gt; &lt;!-- more --&gt;\n&gt;\n&gt; \u6b63\u6587\u5f00\u59cb...\n&gt; EOF\n#\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_7","title":"\u535a\u5ba2\u5143\u6570\u636e","text":"<p>\u6587\u6863\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code># cat docs/posts/hello_mkdocs.md\n---\ndate: 2024-10-18\ncategories:\n  - hello\ndraft: false\n---\n\n# Hello Mkdocs\n\n\u8fd9\u662f\u7f16\u5199\u7684\u7b2c\u4e00\u7bc7\u6587\u6863\n\n&lt;!-- more --&gt;\n\n\u6b63\u6587\u5f00\u59cb...\n#\n</code></pre> <p>\u5176\u4e2d<code>---</code> \u5305\u542b\u7684\u662f\u535a\u5ba2\u7684\u5143\u4fe1\u606f</p> <pre><code>---\ndate: 2024-10-18\ncategories:\n  - hello\ndraft: false\n---\n</code></pre> <ul> <li><code>date</code>\uff1a \u6587\u6863\u7684\u65e5\u671f</li> <li><code>categories</code>\uff1a \u6587\u6863\u7684\u5206\u7c7b</li> <li><code>draft</code>\uff1a \u662f\u5426\u662f\u8349\u7a3f</li> </ul> <p>\u63a5\u4e0b\u6765\u4fbf\u662f\u6458\u8981</p> <pre><code># Hello Mkdocs\n\n\u8fd9\u662f\u7f16\u5199\u7684\u7b2c\u4e00\u7bc7\u6587\u6863\n\n&lt;!-- more --&gt;\n</code></pre> <p><code>&lt;!-- more --&gt;</code> \u6807\u7b7e\u4e4b\u4e0a\u7684\u5185\u5bb9\uff0c\u4fbf\u662f\u6458\u8981\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_8","title":"\u5b9e\u9645\u6548\u679c\u5c55\u793a","text":"<p>\u5b8c\u6210\u540e\uff0c\u4fbf\u53ef\u4ee5\u4f7f\u7528<code>mkdocs serve</code> \u67e5\u770b\u5b9e\u9645\u7684\u6548\u679c\u4e86\u3002</p> <p></p> <p></p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#giscus","title":"\u65b0\u589egiscus\u8bc4\u8bba\u7cfb\u7edf","text":"<p><code>giscus</code> \u662f<code>github</code>\u7684\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\uff0c\u7531<code>GitHub Discussions</code>\u63d0\u4f9b\u652f\u6301\u7684\u8bc4\u8bba\u7cfb\u7edf\u3002</p> <p>\u7531\u4e8e\u662f\u57fa\u4e8e<code>github</code> \u7684\uff0c\u6240\u4ee5\u9700\u8981\u5148\u5728\u7f51\u9875\u4e0a\u767b\u5f55<code>github</code> \u624d\u80fd\u8fdb\u884c\u540e\u7eed\u7684\u64cd\u4f5c\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#giscus_1","title":"\u5b89\u88c5giscus","text":"<p>\u4f7f\u7528\u6d4f\u89c8\u5668\u6253\u5f00https://github.com/apps/giscus\u6253\u5f00\u8be5\u9875\u9762\uff0c\u9009\u62e9<code>Install</code> \u8fdb\u884c\u5b89\u88c5</p> <p></p> <p>\u70b9\u51fb\u5b89\u88c5\u540e\uff0c\u4f1a\u63d0\u793a\u5bf9\u4e8e\u54ea\u4e9b\u5b58\u50a8\u5e93\u6709\u6743\u9650\uff0c\u7531\u4e8e\u662f\u7ed9<code>mkdocs</code> \u4f7f\u7528\uff0c\u6240\u4ee5\u7ed9\u5b9a\u4e00\u4e2a\u9884\u5148\u521b\u5efa\u597d\u7684\u4ed3\u5e93\u5373\u53ef\u3002</p> <p>\u6700\u540e\u70b9\u51fb<code>Install</code> \u5373\u53ef\u5b89\u88c5\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#giscus_2","title":"\u751f\u6210giscus\u914d\u7f6e\u6587\u4ef6","text":"<p>\u6253\u5f00https://giscus.app/zh-CN\u5373\u53ef\u914d\u7f6e\u8be5<code>giscus</code> \uff0c\u8f93\u5165\u4ed3\u5e93\u4fe1\u606f\uff0c\u9009\u62e9\u6620\u5c04\u5173\u7cfb\uff0c\u5373\u53ef\u751f\u6210\u914d\u7f6e\u6587\u4ef6\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#giscusmkdocs","title":"\u5c06giscus\u96c6\u6210\u5230mkdocs\u4e0a","text":"<p>\u8986\u76d6\u539f\u59cb<code>comments.html</code> \u6587\u4ef6\uff0c\u65b0\u5efa<code>overrides/partials/comments.html</code> \u6587\u4ef6\u3002</p> <pre><code># cd ..\n# cd new-project/\n# mkdir -p overrides/partials/\n#\n# touch  overrides/partials/comments.html\n#\n</code></pre> <p>\u7f16\u8f91<code>comments.html</code> \u6587\u4ef6\uff0c\u9996\u5148\u952e\u5165\u6a21\u7248\u5185\u5bb9\uff1a</p> <pre><code># cat overrides/partials/comments.html\n{% if page.meta.comments %}\n  &lt;h2 id=\"__comments\"&gt;{{ lang.t(\"meta.comments\") }}&lt;/h2&gt;\n  &lt;!-- Insert generated snippet here --&gt;\n\n  &lt;!-- Synchronize Giscus theme with palette --&gt;\n  &lt;script&gt;\n    var giscus = document.querySelector(\"script[src*=giscus]\")\n\n    // Set palette on initial load\n    var palette = __md_get(\"__palette\")\n    if (palette &amp;&amp; typeof palette.color === \"object\") {\n      var theme = palette.color.scheme === \"slate\"\n        ? \"transparent_dark\"\n        : \"light\"\n\n      // Instruct Giscus to set theme\n      giscus.setAttribute(\"data-theme\", theme)\n    }\n\n    // Register event handlers after documented loaded\n    document.addEventListener(\"DOMContentLoaded\", function() {\n      var ref = document.querySelector(\"[data-md-component=palette]\")\n      ref.addEventListener(\"change\", function() {\n        var palette = __md_get(\"__palette\")\n        if (palette &amp;&amp; typeof palette.color === \"object\") {\n          var theme = palette.color.scheme === \"slate\"\n            ? \"transparent_dark\"\n            : \"light\"\n\n          // Instruct Giscus to change theme\n          var frame = document.querySelector(\".giscus-frame\")\n          frame.contentWindow.postMessage(\n            { giscus: { setConfig: { theme } } },\n            \"https://giscus.app\"\n          )\n        }\n      })\n    })\n  &lt;/script&gt;\n{% endif %}\n#\n</code></pre> <p>\u63a5\u7740\u5c06\u4e0a\u8ff0\u751f\u6210\u7684<code>giscus</code> \u914d\u7f6e\u6587\u4ef6\uff0c\u7f16\u8f91\u5230\u4e0a\u8ff0<code>comments.html</code>\u6587\u4ef6\u4e2d\u7684<code>&lt;!-- Insert generated snippet here --&gt;</code> \u548c<code>&lt;!-- Synchronize Giscus theme with palette --&gt;</code> \u4e4b\u95f4\u3002</p> <p>\u5b8c\u6574\u7684\u5185\u5bb9\u4e3a\uff1a</p> <pre><code># cat overrides/partials/comments.html\n{% if page.meta.comments %}\n  &lt;h2 id=\"__comments\"&gt;{{ lang.t(\"meta.comments\") }}&lt;/h2&gt;\n  &lt;!-- Insert generated snippet here --&gt;\n\n&lt;!-- giscus.app/client.js \u76f8\u5173\u4ee3\u7801 --&gt;\n\n  &lt;!-- Synchronize Giscus theme with palette --&gt;\n  &lt;script&gt;\n    var giscus = document.querySelector(\"script[src*=giscus]\")\n\n    // Set palette on initial load\n    var palette = __md_get(\"__palette\")\n    if (palette &amp;&amp; typeof palette.color === \"object\") {\n      var theme = palette.color.scheme === \"slate\"\n        ? \"transparent_dark\"\n        : \"light\"\n\n      // Instruct Giscus to set theme\n      giscus.setAttribute(\"data-theme\", theme)\n    }\n\n    // Register event handlers after documented loaded\n    document.addEventListener(\"DOMContentLoaded\", function() {\n      var ref = document.querySelector(\"[data-md-component=palette]\")\n      ref.addEventListener(\"change\", function() {\n        var palette = __md_get(\"__palette\")\n        if (palette &amp;&amp; typeof palette.color === \"object\") {\n          var theme = palette.color.scheme === \"slate\"\n            ? \"transparent_dark\"\n            : \"light\"\n\n          // Instruct Giscus to change theme\n          var frame = document.querySelector(\".giscus-frame\")\n          frame.contentWindow.postMessage(\n            { giscus: { setConfig: { theme } } },\n            \"https://giscus.app\"\n          )\n        }\n      })\n    })\n  &lt;/script&gt;\n{% endif %}\n#\n</code></pre> <p>\u540c\u65f6\uff0c\u8fd8\u9700\u8981\u4fee\u6539<code>mkdocs.yml</code> \u5728<code>theme</code> \u4e2d\u65b0\u589e<code>custom_dir</code> \u53c2\u6570\uff0c\u5b8c\u6574\u7684\u914d\u7f6e\u53c2\u6570\u4e3a\uff1a</p> <pre><code># cat mkdocs.yml\nsite_name: My Blog\ntheme:\n  name: material\n  custom_dir: 'overrides'\n\nplugins:\n  - blog:\n      blog_dir: .\n#\n</code></pre> <p><code>custom_dir</code> \u53c2\u6570\u7684\u4f5c\u7528\u662f\u8986\u76d6\u539f\u59cb\u6a21\u7248\u6587\u4ef6\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_9","title":"\u4e3a\u535a\u6587\u5f00\u542f\u8bc4\u8bba\u6846","text":"<p>\u8fd8\u8bb0\u5f97\u521b\u5efa<code>hello_mkdocs.md</code> \u7684\u5143\u4fe1\u606f\u5417\uff1f</p> <pre><code># head docs/posts/hello_mkdocs.md\n---\ndate: 2024-10-18\ncategories:\n  - hello\ndraft: false\n---\n\n# Hello Mkdocs\n\n\u8fd9\u662f\u7f16\u5199\u7684\u7b2c\u4e00\u7bc7\u6587\u6863\n#\n</code></pre> <p>\u4ec5\u9700\u8981\u5728\u5143\u4fe1\u606f\u4e0a\u6dfb\u52a0<code>comments: true</code> \u5373\u53ef\uff0c\u65b0\u589e\u8bc4\u8bba\u6846\u3002</p> <p>\u4fee\u6539\u540e\u7684\u6587\u4ef6\u4e3a\uff1a</p> <pre><code># head docs/posts/hello_mkdocs.md\n---\ndate: 2024-10-18\ncategories:\n  - hello\ndraft: false\ncomments: true\n---\n\n# Hello Mkdocs\n\n#\n</code></pre> <p>\u6253\u5f00\u7f51\u9875\uff0c\u4fbf\u53ef\u4ee5\u8fdb\u884c\u8bc4\u8bba\u4e86\u3002</p> <p></p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#rss","title":"\u5f00\u542fRSS","text":"<p>\u5173\u4e8e<code>RSS</code>\u7684\u6587\u6863\uff0c\u53c2\u8003\u5982\u4e0b\uff1a https://squidfunk.github.io/mkdocs-material/setup/setting-up-a-blog/#rss</p> <p><code>RSS</code> \u5bf9\u4e8e\u535a\u5ba2\u800c\u8a00\uff0c\u975e\u5e38\u91cd\u8981\uff0c\u53ef\u4ee5\u65b9\u4fbf\u7528\u6237\u8ba2\u9605\u7f51\u7ad9<code>RSS feed</code>\uff0c\u63a5\u4e0b\u6765\u4fbf\u4ecb\u7ecd\u5982\u4f55\u5f00\u542f<code>RSS</code> \u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_10","title":"\u5b89\u88c5\u63d2\u4ef6","text":"<pre><code># pip3 install mkdocs-rss-plugin\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#rss_1","title":"\u914d\u7f6eRSS","text":"<p>\u5728<code>mkdocs.yml</code>\u4e2d\u65b0\u589e\u5173\u4e8e<code>RSS</code> \u4fe1\u606f\u7684\u53c2\u6570\u3002</p> <pre><code>plugins:\n  - blog:\n      blog_dir: .\n  - rss:\n      match_path: /*\n      categories:\n        - categories\n        - tags\n      use_git: false\n</code></pre> <p>\u5176\u53c2\u6570\u7684\u4f5c\u7528\u4e3a\u5f00\u542f<code>rss</code> \u3002</p> <ul> <li><code>match_path:</code>\uff1a \u5339\u914d \u6307\u5b9a \u76ee\u5f55\u4e0b\u7684\u6587\u6863\u3002</li> <li><code>categories</code> \uff1a <code>feed</code> \u7c7b\u522b\u3002</li> <li><code>use_git</code>:  \u7981\u7528<code>git</code> \u3002</li> </ul> <p>\u5176\u5b8c\u6574\u53c2\u6570\u4e3a\uff1a</p> <pre><code># cat mkdocs.yml\nsite_name: My Blog\ntheme:\n  name: material\n  custom_dir: 'overrides'\n\nplugins:\n  - blog:\n      blog_dir: .\n  - rss:\n      match_path: /*\n      categories:\n        - categories\n        - tags\n      use_git: false\n#\n</code></pre>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_11","title":"\u6548\u679c\u5c55\u793a","text":"<p>\u5b8c\u6210\u540e\uff0c\u4fbf\u53ef\u4ee5\u4f7f\u7528<code>mkdocs serve</code> \u67e5\u770b\u5b9e\u9645\u7684\u6548\u679c\u4e86\u3002</p> <p>\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165127.0.0.1:8001/feed_rss_created.xml\u4fbf\u53ef\u4ee5\u67e5\u770b\u8be5\u7ad9\u70b9\u7684<code>RSS</code>\u4fe1\u606f\u4e86\u3002</p> <p></p> <p>\u5982\u4e0a\uff0c\u5219\u8bc1\u660e\u8be5<code>RSS</code> \u914d\u7f6e\u6210\u529f\u3002</p>"},{"location":"2024/10/18/Create-a-simple-blog-system-using-mkdocs.html#_12","title":"\u603b\u7ed3","text":"<p>\u4e00\u4e2a\u6700\u6700\u6700\u7b80\u5355\u7684\u4f7f\u7528<code>mkdocs</code> \u521b\u5efa\u535a\u5ba2\u7cfb\u7edf\u7684\u6848\u4f8b\u5c31\u7ed3\u675f\u4e86\uff0c\u7b80\u5355\u7684\u603b\u7ed3\u4e00\u4e0b\uff1a</p> <p>\u9996\u5148<code>mkdocs</code> \u662f\u57fa\u4e8e<code>python</code> \u7684\u7b2c\u4e09\u65b9\u8f6f\u4ef6\uff0c\u6240\u4ee5\u9700\u8981\u4f9d\u8d56\u5176<code>python</code> \u73af\u5883\uff0c\u6240\u4ee5\u9700\u8981\u4f7f\u7528\u8be5\u5de5\u5177\uff0c\u5f97\u5148\u5b89\u88c5<code>python</code>\u3002</p> <p>https://www.python.org/</p> <p>\u5176\u6b21\u4f7f\u7528\u7684\u535a\u5ba2\u7cfb\u7edf\u662f\u6e90\u4e8e<code>mkdocs</code> \u7684\u7b2c\u4e09\u65b9\u4e3b\u9898<code>material</code>\uff0c\u4e5f\u662f\u9700\u8981\u989d\u5916\u5b89\u88c5\u7684\u3002</p> <p>https://github.com/squidfunk/mkdocs-material</p> <p>\u63a5\u7740\u4fbf\u662f\u5bfc\u5165\u4e86<code>Giscus</code>\u8bc4\u8bba\u7cfb\u7edf\uff0c\u5b83\u662f<code>github</code>\u4e2d\u7684\u4e00\u4e2a\u5e94\u7528\u8f6f\u4ef6\uff0c\u9700\u8981\u5148\u5230<code>github</code>\u4e0a\u8fdb\u884c\u5b89\u88c5\uff0c\u800c\u540e\u5230https://giscus.app/zh-CN\u8fdb\u884c\u914d\u7f6e\uff0c\u83b7\u53d6\u5230\u76f8\u5173\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6700\u540e\u901a\u8fc7\u8986\u76d6<code>mkdocs</code> \u539f\u59cb\u6587\u4ef6\u7684\u65b9\u5f0f\u96c6\u6210\u5230<code>mkdocs</code> \u4e2d\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8986\u76d6<code>mkdocs</code> \u9700\u8981\u4fee\u6539<code>mkdocs.yml</code>\u914d\u7f6e\u6587\u4ef6\uff0c\u5728<code>theme</code> \u4e2d\u5f15\u5165<code>custom_dir</code> \u76f8\u5173\u914d\u7f6e\u3002</p> <p>\u6700\u540e\u4fbf\u662f\u96c6\u6210\u4e86<code>RSS</code>\uff0c\u5b83\u4e5f\u662f\u4e00\u4e2a\u7b2c\u4e09\u65b9\u63d2\u4ef6\uff0c\u9700\u8981\u8fdb\u884c\u989d\u5916\u5b89\u88c5\uff0c\u5b89\u88c5\u5b8c\u6bd5\u540e\uff0c\u9700\u8981\u5728<code>plugins</code> \u4e2d\u8fdb\u884c\u914d\u7f6e<code>RSS</code> \u76f8\u5173\u4fe1\u606f\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html","title":"\u4e86\u89e3POSIX\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u672c\u6587\u5c06\u7b80\u5355\u4ecb\u7ecd<code>POSIX</code>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#posix_1","title":"\u4ec0\u4e48\u662fPOSIX\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p><code>POSIX</code>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e5f\u79f0<code>ERE</code>\uff08Extended Regular Expressions\uff09\u662f\u57fa\u4e8e<code>BRE</code>\u7684\u6269\u5c55\u529f\u80fd\uff0c\u76ee\u7684\u662f\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u4f9b\u66f4\u52a0\u4e30\u5bcc\u7684\u529f\u80fd\uff0c\u548c\u66f4\u52a0\u7b80\u6d01\u7684\u5199\u6cd5\u3002</p> <p>\u5982\u4f55\u542f\u7528\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u5462\uff1f</p> <p>\u5728<code>grep</code> \u4e2d\uff0c\u9700\u8981\u4f7f\u7528<code>-E</code> \u9009\u9879\u6765\u542f\u7528\u6269\u5c55\u529f\u80fd\uff0c<code>sed</code> \u4e5f\u662f\u540c\u7406\uff0c\u9700\u8981\u6dfb\u52a0<code>-E</code>\u6765\u542f\u7528\u6269\u5c55\uff0c\u800c<code>awk</code> \u9ed8\u8ba4\u5c31\u652f\u6301\u8be5\u6269\u5c55\u529f\u80fd\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_1","title":"\u65b0\u589e\u3001\u4fee\u6539\u7684\u70b9","text":""},{"location":"2024/11/08/Extended-Regular-Expressions.html#_2","title":"\u53d6\u6d88\u4e86\u8f6c\u4e49\u7b26","text":"<p>\u5728<code>ERE</code>\u4e2d\uff0c<code>BRE</code>\u9700\u8981\u8f6c\u4e49\u7684\u5143\u5b57\u7b26\uff0c\u5728<code>ERE</code>\u4e2d\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u8f6c\u4e49\u4e86\uff0c\u6bd4\u5982<code>()</code> \u3001<code>{}</code> \u7b49\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_3","title":"\u65b0\u589e\u7684\u5143\u5b57\u7b26","text":"<p>\u5728<code>ERE</code>\u4e2d\uff0c\u65b0\u589e\u4e86<code>+</code> \u548c<code>?</code>\u7684\u5143\u5b57\u7b26\uff0c\u5176\u542b\u4e49\u662f\uff1a</p> <ul> <li><code>+</code>\uff1a \u5339\u914d\u524d\u9762\u7684\u5143\u7d201\u6b21\u6216\u8005\u591a\u6b21\u3002</li> <li><code>?</code>\uff1a \u5339\u914d\u524d\u9762\u7684\u5143\u7d200\u6b21\u6216\u80051\u6b21\u3002</li> </ul>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_4","title":"\u64cd\u4f5c","text":""},{"location":"2024/11/08/Extended-Regular-Expressions.html#_5","title":"\u76f4\u63a5\u5f15\u7528\u4e0d\u9700\u8981\u8f6c\u4e49","text":"<p>\u5728<code>ERE</code>\u4e2d\uff0c\u53ef\u4ee5\u76f4\u63a5\u5f15\u7528<code>{}</code> \u3001<code>()</code> \u4e2d\uff0c\u800c\u4e0d\u9700\u8981\u8fdb\u884c\u8f6c\u4e49\uff0c\u7b80\u5316\u4e86\u5199\u6cd5\uff0c\u5982\uff1a</p> <pre><code>wangli@debian:~$ echo \"worrrrld\" | grep -E 'r{1,3}'\nworrrrld\nwangli@debian:~$\n</code></pre> <pre><code>wangli@debian:~$ echo \"worrrld\" | sed -E 's/(r{3})/-\\1-/'\nwo-rrr-ld\nwangli@debian:~$\n</code></pre> <p>\u5728<code>BRE</code> \u4e2d\uff0c\u9700\u8981\u5c06<code>{}</code> \u548c<code>()</code> \u8fdb\u884c\u8f6c\u4e49\u540e\uff0c\u624d\u80fd\u4f7f\u7528\uff0c\u5199\u51fa\u6765\uff0c\u53ef\u8bfb\u6027\u5927\u5927\u964d\u4f4e\uff0c\u5728<code>ERE</code>\u4e2d\uff0c\u76f4\u63a5\u8c03\u7528\u5373\u53ef\uff0c\u53ef\u8bfb\u6027\u589e\u5f3a\u4e86\u3002</p> <p>\u540c\u6837\u7684\uff0c\u5982\u679c\u53ea\u60f3\u8868\u793a<code>{}</code> \u3001<code>()</code> \u672c\u8eab\u7684\u542b\u4e49\uff0c\u9700\u8981\u7528<code>\\</code> \u8fdb\u884c\u8f6c\u4e49\uff0c\u5982\uff1a</p> <pre><code>wangli@debian:~$ echo \"2{35}\" | grep -E '2{35}'\nwangli@debian:~$\nwangli@debian:~$ echo \"2{35}\" | grep -E '2\\{35\\}'\n2{35}\nwangli@debian:~$\n</code></pre>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_6","title":"\u65b0\u589e\u7684\u5143\u5b57\u7b26","text":"<p>\u5728<code>ERE</code>\u4e2d\uff0c\u65b0\u589e\u4e86<code>?</code> \u548c<code>+</code> 2\u4e2a\u5143\u5b57\u7b26\uff0c\u524d\u8005\u8868\u793a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b260\u6b21\u6216\u80051\u6b21\uff0c\u540e\u8005\u8868\u793a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b261\u6b21\u6216\u591a\u6b21\uff0c\u8fd9\u5176\u5b9e\u4e5f\u662f\u7b80\u5316\u4e86<code>BRE</code>\u7684\u5199\u6cd5\uff0c\u6848\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>wangli@debian:~$ echo \"1123\" | grep -E '111?'\n1123\nwangli@debian:~$\nwangli@debian:~$ echo \"1123\" | grep \"111\\{0,1\\}\"\n1123\nwangli@debian:~$\n</code></pre> <p>\u8fd9\u91cc\u9700\u8981\u4ecb\u7ecd\u4e0b\uff0c\u4e3a\u4ec0\u4e48<code>1123</code> \u53ef\u4ee5\u4f7f\u7528<code>111?</code> \u6765\u83b7\u53d6\u5230\u5462\uff1f\u9996\u5148<code>?</code> \u7684\u542b\u4e49\u662f\u8868\u793a\u5339\u914d\u524d\u9762\u7684\u5b57\u7b260\u6b21\u6216\u80051\u6b21\uff0c\u6240\u4ee5<code>111?</code> \u4f1a\u67092\u4e2d\u60c5\u51b5\uff1a</p> <ul> <li><code>11</code> \uff0c\u518d\u5339\u914d\u4e00\u4e2a<code>1</code> \uff0c\u7ed3\u679c\u662f<code>111</code></li> <li><code>11</code>\uff0c\u4e0d\u5339\u914d\u540e\u9762\u7684<code>1</code> \uff0c\u7ed3\u679c\u662f<code>11</code> </li> </ul> <p>\u6240\u4ee5\u6700\u540e\u4f1a\u88ab\u5339\u914d\u5230\uff0c\u540c\u6837\u7684\uff0c\u4f7f\u7528<code>BRE</code>\u6765\u5199\u7684\u8bdd\uff0c\u8868\u8fbe\u5f0f\u4e3a <code>111\\{0,1\\}</code>\uff0c\u7136\u540e\u529f\u80fd\u5b8c\u5168\u4e00\u6837\uff0c\u4f46\u662f\u975e\u5e38\u4e0d\u76f4\u89c2\u3002</p> <p>\u518d\u6765\u770b\u770b<code>+</code> \u5462\u3002</p> <pre><code>wangli@debian:~$ echo \"1111111123\" | sed -E 's/(1+)/\\1-/'\n11111111-23\nwangli@debian:~$\nwangli@debian:~$ echo \"1111111123\" | sed 's/\\(1\\{1,\\}\\)/\\1-/'\n11111111-23\nwangli@debian:~$\n</code></pre> <p>\u901a\u8fc7\u4e0a\u97622\u4e2a\u8bed\u53e5\uff0c\u53ef\u4ee5\u53d1\u73b0\u867d\u7136<code>s/(1+)/\\1-/</code> \u548c<code>s/\\(1\\{1,\\}\\)/\\1-/</code> \u6548\u679c\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u662f\u7b2c\u4e00\u79cd\u8981\u7b80\u5355\u3001\u76f4\u89c2\u5f88\u591a\uff0c\u53ef\u8bfb\u6027\u8981\u6bd4\u7b2c\u4e8c\u79cd\u597d\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_7","title":"\u4e00\u4e9b\u5173\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u4f8b\u5b50","text":""},{"location":"2024/11/08/Extended-Regular-Expressions.html#_8","title":"\u5254\u9664\u591a\u4f59\u7684\u7a7a\u683c","text":"<p>\u6709\u4ee5\u4e0b\u6587\u672c\uff1a</p> <pre><code>wangli@debian:~$ cat test.txt\n            grep    prints\n\n lines   that    contain   a    match  for one or more            patterns.\nwangli@debian:~$\n</code></pre> <p>\u9700\u8981\u5c06\u591a\u4f59\u7684\u7a7a\u683c\u7ed9\u5254\u9664\u6389\u3002</p> <pre><code>wangli@debian:~$ cat test.txt | sed -E -e 's/ +/ /g' -e 's/^ +//g'\ngrep prints\n\nlines that contain a match for one or more patterns.\nwangli@debian:~$\n</code></pre> <p>\u4f7f\u7528<code>sed -e</code> \u53ef\u4ee5\u6267\u884c\u591a\u6761\u547d\u4ee4\uff0c<code>s/ +/ /g</code> \u8868\u793a\u5c06\u5305\u542b\u4e86\u591a\u4e2a\u8fde\u7eed\u7a7a\u683c\u90fd\u66ff\u6362\u4e3a1\u4e2a\u7a7a\u683c\uff0c<code>s/^ +//g</code> \u8868\u793a\u5c06\u4ee5\u7a7a\u683c\u5f00\u5934\u7684\u8fde\u7eed\u7a7a\u683c\u90fd\u66ff\u6362\u4e3a\u7a7a\uff0c\u5373\u5220\u9664\u4ee5\u7a7a\u683c\u5f00\u5934\u7684\u8fde\u7eed\u7a7a\u683c\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_9","title":"\u5220\u9664\u6ce8\u91ca","text":"<p>\u5b9a\u4e49\u6ce8\u91ca\u7684\u542b\u4e49</p> <pre><code># \u8fd9\u4e5f\u662f\u6ce8\u91ca\n# \u8fd9\u4e5f\u662f\u4e00\u79cd\u6ce8\u91ca #\n# \u8fd9\u4e5f\u662f\u4e00\u79cd\u6ce8\u91ca # \u8fd9\u662f\u6b63\u5e38\u7684\u5185\u5bb9\n</code></pre> <p>\u6709\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>wangli@debian:~$ cat test.txt\n# \u8fd9\u4e5f\u662f\u6ce8\u91ca\n# \u8fd9\u4e5f\u662f\u4e00\u79cd\u6ce8\u91ca #\n# \u8fd9\u4e5f\u662f\u4e00\u79cd\u6ce8\u91ca # \u8fd9\u662f\u6b63\u5e38\u7684\u5185\u5bb9\n\na b e d # \u542b\u4e49\u662f a b c d\nc d e f # \u8fd9\u662f\u6ce8\u91ca # g h i j k\n\na # \u6ce8\u91ca # b\n\n# \u8fd9\u4e5f\u662f\u6ce8\u91ca\n# \u8fd9\u8fd8\u662f\u6ce8\u91ca # ccccc\nddd\naa\nwangli@debian:~$\n</code></pre> <p>\u53bb\u9664\u6389\u6ce8\u91ca</p> <pre><code>wangli@debian:~$ cat  test.txt | sed -E -e 's/#.*#//' -e 's/#.*//'\n\n\n \u8fd9\u662f\u6b63\u5e38\u7684\u5185\u5bb9\n\na b e d\nc d e f  g h i j k\n\na  b\n\n\n ccccc\nddd\naa\nwangli@debian:~$\n</code></pre>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_10","title":"\u63d0\u53d6\u5e76\u4e14\u4ea4\u6362\u5b57\u7b26\u4e32\u4e2d\u7684\u4e24\u4e2a\u6570\u5b57","text":"<p>\u6709\u4ee5\u4e0b\u6587\u672c\uff1a</p> <pre><code>wangli@debian:~$ cat test.txt\n\n\n\na 123 b c d e 456 f\nwangli@debian:~$\n</code></pre> <p>\u9700\u8981\u5c06<code>123</code>\u548c<code>456</code>\u987a\u5e8f\u4ea4\u6362\u3002</p> <pre><code>wangli@debian:~$ cat test.txt | sed -E -n 's/(.* )([0-9]{1,5})( .* )([0-9]{1,5})/\\1\\4\\3\\2/p'\na 456 b c d e 123 f\nwangli@debian:~$\n</code></pre> <p>\u4e0a\u9762\u6b63\u5219\u542b\u4e49\u4e3a\uff1a</p> <ul> <li><code>(.* )</code>\uff1a \u8868\u793a\u5339\u914d\u4ee5\u4efb\u4f55\u5b57\u7b26\u5f00\u5934\u4e14\u4efb\u4f55\u957f\u5ea6\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u4ee5\u7a7a\u683c\u7ed3\u675f\uff0c\u5e76\u4e14\u8bbe\u4e3a\u5206\u7ec41\u3002</li> <li><code>([0-9]{1,5})</code>\uff1a \u8868\u793a\u5339\u914d1-5\u4e3a\u6570\u5b57\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e3a\u5206\u7ec42\u3002</li> <li><code>( .* )</code>\uff1a\u8868\u793a\u5339\u914d\u4ee5\u7a7a\u683c\u5f00\u5934\u548c\u7a7a\u683c\u7ed3\u5c3e\u7684\u4efb\u4f55\u5b57\u7b26\uff0c\u5e76\u4e14\u8bbe\u4e3a\u5206\u7ec43\u3002</li> <li><code>([0-9]{1,5})</code>\uff1a\u8868\u793a\u5339\u914d1-5\u4e3a\u6570\u5b57\uff0c\u5e76\u4e14\u8bbe\u7f6e\u4e3a\u5206\u7ec44\u3002</li> </ul> <p>\u6709\u4e86\u5982\u4e0a\u7684\u89c4\u5219\uff0c\u5c31\u53ef\u4ee5\u5c06<code>a 123 b c d e 456 f</code> \u5206\u4e3a4\u7ec4\uff0c\u5206\u522b\u4e3a\uff1a</p> <ul> <li><code>a</code></li> <li><code>123</code></li> <li><code>b c d e</code></li> <li><code>456</code></li> </ul> <p>\u6b64\u65f6\uff0c\u5728\u5f15\u7528\u5206\u7ec4\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u5c06<code>4</code> \u548c<code>2</code>\u8fdb\u884c\u5bf9\u8c03\uff0c\u5219\u53ef\u4ee5\u6ee1\u8db3<code>123</code> \u548c<code>456</code>\u4ea4\u6362\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#ip","title":"\u83b7\u53d6\u673a\u5668\u7684IP\u5730\u5740","text":"<pre><code>wangli@debian:~$ ip a | sed -E -n 's/.* ([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})\\/[0-9]{1,3}.*/\\1/p'\n127.0.0.1\n192.168.1.135\nwangli@debian:~$\n</code></pre> <p>\u4f7f\u7528<code>ip a</code> \u53ef\u4ee5\u67e5\u8be2\u6240\u6709\u7684IP\u4fe1\u606f</p> <pre><code>wangli@debian:~$ ip a\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet 127.0.0.1/8 scope host lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope host noprefixroute\n       valid_lft forever preferred_lft forever\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000\n    link/ether 08:00:27:7c:92:af brd ff:ff:ff:ff:ff:ff\n    inet 192.168.1.135/24 brd 192.168.1.255 scope global dynamic noprefixroute enp0s3\n       valid_lft 4631sec preferred_lft 4631sec\n    inet6 fe80::a00:27ff:fe7c:92af/64 scope link noprefixroute\n       valid_lft forever preferred_lft forever\nwangli@debian:~$\n</code></pre> <p>\u4f7f\u7528\u7684\u6b63\u5219\u5982\u4e0b\uff1a</p> <pre><code>sed -E -n 's/.* ([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})\\/[0-9]{1,3}.*/\\1/p'\n</code></pre> <p>\u4f7f\u7528<code>sed -E</code> \u8868\u793a\u542f\u7528\u6b63\u5219\uff0c\u800c<code>sed -n</code> \u8868\u793a\u53ea\u8f93\u51fa\u5339\u914d\u7684\u90e8\u5206\u3002</p> <p>\u800c\u6b63\u5219\u8868\u8fbe\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>.* ([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})\\/[0-9]{1,3}.*\n</code></pre> <p>\u610f\u601d\u4e3a\u63d0\u53d6\u5305\u542b\u6240\u6709<code>IP</code>\u5730\u5740\u548c\u5b50\u7f51\u63a9\u7801\u7684\u5185\u5bb9\uff0c\u5e76\u4e14\u53ea\u63d0\u53d6<code>IP</code>\u90e8\u5206\uff0c\u5ffd\u7565\u5b50\u7f51\u63a9\u7801\uff0c\u5176\u4e2d<code>IP</code> \u90e8\u5206\u53c8\u89c4\u5b9a\u4e86\u83b7\u53d6\u7684\u662f<code>IPv4</code>\u683c\u5f0f\u3002</p> <p>\u6240\u4ee5\uff0c\u8be5\u6b63\u5219\u8868\u8fbe\u5f0f\u542b\u4e49\u4e3a\uff1a</p> <ul> <li><code>.*</code> \uff1a\u5339\u914d\u4efb\u4f55\u957f\u5ea6\u7684\u5b57\u7b26\uff0c\u5e76\u4e14\u4ee5\u7a7a\u683c<code></code>\u7ed3\u675f\u3002</li> <li><code>([0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3})</code>\uff1a \u5339\u914d<code>IPv4</code>\u5730\u5740\uff0c\u5e76\u4e14\u4f7f\u7528\u5206\u7ec4\u6355\u83b7\u3002</li> <li><code>\\/[0-9]{1,3}.*</code> \uff1a\u5339\u914d\u659c\u6760<code>/</code>\u548c\u5b50\u7f51\u63a9\u7801\u90e8\u5206\u3002</li> <li><code>.*</code>\uff1a\u6700\u540e\u7684\u5339\u914d\u540e\u9762\u7684\u6240\u6709\u5b57\u7b26\u3002</li> </ul>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#url","title":"\u63d0\u53d6URL\u4e2d\u7684\u534f\u8bae\u3001\u57df\u540d\u548c\u8def\u5f84","text":"<pre><code>wangli@debian:~$ echo 'https://1.3.3.4/hello/world.txt' | sed -E -n \"s|(.*)://([^/]+)/(.*)|s1:\\1 s2:\\2 s3:\\3|p\"\ns1:https s2:1.3.3.4 s3:hello/world.txt\nwangli@debian:~$\n</code></pre> <p>\u5176\u4e2d\u6b63\u5219\u8868\u8fbe\u5f0f\u4e3a\uff1a</p> <pre><code>sed -E -n \"s|(.*)://([^/]+)/(.*)|s1:\\1 s2:\\2 s3:\\3|p\"\n</code></pre> <p>\u5176\u4e2d<code>[^/]+</code> \u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <p><code>[]</code> \u8868\u793a\u4e00\u4e2a\u5b57\u7b26\u96c6\uff0c<code>[^/]</code> \u5219\u8868\u793a\u9664\u4e86<code>/</code> \u4ee5\u5916\u7684\u6240\u6709\u5b57\u7b26\uff0c\u540e\u9762\u7684<code>+</code> \u8868\u793a\u4e0a\u4e00\u4e2a\u5b57\u7b26\u81f3\u5c11\u51fa\u73b01\u6b21\uff0c\u8fd9\u91cc\u5982\u679c\u4f7f\u7528<code>(.*)/</code>\u7684\u8bdd\uff0c\u4f1a\u51fa\u73b0\u8d2a\u5a6a\u5339\u914d\u3002</p>"},{"location":"2024/11/08/Extended-Regular-Expressions.html#_11","title":"\u603b\u7ed3","text":"<p>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f\u76f8\u5bf9\u57fa\u7840\u6b63\u5219\u8868\u8fbe\u5f0f\u800c\u8a00\uff0c\u7b80\u5316\u4e86\u5199\u6cd5\uff0c\u5982<code>{}</code>\u3001<code>()</code> \u4e0d\u9700\u8981\u5728\u989d\u5916\u8f6c\u4e49\u4e86\uff0c\u8fd8\u65b0\u589e\u4e86<code>+</code> \u548c<code>?</code> \u5143\u5b57\u7b26\u3002</p> <p>\u6709\u5173\u6b63\u5219\u8868\u8fbe\u5f0f\u5386\u53f2\u53ef\u4ee5\u770b\u4e0b\uff1a\u6b63\u5219\u8868\u8fbe\u5f0f - \u7ef4\u57fa\u767e\u79d1\uff0c\u81ea\u7531\u7684\u767e\u79d1\u5168\u4e66 (wikipedia.org)\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html","title":"\u53e4\u8001\u7684\u884c\u7f16\u8f91\u5668\uff1aed","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd\u884c\u7f16\u8f91\u5668<code>ed</code>\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_1","title":"\u4ec0\u4e48\u662fed","text":"<p><code>ed</code> \u662f<code>Unix</code>\u7cfb\u7edf\u6700\u65e9\u7684\u884c\u7f16\u8f91\u5668\u4e4b\u4e00\uff0c\u662f\u4e00\u4e2a\u9762\u5411\u884c\u7684\u6587\u672c\u7f16\u8f91\u5668\uff0c\u7528\u4e8e\u5bf9\u6587\u4ef6\u8fdb\u884c\u589e\u558a\u6539\u67e5\u64cd\u4f5c\u3002\u540e\u7eed\u719f\u77e5\u7684<code>vi</code> \u3001<code>awk</code> \u3001<code>sed</code> \u7b49\u90fd\u501f\u9274\u4e86<code>ed</code> \u7f16\u8f91\u5668\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982\uff0c<code>vi</code> \u7684\u5e95\u5c42\u662f\u884c\u7f16\u8f91\u5668<code>ex</code> \uff08<code>ed</code> \u7279\u5f81\u7684\u6269\u5c55\u96c6\uff09\u3002</p> <p>\u597d\u5728<code>Gnu</code>\u9879\u76ee\u5c06\u5176\u79fb\u690d\u5230\u4e86<code>Linux</code> \u4e2d\uff0c\u6211\u4eec\u624d\u5f97\u4ee5\u5728<code>Linux</code> \u4e2d\u4f7f\u7528\u5b83\uff0c\u5730\u5740\u4e3a\uff1a  https://www.gnu.org/software/ed/\u3002</p> <p>\u5f53\u524d\u6587\u6863\u4f7f\u7528\u7684<code>ed</code>\u7248\u672c\u4e3a\uff1a <code>GNU ed 1.20</code> </p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_2","title":"\u5b89\u88c5ed","text":"<p>\u76ee\u524d\u6700\u65b0\u7684\u7248\u672c\u662f<code>1.20</code> \u7248\u672c</p> <p>\u5f53\u524d\u65f6\u95f4\uff1a2024\u5e7410\u670831\u65e5</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_3","title":"\u4e0b\u8f7d<code>ed</code>","text":"<pre><code># wget https://ftp.gnu.org/gnu/ed/ed-1.20.tar.lz\n</code></pre> <p>\u89e3\u538b</p> <pre><code># lzip -d ed-1.20.tar.lz\n# tar xf ed-1.20.tar\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_1","title":"\u7f16\u8bd1\u5b89\u88c5","text":"<pre><code># cd ed-1.20\n# ./configure\n# make\n# make install\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_2","title":"\u67e5\u770b\u7248\u672c","text":"<pre><code># ed --version\n</code></pre> <p>\u82e5\u5b89\u88c5\u5b8c\u6210\uff0c\u4f1a\u8f93\u51fa\u4ee5\u4e0b\u4fe1\u606f</p> <pre><code>GNU ed 1.20\nCopyright (C) 1994 Andrew L. Moore.\nCopyright (C) 2024 Antonio Diaz Diaz.\nLicense GPLv2+: GNU GPL version 2 or later &lt;http://gnu.org/licenses/gpl.html&gt;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_4","title":"ed\u7684\u57fa\u672c\u4f7f\u7528","text":""},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_5","title":"\u542f\u52a8ed\u7f16\u8f91\u5668","text":"<p>\u4f7f\u7528<code>ed filename</code>\uff0c\u8be5\u547d\u4ee4\u4f1a\u5c1d\u8bd5\u6253\u5f00<code>filename</code> \u6587\u4ef6\uff0c\u82e5\u5f53\u8be5\u6587\u4ef6\u4e0d\u5b58\u5728\u65f6\uff0c\u5219\u4f1a\u62a5\u9519<code>filename: No such file or directory</code>\uff0c<code>ed</code>\u5219\u4f1a\u8fdb\u5165\u5230\u7f16\u8f91\u6a21\u5f0f\uff0c\u76f4\u5230\u624b\u52a8\u4fdd\u5b58\uff0c\u8be5\u6587\u4ef6\u624d\u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14\u5199\u5165\u5185\u5bb9\u3002</p> <p>\u6587\u4ef6\u5b58\u5728\uff1a</p> <pre><code># ed filename_1\n12\nq\n#\n</code></pre> <p>\u5f53\u6587\u4ef6\u5b58\u5728\u7684\u65f6\u5019\uff0c\u4f7f\u7528<code>ed</code>\u5373\u53ef\u6253\u5f00\u8be5\u6587\u4ef6\uff0c\u5e76\u4e14\u8f93\u51fa\u5b57\u7b26\u6570\uff0c\u8f93\u5165q\u9000\u51fa\u3002</p> <p>\u6587\u4ef6\u4e0d\u5b58\u5728\uff1a</p> <pre><code># ls -lhta filename_2\nls: cannot access filename_2: No such file or directory\n#\n# ed filename_2\nfilename_2: No such file or directory\na\nhello filename_2\n.\nw\n17\nq\n# cat filename_2\nhello filename_2\n#\n</code></pre> <p>\u5f53\u6587\u4ef6\u4e0d\u5b58\u5728\u7684\u65f6\u5019\uff0c\u4f7f\u7528<code>ed</code> \u5c1d\u8bd5\u6253\u5f00\u8be5\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u62a5\u9519<code>No such file or directory</code> \uff0c\u4f46\u662f\u8fd8\u662f\u4f1a\u8fdb\u5165\u5230\u7f16\u8f91\u6a21\u5f0f\uff0c\u6b64\u65f6\u82e5\u8f93\u5165<code>a</code>\u547d\u4ee4\uff0c\u63a5\u7740\u8f93\u5165\u9700\u8981\u8ffd\u52a0\u7684\u884c<code>hello filename_2</code> \uff0c\u8f93\u5165<code>.</code> \u8fdb\u884c\u7ed3\u675f\u8f93\u5165\uff0c\u547d\u4ee4<code>w</code> \u5219\u8fdb\u884c\u4fdd\u5b58\uff0c\u4fdd\u5b58\u5b8c\u6210\u540e\uff0c\u4f1a\u8f93\u51fa\u5b57\u7b26\u6570\uff0c\u6700\u540e\u8f93\u5165<code>q</code> \u8fdb\u884c\u9000\u51fa<code>ed</code> \u7f16\u8f91\u5668\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_3","title":"\u6570\u636e\u6253\u5370\u548c\u904d\u5386","text":"<p>\u8fdb\u5165<code>ed</code> \u7f16\u8f91\u5668\u6253\u5f00\u6587\u4ef6\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u547d\u4ee4\u6253\u5370\u548c\u5b9a\u4f4d\u884c\u4fe1\u606f\u3002</p> <p>\u6570\u636e\u51c6\u5907</p> <pre><code># echo -e '123\\n456\\n789' &gt;&gt; filename_1\n#\n# cat filename_1\nhello world\n123\n456\n789\n#\n</code></pre> <p>\u4f7f\u7528<code>p</code> \u663e\u793a\u5f53\u524d\u7684\u884c\uff1a</p> <pre><code># ed filename_1\n24\np\n789\n\n</code></pre> <p>\u4f7f\u7528<code>ed</code> \u9ed8\u8ba4\u6253\u5f00\u6587\u4ef6\u540e\uff0c\u4f1a\u8fdb\u5165\u5230\u6700\u540e\u4e00\u884c\u3002\u4f7f\u7528<code>p</code> \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u5f53\u524d\u884c\u3002</p> <p>\u4f7f\u7528<code>,p</code> \u6253\u5370\u6240\u6709\u884c\uff1a</p> <pre><code># ed filename_1\n24\n,p\nhello world\n123\n456\n789\n\n</code></pre> <p>\u4f7f\u7528<code>ed</code> \u9ed8\u8ba4\u6253\u5f00\u6587\u4ef6\u540e\uff0c\u4f7f\u7528<code>,p</code> \u4f1a\u6253\u5370\u6240\u6709\u884c\u3002</p> <p>\u82e5\u60f3\u6253\u5370\u56fa\u5b9a\u7684\u884c\u7684\u8bdd\uff0c\u53ef\u4ee5\u4f7f\u7528<code>{startN},{endN}p</code> \u547d\u4ee4\uff0c\u8fd9\u624d\u662f<code>,p</code> \u7684\u5b8c\u6574\u5199\u6cd5\uff0c\u5982\uff0c\u6253\u53702\u52304\u884c\uff0c\u5219\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code># ed filename_1\n24\n2,4p\n123\n456\n789\n\n</code></pre> <p>\u4f7f\u7528<code>=</code> \u6253\u5370\u5f53\u524d\u6587\u4ef6\u7684\u884c\u53f7</p> <pre><code># ed filename_1\n24\n=\n4\n\n</code></pre> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u80fd\u4f7f\u7528<code>n</code> \u6765\u6253\u5370\u6240\u5728\u884c\u7684\u884c\u53f7\u548c\u5185\u5bb9</p> <pre><code># ed filename_1\n24\nn\n4       789\n\n</code></pre> <p>\u82e5\u60f3\u8f93\u51fa\u56fa\u5b9a\u884c\uff0c\u548c<code>p</code> \u547d\u4ee4\u7c7b\u4f3c\uff0c\u5982\uff0c\u6253\u53702\u52304\u884c\u7684\u5185\u5bb9\uff0c\u5305\u62ec\u884c\u53f7\uff0c\u5219\u547d\u4ee4\u5982\u4e0b\uff1a</p> <pre><code># ed filename_1\n24\n2,4n\n2       123\n3       456\n4       789\n\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_4","title":"\u884c\u5b9a\u4f4d","text":"<p><code>ed</code> \u6253\u5f00\u6587\u4ef6\u540e\uff0c\u9ed8\u8ba4\u4f1a\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u884c\uff0c\u5982\u4e0b\u547d\u4ee4\uff0c\u53ef\u4ee5\u5feb\u901f\u8fdb\u884c\u884c\u5b9a\u4f4d\u3002</p> <p>\u51c6\u5907\u6570\u636e\uff1a</p> <pre><code># echo -e \"a\\nb\\nc\\nd\\ne\\nf\"  &gt; filename_1\n</code></pre> <p>\u5728<code>ed</code> \u4e2d\uff0c\u8f93\u5165<code>1</code> \u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b2c\u4e00\u884c\uff0c<code>$</code> \u5219\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u884c\u3002</p> <pre><code># ed filename_1\n12\n1\na\n$\nf\n\n</code></pre> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c\u8fd8\u80fd\u57fa\u4e8e\u5f53\u524d\u884c\u8fdb\u884c\u5feb\u901f\u5b9a\u4f4d\uff0c\u6bd4\u5982\u5b9a\u4f4d\u5230\u5f53\u524d\u884c\u7684\u540e2\u884c\u3002</p> <pre><code># ed filename_1\n12\n1\na\n+2\nc\n\n</code></pre> <p>\u5b9a\u4f4d\u5230\u5f53\u524d\u884c\u7684\u524d2\u884c\u3002</p> <pre><code># ed filename_1\n12\n$\nf\n-2\nd\n\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_5","title":"\u8ffd\u52a0\u6587\u672c","text":"<p>\u5728<code>ed</code> \u4e2d\uff0c\u67092\u4e2a\u547d\u4ee4\uff0c\u5206\u522b\u662f<code>a</code> \u548c<code>i</code> \uff0c\u5176\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li><code>a</code>\uff1a\u5728\u5f53\u524d\u884c\u540e\u8ffd\u52a0\u884c</li> <li><code>i</code> \uff1a\u5728\u5f53\u524d\u884c\u524d\u63d2\u5165\u884c</li> </ul> <p>\u4f7f\u7528<code>a</code> \u8fdb\u884c\u8ffd\u52a0\u884c</p> <pre><code># ed filename_1\n24\na\na append to data\n.\nw\n41\nq\n#\n</code></pre> <p>\u5728<code>ed</code> \u4e2d\uff0c\u4f7f\u7528<code>a</code> \u547d\u4ee4\u540e\u4f1a\u8fdb\u5165\u5230\u63d2\u5165\u6a21\u5f0f\uff0c\u53ef\u4ee5\u8f93\u5165\u591a\u884c\u7684\u5185\u5bb9\uff0c\u8f93\u5165\u5b8c\u6210\u540e\uff0c\u8f93\u5165<code>.</code> \u8fdb\u884c\u7ed3\u675f\u8f93\u5165\uff0c<code>w</code> \u4f1a\u4fdd\u5b58\u5185\u5bb9\u5230\u78c1\u76d8\uff0c<code>q</code>\u5219\u9000\u51fa<code>ed</code> \u7f16\u8f91\u5668\u3002</p> <p>\u67e5\u770b\u6587\u4ef6\u5185\u5bb9</p> <pre><code># cat filename_1\nhello world\n123\n456\n789\na append to data\n#\n</code></pre> <p>\u4f7f\u7528<code>i</code> \u63d2\u5165\u884c</p> <pre><code># ed filename_1\n41\n1\nhello world\nn\n1       hello world\ni\nhello insert data\nooooooo\n.\nw\n67\nq\n#\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u4e2d\uff0c\u5728<code>ed</code> \u6253\u5f00<code>filename_1</code> \u540e\uff0c\u4f7f\u7528<code>1</code> \u5148\u5207\u5230\u5230\u7b2c1\u884c\uff0c\u5e76\u4e14\u4f7f\u7528<code>n</code> \u8f93\u51fa\u5f53\u524d\u884c\u7684\u884c\u53f7\u548c\u5185\u5bb9\uff0c\u968f\u540e\u8f93\u5165<code>i</code> \u6307\u4ee4\uff0c\u63d2\u5165\u4e862\u884c\u5185\u5bb9\uff0c\u8f93\u5165<code>.</code>\u8fdb\u884c\u7ed3\u675f\u8f93\u5165\uff0c\u968f\u540e\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u9000\u51fa\u3002</p> <p>\u67e5\u770b\u6587\u4ef6</p> <pre><code># cat filename_1\nhello insert data\nooooooo\nhello world\n123\n456\n789\na append to data\n#\n</code></pre> <p>\u9700\u8981\u63d2\u5165\u7684\u5185\u5bb9\uff0c\u5df2\u7ecf\u88ab\u63d2\u5165\u5230\u6700\u524d\u9762\u4e86\u3002</p> <p>\u5982\u679c\u5728\u8ffd\u52a0\u5185\u5bb9\u4e2d\uff0c\u6070\u597d\u9700\u8981\u5728\u5355\u884c\u8f93\u5165<code>.</code> \uff0c\u8be5<code>.</code> \u5c06\u4f5c\u4e3a\u5b57\u7b26\uff0c\u800c\u975e\u7ed3\u675f\u6807\u5fd7\u7b26\uff0c\u5e94\u8be5\u5728\u8be5<code>.</code> \u540e\u518d\u8ffd\u52a0\u4e00\u4e2a\u7a7a\u683c\uff0c\u4f8b\u5982<code>.</code> \uff0c\u5b9e\u9645\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <pre><code># &gt; filename_1\n#\n# ed filename_1\n0\ni\ninsert into data\n. \n123456\n.\nw\n27\nq\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u5728<code>insert...</code> \u548c<code>123456</code> \u4e4b\u95f4\u7684<code>.</code> \uff0c\u662f<code>.</code>  + \u7a7a\u683c\uff0c\u5426\u5219\u4f1a\u88ab\u5f53\u6210\u662f\u7ed3\u675f\u7b26\u3002</p> <p>\u4f7f\u7528<code>cat -A</code> \u6765\u67e5\u8be2\u4e00\u4e0b\uff1a</p> <pre><code># cat -A filename_1\ninsert into data$\n. $\n123456$\n#\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_6","title":"\u5220\u9664\u884c","text":"<p>\u5728<code>ed</code> \u4e2d\uff0c\u4f7f\u7528<code>d</code> \u53ef\u4ee5\u8fdb\u884c\u5220\u9664\u884c\u64cd\u4f5c\uff0c\u9996\u5148\u8fdb\u884c\u6570\u636e\u51c6\u5907\uff1a</p> <pre><code># echo -e \"a\\nb\\nc\\nd\\ne\\nf\"  &gt; filename_1\n# cat filename_1\na\nb\nc\nd\ne\nf\n#\n</code></pre> <p>\u4f7f\u7528<code>d</code> \u53ef\u4ee5\u5220\u9664\u5f53\u524d\u884c\uff1a</p> <pre><code># ed filename_1\n12\nd\n,p\na\nb\nc\nd\ne\n\n</code></pre> <p>\u8fdb\u5165<code>ed</code> \u540e\uff0c\u9ed8\u8ba4\u4f1a\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u884c\uff0c\u4f7f\u7528<code>d</code> \u6307\u4ee4\uff0c\u5c06\u5220\u9664\u6700\u540e\u4e00\u884c\uff0c\u5373<code>f</code> \u88ab\u5220\u9664\u4e86\u3002</p> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c\u8fd8\u80fd\u6307\u5b9a\u884c\u8fdb\u884c\u5220\u9664\uff0c\u6bd4\u59822\u52304\u884c\u8fdb\u884c\u5220\u9664\uff1a</p> <pre><code># ed filename_1\n10\n2,4d\n,p\na\ne\n\n</code></pre> <p>\u8fdb\u5165<code>ed</code> \u540e\uff0c\u4f7f\u7528<code>2,4d</code> \u6307\u4ee4\uff0c\u5c06\u5220\u96642\u52304\u884c\uff0c\u5373<code>b</code> \u3001<code>c</code> \u88ab\u5220\u9664\u4e86\u3002</p> <p>\u5982\u679c\u60f3\u5220\u9664\u5168\u90e8\u884c\uff0c\u5219\u76f4\u63a5\u6267\u884c<code>,d</code> \u5373\u53ef\u5220\u9664\u6240\u6709\u884c\uff1a</p> <pre><code># ed filename_1\n4\n,d\n\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_7","title":"\u6587\u4ef6\u7684\u9000\u51fa","text":"<p>\u4f7f\u7528<code>q</code> \u6307\u4ee4\u4f1a\u5c1d\u8bd5\u9000\u51fa<code>ed</code> \u7f16\u8f91\u5668\uff0c\u5f53\u5185\u5b58\u6570\u636e\u6ca1\u6709\u5199\u5165\u5230\u78c1\u76d8\u7684\u65f6\u5019\uff0c\u4f1a\u62a5\u9519<code>?</code> \u3002</p> <pre><code># ed filename_1\n0\na\n123\n.\nq\n?\n\n</code></pre> <p>\u6b64\u65f6\u82e5\u60f3\u9000\u51fa<code>ed</code> \u7f16\u8f91\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528<code>Q</code> \u6307\u4ee4\u8fdb\u884c\u5f3a\u5236\u9000\u51fa\uff0c\u5185\u5b58\u7684\u6570\u636e\u5c06\u4f1a\u4e22\u5f03\uff0c\u4e0d\u4f1a\u5199\u5165\u5230\u78c1\u76d8\u4e2d\u3002</p> <pre><code># cat filename_1\n# ed filename_1\n0\na\n123\n.\nq\n?\nQ\n# cat filename_1\n#\n</code></pre> <p>\u82e5\u60f3\u4fdd\u5b58\u540e\u9000\u51fa<code>ed</code> \u7f16\u8f91\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528<code>w</code> \u5148\u8fdb\u884c\u5199\u5165\u5230\u78c1\u76d8\uff0c\u800c\u540e\u4f7f\u7528<code>q</code> \u8fdb\u884c\u9000\u51fa\u3002</p> <pre><code># ed filename_1\n0\na\n123\n.\nw\n4\nq\n# cat filename_1\n123\n#\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_6","title":"ed\u7684\u9ad8\u7ea7\u64cd\u4f5c","text":""},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_8","title":"\u6570\u636e\u51c6\u5907","text":"<p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u9700\u8981\u51c6\u5907\u4e00\u4efd\u6570\u636e</p> <pre><code># cat &gt;&gt; test.txt &lt;&lt; EOF\nname    age     sex\nAlice   28      F\nBob     32      M\nCharlie 25      M\nDaisy   29      F\nEthan   30      M\nFiona   27      M\nGeorge  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\nEOF\n#\n</code></pre> <p>\u67e5\u770b\u6570\u636e</p> <pre><code># cat test.txt\nname    age     sex\nAlice   28      F\nBob     32      M\nCharlie 25      M\nDaisy   29      F\nEthan   30      M\nFiona   27      M\nGeorge  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\n#\n</code></pre> <p>\u67e5\u770b\u6570\u636e\u57fa\u672c\u4fe1\u606f</p> <pre><code># wc test.txt\n 11  33 200 test.txt\n#\n</code></pre> <p>\u5176\u4e2d<code>test.txt</code> \u7684\u4fe1\u606f\u4e3a\uff1a</p> <ul> <li>11\u884c</li> <li>33\u4e2a\u5355\u8bcd</li> <li>200\u4e2a\u5b57\u7b26</li> </ul>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_7","title":"ed\u67e5\u8be2\u884c\u6570\u636e","text":"<p>\u51c6\u5907\u5de5\u4f5c</p> <p>\u4f7f\u7528<code>ed</code> \u8ddf\u4e0a\u6587\u4ef6\u540d\uff0c\u5373\u53ef\u6253\u5f00\u6587\u4ef6\u3002</p> <p>\u8be5\u64cd\u4f5c\u662f\u5c06\u6587\u4ef6\u7684\u5185\u5bb9\u653e\u5230\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff0c\u5f53\u7f16\u8f91\u5b8c\u6210\u540e\uff0c\u9700\u8981\u624b\u52a8\u4fdd\u5b58\uff0c\u6b64\u65f6\u624d\u4f1a\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u4e2d\u3002</p> <pre><code># ed test.txt\n200\n\n</code></pre> <p>\u9ed8\u8ba4\u4f7f\u7528<code>ed</code> \u6253\u5f00\u6587\u4ef6\u540e\uff0c\u4f1a\u8f93\u51fa\u6587\u4ef6\u5b57\u7b26\u6570\uff0c\u5e76\u4e14\u5c06\u4f4d\u7f6e\u5b9a\u4f4d\u5230\u6700\u540e\u4e00\u884c\u3002</p> <p>\u7b80\u5355\u67e5\u8be2</p> <p>\u6b64\u65f6\u4f7f\u7528<code>p</code> \u4f1a\u6253\u5370\u5f53\u524d\u884c\u7684\u5185\u5bb9\uff0c\u5373\u6700\u540e\u4e00\u884c\u3002</p> <pre><code># ed test.txt\n200\np\nJulia   24      F\n\n</code></pre> <p>\u82e5\u60f3\u67e5\u8be2\u6240\u6709\u7684\u5185\u5bb9\uff0c\u53ef<code>,p</code> \u5373\u53ef\u3002</p> <pre><code>,p\nname    age     sex\nAlice   28      F\nBob     32      M\nCharlie 25      M\nDaisy   29      F\nEthan   30      M\nFiona   27      M\nGeorge  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\n\n</code></pre> <p>\u590d\u6742\u641c\u7d22</p> <p>\u82e5\u60f3\u67e5\u8be2\u7b26\u5408\u89c4\u8303\u7684\u884c\uff0c\u6bd4\u5982<code>sex</code> \u662f<code>M</code> \u7684\u884c\u3002</p> <pre><code>g/M/p\nBob     32      M\nCharlie 25      M\nEthan   30      M\nFiona   27      M\nGeorge  31      M\nIsaac   33      M\n\n\n</code></pre> <p>\u5176\u4e2d<code>g</code> \u8868\u793a\u5168\u5c40\u3001<code>M</code> \u8868\u793a\u641c\u7d22\u5173\u952e\u5b57\u4e3a<code>M</code>\uff0c<code>p</code> \u662f\u6253\u5370\u5339\u914d\u884c\uff0c\u6bcf\u4e2a\u6307\u4ee4\u7531<code>/</code> \u5206\u5272\u5f00\u6765\uff0c\u82e5\u4e0d\u5305\u542b<code>g</code> \u5219\u9ed8\u8ba4\u53ea\u5339\u914d\u4e00\u884c\u3002</p> <pre><code>/M/p\nBob     32      M\n\n\n</code></pre> <p>\u82e5\u60f3\u66f4\u4e3a\u7cbe\u786e\u7684\u5339\u914d\uff0c\u5982 1-8\u884c\u4e2d\u51fa\u73b0<code>M</code>\u7684\u884c\u4fe1\u606f\u3002</p> <pre><code>1,8g/M/p\nBob     32      M\nCharlie 25      M\nEthan   30      M\nFiona   27      M\nGeorge  31      M\n\n\n</code></pre> <p>\u5229\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u641c\u7d22</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c<code>ed</code> \u8fd8\u652f\u6301\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982\u67e5\u8be2<code>name</code> \u4ee5<code>e</code> \u7ed3\u5c3e\u7684\u884c\u4fe1\u606f\u3002</p> <pre><code>g/.*e\\s/p\nname    age     sex\nAlice   28      F\nCharlie 25      M\nGeorge  31      M\n\n\n</code></pre> <p>\u5176\u6b63\u5219\u8868\u8fbe\u5f0f<code>.*e\\s</code> \u7684\u610f\u601d\u662f\u5339\u914d\u4ee5<code>e</code> \u7d27\u63a5\u7740\u7a7a\u683c\u7684\u884c\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_8","title":"ed \u7f16\u8f91\u884c\u6570\u636e","text":"<p>\u6570\u636e\u51c6\u5907</p> <p>\u8981\u7f16\u8f91\u884c\u5185\u5bb9\uff0c\u9996\u5148\u8981\u5148\u5c06\u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff0c\u5373\u4f7f\u7528<code>ed</code> \u6253\u5f00\u6587\u4ef6\u3002</p> <pre><code># ed test.txt\n200\n\n\n</code></pre> <p>\u8fdb\u884c\u7b80\u5355\u7684\u66ff\u6362</p> <p>\u73b0\u5728\u5c06\u7b2c\u4e00\u884c\u7684<code>a</code> \u66ff\u6362\u4e3a<code>A</code> </p> <pre><code>1\nname    age     sex\ns/a/A/\n1\nnAme    age     sex\n\n\n</code></pre> <p>\u9996\u5148\uff0c\u9700\u8981\u5207\u6362\u5230\u7b2c\u4e00\u884c\uff0c\u7136\u540e\u4f7f\u7528 <code>s/a/A/</code> \u5c06\u5c0f\u5199\u7684 <code>a</code> \u66ff\u6362\u4e3a\u5927\u5199\u7684 <code>A</code>\u3002\u4e0d\u8fc7\uff0c\u67e5\u770b\u540e\u53d1\u73b0\u8be5\u547d\u4ee4\u53ea\u4fee\u6539\u4e86\u7b2c\u4e00\u4e2a\u51fa\u73b0\u7684 <code>a</code>\uff0c\u800c\u540e\u7eed\u7684 <code>a</code> \u5e76\u672a\u66ff\u6362\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>ed</code> \u53ea\u4f1a\u4fee\u6539\u9996\u6b21\u5339\u914d\u5230\u7684\u5185\u5bb9\u3002\u82e5\u60f3\u66ff\u6362\u6574\u884c\u4e2d\u7684\u6240\u6709\u5339\u914d\u9879\uff0c\u9700\u8981\u5728\u547d\u4ee4\u540e\u6dfb\u52a0\u53c2\u6570 <code>g</code>\uff0c\u8868\u793a\u5168\u5c40\u66ff\u6362\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c06\u7b2c\u4e00\u884c\u4e2d\u7684 <code>e</code> \u66ff\u6362\u4e3a <code>E</code>\uff0c\u5e76\u5bf9\u6240\u6709\u5339\u914d\u9879\u8fdb\u884c\u66ff\u6362\u3002</p> <pre><code>1\nnAme    age     sex\ns/e/E/g\n1\nnAmE    agE     sEx\n\n\n</code></pre> <p>\u4ece\u4e0a\u9762\u7684\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff0c\u66ff\u6362\u5df2\u6210\u529f\u5b8c\u6210\u3002</p> <p>\u8fdb\u884c\u5168\u5c40\u66ff\u6362</p> <p>\u5982\u679c\u60f3\u8981\u5c06\u6587\u672c\u4e2d\u6240\u6709\u7684 <code>e</code> \u66ff\u6362\u4e3a <code>E</code>\uff0c\u5219\u9700\u8981\u4f7f\u7528\u4ee5\u4e0b\u53c2\u6570\u3002</p> <pre><code>g/.*/s/e/E/g\n,p\nnAmE    agE     sEx\nAlicE   28      F\nBob     32      M\nCharliE 25      M\nDaisy   29      F\nEthan   30      M\nFiona   27      M\nGEorgE  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\n\n\n</code></pre> <p><code>g/.*/s/e/E/g</code> \u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a <code>g</code>\uff1a\u8868\u793a\u5168\u5c40\u64cd\u4f5c\u3002</li> <li><code>.*</code>\uff1a\u8868\u793a\u5339\u914d\u6240\u6709\u884c\u3002</li> <li><code>s/e/E/</code>\uff1a\u8868\u793a\u5c06 <code>e</code> \u66ff\u6362\u4e3a <code>E</code>\u3002</li> <li>\u6700\u540e\u4e00\u4e2a <code>g</code>\uff1a\u8868\u793a\u5168\u5c40\u66ff\u6362\u3002</li> </ul> <p>\u8fdb\u884c\u7279\u5b9a\u884c\u533a\u95f4\u6570\u636e\u66ff\u6362</p> <p>\u82e5\u53ea\u60f3\u4fee\u6539\u7279\u5b9a\u884c\u533a\u95f4\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u66f4\u6539 <code>.*</code> \u7684\u53c2\u6570\u503c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>,p\nnAmE    agE     sEx\nAlicE   28      F\nBob     32      M\nCharliE 25      M\nDaisy   29      F\nEthan   30      M\nFiona   27      M\nGEorgE  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\n2,$s/E/e/g\n,p\nnAmE    agE     sEx\nAlice   28      F\nBob     32      M\nCharlie 25      M\nDaisy   29      F\nethan   30      M\nFiona   27      M\nGeorge  31      M\nHannah  26      F\nIsaac   33      M\nJulia   24      F\n\n\n</code></pre> <p><code>2,$s/E/e/g</code> \u7684\u542b\u4e49\u662f\uff1a\u5728\u7b2c\u4e8c\u884c\u5230\u6700\u540e\u4e00\u884c\u7684\u8303\u56f4\u5185\u5339\u914d\u5305\u542b <code>E</code> \u7684\u5185\u5bb9\uff0c\u5e76\u5c06\u5176\u66ff\u6362\u4e3a <code>e</code>\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed-shell","title":"\u5728<code>ed</code> \u4e2d\u6267\u884c<code>shell</code> \u547d\u4ee4","text":"<p>\u5728<code>ed</code> \u4e2d\u53ef\u4ee5\u6267\u884c\u7b80\u5355\u7684\u547d\u4ee4\uff0c\u6bd4\u5982\uff1a \u83b7\u53d6\u4e00\u4e0b\u5f53\u524d\u7684\u670d\u52a1\u5668\u65f6\u95f4\u3002</p> <pre><code># ed\n! date\nMon Nov  4 14:25:23 CST 2024\n!\n\n</code></pre> <p>\u6ce8\u610f\uff0c<code>ed</code> \u53ea\u80fd\u8bc6\u522b\u6700\u7b80\u5355\u7684\u547d\u4ee4\uff0c\u5982\u6709\u7279\u6b8a\u5b57\u7b26\uff0c\u6bd4\u5982<code>date +\"%F %T\"</code> \u5219\u4e0d\u884c\uff0c\u56e0\u4e3a<code>%</code> \u662f\u7279\u6b8a\u5b57\u7b26\uff0c\u7528\u4e8e\u5f15\u7528\u6587\u4ef6\u548c\u884c\uff0c<code>%</code> \u6b63\u786e\u7684\u7528\u6cd5\u4e3a\uff1a</p> <pre><code># ed filename_1\n12\n! ls %\n ls filename_1\nfilename_1\n!\n\n</code></pre> <p>\u800c\u5982\u679c\u76f4\u63a5\u4f7f\u7528<code>date +\"%F %T\"</code>\uff0c\u4f1a\u8fbe\u4e0d\u5230\u9884\u671f\u6548\u679c\uff1a</p> <pre><code># ed filename_1\n12\n! date +\"%F %T\"\n date +\"filename_1F filename_1T\"\nfilename_1F filename_1T\n!\n\n</code></pre> <p>\u597d\u5728\u53ef\u4ee5\u5c06\u8be5\u547d\u4ee4\u5199\u5165\u5916\u90e8\u6587\u4ef6\u4e2d\uff0c\u5728<code>ed</code> \u4e2d\u8fdb\u884c\u8c03\u7528\u5373\u53ef\uff1a</p> <p>\u9996\u5148\uff0c\u9700\u8981\u5148\u51c6\u5907\u597d\u811a\u672c</p> <pre><code># echo 'date +\"%F %T\"' &gt;&gt; getDate.sh\n# sh getDate.sh\n2024-11-04 14:36:34\n#\n</code></pre> <p>\u800c\u540e\u5728<code>ed</code> \u4e2d\u8c03\u7528\u8be5\u811a\u672c\u5373\u53ef</p> <pre><code># ed\n! sh getDate.sh\n2024-11-04 14:37:30\n!\n\n</code></pre> <p>\u4e0d\u4ec5\u5982\u6b64\uff0c<code>ed</code> \u8fd8\u652f\u6301\u5c06\u6267\u884c\u7684\u7ed3\u679c\u63d2\u5165\u5230\u5f53\u524d\u6587\u672c\u4e2d\uff0c\u4f8b\u5982\uff1a</p> <pre><code># ed\nr ! sh getDate.sh\n20\n,p\n2024-11-04 14:40:38\n\n\n</code></pre> <p>\u53ea\u9700\u8981<code>r !</code>\u52a0\u4e0a\u6267\u884c\u7684\u547d\u4ee4\uff0c\u5373\u53ef\u5c06\u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u63d2\u5165\u5230\u5f53\u524d\u6587\u672c\u4e2d\u3002</p>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#ed_9","title":"ed \u811a\u672c\u5316","text":"<p>\u53ef\u4ee5\u5c06<code>ed</code> \u7684\u7f16\u8f91\u547d\u4ee4\u653e\u5728\u72ec\u7acb\u7684\u6587\u4ef6\u4e2d\uff0c\u5e76\u4e14\u5c06\u4ed6\u4eec\u4f5c\u4e3a<code>ed</code>\u884c\u7f16\u8f91\u5668\u7684\u8f93\u5165\uff0c\u8fd9\u6837\u7684\u8bdd<code>ed</code>\u5c31\u5177\u5907\u4e86\u811a\u672c\u5316\u7684\u80fd\u529b\u3002</p> <p>\u4f8b\u5982\uff1a \u5c06\u4e00\u4e9b\u5217\u7684<code>ed</code> \u8bed\u53e5\u653e\u5165\u5230<code>ed.script</code> \u7684\u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u5229\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u5bf9\u6587\u4ef6\u6267\u884c\u8be5<code>ed</code> \u811a\u672c\uff1a</p> <pre><code>ed filename &lt; ed.script\n</code></pre> <p>\u53ef\u4ee5\u6765\u5c1d\u8bd5\u4e00\u4e0b\uff1a</p> <p>\u9996\u5148\uff0c\u6765\u7f16\u5199<code>ed.script</code>(\u53ef\u4ee5\u4efb\u610f\u547d\u540d\u8be5\u6587\u4ef6)</p> <pre><code># cat ed.script\n0,r ! date\n$,a\nthe end.\ned url site: https://www.gnu.org/software/ed\n.\ng/.*/s/a/A/g\ng/.*/s/c/C/g\nw\nq\n#\n</code></pre> <p>\u89e3\u6790\u4e00\u4e0b\u6bcf\u4e2a\u8bed\u53e5\u7684\u542b\u4e49\uff1a</p> <ul> <li><code>0,r ! date</code> \uff1a\u5728\u9996\u884c\u63d2\u5165<code>date</code> \u547d\u4ee4\u6267\u884c\u7684\u7ed3\u679c\u3002</li> <li><code>$,a</code> \uff1a\u5728\u5c3e\u884c\u8ffd\u52a02\u884c\u5b57\u7b26\uff0c\u7b2c\u4e00\u884c\u4e3a\uff1a<code>the end.</code>\uff0c\u7b2c\u4e8c\u884c\u4e3a\uff1a<code>ed url site: https://www.gnu.org/software/ed</code> \uff0c\u7b2c\u4e09\u884c\u7684<code>.</code> \u662f<code>a</code>\u547d\u4ee4\u7684\u7ed3\u675f\u7b26\u3002</li> <li><code>g/.*/s/a/A/g</code>\uff1a\u8fdb\u884c\u5168\u6587\u5168\u5c40\u66ff\u6362\uff0c\u5c06<code>a</code>\u66ff\u6362\u4e3a<code>A</code>\u3002</li> <li><code>g/.*/s/c/C/g</code>\uff1a\u8fdb\u884c\u5168\u6587\u5168\u5c40\u66ff\u6362\uff0c\u5c06<code>c</code>\u66ff\u6362\u4e3a<code>C</code>\u3002</li> <li><code>w</code>\uff1a\u4fdd\u5b58\u3002</li> <li><code>q</code>\uff1a\u9000\u51fa\u3002</li> </ul> <p>\u63a5\u7740\uff0c\u4f7f\u7528<code>ed filename &lt; ed.script</code> \u7684\u5f62\u5f0f\u6765\u6267\u884c\u8be5\u811a\u672c\u3002</p> <p>\u9996\u5148\uff0c\u5148\u67e5\u770b<code>filename_1</code> \u7684\u5185\u5bb9\u3002</p> <pre><code># cat filename_1\na\nb\nc\nd\ne\nf\n#\n</code></pre> <p>\u63a5\u7740\uff0c\u4fbf\u5bf9\u8be5\u6587\u4ef6\u6267\u884c<code>ed.script</code> \u547d\u4ee4\u3002</p> <pre><code># ed filename_1 &lt; ed.script\n12\n29\n95\n#\n</code></pre> <p>\u6700\u540e\u518d\u6b21\u67e5\u770b<code>filename_1</code> \u6587\u4ef6\u3002</p> <pre><code># cat filename_1\nMon Nov  4 15:14:21 CST 2024\nA\nb\nC\nd\ne\nf\nthe end.\ned url site: https://www.gnu.org/softwAre/ed\n#\n</code></pre>"},{"location":"2024/11/04/The-oldest-line-editor-ed.html#_9","title":"\u603b\u7ed3","text":"<p><code>ed</code> \u662f<code>Uinx</code>\u4e0b\u7684\u4e0a\u53e4\u884c\u7f16\u8f91\u5668\uff0c\u5728\u76ee\u524d\u7684\u4e3b\u6d41<code>Linux</code>\u7248\u672c\u4e2d\uff0c\u90fd\u6ca1\u6709\u4e86\u5b83\u7684\u8eab\u5f71\uff0c\u4f46\u662f\u5b83\u5f71\u54cd\u4e86<code>sed</code> \u3001<code>grep</code>\u3001<code>vi</code> \u7b49\u4e00\u4f17\u8f6f\u4ef6\uff0c\u751a\u81f3\u4e8e\u5728\u4e0a\u8ff0\u8f6f\u4ef6\u4f7f\u7528\u4e2d\u90fd\u80fd\u770b\u5230<code>ed</code> \u7684\u8eab\u5f71\u3002</p> <p>\u5982\u679c\u4f60\u6b63\u5728\u5b66\u4e60<code>sed</code>\u3001<code>grep</code>\u3001<code>vi</code> \u7b49\uff0c\u4e0d\u59a8\u82b1\u51e0\u5206\u949f\u4e86\u89e3\u4e00\u4e0b<code>ed</code> \u8fd9\u4e2a\u201c\u8001\u524d\u8f88\u201d\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html","title":"Linux Namespace \u7b80\u5355\u7406\u89e3","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd<code>Linux Namespace</code>\u3002</p> <p>\u4e00\u63d0\u5230\u5bb9\u5668\u6280\u672f\uff0c\u968f\u4e4b\u60f3\u5230\u7684\u4fbf\u662f<code>namespace</code> \u662f\u5bb9\u5668\u5316\u7684\u57fa\u77f3\uff0c\u672c\u7bc7\u6587\u7ae0\u5c06\u5bf9<code>Namespace</code>\u8fdb\u884c\u7b80\u5355\u7684\u4e86\u89e3\u3002</p> <p>\u672c\u6587\u6240\u4f9d\u8d56\u7684\u73af\u5883\u4e3a\uff1a</p> <pre><code>root@debian:~# hostnamectl\n Static hostname: windows11pro\n       Icon name: windowsBooks\n         Chassis: laptop \ud83d\udcbb\nOperating System: Debian GNU/Linux 12 (bookworm)  \n          Kernel: Linux 6.1.0-26-amd64\n    Architecture: x86-64\n Hardware Vendor: ASUSTeK COMPUTER INC.\n  Hardware Model: X441UVK\nFirmware Version: X441UVK.314\nroot@debian:~#\n</code></pre> <p><code>Namepace</code> \u4e5f\u79f0\u4e4b\u4e3a\u547d\u540d\u7a7a\u95f4\uff0c\u6700\u65e9\u51fa\u73b0\u5728\u5185\u6838<code>2.4.19</code> \u4e0a\uff0c\u540e\u671f\u9010\u6b65\u8fed\u4ee3\u7684\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5c06<code>Linux</code> \u7684\u8d44\u6e90\u9694\u79bb\u5f00\u6765\uff0c\u53ef\u4ee5\u8fd9\u6837\u7406\u89e3\uff0c<code>Nmaespace</code> \u5c31\u662f\u4e3a\u4e86\u865a\u62df\u5316\u800c\u5b58\u5728\u7684\u3002</p> <p><code>Namespace</code> \u7c7b\u578b\u4f17\u591a\uff0c\u8fd9\u91cc\u5217\u4e3e\u4e00\u4e2a\u8868\u683c\u8bf4\u660e\u3002</p> \u5185\u6838\u7248\u672c Namespace \u7cfb\u7edf\u8c03\u7528\u53c2\u6570 \u542b\u4e49 2.4.19 Mount Namespace CLONE_NEWNS \u6587\u4ef6\u7cfb\u7edf\u7684\u9694\u79bb 2.6.19 UTS Namespace CLONE_NEWUTS nodename\u548cdamainname\u7684\u9694\u79bb 2.6.19 IPC Namespace CLONE_NEWIPC \u8fdb\u7a0b\u95f4\u901a\u4fe1\u8d44\u6e90\u9694\u79bb 2.6.24 PID Namespace CLONE_NEWPID \u8fdb\u7a0bID\u7684\u9694\u79bb 2.6.29 Network Namespace CLONE_NEWNET \u7f51\u7edc\u7684\u9694\u79bb 3.8 User Namespace CLIONE_NEWUSER \u7528\u6237\u548c\u7ec4\u7684\u9694\u79bb 5.6 Time Namespace CLONE_NEWTIME \u7cfb\u7edf\u65f6\u949f\u7684\u9694\u79bb"},{"location":"2024/11/05/Linux-Namespace.html#_1","title":"\u524d\u7f6e\u51c6\u5907","text":"<p>\u9646\u6e38\u66fe\u8bf4\uff0c\u201d\u7eb8\u4e0a\u5f97\u6765\u7ec8\u89c9\u6d45\uff0c\u7edd\u77e5\u6b64\u4e8b\u8981\u8eac\u884c\u3002\u201c\uff0c\u5b9e\u8df5\u624d\u662f\u68c0\u9a8c\u771f\u7406\u7684\u552f\u4e00\u6807\u51c6\uff0c\u6240\u4ee5\uff0c\u5728\u6b63\u5f0f\u4e86\u89e3<code>Namespace</code> \u4e4b\u524d\uff0c\u5f97\u5148\u4e86\u89e3\u4e0b\u5173\u4e8e<code>Namespace</code> \u76f8\u5173\u7684\u5de5\u5177\uff1a<code>unshare</code>\uff0c\u5982\u679c\u8981\u89e3\u91ca\u8be5\u5de5\u5177\uff0c\u7528<code>unshare - run program in new namespaces</code> \u8868\u8fbe\u518d\u5408\u9002\u4e0d\u8fc7\u4e86\uff0c\u5b83\u53ef\u4ee5\u5728\u65b0\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u8fd0\u884c\u8981\u6307\u5b9a\u7684\u7a0b\u5e8f\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#unshare","title":"unshare\u5de5\u5177\u7684\u4f7f\u7528","text":"<p>\u521b\u5efa<code>Namespace</code> \u4e3b\u8981\u7684\u53c2\u6570\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li><code>-m</code> \u3001<code>--mount</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>Mount namespace</code>\u3002</li> <li><code>-u</code>\u3001<code>--uts</code>\uff1a\u7528\u4ee5\u521b\u5efa <code>Uts Namespace</code> \u3002</li> <li><code>-i</code>\u3001<code>--ipc</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>IPC Namespace</code>\u3002</li> <li><code>-p</code>\u3001<code>--pid</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>Pid Namespace</code>\u3002</li> <li><code>-n</code>\u3001<code>--net</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>Network Namespace</code> \u3002</li> <li><code>-U</code>\u3001<code>--user</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>User Namespace</code> \u3002</li> <li><code>-T</code>\u3001<code>--time</code>\uff1a\u7528\u4ee5\u521b\u5efa<code>Time Namespace</code> \u3002</li> </ul> <p>\u4e3e\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5728<code>Network Namespace</code>\u542f\u52a8\u4e00\u4e2a<code>bash</code> \u8fdb\u7a0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff1a</p> <p>\u5728\u6b64\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u83b7\u53d6\u4e00\u4e0b\u5f53\u524d\u673a\u5668\u7684<code>IP</code>\u4fe1\u606f\uff0c\u5df2\u505a\u53c2\u8003\uff1a</p> <pre><code>root@debian:~# ip link\n1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000\n    link/ether 08:00:27:7c:92:af brd ff:ff:ff:ff:ff:ff\nroot@debian:~#\n</code></pre> <p>\u5728<code>Network Namespace</code> \u4e2d\u6267\u884c\u547d\u4ee4</p> <pre><code>root@debian:~# unshare -n /usr/bin/bash\nroot@debian-linux:~#\nroot@debian-linux:~# ip link\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN mode DEFAULT group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\nroot@debian-linux:~#\n</code></pre> <p>\u4f7f\u7528<code>unshare -n /usr/bin/bash</code>\u4f1a\u521b\u5efa\u4e00\u4e2a<code>Network Namespace</code>\uff0c\u5e76\u4e14\u5728\u8be5<code>Namespace</code> \u4e2d\u6267\u884c<code>bash</code> \u64cd\u4f5c\uff0c\u4f7f\u7528<code>exit</code> \u5373\u53ef\u9000\u51fa\u8be5<code>Namespace</code>\u3002</p> <p>\u8fd9\u662f<code>unshare</code> \u7684\u6700\u7b80\u5355\u7684\u7528\u6cd5\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#_2","title":"\u4fee\u6539\u63d0\u793a\u7b26","text":"<p><code>Linux</code> \u7684\u63d0\u793a\u7b26\u683c\u5f0f\u90fd\u88ab\u8bb0\u5f55\u5230\u4e86<code>PS1</code>\u7684\u5185\u7f6e\u53d8\u91cf\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>echo</code>\u67e5\u770b\u5176\u5185\u5bb9\u3002</p> <pre><code>root@debian:~# echo $PS1\n${debian_chroot:+($debian_chroot)}\\u@\\h:\\w\\$\nroot@debian:~#\n</code></pre> <p>\u4e3a\u4e86\u65b9\u4fbf\u4f7f\u7528<code>unshare</code>\u542f\u52a8\u65b0\u8fdb\u7a0b\u66f4\u52a0\u76f4\u89c2\uff0c\u6240\u4ee5\u9700\u8981\u4fee\u6539\u4e00\u4e0b\u547d\u4ee4\u63d0\u793a\u7b26\uff0c\u9996\u5148\u5728<code>/root/.bashrc</code> \u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u5982\u4e0b\u4ee3\u7801\uff1a</p> <pre><code># \u6253\u5f00\u8c03\u8bd5\nset -x\n\n# \u5b9a\u4e49\u9ed8\u8ba4\u7684PS1\u503c\nexport PS1=\"${debian_chroot:+($debian_chroot)}[\\u@\\h]:[\\w][tty:\\l]\\\\$ \"\n\n# \u8bbe\u7f6e\u522b\u540d\nalias unshare=\"UNSHARE=1 unshare \"\n\n# \u5982\u679c\u53d8\u91cf\u4e2d\u7684UNSHARE\u503c\u4e3a1\uff0c\u5219\u4fee\u6539PS1\u503c\nif [ ! -e ${UNSHARE} ] &amp;&amp; [ ${UNSHARE} -eq 1 ];then\n        export PS1=\"(unshare) ${debian_chroot:+($debian_chroot)}[\\u@\\h]:[\\w][tty:\\l]\\\\$ \"\nfi\n\n# \u5173\u95ed\u8c03\u8bd5\nset +x\n</code></pre> <p>\u589e\u52a0\u4e0a\u8ff0\u4ee3\u7801\u540e\uff0c\u91cd\u65b0\u52a0\u8f7d\u4e00\u4e0b<code>/root/.bashrc</code>\u5c31\u53ef\u4ee5\u4f7f\u7528<code>unshare</code> \u542f\u52a8<code>bash</code>\u8fdb\u7a0b\u4e86\u3002</p> <p>\u9996\u5148\u5148\u91cd\u65b0\u52a0\u8f7d\u4e00\u4e0b<code>/root/.bashrc</code> \u6587\u4ef6</p> <pre><code>root@debian:~# source /root/.bashrc\n++ export 'PS1=[\\u@\\h]:[\\w][tty:\\l]\\$ '\n++ PS1='[\\u@\\h]:[\\w][tty:\\l]\\$ '\n++ alias 'unshare=UNSHARE=1 unshare '\n++ '[' '!' -e ']'\n++ set +x\n[root@debian]:[~][tty:1]#\n</code></pre> <p>\u4f7f\u7528<code>unshare</code> \u542f\u52a8<code>bash</code> \u8fdb\u7a0b</p> <pre><code>\n[root@debian]:[~][tty:1]# unshare -n /usr/bin/bash\n+ export 'PS1=[\\u@\\h]:[\\w][tty:\\l]\\$ '\n+ PS1='[\\u@\\h]:[\\w][tty:\\l]\\$ '\n+ alias 'unshare=UNSHARE=1 unshare '\n+ '[' '!' -e 1 ']'\n+ '[' 1 -eq 1 ']'\n+ export 'PS1=(unshare) [\\u@\\h]:[\\w][tty:\\l]\\$ '\n+ PS1='(unshare) [\\u@\\h]:[\\w][tty:\\l]\\$ '\n+ set +x\n(unshare) [root@debian]:[~][tty:1]#\n</code></pre> <p>\u901a\u8fc7\u4e0a\u9762\u8bbe\u7f6e\uff0c\u5c31\u53ef\u4ee5\u66f4\u52a0\u76f4\u89c2\u7684\u770b\u51fa\u5f53\u524d<code>shell</code> \u662f\u5426\u5728<code>Namespace</code> \u4e2d\uff0c\u540e\u7eed\u4e3a\u4e86\u4fe1\u606f\u66f4\u52a0\u7b80\u6d01\uff0c\u6240\u4ee5\u5c31\u6682\u65f6\u5c06\u8c03\u8bd5\u7ed9\u5173\u95ed\u4e86\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#_3","title":"\u547d\u540d\u7a7a\u95f4\u6587\u4ef6\u63cf\u8ff0\u7b26","text":"<p>\u5728<code>Linux</code> \u4e2d\uff0c\u67e5\u770b2\u4e2a\u8fdb\u7a0b\u662f\u5426\u5c5e\u4e8e\u540c\u4e00\u4e2a\u547d\u540d\u7a7a\u95f4\uff0c\u53ef\u4ee5\u67e5\u770b<code>/proc/\u8fdb\u7a0bID/ns/*</code> \u4e0b\u9762\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5982\u679c\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e00\u81f4\uff0c\u5219\u8bc1\u660e\u662f\u5904\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u7684\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u4e0b2\u4e2a\u8fdb\u7a0b\u7684<code>namespace</code>\u6587\u4ef6\u63cf\u8ff0\u7b26\u5982\u4e0b\uff1a</p> <pre><code>[root@debian]:[~][tty:0]# readlink /proc/983/ns/*\ncgroup:[4026531835]\nipc:[4026531839]\nmnt:[4026531841]\nnet:[4026531840]\npid:[4026531836]\npid:[4026531836]\ntime:[4026531834]\ntime:[4026531834]\nuser:[4026531837]\nuts:[4026531838]\n[root@debian]:[~][tty:0]# readlink /proc/998/ns/*\ncgroup:[4026531835]\nipc:[4026531839]\nmnt:[4026531841]\nnet:[4026531840]\npid:[4026531836]\npid:[4026531836]\ntime:[4026531834]\ntime:[4026531834]\nuser:[4026531837]\nuts:[4026531838]\n[root@debian]:[~][tty:0]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5176\u6bcf\u9879<code>namespace</code> \u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u6240\u4ee5\u8bc1\u660e\u8be52\u4e2a\u8fdb\u7a0b\u5c5e\u4e8e\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u3002</p> <p>\u5982\u679c\u662f\u4f7f\u7528<code>unshare</code> \u521b\u5efa\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u5176<code>namespace</code> \u6587\u4ef6\u63cf\u8ff0\u7b26\u5e94\u8be5\u4e0d\u4e00\u81f4\u3002</p> <pre><code># unshare -m /usr/bin/bash\n(unshare) [root@debian]:[~][tty:0]# echo $$\n1000\n(unshare) [root@debian]:[~][tty:0]#\n(unshare) [root@debian]:[~][tty:0]# readlink /proc/1000/ns/*\ncgroup:[4026531835]\nipc:[4026531839]\nmnt:[4026532316]\nnet:[4026531840]\npid:[4026531836]\npid:[4026531836]\ntime:[4026531834]\ntime:[4026531834]\nuser:[4026531837]\nuts:[4026531838]\n(unshare) [root@debian]:[~][tty:0]#\n</code></pre> <p>\u5728\u8be5<code>mount namespace</code> \u4e2d\uff0c\u5176<code>mount namespace</code> \u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a4026532316\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:0]# exit\nexit\n[root@debian]:[~][tty:0]# echo $$\n983\n[root@debian]:[~][tty:0]# readlink /proc/983/ns/*\ncgroup:[4026531835]\nipc:[4026531839]\nmnt:[4026531841]\nnet:[4026531840]\npid:[4026531836]\npid:[4026531836]\ntime:[4026531834]\ntime:[4026531834]\nuser:[4026531837]\nuts:[4026531838]\n[root@debian]:[~][tty:0]#\n</code></pre> <p>\u5728\u8be5\u5bbf\u4e3b\u673a\u4e2d\uff0c\u5176<code>mount namespace</code> \u6587\u4ef6\u63cf\u8ff0\u7b26\u4e3a4026531841\u3002\u5728\u5bbf\u4e3b\u673a\u7684<code>namespace</code> \uff0c\u4e5f\u79f0\u4e4b\u4e3a\u9ed8\u8ba4<code>namespace</code> \u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c2\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e0d\u4e00\u81f4\uff0c\u8bf4\u660e2\u4e2a\u8fdb\u7a0b\u662f\u5728\u4e0d\u540c\u7684<code>mount namespace</code> \u4e2d\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#nmaespace","title":"\u5404\u4e2aNmaespace\u4ecb\u7ecd","text":""},{"location":"2024/11/05/Linux-Namespace.html#uts-namespace","title":"UTS Namespace","text":"<p><code>UTS Namespace</code> \u662f\u7528\u6765\u9694\u79bb\u4e3b\u673a\u540d\u548c\u57df\u540d\u7684\uff0c\u53ef\u4ee5\u4f7f\u4e0d\u540c\u7684<code>Namespace</code> \u62e5\u6709\u4e0d\u540c\u7684\u4e3b\u673a\u540d\u3002</p> <p>\u4f7f\u7528<code>unshare</code> \u8fdb\u5165<code>bash</code> \u540e\u5c1d\u8bd5\u4fee\u6539\u4e3b\u673a\u540d\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5230\u5bbf\u4e3b\u673a\u7684\uff0c\u4f8b\u5982\u5982\u4e0b\uff1a</p> <pre><code>[root@debian]:[~][tty:1]# unshare -u /usr/bin/bash\n(unshare) [root@debian]:[~][tty:1]#\n(unshare) [root@debian]:[~][tty:1]# echo $$\n13858\n(unshare) [root@debian]:[~][tty:1]#\n(unshare) [root@debian]:[~][tty:1]# hostname new-debian-uts\n(unshare) [root@debian]:[~][tty:1]#\n(unshare) [root@debian]:[~][tty:1]# hostname\nnew-debian-uts\n(unshare) [root@debian]:[~][tty:1]#\n</code></pre> <p>\u4e0a\u8ff0\u547d\u4ee4\u4f7f\u7528<code>unshare</code> \u521b\u5efa\u4e86\u4e00\u4e2a<code>uts namespace</code> \uff0c\u5e76\u4e14\u5c06<code>bash</code> \u653e\u5165\u5176\u4e2d\u6267\u884c\uff0c\u9996\u5148\u6253\u5370\u4e86\u5176\u8fdb\u7a0b\u7684<code>PID</code>\u4e3a<code>13858</code> \u3001\u800c\u540e\u8fdb\u884c\u4e86\u4e3b\u673a\u540d\u8bbe\u7f6e\u3002</p> <p>\u540c\u65f6\u5728\u4e0d\u5173\u95ed\u8be5<code>shell</code> \u7684\u524d\u63d0\u4e0b\uff0c\u6253\u5f00\u53e6\u4e00\u4e2a\u7ec8\u7aef\uff0c\u83b7\u53d6\u4e3b\u673a\u540d\u4fe1\u606f\u3002</p> <pre><code>[root@debian]:[~][tty:5]# hostname\ndebian\n[root@debian]:[~][tty:5]#\n[root@debian]:[~][tty:5]# echo $$\n13863\n[root@debian]:[~][tty:5]#\n[root@debian]:[~][tty:5]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728<code>uts namespace</code>\u547d\u540d\u7a7a\u95f4\u4e2d\u4fee\u6539\u4e3b\u673a\u540d\uff0c\u5e76\u4e0d\u5f71\u54cd\u5bbf\u4e3b\u673a\u73af\u5883\uff0c\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u67e5\u8be2\u4e00\u4e0b2\u4e2a\u8fdb\u7a0b\u7684<code>ns</code>\u503c\uff1a</p> <pre><code># readlink /proc/{13858,13863}/ns/uts\nuts:[4026532256]\nuts:[4026531838]\n[root@debian]:[~][tty:5]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u8ff02\u4e2a\u8fdb\u7a0b\u7684<code>uts namespace</code> \u6587\u4ef6\u63cf\u8ff0\u7b26\u5e76\u4e0d\u4e00\u81f4\uff0c\u6240\u4ee5\u662f2\u4e2a\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u6240\u4ee5\uff0c\u4fee\u6539\u4e3b\u673a\u540d\u624d\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#ipc-namespace","title":"IPC Namespace","text":"<p><code>ipc namespace</code> \u662f\u9694\u79bb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u8d44\u6e90\uff0c\u4f46\u4e0d\u662f\u6240\u6709\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u90fd\u4f1a\u88ab\u9694\u79bb\uff0c\u5b83\u4e3b\u8981\u9694\u79bb \u6d88\u606f\u961f\u5217\u3001\u4fe1\u53f7\u91cf\u3001\u5171\u4eab\u5185\u5b58\u7b49\u3002</p> <p>\u5173\u4e8e<code>IPC</code>\u901a\u4fe1\uff0c\u662f\u5426\u53ef\u4ee5\u88ab<code>ipc namespace</code>\u9694\u79bb\uff0c\u53ef\u4ee5\u67e5\u770b\u5982\u4e0b\u8868\u683c\uff1a</p> IPC\u673a\u5236 \u9700\u6c42 IPC Namespace\u9694\u79bb \u7ba1\u9053\u3001\u547d\u540d\u7ba1\u9053 \u8fdb\u7a0b\u95f4\u7b80\u5355\u6570\u636e\u4ea4\u6362 \u4e0d\u4f1a\u9694\u79bb \u6d88\u606f\u961f\u5217 \u8fdb\u7a0b\u95f4\u5f02\u6b65\u4fe1\u606f\u4ea4\u6362 \u9694\u79bb \u4fe1\u53f7\u91cf \u8fdb\u7a0b\u95f4\u540c\u6b65\u548c\u4e92\u65a5 \u9694\u79bb \u5171\u4eab\u5185\u5b58 \u8fdb\u7a0b\u95f4\u5927\u5757\u6570\u636e\u5171\u4eab \u9694\u79bb \u5957\u63a5\u5b57 \u8fdb\u7a0b\u95f4\u7f51\u7edc\u901a\u4fe1 \u4e0d\u4f1a\u9694\u79bb <p>\u8fd9\u91cc\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u3002</p> <p>\u5728\u5bbf\u4e3b\u673a\u4e0a\u67e5\u8be2\u5171\u4eab\u5185\u5b58\u6bb5\u4fe1\u606f\u3002</p> <pre><code>[root@debian]:[~][tty:0]# ipcs -m\n\n------ Shared Memory Segments --------\nkey        shmid      owner      perms      bytes      nattch     status\n0x00000000 3          lightdm    600        524288     2          dest\n0x00000000 4          lightdm    600        33554432   2          dest\n\n[root@debian]:[~][tty:0]#\n</code></pre> <p>\u5728\u5bbf\u4e3b\u673a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5171\u4eab\u5185\u5b58\u6bb5\u3002</p> <pre><code>[root@debian]:[~][tty:0]# ipcmk -M 128\nShared memory id: 6\n[root@debian]:[~][tty:0]#\n[root@debian]:[~][tty:0]# ipcs -m\n\n------ Shared Memory Segments --------\nkey        shmid      owner      perms      bytes      nattch     status\n0x00000000 3          lightdm    600        524288     2          dest\n0x00000000 4          lightdm    600        33554432   2          dest\n0x8b111882 6          root       644        128        0\n\n[root@debian]:[~][tty:0]#\n</code></pre> <p>\u800c\u540e\u5728<code>ipc namespace</code> \u4e2d\u6765\u67e5\u8be2\u5171\u4eab\u5185\u5b58\u6bb5\u3002</p> <pre><code># unshare -i -u /usr/bin/bash\n(unshare) [root@debian]:[~][tty:0]#\n(unshare) [root@debian]:[~][tty:0]# ipcs -m\n\n------ Shared Memory Segments --------\nkey        shmid      owner      perms      bytes      nattch     status\n\n(unshare) [root@debian]:[~][tty:0]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728<code>ipc namespace</code> \u4e2d\u5171\u4eab\u5185\u5b58\u6bb5\u90fd\u6ca1\u4e86\uff0c\u540c\u6837\u7684\uff0c\u5728\u8be5<code>namespace</code> \u4e2d\u521b\u5efa\u5171\u4eab\u5185\u5b58\u6bb5\uff0c\u5176\u5bbf\u4e3b\u673a\u4e5f\u4e0d\u53ef\u4ee5\u95f4\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:0]# ipcmk -M 128\nShared memory id: 0\n(unshare) [root@debian]:[~][tty:0]#\n(unshare) [root@debian]:[~][tty:0]# ipcs -m\n\n------ Shared Memory Segments --------\nkey        shmid      owner      perms      bytes      nattch     status\n0x4ec24363 0          root       644        128        0\n\n(unshare) [root@debian]:[~][tty:0]#\n</code></pre> <p>\u5728\u4e0a\u8ff0<code>namespace</code> \u4e0d\u9000\u51fa\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u5bbf\u4e3b\u673a\u4e2d\u67e5\u8be2\u5171\u4eab\u5185\u5b58\u6bb5\u3002</p> <pre><code>[root@debian]:[~][tty:1]# ipcs -m\n\n------ Shared Memory Segments --------\nkey        shmid      owner      perms      bytes      nattch     status\n0x00000000 3          lightdm    600        524288     2          dest\n0x00000000 4          lightdm    600        33554432   2          dest\n0x8b111882 6          root       644        128        0\n\n[root@debian]:[~][tty:1]#\n</code></pre> <p>\u5982\u4e0a\u4f8b\u5b50\u8bf4\u660e\uff0c\u5728<code>ipc namespace</code> \u4e2d\uff0c<code>IPC</code>\u8d44\u6e90\u5df2\u88ab\u9694\u79bb\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#pid-namespace","title":"Pid Namespace","text":"<p><code>Pid Namespace</code> \u662f\u7528\u6765\u9694\u79bb\u8fdb\u7a0b<code>ID</code> \u7684\uff0c\u5728<code>Pid Namespace</code> \u4e2d\u7684\u8fdb\u7a0b\u90fd\u6709\u72ec\u7acb\u7684<code>PID</code> \u3002</p> <p>\u4f7f\u7528<code>unshare</code> \u521b\u5efa<code>pid namespace</code> \u5e76\u4e14\u83b7\u53d6\u5f53\u524d<code>PID</code> </p> <pre><code>[root@debian]:[~][tty:2]# unshare -u -i -p --fork /usr/bin/bash\n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# echo $$\n1\n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# \n</code></pre> <p>\u521b\u5efa<code>pid namespace</code> \u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u52a0<code>--fork</code> \u6765<code>fork</code>\u4e00\u4e2a\u65b0\u7684\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u53ea\u6709\u65b0\u7684\u5b50\u8fdb\u7a0b\u624d\u4f1a\u5206\u914d<code>pid</code>\uff0c\u5728\u4f7f\u7528<code>pid namespace</code> \u540e\uff0c\u65b0\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\u7684<code>pid</code> \u90fd\u4f1a\u4ece1\u5f00\u59cb\u8ba1\u6570\u3002</p> <p>\u5b9e\u9645\u4e0a\u67e5\u8be2\u8fdb\u7a0b\u6811\u4fe1\u606f\uff0c\u53ef\u4ee5\u53d1\u73b0<code>linux</code>\u662f\u505a\u4e86\u4e00\u4e2a\u8f6c\u6362\uff0c\u5c06\u5bbf\u4e3b\u673a\u7684<code>pid</code> \u4f1a\u6620\u5c04\u8fdb<code>pid namespace</code> \u4e2d\u7684\u8fdb\u7a0b<code>ID</code> \u3002</p> <pre><code>[root@debian]:[~][tty:1]# ps axjf | head -n 1\n   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND\n      1     756     756     756 ?             -1 SLsl     0   0:00 /usr/sbin/lightdm\n    756     777     777     777 tty7         777 Ssl+     0   0:02  \\_ /usr/lib/xorg/Xorg :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n    756    1104     756     756 ?             -1 Sl       0   0:00  \\_ lightdm --session-child 15 26\n   1104    1133    1133    1133 ?             -1 Ssl      0   0:00      \\_ /usr/bin/lxsession -s LXDE -e LXDE\n   1133    1228    1228    1228 ?             -1 Ss       0   0:00          \\_ /usr/bin/ssh-agent x-session-manager\n   1133    1259    1133    1133 ?             -1 S        0   0:00          \\_ openbox --config-file /root/.config/openbox/lxde-rc.xml\n   1133    1264    1133    1133 ?             -1 Sl       0   0:00          \\_ lxpolkit\n   1133    1266    1133    1133 ?             -1 Sl       0   0:00          \\_ lxpanel --profile LXDE\n   1133    1269    1133    1133 ?             -1 Sl       0   0:00          \\_ pcmanfm --desktop --profile LXDE\n   1269    1431    1133    1133 ?             -1 Sl       0   0:00          |   \\_ lxterminal\n   1431    1434    1434    1434 pts/2       1469 Ss       0   0:00          |       \\_ bash\n   1434    1468    1468    1434 pts/2       1469 S        0   0:00          |           \\_ unshare -u -i -p --fork /usr/bin/bash\n   1468    1469    1469    1434 pts/2       1469 S+       0   0:00          |               \\_ /usr/bin/bash\n</code></pre> <p>\u5176\u5b9e\u8be5<code>bash</code> \u7684\u8fdb\u7a0b<code>id</code> \u4e3a<code>1469</code> \uff0c\u4f46\u662f\u4f7f\u7528\u4e86<code>pid namespace</code> \uff0c\u6240\u4ee5\u5728\u8be5<code>namesapce</code> \u4e2d\u4f1a\u88ab\u6620\u5c04\u4e3a\u4e86<code>1</code> \uff0c\u6b64\u65f6\u82e5\u5728\u5bbf\u4e3b\u673a\u4e0a<code>kill -9 1469</code> \uff0c\u5219\u4f1a\u5f71\u54cd\u5230\u547d\u540d\u7a7a\u95f4\u7684\u8fdb\u7a0b\u3002</p> <pre><code>[root@debian]:[~][tty:1]# kill -9 1469\n[root@debian]:[~][tty:1]#\n</code></pre> <p>\u540c\u6837\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u8fdb\u7a0b\u4f1a\u88ab<code>kill</code> \u6389\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# unshare: sigprocmask unblock failed: Invalid argument\n[root@debian]:[~][tty:2]# \n</code></pre>"},{"location":"2024/11/05/Linux-Namespace.html#mount-namespace","title":"Mount Namespace","text":"<p><code>Mount Namespace</code> \u662f\u6700\u65e9\u51fa\u73b0\u7684<code>Namespace</code> \uff0c\u53ef\u4ee5\u770b\u5230\u5176\u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u4e3a <code>CLONE_NEWNS</code> \uff0c\u548c\u540e\u7eed\u51fa\u73b0\u7684<code>Namespace</code> \u7cfb\u7edf\u8c03\u7528\u53c2\u6570\u90fd\u4e0d\u540c\uff0c\u8fd9\u662f\u56e0\u4e3a\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u5927\u4f6c\u4eec\u8ba4\u4e3a\uff0c\u4e0d\u4f1a\u5728\u51fa\u73b0\u5176\u4ed6<code>Namespace</code> \u4e86\uff0c\u6240\u4ee5\u5c31\u4ee5\u6b64\u4e3a\u547d\u540d\uff0c\u540e\u9762\u7684\u4e8b\u60c5\uff0c\u5927\u5bb6\u5c31\u90fd\u77e5\u9053\u4e86\uff0c\u4e3a\u4e86\u517c\u5bb9\uff0c\u6240\u4ee5\u8be5<code>Mount Namespace</code> \u8fd8\u662f\u4ee5<code>CLONE_NEWNS</code> \u6765\u547d\u540d\u7684\u3002</p> <p><code>Mount Namespace</code> \u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u6587\u4ef6\u7cfb\u7edf\u7684\u9694\u79bb\u548c\u7ba1\u7406\u3002</p> <p>\u4f7f\u7528<code>unshare</code> \u521b\u5efa<code>mount namespace</code> \u5e76\u4e14\u91cd\u65b0\u6302\u8f7d<code>proc</code> \u5206\u533a\u3002</p> <pre><code>[root@debian]:[~][tty:2]# unshare -u -i -p -m --fork /usr/bin/bash\n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# echo $$\n1\n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# mount -t proc proc /proc \n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# ps aux \nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.1   7196  3996 pts/2    S    03:40   0:00 /usr/bin/bash\nroot           3  0.0  0.2  11084  4456 pts/2    R+   03:40   0:00 ps aux\n(unshare) [root@debian]:[~][tty:2]# \n\n</code></pre> <p>\u4e0a\u8ff0\u4f7f\u7528<code>unshare</code> \u521b\u5efa\u4e86<code>mount namespace</code> \uff0c\u5e76\u4e14\u5c06<code>bash</code> \u653e\u5165\u5176\u6267\u884c\uff0c\u5728\u8be5<code>mount namespace</code> \u4e2d\uff0c\u4f7f\u7528<code>mount</code> \u91cd\u65b0\u6302\u8f7d\u4e86<code>proc</code> \uff0c\u63a5\u7740\u67e5\u8be2\u6240\u6709\u8fdb\u7a0b\uff0c\u7531\u4e8e<code>pid namesapce</code> \u9694\u79bb\uff0c\u6240\u4ee5\u53ea\u80fd\u67e5\u8be2\u5230\u5f53\u524d\u547d\u540d\u7a7a\u95f4\u4e2d\u7684\u8fdb\u7a0b\u4e86\u3002</p> <p>\u9ed8\u8ba4\u7684<code>mount namespace</code> \u4f1a\u7ee7\u627f\u5bbf\u4e3b\u673a\u7684\u547d\u540d\u7a7a\u95f4\uff0c\u82e5\u4e0d\u8fdb\u884c\u91cd\u65b0\u6302\u8f7d<code>proc</code> \uff0c\u67e5\u770b\u5230\u7684\u4fe1\u606f\u5c31\u662f\u5bbf\u4e3b\u673a\u7684\u4fe1\u606f\u3002</p> <p>\u540c\u6837\u7684\uff0c\u5728\u8be5<code>namesapce</code> \u4e2d\u8bbe\u7f6e\u7684\u6302\u8f7d\uff0c\u5728\u5bbf\u4e3b\u673a\u662f\u9694\u79bb\u5f00\u6765\u7684\uff0c\u4f8b\u5982\uff1a</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1        19G  3.9G   14G  23% /\nudev            953M     0  953M   0% /dev\ntmpfs           984M  4.0K  984M   1% /dev/shm\ntmpfs           197M 1004K  196M   1% /run\ntmpfs           5.0M  8.0K  5.0M   1% /run/lock\ntmpfs           197M   44K  197M   1% /run/user/1000\ntmpfs           197M   44K  197M   1% /run/user/0\n/dev/sda5       6.4G  348M  5.8G   6% /var\n/dev/sda8        71G  1.2G   67G   2% /home\n/dev/sda7       1.2G   68K  1.1G   1% /tmp\n(unshare) [root@debian]:[~][tty:2]# mount /dev/sda1 /data\n(unshare) [root@debian]:[~][tty:2]# mount | grep /data\n/dev/sda1 on /data type ext4 (rw,relatime,errors=remount-ro)\n(unshare) [root@debian]:[~][tty:2]# \n</code></pre> <p>\u5728\u4e0d\u9000\u51fa\u5f53\u524d<code>mount namesapce</code>\u73af\u5883\u4e0b\uff0c\u67e5\u8be2\u5bbf\u4e3b\u673a\u5173\u4e8e<code>/data</code>\u7684\u6302\u8f7d\u3002</p> <pre><code>[root@debian]:[~][tty:1]# mount /dev/sda1 /data\n[root@debian]:[~][tty:1]#\n</code></pre> <p>\u5982\u6b64\uff0c<code>mount namespace</code> \u9694\u79bb\u4e86\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#network-namespace","title":"Network Namespace","text":"<p><code>network namespace</code> \u9694\u79bb\u7684\u662f\u7f51\u7edc\u73af\u5883\uff0c\u7f51\u7edc\u901a\u4fe1\u662f\u8f83\u4e3a\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u5148\u4ec5\u4ec5\u8bc1\u660e<code>network namesapce</code> \u9694\u79bb\u6027\u3002</p> <p>\u4f7f\u7528<code>unshare</code> \u521b\u5efa<code>network namespace</code> \uff0c\u5e76\u4e14\u4f7f<code>bash</code> \u5728\u5176\u8fd0\u884c\u3002</p> <pre><code>(unshare) [root@debian]:[~][tty:2]# unshare  -u -i -p -m -n --fork /usr/bin/bash\n(unshare) [root@debian]:[~][tty:2]# \n(unshare) [root@debian]:[~][tty:2]# ip a\n1: lo: &lt;LOOPBACK&gt; mtu 65536 qdisc noop state DOWN group default qlen 1000\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n(unshare) [root@debian]:[~][tty:2]# \n</code></pre> <p>\u521b\u5efa\u4e86<code>network namespace</code> \u4e4b\u540e\uff0c\u67e5\u8be2\u5176<code>ip</code> \u4fe1\u606f\uff0c\u53ea\u6709\u672c\u5730\u56de\u73af\u5730\u5740\uff0c\u72b6\u6001\u8fd8\u662f\u5173\u95ed\u7684\uff0c\u8bf4\u660e <code>network namespace</code>\u9694\u79bb\u4e86\u5176\u7f51\u7edc\u73af\u5883\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#user-namespace","title":"User Namespace","text":"<p><code>user namespace</code> \u9694\u79bb\u7684\u662f\u7528\u6237\u548c\u7528\u6237\u7ec4\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u4e0d\u540c\u7684<code>user namespace</code> \u4e2d\u7684<code>user id</code> \u548c<code>group id</code> \u53ef\u4ee5\u662f\u4e0d\u540c\u7684\u3002\u6700\u4e3a\u5e38\u7528\u7684\u662f\u5728\u5bbf\u4e3b\u673a\u4ee5\u4e00\u4e2a\u975e<code>root</code> \u7528\u6237\u8fd0\u884c\u521b\u5efa\u4e86\u4e00\u4e2a<code>user namespace</code> \uff0c\u7136\u540e\u5728\u8be5<code>user namespace</code> \u4e2d\u5374\u88ab\u6620\u5c04\u6210\u4e86<code>root</code> \u7528\u6237\u3002</p> <p>\u4f7f\u7528<code>unshare</code> \u521b\u5efa<code>user namespace</code>\uff0c\u5e76\u4e14\u4f7f<code>bash</code> \u5728\u5176\u8fd0\u884c\u3002</p> <pre><code>[root@debian]:[~][tty:2]# unshare -u -i -p -m -n -U --fork /usr/bin/bash\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ id\nuid=65534(nobody) gid=65534(nogroup) groups=65534(nogroup)\n(unshare) [nobody@debian]:[~][tty:2]$ \n\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u589e\u52a0\u4e86<code>user namespace</code> \u540e\uff0c\u5176\u7528\u6237\u88ab\u6620\u5c04\u4e3a\u4e86<code>nobody</code>\u7528\u6237\u3002</p> <p>\u5982\u679c\u60f3\u8981\u4fee\u6539\u5176\u5bb9\u5668\u4e2d\u7684<code>userid</code>\u503c\uff0c\u53ef\u4ee5\u4f7f\u7528<code>newuidmap</code> \u8fdb\u884c<code>uid</code> \u6620\u5c04\u3002</p> <p>\u9996\u5148\uff0c\u9700\u8981\u627e\u5230\u5176<code>user namespace</code> \u4e0b\u8fd0\u884c\u8fdb\u7a0b\u7684<code>pid</code> \u3002</p> <pre><code>[root@debian]:[~][tty:0]# ps axjf\n   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND\n      1     756     756     756 ?             -1 SLsl     0   0:00 /usr/sbin/lightdm\n    756    2547    2547    2547 tty7        2547 Ssl+     0   0:01  \\_ /usr/lib/xorg/Xorg :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n    756    2633     756     756 ?             -1 Sl       0   0:00  \\_ lightdm --session-child 15 26\n   2633    2637    2637    2637 ?             -1 Ssl      0   0:00      \\_ /usr/bin/lxsession -s LXDE -e LXDE\n   2637    2729    2729    2729 ?             -1 Ss       0   0:00          \\_ /usr/bin/ssh-agent x-session-manager\n   2637    2749    2637    2637 ?             -1 S        0   0:00          \\_ openbox --config-file /root/.config/openbox/lxde-rc.xml\n   2637    2750    2637    2637 ?             -1 Sl       0   0:00          \\_ lxpolkit\n   2637    2752    2637    2637 ?             -1 Sl       0   0:00          \\_ lxpanel --profile LXDE\n   2637    2754    2637    2637 ?             -1 Sl       0   0:00          \\_ pcmanfm --desktop --profile LXDE\n   2754    2886    2637    2637 ?             -1 Sl       0   0:00          |   \\_ lxterminal\n   2886    2889    2889    2889 pts/2       2916 Ss       0   0:00          |       \\_ bash\n   2889    2915    2915    2889 pts/2       2916 S        0   0:00          |           \\_ unshare -u -i -p -m -n -U --fork /usr/bin/bash\n   2915    2916    2916    2889 pts/2       2916 S+       0   0:00          |               \\_ /usr/bin/bash\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5176\u771f\u5b9e\u7684<code>pid</code>\u662f<code>2916</code>\uff0c\u5219\u5728\u5bbf\u4e3b\u673a\u4e0a\u9700\u8981\u6267\u884c\u5982\u4e0b\u6620\u5c04\u3002</p> <pre><code>[root@debian]:[~][tty:1]# newuidmap 2916 0 0 1\n[root@debian]:[~][tty:1]#\n</code></pre> <p>\u6b64\u65f6\uff0c\u518d\u56de\u5230<code>user namespace</code> \u4e2d\uff0c\u67e5\u770b\u7528\u6237\u4fe1\u606f\u3002</p> <pre><code>(unshare) [nobody@debian]:[~][tty:2]$ id\nuid=0(root) gid=65534(nogroup) groups=65534(nogroup)\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ mount -t proc proc /proc\n(unshare) [nobody@debian]:[~][tty:2]$ ps aux \nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.1   7196  3876 pts/2    S    04:42   0:00 /usr/bin/bash\nroot           8  0.0  0.2  11084  4328 pts/2    R+   04:49   0:00 ps aux\n(unshare) [nobody@debian]:[~][tty:2]$ \n\n</code></pre> <p>\u5176<code>uid</code> \u5219\u53d8\u4e3a\u4e86<code>root</code> \uff0c\u4e5f\u53ef\u4ee5\u8fdb\u884c\u78c1\u76d8\u6302\u8f7d\u3002</p> <p>\u5f53\u7136\uff0c\u5728\u666e\u901a\u7528\u6237\u4e0b\uff0c\u4e5f\u662f\u540c\u7406\u3002</p> <p>\u4f7f\u7528\u666e\u901a\u7528\u6237\u4f7f\u7528<code>unshare</code>\u521b\u5efa<code>user namespace</code> \u5e76\u4e14\u542f\u52a8<code>bash</code> \u547d\u4ee4\u3002</p> <pre><code>[wangli@debian]:[~][tty:2]$ unshare -u -i -p -m -n -U --fork /usr/bin/bash\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ id\nuid=65534(nobody) gid=65534(nogroup) groups=65534(nogroup)\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ \n</code></pre> <p>\u67e5\u8be2\u5176\u771f\u5b9e\u7684<code>pid</code> \u3002</p> <pre><code>[root@debian]:[~][tty:0]# ps axjf\n   PPID     PID    PGID     SID TTY        TPGID STAT   UID   TIME COMMAND\n      1     756     756     756 ?             -1 SLsl     0   0:00 /usr/sbin/lightdm\n    756    2992    2992    2992 tty7        2992 Ssl+     0   0:01  \\_ /usr/lib/xorg/Xorg :0 -seat seat0 -auth /var/run/lightdm/root/:0 -nolisten tcp vt7 -novtswitch\n    756    3077     756     756 ?             -1 Sl       0   0:00  \\_ lightdm --session-child 14 26\n   3077    3083    3083    3083 ?             -1 Ssl   1000   0:00      \\_ /usr/bin/lxsession -s LXDE -e LXDE\n   3083    3169    3169    3169 ?             -1 Ss    1000   0:00          \\_ /usr/bin/ssh-agent x-session-manager\n   3083    3185    3083    3083 ?             -1 S     1000   0:00          \\_ openbox --config-file /home/wangli/.config/openbox/lxde-rc.xml\n   3083    3186    3083    3083 ?             -1 Sl    1000   0:00          \\_ lxpolkit\n   3083    3189    3083    3083 ?             -1 Sl    1000   0:00          \\_ lxpanel --profile LXDE\n   3083    3192    3083    3083 ?             -1 Sl    1000   0:00          \\_ pcmanfm --desktop --profile LXDE\n   3192    3387    3083    3083 ?             -1 Sl    1000   0:00          |   \\_ lxterminal\n   3387    3390    3390    3390 pts/2       3418 Ss    1000   0:00          |       \\_ bash\n   3390    3417    3417    3390 pts/2       3418 S     1000   0:00          |           \\_ unshare -u -i -p -m -n -U --fork /usr/bin/bash\n   3417    3418    3418    3390 pts/2       3418 S+    1000   0:00          |               \\_ /usr/bin/bash\n</code></pre> <p>\u67e5\u8be2\u5230\u5176<code>PID</code>\u4e3a3418\uff0c\u5728\u53e6\u5916\u7684\u7ec8\u7aef\uff0c\u6267\u884c<code>newuidmap</code>\u64cd\u4f5c</p> <pre><code>[wangli@debian]:[/root][tty:1]$ id\nuid=1000(wangli) gid=1000(wangli) groups=1000(wangli),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(users),106(netdev),111(lpadmin),114(scanner)\n[wangli@debian]:[/root][tty:1]$\n[wangli@debian]:[/root][tty:1]$ newuidmap 3418 0 1000 1\n[wangli@debian]:[/root][tty:1]$\n</code></pre> <p>\u8bf7\u6ce8\u610f\uff0c\u8fd9\u91cc<code>loweruid</code>\u8bbe\u7f6e\u4e3a\u4e861000\uff0c\u8fd9\u662f\u56e0\u4e3a<code>wangli</code>\u8fd9\u4e2a\u7528\u6237\u7684<code>uid</code>\u4e3a1000\u3002</p> <p>\u6b64\u65f6\u518d\u5230<code>user namespace</code> \u4e2d\u67e5\u770b<code>id</code> \u4fe1\u606f\u3002</p> <pre><code>(unshare) [nobody@debian]:[~][tty:2]$ id\nuid=0(root) gid=65534(nogroup) groups=65534(nogroup)\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ mount -t proc proc /proc\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ ps aux \nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.2   8008  4720 pts/2    S    04:55   0:00 /usr/bin/bash\nroot           6  0.0  0.2  11084  4440 pts/2    R+   05:02   0:00 ps aux\n(unshare) [nobody@debian]:[~][tty:2]$ \n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5176<code>uid</code> \u5df2\u7ecf\u88ab\u6620\u5c04\u4e3a\u4e86<code>root</code> \uff0c\u6b64\u65f6\uff0c\u6267\u884c<code>mount</code>\u8fdb\u884c\u6302\u8f7d\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#time-namespace","title":"Time Namespace","text":"<p><code>Time Nmaespace</code> \u5141\u8bb8\u8fdb\u7a0b\u5728\u72ec\u7acb\u7684\u65f6\u95f4\u4e0a\u4e0b\u6587\u4e2d\u8fd0\u884c\u3002\u4f7f\u7528\u4e86<code>time namespace</code> \u7684\u8fdb\u7a0b\u53ef\u4ee5\u62e5\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u65f6\u95f4\u89c6\u56fe\u5e76\u4e14\u548c\u5176\u4ed6<code>time namespace</code> \u548c\u5bbf\u4e3b\u673a\u9694\u79bb\u5f00\u6765\u3002</p> <p>\u4e0b\u9762\u4e3e\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u4f8b\u5b50\uff1a</p> <p>\u5148\u67e5\u8be2\u7cfb\u7edf\u542f\u52a8\u7684\u79d2\u6570</p> <pre><code>[wangli@debian]:[~][tty:2]$  cat /proc/uptime \n11397.34 10829.19\n[wangli@debian]:[~][tty:2]$ \n</code></pre> <p>\u4f7f\u7528<code>unshare</code>\u542f\u52a8<code>time namespace</code> \u547d\u540d\u7a7a\u95f4\uff0c\u4e14\u8fd0\u884c<code>bash</code>\u8fdb\u7a0b\u3002</p> <pre><code>[wangli@debian]:[~][tty:2]$ unshare -u -i -p -m -n -U -T --boottime -11397 --fork /usr/bin/bash\n(unshare) [nobody@debian]:[~][tty:2]$ uptime \n 05:36:09 up 0 min,  3 users,  load average: 0.00, 0.01, 0.00\n(unshare) [nobody@debian]:[~][tty:2]$ \n(unshare) [nobody@debian]:[~][tty:2]$ \n</code></pre> <p>\u5728\u547d\u540d\u7a7a\u95f4\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5176<code>uptime</code> \u7684\u542f\u52a8\u65f6\u95f4\u5df2\u7ecf\u4e3a0\u4e86\u3002</p> <p>\u5728\u4e0d\u9000\u51fa<code>time namespace</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u4e00\u4e2a\u65b0\u7684<code>shell</code> \u6765\u67e5\u770b<code>uptime</code> \u4fe1\u606f</p> <pre><code>[wangli@debian]:[~][tty:3]$ uptime \n 05:39:01 up  3:12,  3 users,  load average: 0.00, 0.01, 0.00\n[wangli@debian]:[~][tty:3]$ \n</code></pre> <p>\u7531\u6b64\u8bc1\u660e\uff0c<code>time namespace</code>\u5bf9\u4e8e\u7cfb\u7edf\u65f6\u95f4\u7684\u9694\u79bb\u6027\u3002</p>"},{"location":"2024/11/05/Linux-Namespace.html#_4","title":"\u603b\u7ed3","text":"<p>\u9996\u5148\uff0c\u5728\u4ecb\u7ecd<code>Linux Nmaespace</code>\u4e4b\u524d\u5148\u8fdb\u884c\u4e86\u524d\u7f6e\u51c6\u5907\uff0c\u5305\u62ec <code>unshare</code>\u5de5\u5177\u7684\u4f7f\u7528\u3001\u4fee\u6539\u63d0\u793a\u7b26\u3001\u547d\u540d\u7a7a\u95f4\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u57fa\u672c\u8bf4\u660e\u7b49\u3002</p> <p>\u800c\u540e\u5c31\u4ecb\u7ecd\u4e86<code>Linux Namespace</code>\u57fa\u672c\u4fe1\u606f\uff0c\u5f52\u7eb3\u5982\u4e0b\uff1a</p> <p><code>Linux Nmaespace</code> \u662f<code>Linux</code>\u5185\u6838\u4e00\u9879\u5f3a\u5927\u7684\u529f\u80fd\uff0c\u662f\u5bb9\u5668\u5316\u7684\u57fa\u77f3\uff0c\u81f3\u76ee\u524d\u4e3a\u6b62\uff0c\u4e00\u5171\u67097\u79cd\u7c7b\u522b\u7684<code>Namespace</code>\uff0c\u6309\u7167\u53d1\u5e03\u65f6\u95f4\u987a\u5e8f\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li><code>Mount Namespace</code> \uff1a\u9694\u79bb\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li><code>UTS Namespace</code>\uff1a \u9694\u79bb\u4e3b\u673a\u540d\u548c\u57df\u540d\u3002</li> <li><code>IPC Namespace</code>\uff1a\u9694\u79bb\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002</li> <li><code>PID Namespace</code>\uff1a\u9694\u79bb\u8fdb\u7a0bID\u3002</li> <li><code>Network Namespace</code>\uff1a\u9694\u79bb\u7f51\u7edc\u3002</li> <li><code>User Namespace</code>\uff1a\u9694\u79bb\u7528\u6237\u548c\u7ec4\u3002</li> <li><code>Time Namespace</code>\uff1a\u9694\u79bb\u7cfb\u7edf\u65f6\u949f\u3002</li> </ul> <p>\u5982\u4e0a\u4f17\u591a\u7684<code>Namespace</code> \u4f7f\u5f97\u5728\u540c\u4e00\u53f0\u673a\u5668\u4e0a\u8fd0\u884c\u591a\u4e2a\u201c\u72ec\u7acb\u201d\u7684\u8fdb\u7a0b\u73af\u5883\uff0c\u79f0\u4e3a\u53ef\u80fd\uff0c\u6240\u4ee5<code>Linux Namespace</code>\u624d\u662f\u5bb9\u5668\u5316\u7684\u57fa\u7840\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html","title":"\u4e86\u89e3POSIX\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u672c\u6587\u5c06\u4ecb\u7ecd\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <p><code>Linux</code>\u6700\u5e38\u89c1\u7684\u8868\u8fbe\u5f0f\u6709\u4e09\u79cd\uff1a</p> <ul> <li> <p><code>POSIX</code>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff1b</p> </li> <li> <p><code>POSIX</code>\u6269\u5c55\u6b63\u5219\u8868\u8fbe\u5f0f \uff1b</p> </li> <li> <p><code>Perl</code> \u517c\u5bb9\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> </li> </ul> <p>\u672c\u6587\u5c06\u7b80\u5355\u4ecb\u7ecd<code>POSIX</code>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#posix_1","title":"\u4ec0\u4e48\u662f<code>POSIX</code>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p><code>POSIX</code>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u4e5f\u79f0<code>BRE</code> (Basic Regular Expression) \uff0c\u662f<code>POSIX</code>\u6807\u51c6\u4e2d\u7684\u4e00\u79cd\u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u5728<code>Linux</code> \u4e2d\uff0c<code>grep</code>\u3001<code>sed</code>\u3001<code>awk</code>\u7b49\u5de5\u5177\u90fd\u652f\u6301\u8be5\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#bre","title":"BRE\u7279\u70b9","text":"<p>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u8bed\u6cd5\u76f8\u5bf9\u800c\u8a00\u8f83\u4e3a\u7b80\u5355\uff0c\u9002\u7528\u4e8e\u5927\u591a\u6570\u57fa\u672c\u7684\u6587\u672c\u5339\u914d\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#_1","title":"\u652f\u6301\u7684\u5143\u5b57\u7b26","text":"\u5143\u5b57\u7b26 \u7528\u9014 . \u5339\u914d\u9664\u6362\u884c\u7b26\u4ee5\u5916\u7684\u4efb\u610f\u5355\u4e2a\u5b57\u7b26 * \u5339\u914d\u4efb\u610f\u4e2a\uff08\u5305\u62ec0\u4e2a\uff09\u524d\u9762\u7684\u5b57\u7b26 [...] \u5339\u914d\u65b9\u62ec\u53f7\u4e2d\u7684\u5b57\u7b26\u96c6\u4e2d\u7684\u4efb\u4f55\u4e00\u4e2a [^...] \u5982\u679c\u65b9\u62ec\u53f7\u4e2d\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f<code>^</code>\uff0c\u5219\u8868\u793a\u5426\u5b9a\u5339\u914d ^ \u5982\u679c\u4f5c\u4e3a\u6b63\u5219\u7b2c\u4e00\u4e2a\u5b57\u7b26\uff0c\u5219\u8868\u793a\u5339\u914d\u884c\u8d77\u59cb $ \u5982\u679c\u4f5c\u4e3a\u6b63\u5219\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\uff0c\u5219\u8868\u793a\u5339\u914d\u884c\u7684\u7ed3\u5c3e \\{n\\} \u5c06\u5339\u914dn\u6b21\u51fa\u73b0 \\{n,m\\} \u5339\u914d\u5b83\u524d\u4e00\u4e2a\u8303\u56f4\u5185\u5355\u4e2a\u5b57\u7b26\u51fa\u73b0\u7684\u6b21\u6570\uff0c\u5339\u914dn\u6b21m\u6b21\u4e4b\u524d\u7684\u4efb\u610f\u6b21\u6570 \\ \u8f6c\u4e49\u7279\u6b8a\u5b57\u7b26"},{"location":"2024/11/06/Regular-Expression.html#_2","title":"\u652f\u6301\u7684\u8f6c\u4e49\u5b57\u7b26","text":"\u8f6c\u4e49\u5b57\u7b26 \u7528\u9014 \\. \u5339\u914d\u5b57\u9762\u610f\u601d\u7684\u70b9<code>.</code> \\\\ \u5339\u914d\u5b57\u9762\u610f\u601d\u7684\u53cd\u659c\u6760<code>\\</code> \\* \u5339\u914d\u5b57\u9762\u610f\u601d\u7684\u661f\u53f7<code>*</code>"},{"location":"2024/11/06/Regular-Expression.html#_3","title":"\u652f\u6301\u7684\u5b57\u7b26\u96c6","text":"\u5b57\u7b26\u96c6 \u7528\u9014 [abc] \u5339\u914d<code>a</code>\u3001<code>b</code>\u3001<code>c</code> \u4e2d\u7684\u4efb\u610f\u5b57\u7b26 [0-9] \u5339\u914d\u4efb\u610f\u6570\u5b57\uff0c\u540c\u7406<code>[a-z]</code>\u5339\u914d\u4efb\u610f\u5c0f\u5199\u5b57\u7b26\u3001<code>[A-Z]</code>\u5339\u914d\u4efb\u610f\u5927\u5199\u5b57\u7b26 [^abc] \u5339\u914d\u4e0d\u5305\u542b<code>a</code>\u3001<code>b</code>\u3001<code>c</code> \u7684\u4efb\u610f\u5b57\u7b26"},{"location":"2024/11/06/Regular-Expression.html#_4","title":"\u652f\u6301\u7684\u5b57\u7b26\u7c7b","text":"\u5b57\u7b26\u7c7b \u7528\u9014 [:alnum:] \u53ef\u6253\u5370\u7684\u5b57\u7b26 [:alpha:] \u5b57\u6bcd\u5b57\u7b26 [:blank:] \u7a7a\u683c\u548c\u5236\u8868\u7b26 [:cntrl:] \u63a7\u5236\u5b57\u7b26 [:digit:] \u6570\u5b57\u5b57\u7b26 [:graph:] \u53ef\u6253\u5370\u7684\u548c\u53ef\u89c1\u7684\u5b57\u7b26 [:lower:] \u5c0f\u5199\u5b57\u7b26 [:print:] \u53ef\u6253\u5370\u7684\u5b57\u7b26 [:punct:] \u6807\u70b9\u7b26\u53f7\u5b57\u7b26 [:space:] \u7a7a\u767d\u5b57\u7b26 [:upper:] \u5927\u5199\u5b57\u7b26 [:xdigit:] \u5341\u516d\u8fdb\u5236\u6570\u5b57"},{"location":"2024/11/06/Regular-Expression.html#_5","title":"\u652f\u6301\u7684\u5206\u7ec4\u64cd\u4f5c","text":"\u5206\u7ec4 \u7528\u9014 \\(\\) \u6355\u83b7\u5b57\u7b26"},{"location":"2024/11/06/Regular-Expression.html#_6","title":"\u5143\u5b57\u7b26\u64cd\u4f5c","text":""},{"location":"2024/11/06/Regular-Expression.html#_7","title":"<code>.</code> \u53ef\u4ee5\u5339\u914d\u4efb\u610f\u5b57\u7b26","text":"<pre><code>root@debian:~# echo '123' | grep '1.3'\n123\nroot@debian:~#\n</code></pre> <p><code>.</code> \u53ef\u4ee5\u5339\u914d\u4efb\u4f55\u5b57\u7b26\uff0c\u4f46\u662f\u4e0d\u5305\u62ec\u6362\u884c\u7b26<code>\\n</code>\u3002</p> <p>\u4f46\u662f\u65e0\u6cd5\u5339\u914d\u6362\u884c\u7b26</p> <pre><code>root@debian:~# echo -e '1\\n2\\n3' &gt; hello\nroot@debian:~#\nroot@debian:~# cat hello -A\n1$\n2$\n3$\nroot@debian:~#\nroot@debian:~# grep '1.2' hello\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_8","title":"<code>*</code> \u5339\u914d\u4efb\u610f\u4e2a\u524d\u9762\u7684\u5b57\u7b26","text":"<pre><code>root@debian:~# echo \"abbbbbbbbbd\" | grep 'a*d'\nabbbbbbbbbd\nroot@debian:~#\n</code></pre> <p><code>*</code> \u5339\u914d\u4e0a\u9762\u4efb\u610f\u5b57\u7b26<code>0</code> \u6b21\u6216\u8005\u65e0\u6570\u6b21\u3002</p> <pre><code>root@debian:~# echo \"1\" | grep ' *'\n1\nroot@debian:~#\n</code></pre> <p>\u4e0a\u9762\u6848\u4f8b\u4e4b\u6240\u4ee5\u80fd\u591f\u88ab\u5339\u914d\u5230\u662f\u56e0\u4e3a</p> <p>\u53ef\u4ee5\u548c<code>*</code>\u4e00\u8d77\u4f7f\u7528\uff0c\u8868\u793a\u5339\u914d\u4efb\u610f\u5b57\u7b26</p> <pre><code>root@debian:~# echo \"abced\" | grep 'a.*e'\nabced\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_9","title":"<code>^</code>\u5339\u914d\u8d77\u59cb\u884c","text":"<pre><code>root@debian:~# echo \"abced\" | grep '^a'\nabced\nroot@debian:~#\nroot@debian:~# echo \"baced\" | grep '^a'\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_10","title":"<code>$</code>\u5339\u914d\u884c\u7ed3\u5c3e","text":"<pre><code>root@debian:~# echo 'abced' | grep 'd$'\nabced\nroot@debian:~# echo 'abcede' | grep 'd$'\nroot@debian:~#\n</code></pre> <p>\u53ef\u4ee5\u548c<code>^</code> \u642d\u914d\u4f7f\u7528\uff0c\u8868\u793a\u5339\u914d\u7a7a\u884c</p> <pre><code>root@debian:~# echo '' | grep '^$'\n\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_11","title":"\u5339\u914d\u4e0a\u4e00\u4e2a\u5b57\u7b26\u51fa\u73b0\u7684\u6b21\u6570","text":"<pre><code>root@debian:~# echo 'abbbc' | grep 'ab\\{3\\}c'\nabbbc\nroot@debian:~#\n</code></pre> <p>\u6ce8\u610f\uff0c\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\uff0c<code>{}</code> \u5fc5\u987b\u4f7f\u7528<code>\\</code> \u8fdb\u884c\u8f6c\u4e49\uff0c\u5982\u76f4\u63a5\u4f7f\u7528\u65f6\u4e0d\u884c\u7684\u3002</p> <pre><code>root@debian:~# echo 'abbbc' | grep 'ab{3}c'\nroot@debian:~#\n</code></pre> <p>\u5982\u679c\u4e0d\u52a0<code>\\</code>\u8fdb\u884c\u8f6c\u4e49\uff0c\u662f\u76f4\u63a5\u5339\u914d<code>{}</code>\u5b57\u7b26\uff0c\u800c\u975e\u6b63\u5219\u8868\u8fbe\u5f0f\u3002</p> <pre><code>root@debian:~# echo 'ab{3}c' | grep 'ab{3}c'\nab{3}c\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_12","title":"\u5339\u914d\u4e0a\u4e00\u4e2a\u51fa\u73b0\u7684\u6b21\u6570\u8303\u56f4","text":"<pre><code>root@debian:~# echo \"abbbc\" | grep 'ab\\{3,5\\}c'\nabbbc\nroot@debian:~# echo \"abbbc\" | grep 'ab\\{4,5\\}c'\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_13","title":"\u8f6c\u4e49\u7279\u6b8a\u5b57\u7b26","text":"<pre><code>root@debian:~# echo \"a\\.e\" | grep 'a\\\\.e'\na\\.e\nroot@debian:~#\n</code></pre> <p><code>.</code> \u3001<code>*</code> \u3001<code>^</code>\u3001<code>$</code>\u90fd\u9700\u8981\u8fdb\u884c\u8f6c\u4e49\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#_14","title":"\u5b57\u7b26\u96c6\u64cd\u4f5c","text":""},{"location":"2024/11/06/Regular-Expression.html#_15","title":"\u5339\u914d\u8303\u56f4\u5185\u7684\u4efb\u610f\u5b57\u7b26","text":"<pre><code>root@debian:~# echo 'a2c' | grep 'a[123]c'\na2c\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_16","title":"\u5339\u914d\u5b57\u7b26\u8303\u56f4","text":"<pre><code>root@debian:~# echo \"3\" | grep '[1-9]'\n3\nroot@debian:~#\nroot@debian:~# echo \"a\" | grep '[a-z]'\na\nroot@debian:~#\nroot@debian:~# echo \"a\" | grep '[a-z]'\na\nroot@debian:~#\nroot@debian:~# echo \"Z\" | grep '[a-Z]'\nZ\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_17","title":"\u5b57\u7b26\u7c7b\u64cd\u4f5c","text":""},{"location":"2024/11/06/Regular-Expression.html#_18","title":"\u5339\u914d\u6570\u5b57\u5b57\u7b26","text":"<pre><code>root@debian:~# echo '13579' | grep '[[:digit:]]'\n13579\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_19","title":"\u5339\u914d\u5c0f\u5199\u5b57\u6bcd","text":"<pre><code>root@debian:~# echo 'abcde' | grep '[[:lower:]]'\nabcde\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_20","title":"\u5339\u914d\u5927\u5199\u5b57\u6bcd","text":"<pre><code>root@debian:~# echo 'ABCDE' | grep '[[:upper:]]'\nABCDE\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_21","title":"\u5339\u914d\u7a7a\u767d\u5b57\u7b26","text":"<pre><code>root@debian:~# echo \"   \" | grep '[[:space:]]'\n\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_22","title":"\u5206\u7ec4\u64cd\u4f5c","text":"<p>\u5206\u7ec4\u662f\u6307\u4f7f\u7528\u5c0f\u62ec\u53f7\u5c06\u8868\u8fbe\u5f0f\u62ec\u8d77\u6765\uff0c\u521b\u5efa\u5b50\u6a21\u5f0f\uff0c\u8be5\u5b50\u6a21\u5f0f\u4f1a\u88ab\u4fdd\u5b58\uff0c\u65b9\u4fbf\u4e4b\u540e\u7684\u5f15\u7528\u548c\u5904\u7406\uff0c\u540c\u6837\u7684\uff0c<code>()</code> \u4e5f\u9700\u8981\u4f7f\u7528<code>\\</code>\u8f6c\u4e49\uff0c\u5426\u5219\u4f1a\u88ab\u5f53\u6210\u666e\u901a\u5b57\u7b26\u5904\u7406\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#_23","title":"\u6355\u83b7\u5206\u7ec4","text":"<pre><code>root@debian:~# echo \"abcabcabcabc\" | grep '\\(abc\\)\\+'\nabcabcabcabc\nroot@debian:~#\n</code></pre>"},{"location":"2024/11/06/Regular-Expression.html#_24","title":"\u5206\u7ec4\u5f15\u7528","text":"<pre><code>root@debian:~# echo \"180-1234-1234\" | sed 's/\\([[:digit:]]\\{3\\}\\)-\\([[:digit:]]\\{4\\}\\)-\\([[:digit:]]\\{4\\}\\)/+86 \\1 \\2 \\3/'\n+86 180 1234 1234\nroot@debian:~#\n</code></pre> <p><code>grep</code> \u4e3b\u8981\u662f\u7528\u4ee5\u5339\u914d\u548c\u67e5\u627e\uff0c\u6240\u4ee5\u5b83\u4e0d\u5177\u5907\u6355\u83b7\u5206\u7ec4\u548c\u5f15\u7528\u5206\u7ec4\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u8fd9\u91cc\u4f7f\u7528<code>sed</code> \u8fdb\u884c\u66ff\u4ee3\uff0c\u82e5\u662f\u592a\u96be\u4e86\uff0c\u53ef\u4ee5\u770b\u5982\u4e0b\u6848\u4f8b\uff1a</p> <pre><code>root@debian:~# echo \"180-1234-1234\" | sed 's/180/182/'\n182-1234-1234\nroot@debian:~#\n</code></pre> <p>\u5982\u4e0a\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u66ff\u6362\uff0c<code>sed 's/old/new/'</code>\u3002</p> <p>\u5982\u679c\u5f15\u7528\u4e86\u5206\u7ec4</p> <pre><code>root@debian:~# echo \"180-1234-1234\" | sed 's/\\(180\\)-\\(1234\\)-\\(1234\\)/\\1 \\2 \\3/'\n180 1234 1234\nroot@debian:~#\n</code></pre> <p>\u8fd9\u91cc\u5c06<code>180</code>\u6355\u83b7\u4e3a\u5206\u7ec41\u3001<code>1234</code>\u6355\u83b7\u4e3a\u5206\u7ec42\u3001\u6700\u540e\u7684<code>1234</code>\u6355\u83b7\u4e3a\u5206\u7ec43\uff0c\u5728\u8fdb\u884c\u66ff\u6362\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>\\1</code>\u3001<code>\\2</code>\u7b49\u76f4\u63a5\u5f15\u7528\u5206\u7ec4\u5185\u5bb9\u3002\u5206\u7ec4\u6700\u591a\u4e3a1\u52309\u51719\u4e2a\u3002</p>"},{"location":"2024/11/06/Regular-Expression.html#_25","title":"\u603b\u7ed3","text":"<p>\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u76f8\u5bf9\u800c\u8a00\uff0c\u6bd4\u8f83\u7b80\u5355\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u57fa\u672c\u6b63\u5219\u8868\u8fbe\u5f0f\u4e2d\uff0c\u5927\u62ec\u53f7<code>{}</code> \u548c\u5c0f\u62ec\u53f7<code>()</code>\u90fd\u5fc5\u987b\u8981\u4f7f\u7528<code>\\</code> \u8fdb\u884c\u8f6c\u4e49\uff0c\u5426\u5219\u5c06\u8868\u793a\u5b57\u7b26\u672c\u8eab\u3002\u800c<code>.</code> \u3001<code>*</code>\u3001<code>^</code>\u3001<code>$</code> \u7b49\uff0c\u9ed8\u8ba4\u5c31\u662f\u6b63\u5219\uff0c\u5982\u679c\u9700\u8981\u4f7f\u7528\u5176\u5b57\u7b26\u672c\u8eab\uff0c\u5219\u9700\u8981\u4f7f\u7528<code>\\</code>\u8fdb\u884c\u8f6c\u4e49\u3002</p> <p>\u54e6\uff0c\u5bf9\u4e86\uff0c\u5728<code>shell</code>\u4e2d\uff0c\u6211\u4eec\u67e5\u8be2\u6587\u4ef6\uff0c\u53ef\u80fd\u4f1a\u7528\u5230\u7c7b\u4f3c\u7684\u5199\u6cd5\uff1a</p> <pre><code>root@debian:~# ls -d ns[123]\nns1  ns2\nroot@debian:~# ls -d *\nBRE  Desktop  Documents  Downloads  hello  Music  ns1  ns2  Pictures  Public  Templates  Videos\nroot@debian:~# ls -d .*\n.bash_history  .cache   .dmrc     .local    .ssh                                 .viminfo    .Xauthority       .xsession-errors.old\n.bashrc        .config  .lesshst  .profile  .vboxclient-vmsvga-session-tty7.pid  .wget-hsts  .xsession-errors\nroot@debian:~#\n</code></pre> <p>\u8fd9\u4e2a\u5176\u5b9e\u662f<code>bash</code>\u4e2d\u7684\u901a\u914d\u7b26\u5339\u914d\uff0c\u4e0d\u662f\u6b63\u5219\u8868\u8fbe\u5f0f\u54e6\uff0c\u4e0d\u8981\u5f04\u6df7\u4e86\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html","title":"\u4f7f\u7528python\u5b9e\u73b0\u4fee\u6539\u963f\u91cc\u4e91DNS\u57df\u540d\u89e3\u6790","text":"<p>\u5f53\u516c\u7f51<code>IP</code>\u662f\u6d6e\u52a8\u7684\u65f6\u5019\uff0c\u7528\u4e00\u4e2a\u57df\u540d\u53bb\u5b9e\u65f6\u89e3\u6790\uff0c\u624d\u4e0d\u4f1a\u90a3\u4e48\u7cdf\u7cd5\uff0c\u672c\u6587\u5c06\u4ecb\u7ecd\u4f7f\u7528<code>python</code>\u4fee\u6539\u963f\u91cc\u4e91<code>dns</code>\u57df\u540d\u89e3\u6790\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_1","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip3 install requests\npip3 install aliyun-python-sdk-core-v3\npip3 install aliyun-python-sdk-alidns==2.0.6\n</code></pre>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_2","title":"\u90e8\u7f72","text":"<pre><code>git clone https://github.com/wangli2025/aliyunDnsUpdateRecord.git\ncd aliyunDnsUpdateRecord\nchmod +x main.py\nsudo ln -s $(pwd)/main.py /usr/local/bin/aliyunDnsUpdateRecord\n</code></pre> <p>\u90e8\u7f72\u5b8c\u6210\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528<code>aliyunDnsUpdateRecord --help</code> \u67e5\u770b\u5e2e\u52a9</p> <pre><code>$ aliyunDnsUpdateRecord --help\nusage: aliyunDnsUpdateRecord [-h] [-c CONFIGPATH] [-d DOMAINNAME] [-r RR] [-t TYPE] [-v VALUE]\n\n\u963f\u91cc\u4e91\u4fee\u6539\u57df\u540d\u89e3\u6790\u547d\u4ee4\u884c\u5de5\u5177\n\noptions:\n  -h, --help            show this help message and exit\n  -c CONFIGPATH, --configPath CONFIGPATH\n                        \u914d\u7f6e\u6587\u4ef6\n  -d DOMAINNAME, --DomainName DOMAINNAME\n                        \u57df\u540d\n  -r RR, --RR RR        \u4e3b\u673a\n  -t TYPE, --Type TYPE  \u89e3\u6790\u7c7b\u578b\n  -v VALUE, --Value VALUE\n                        \u89e3\u6790\u503c\n$ \n</code></pre>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_3","title":"\u4f7f\u7528","text":""},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_4","title":"\u914d\u7f6e\u79d8\u94a5","text":""},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_5","title":"\u4f7f\u7528\u914d\u7f6e\u6587\u4ef6","text":"<pre><code>cat .alidns.json\n{\n    \"AliDNS_AccessKey_ID\": \"\u963f\u91cc\u4e91ID\",\n    \"AliDNS_Access_Key_Secret\": \"\u963f\u91cc\u4e91key\",\n    \"AliDNS_region_id\": \"\u533a\u57df\"\n}\n</code></pre>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_6","title":"\u4f7f\u7528\u73af\u5883\u53d8\u91cf","text":"<pre><code>export AliDNS_AccessKey_ID=\u963f\u91cc\u4e91ID\nexport AliDNS_Access_Key_Secret=\u963f\u91cc\u4e91key\nexport AliDNS_region_id=\u533a\u57df\n</code></pre> <p>\u79d8\u94a5\u8bfb\u53d6\u987a\u5e8f\u4e3a\uff1a\u914d\u7f6e\u6587\u4ef6 --&gt; \u73af\u5883\u53d8\u91cf\u3002\u82e5\u8bfb\u53d6\u5230\u914d\u7f6e\u6587\u4ef6\u7684\u5185\u5bb9\u4e86\uff0c\u5219\u4e0d\u4f1a\u518d\u83b7\u53d6\u73af\u5883\u53d8\u91cf\u914d\u7f6e\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_7","title":"\u811a\u672c\u6267\u884c","text":"<p>\u914d\u7f6e\u79d8\u94a5\u540e\uff0c\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5373\u53ef\u66f4\u65b0\u89e3\u6790\u3002</p> <pre><code>$ aliyunDnsUpdateRecord -d example.com -r www -t A -v 127.0.0.10\n</code></pre> <p>\u5982\u679c\u4f7f\u7528\u7684\u662f\u914d\u7f6e\u6587\u4ef6\u65b9\u5f0f\uff0c\u4e14\u6587\u4ef6\u8def\u5f84\u4e0d\u662f\u6267\u884c\u547d\u4ee4\u6240\u5728\u7684<code>./.alidns.json</code>\uff0c\u5219\u9700\u8981\u5355\u72ec\u4f7f\u7528<code>-c</code> \u5355\u72ec\u6307\u5b9a\u3002</p> <pre><code>$ cat c.json \n{\n    \"AliDNS_AccessKey_ID\": \"\u963f\u91cc\u4e91ID\",\n    \"AliDNS_Access_Key_Secret\": \"\u963f\u91cc\u4e91key\",\n    \"AliDNS_region_id\": \"\u533a\u57df\"\n}\n$ \n$ aliyunDnsUpdateRecord -c c.json -d example.com -r www -t A -v 127.0.0.10\n</code></pre> <p>\u5982\u679c\u6b63\u786e\u4fee\u6539\uff0c\u4f1a\u8f93\u5165\u5982\u4e0b\u5185\u5bb9\uff1a</p> <pre><code>\u89e3\u6790\u4fee\u6539\u6210\u529f example.com www 127.0.0.10\n</code></pre> <p>\u5982\u679c\u60f3\u5c06\u57df\u540d\u89e3\u6790\u4fee\u6539\u4e3a\u672c\u673a\u6240\u5728\u7684\u516c\u7f51\u5730\u5740\uff0c\u5219\u4e0d\u7528\u6dfb\u52a0<code>-v</code> \u5373\u53ef\u3002</p> <pre><code>$ aliyunDnsUpdateRecord -d example.com -r www -t A\n</code></pre> <p>\u5982\u4e0a\u9ed8\u8ba4\u4f1a\u83b7\u53d6\u672c\u673a\u6240\u5728\u7684\u516c\u7f51\u5730\u5740\uff0c\u5e76\u4e14\u4fee\u6539<code>example.com</code>\u7684<code>www</code>\u4e3b\u673a\u4e0a\u7684<code>A</code>\u8bb0\u5f55\u503c\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_8","title":"\u62a5\u9519\u4fe1\u606f","text":""},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_9","title":"\u79d8\u94a5\u914d\u7f6e\u51fa\u9519","text":"<pre><code>ERROR:root:\u83b7\u53d6[\u57df\u540d]\u57df\u540d\u89e3\u6790\u5931\u8d25: HTTP Status: 404 Error:InvalidAccessKeyId.NotFound Specified access key is not found. \n</code></pre> <p>\u8bf7\u68c0\u67e5\u79d8\u94a5\u914d\u7f6e\u662f\u5426\u6b63\u786e\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_10","title":"\u627e\u4e0d\u5230\u57df\u540d","text":"<pre><code>ERROR:root:\u83b7\u53d6[\u57df\u540d]\u57df\u540d\u89e3\u6790\u5931\u8d25: HTTP Status: 400 Error:InvalidDomainName.NoExist The specified domain name does not exist. Refresh the page and try again.\n</code></pre> <p>\u8bf7\u68c0\u67e5\u57df\u540d\u914d\u7f6e\u662f\u5426\u6b63\u786e\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#ram","title":"RAM\u6743\u9650\u914d\u7f6e\u51fa\u9519","text":"<pre><code>ERROR:root:\u83b7\u53d6[\u57df\u540d]\u57df\u540d\u89e3\u6790\u5931\u8d25: HTTP Status: 403 Error:Forbidden.RAM User not authorized to operate on the specified resource, or this API doesn't support RAM. \n</code></pre> <p>\u8bf7\u68c0\u67e5RAM\u6743\u9650\u914d\u7f6e\u662f\u5426\u6b63\u786e\uff0c\u5982\u679c\u6ca1\u6709\u914d\u7f6e\u66f4\u52a0\u7ec6\u5316\u7684\u81ea\u5b9a\u4e49\u7b56\u7565\uff0c\u5219\u5e94\u8be5\u6dfb\u52a0 AliyunDNSFullAccess \u7cfb\u7edf\u7b56\u7565\u3002</p>"},{"location":"2024/11/07/Using-Python-to-modify-Alibaba-Cloud-DNS-domain-name-resolution.html#_11","title":"\u89e3\u6790\u8bb0\u5f55\u4e3a\u627e\u5230","text":"<pre><code>\u672a\u627e\u5230\u8be5\u57df\u540d\u89e3\u6790\u8bb0\u5f55\uff0c\u8bf7\u68c0\u67e5\u662f\u5426\u88ab\u6dfb\u52a0\uff0c[\u57df\u540d\u4fe1\u606f]\n</code></pre> <p>\u672a\u627e\u5230\u89e3\u6790\u8bb0\u5f55\uff0c\u8bf7\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u88ab\u6dfb\u52a0\u4e86</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html","title":"\u5728\u5bb9\u5668\u4e2d\u5982\u4f55\u6302\u8f7drootfs","text":"<p>\u672c\u7bc7\u6587\u7ae0\u5c06\u4ecb\u7ecd\u5982\u4f55\u5728\u5bb9\u5668\u4e2d\u66f4\u6539\u6587\u4ef6\u6839\u76ee\u5f55\u3002</p> <p>\u672c\u7bc7\u6587\u7ae0\u4f7f\u7528\u7684\u73af\u5883\u4e3a\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# hostnamectl\n Static hostname: ubuntu\n       Icon name: computer-vm\n         Chassis: vm \ud83d\uddb4\n    Product UUID: d7a79327-c7b6-4c40-a8d2-abf3244c3abc\n  Virtualization: oracle\nOperating System: Ubuntu 24.10\n          Kernel: Linux 6.11.0-9-generic\n    Architecture: x86-64\n Hardware Vendor: innotek GmbH\n  Hardware Model: VirtualBox\n Hardware Serial: 0\nFirmware Version: VirtualBox\n   Firmware Date: Fri 2006-12-01\n    Firmware Age: 17y 11month 1w 6d\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>debian 12 \u9ed8\u8ba4\u5185\u6838\u4e0d\u652f\u6301<code>pivot_root</code>\u547d\u4ee4\uff0c\u5728\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u628a\u673a\u5668\u7cfb\u7edf\u641e\u574f\u4e86\uff0c\u6240\u4ee5\u7528<code>ubuntu</code>\u6f14\u793a\u3002</p> <p>\u6b64\u524d\u5df2\u7ecf\u4ecb\u7ecd\u4e86<code>Linux</code>\u4e2d\u7684\u76f8\u5173<code>namespace</code>\uff0c\u8fd9\u91cc\u7b80\u5355\u56de\u987e\u4e00\u4e0b\u3002</p> <p>\u4f7f\u7528<code>unshare</code>\u53ef\u4ee5\u5c06\u547d\u4ee4\u632a\u5230\u76f8\u5e94\u7684<code>namespace</code>\u4e2d\u6267\u884c\uff0c\u6848\u4f8b\u5982\u4e0b\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# unshare -m -p -u -n -i -f /usr/bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# mount -t proc proc /proc\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# ps aux\nUSER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot           1  0.0  0.1   7696  4460 pts/0    S    08:45   0:00 /usr/bin/bash\nroot           9  0.0  0.1   8428  4012 pts/0    R+   08:45   0:00 ps aux\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# df -h\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda4        92G  6.6G   81G   8% /\ntmpfs           1.7G     0  1.7G   0% /dev/shm\n...\ntmpfs           1.7G     0  1.7G   0% /tmp\n/dev/sda2       4.9G  172M  4.5G   4% /boot\n(unshare) [root@ubuntu]:[~][tty:0]# exit\nexit\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u4e0a\u9762\u4f8b\u5b50\uff0c\u867d\u7136\u6210\u529f\u5728\u76f8\u5e94\u7684<code>namespace</code>\u7684\u8fd0\u884c\u8fdb\u7a0b\u4e86\uff0c\u4f46\u662f\u5728\u8be5\u5bb9\u5668\u4e2d\uff0c\u6587\u4ef6\u7cfb\u7edf\u8fd8\u662f\u4f7f\u7528\u7684\u5bbf\u4e3b\u673a\u7684\uff0c\u672c\u7bc7\u6587\u7ae0\u5c31\u7b80\u5355\u6765\u8bb2\u4e00\u4e0b\uff0c\u5982\u4f55\u5728\u5bb9\u5668\u4e2d\u6302\u8f7d<code>rootfs</code>\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#rootfs_1","title":"\u83b7\u53d6rootfs","text":""},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#rootfs_2","title":"\u4ec0\u4e48\u662frootfs","text":"<p>\u4e5f\u79f0\u4e3a\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u662f\u7cfb\u7edf\u542f\u52a8\u7684\u65f6\u5019\u52a0\u8f7d\u7684\u7b2c\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u5305\u542b\u4e86\u7cfb\u7edf\u7684\u57fa\u672c\u76ee\u5f55\u7ed3\u6784\u548c\u6240\u5fc5\u8981\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#dockerrootfs","title":"\u5229\u7528docker\u83b7\u53d6rootfs","text":"<p>\u8fd9\u91cc\u4f7f\u7528<code>docker pull</code> \u62c9\u53d6\u4e00\u4e2a\u955c\u50cf\uff0c\u89e3\u538b\u5f00\u6765\u4fbf\u662f<code>rootfs</code>\u4e86\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# docker pull busybox\nUsing default tag: latest\nlatest: Pulling from library/busybox\na46fbb00284b: Pull complete\nDigest: sha256:768e5c6f5cb6db0794eec98dc7a967f40631746c32232b78a3105fb946f3ab83\nStatus: Downloaded newer image for busybox:latest\ndocker.io/library/busybox:latest\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u4f7f\u7528<code>docker pull</code>\u62c9\u53d6\u4e00\u4e2a\u6700\u7b80\u5355\u7684<code>busybox</code>\u955c\u50cf\u3002</p> <p>\u4f7f\u7528<code>docker export</code>\u53ef\u4ee5\u5c06\u5176\u5bfc\u51fa\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# docker run -d busybox\n7512c7ab5a8760ccf1080612fbb48533a08b23e5cfe32b6276f828355500a982\n[root@ubuntu]:[~][tty:0]# docker export -o rootfs.tar 7512c7ab5a8760ccf1080612fbb48533a08b23e5cfe32b6276f828355500a982\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u89e3\u538b\u5f00\u6765\uff0c\u4fbf\u662f\u5b8c\u6574\u7684<code>rootfs</code>\u4e86\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# mkdir rootfs\n[root@ubuntu]:[~][tty:0]# tar xf rootfs.tar -C rootfs\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u67e5\u770b<code>busybox</code>\u5b8c\u6574\u7684<code>rootfs</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# cd rootfs\n[root@ubuntu]:[~/rootfs][tty:0]# ls\nbin  dev  etc  home  lib  lib64  proc  root  sys  tmp  usr  var\n[root@ubuntu]:[~/rootfs][tty:0]#\n</code></pre>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#_1","title":"\u66f4\u6539\u6839\u6587\u4ef6\u7cfb\u7edf","text":""},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#pivot_root","title":"\u4f7f\u7528pivot_root\u66f4\u6539\u6839\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u5982\u4e0a\uff0c\u5df2\u7ecf\u83b7\u53d6\u4e86<code>rootfs</code>\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u63a5\u4e0b\u6765\u5c06\u4f7f\u7528<code>pivot_root</code>\u8fdb\u884c\u66f4\u6539\u6839\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p><code>pivot_root</code>\u662f\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u7528\u4e8e\u66f4\u6539\u6587\u4ef6\u7cfb\u7edf\u7684\u6839\u76ee\u5f55\uff0c\u7528\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>pivot_root new_root put_old\n</code></pre> <p>\u5176\u4e2d<code>new_root</code>\u662f\u6307\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c<code>put_old</code>\u5219\u662f\u6307\u8001\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u547d\u4ee4\u6267\u884c\u540e\uff0c\u4f1a\u5c06<code>new_root</code>\u76ee\u5f55\u6302\u8f7d\u4e3a\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u800c\u8001\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u5219\u4f1a\u6302\u8f7d\u5230<code>put_old</code>\u4e0a\u3002</p> <p><code>new_root</code>\u548c<code>put_old</code>\u90fd\u8981\u662f\u72ec\u7acb\u7684\u6587\u4ef6\u7cfb\u7edf\u624d\u53ef\u4ee5\uff0c\u82e5\u4e0d\u662f\u7684\u8bdd\uff0c\u9700\u8981\u4f7f\u7528<code>mount</code>\u8fdb\u884c\u58f0\u660e\u5f0f\u6302\u8f7d\u3002</p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u4e00\u5b9a\u8981\u5728<code>mount namespace</code>\u4e2d\u6267\u884c<code>pivot_root</code>\u64cd\u4f5c\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# cd\n[root@ubuntu]:[~][tty:0]# mkdir -p rootfs/put_old\n[root@ubuntu]:[~][tty:0]#\n[root@ubuntu]:[~][tty:0]# unshare -m -u -i -p -n -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/rootfs /root/rootfs\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/rootfs/put_old /root/rootfs/put_old\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# pivot_root /root/rootfs /root/rootfs/put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# cd\n(unshare) [root@ubuntu]:[~][tty:tty]# ls -l\ntotal 0\n(unshare) [root@ubuntu]:[~][tty:tty]# ls -l /\ntotal 56\ndrwxr-xr-x    2 root     root         12288 Sep 26 21:31 bin\ndrwxr-xr-x    4 root     root          4096 Nov 13 09:04 dev\ndrwxr-xr-x    3 root     root          4096 Nov 13 09:04 etc\ndrwxr-xr-x    2 nobody   nobody        4096 Sep 26 21:31 home\ndrwxr-xr-x    2 root     root          4096 Sep 26 21:31 lib\nlrwxrwxrwx    1 root     root             3 Sep 26 21:31 lib64 -&gt; lib\ndrwxr-xr-x    2 root     root          4096 Nov 13 09:04 proc\ndrwxr-xr-x   20 root     root          4096 Nov 13 08:34 put_old\ndrwx------    2 root     root          4096 Nov 13 09:16 root\ndrwxr-xr-x    2 root     root          4096 Nov 13 09:04 sys\ndrwxrwxrwt    2 root     root          4096 Sep 26 21:31 tmp\ndrwxr-xr-x    4 root     root          4096 Sep 26 21:31 usr\ndrwxr-xr-x    4 root     root          4096 Sep 26 21:31 var\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/mount -t proc proc /proc\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\nudev                      1.6G         0      1.6G   0% /put_old/dev\ntmpfs                     1.7G         0      1.7G   0% /put_old/dev/shm\ntmpfs                   340.2M      1.1M    339.1M   0% /put_old/run\ntmpfs                     5.0M         0      5.0M   0% /put_old/run/lock\n...\ntmpfs                     1.7G         0      1.7G   0% /put_old/tmp\n/dev/sda2                 4.8G    171.7M      4.4G   4% /put_old/boot\noverlay                  92.0G      6.9G     80.3G   8% /put_old/var/lib/docker/overlay2/cc5c084fbc8408885238df38f319ed6b4c30633214a40cb826b509ebaf8a37ea/merged\noverlay                  92.0G      6.9G     80.3G   8% /put_old/var/lib/docker/overlay2/bafdfaa3dbd7563bd81d30ec86c03b7749a08b144304eae7c5de60922482dc5c/merged\n/dev/sda4                92.0G      6.9G     80.3G   8% /\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p>\u5982\u4e0a\uff0c\u5728<code>rootfs</code>\u76ee\u5f55\u4e0b\u521b\u5efa\u4e86<code>put_old</code>\u76ee\u5f55\uff0c\u7528\u4ee5\u5b58\u653e\u8001\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u4f7f\u7528<code>unshare</code>\u8fdb\u5165<code>namespace</code>\u540e\uff0c\u5bf9<code>/root/rootfs</code>\u548c<code>/root/rootfs/put_old</code>\u8fdb\u884c\u58f0\u660e\u5f0f\u6302\u8f7d\u3002</p> <p>\u800c\u540e\u4f7f\u7528<code>pivot_root</code>\u8fdb\u884c\u5207\u6362\u76ee\u5f55\uff0c\u91cd\u65b0\u6302\u8f7d<code>proc</code>\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f7f\u7528<code>df -h</code>\u67e5\u770b\u6587\u4ef6\u6302\u8f7d\u70b9\uff0c\u4e0d\u96be\u770b\u51fa\uff0c\u8001\u7684\u6587\u4ef6\u7cfb\u7edf\u5df2\u7ecf\u88ab\u6302\u8f7d\u5230<code>/put_old</code>\u76ee\u5f55\u4e2d\u4e86\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#_2","title":"\u5378\u8f7d\u8001\u7684\u6839\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u867d\u7136\u5207\u6362\u4e3a\u4e86\u65b0\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\uff0c\u4f46\u662f\u6302\u8f7d\u70b9\u90fd\u8fd8\u5728\uff0c\u4e5f\u80fd\u64cd\u4f5c<code>/put_old</code>\u4e2d\u7684\u76ee\u5f55\u548c\u6587\u4ef6\uff0c\u8fd9\u91cc\u4ecb\u7ecd\u5c06\u5176\u5378\u8f7d\u6389\u3002</p> <p>\u53ea\u9700\u8981\u4f7f\u7528<code>umount -l</code>\u5378\u8f7d\u6389\u5373\u53ef\uff0c\u5982\u4e0b\uff1a</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:tty]# umount -l /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda4                92.0G      6.9G     80.3G   8% /\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/mount\n/dev/sda4 on / type ext4 (rw,relatime)\n/dev/sda4 on /put_old type ext4 (rw,relatime)\nproc on /proc type proc (rw,relatime)\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p><code>umount -l</code>\u662f\u60f0\u6027\u5378\u8f7d\uff0c\u60f0\u6027\u5378\u8f7d\u662f\u6307\u5c06\u6302\u8f7d\u70b9\u6807\u8bb0\u4e3a\u5f85\u5378\u8f7d\u72b6\u6001\uff0c\u4f46\u662f\u4e0d\u4f1a\u7acb\u5373\u8fdb\u884c\u5378\u8f7d\uff0c\u60f0\u6027\u5378\u8f7d\u540e\uff0c\u4ece\u8868\u9762\u6765\u770b\uff0c\u90fd\u4f1a\u5378\u8f7d\u5e72\u51c0\uff0c\u4f46\u662f\u5b83\u4f1a\u7b49\u6587\u4ef6\u7cfb\u7edf\u4e0d\u518d\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u771f\u6b63\u5378\u8f7d\u6389\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#_3","title":"\u6620\u5c04\u6302\u8f7d\u70b9","text":"<p>\u82e5\u60f3\u5378\u8f7d\u6389\u8001\u6587\u4ef6\u7cfb\u7edf\uff0c\u53c8\u60f3\u6620\u5c04\u90e8\u5206\u76ee\u5f55\u5230\u8be5<code>namespace</code>\u4e2d\uff0c\u53ef\u4ee5\u5728\u60f0\u6027\u5378\u8f7d\u524d\uff0c\u8fdb\u884c\u58f0\u660e\u5f0f\u6302\u8f7d\u5373\u53ef\uff0c\u4f8b\u5982\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:0]# unshare -m -u -i -p -n -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/rootfs /root/rootfs\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/rootfs/put_old /root/rootfs/put_old\n(unshare) [root@ubuntu]:[~][tty:0]# pivot_root /root/rootfs /root/rootfs/put_old\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/mount -t proc proc /proc\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\nudev                      1.6G         0      1.6G   0% /put_old/dev\ntmpfs                     1.7G         0      1.7G   0% /put_old/dev/shm\ntmpfs                   340.2M      1.1M    339.1M   0% /put_old/run\ntmpfs                     5.0M         0      5.0M   0% /put_old/run/lock\n...\ntmpfs                   340.2M     12.0K    340.2M   0% /put_old/run/user/1000\ntmpfs                     1.7G         0      1.7G   0% /put_old/tmp\n/dev/sda2                 4.8G    171.7M      4.4G   4% /put_old/boot\noverlay                  92.0G      6.9G     80.3G   8% /put_old/var/lib/docker/overlay2/cc5c084fbc8408885238df38f319ed6b4c30633214a40cb826b509ebaf8a37ea/merged\noverlay                  92.0G      6.9G     80.3G   8% /put_old/var/lib/docker/overlay2/bafdfaa3dbd7563bd81d30ec86c03b7749a08b144304eae7c5de60922482dc5c/merged\n/dev/sda4                92.0G      6.9G     80.3G   8% /\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# mkdir /put_old/root/\n.bash_history  .bashrc        .dockerenv     .lesshst       .profile       rootfs/        rootfs.tar     .ssh/          .viminfo\n(unshare) [root@ubuntu]:[~][tty:tty]# mkdir /put_old/root/dir1\n(unshare) [root@ubuntu]:[~][tty:tty]# mkdir ~/dir2\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/mount --bind /put_old/root/dir1 /root/dir2\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# umount -l /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# df -h\nFilesystem                Size      Used Available Use% Mounted on\n/dev/sda4                92.0G      6.9G     80.3G   8% /\n/dev/sda4                92.0G      6.9G     80.3G   8% /put_old\n/dev/sda4                92.0G      6.9G     80.3G   8% /root/dir2\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p>\u5982\u4e0a\u64cd\u4f5c\u548c\u4e0a\u8ff0\u64cd\u4f5c\u4e00\u81f4\uff0c\u53ea\u4e0d\u8fc7\u5728\u60f0\u6027\u6302\u8f7d\u4e4b\u524d\uff0c\u521b\u5efa\u4e862\u4e2a\u76ee\u5f55\uff0c<code>/put_old/root/dir1</code> \u548c<code>~/dir2</code>\uff0c\u800c\u540e\u8fdb\u884c\u58f0\u660e\u5f0f\u6302\u8f7d\uff0c\u6700\u540e\u60f0\u6027\u5378\u8f7d\u6389<code>/put_old</code>\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5bbf\u4e3b\u673a\u7684\u6302\u8f7d\u70b9\u4e86\u3002</p> <p>\u5b9e\u9645\u5199\u5165\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u5982\u4e0b\uff1a</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:tty]# echo 'hello' &gt; /root/dir2/123.ttx\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p>\u5728<code>namespace</code>\u4e2d\uff0c\u521b\u5efa\u4e86<code>/root/dir2/123.ttx</code>\uff0c\u5e76\u4e14\u5199\u5165\u503c<code>hello</code>\uff0c\u800c\u5728\u5bbf\u4e3b\u673a\u4e2d\u540c\u6837\u67e5\u770b\u8be5\u6587\u4ef6\u3002</p> <pre><code>[root@ubuntu]:[~][tty:1]# cat dir1/123.ttx\nhello\n[root@ubuntu]:[~][tty:1]#\n</code></pre>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#overlayrootfs","title":"\u4f7f\u7528overlay\u6765\u91cd\u590d\u5229\u7528rootfs","text":"<p>\u4e0a\u8ff0\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u82e5\u5f00\u542f\u4e86\u591a\u4e2a\u5bb9\u5668\uff0c\u662f\u9700\u8981\u4e3a\u6bcf\u4e00\u4e2a\u5bb9\u5668\u90fd\u62f7\u8d1d\u4e00\u4efd<code>rootfs</code>\uff0c\u5b9e\u9645\u4e0a<code>rootfs</code>\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5b58\u5728\u592a\u591a\u7684\u4fee\u6539\uff0c\u5982\u679c\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5219\u975e\u5e38\u6d6a\u8d39\u5b58\u50a8\u7a7a\u95f4\uff0c\u597d\u5728<code>overlay</code>\u53ef\u4ee5\u89e3\u51b3\u8be5\u95ee\u9898\u3002</p> <p><code>overlay</code>\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u5141\u8bb8\u5c06\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u89c6\u56fe\u53e0\u52a0\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u7cfb\u7edf\u4e0a\uff0c\u53ef\u4ee5\u7b80\u5355\u7684\u5206\u4e3a\u57fa\u7840\u5c42\u548c\u53ef\u5199\u5c42\uff0c\u5f53\u4f7f\u7528\u8be5\u6587\u4ef6\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u9700\u8981\u6307\u5b9a\u8fd92\u4e2a\u5c42\u6b21\uff0c\u5f53\u6587\u4ef6\u6709\u4fee\u6539\u7684\u65f6\u5019\uff0c\u4f1a\u4ece\u57fa\u7840\u5c42\u62f7\u8d1d\u4e00\u4efd\uff0c\u5230\u53ef\u5199\u5c42\uff0c\u4fee\u6539\u53ef\u5199\u5c42\u7684\u6570\u636e\uff0c\u4e0d\u4f1a\u5f71\u54cd\u6700\u5e95\u5c42\u7684\u539f\u59cb\u6570\u636e\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u591a\u4e2a\u5bb9\u5668\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00<code>rootfs</code>\uff0c\u53ea\u9700\u8981\u4e3a\u6bcf\u4e2a\u5bb9\u5668\u90fd\u6307\u5b9a\u4e0d\u540c\u7684\u53ef\u884c\u5c42\u5373\u53ef\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#overlay","title":"\u4f7f\u7528<code>overlay</code>\u8fdb\u884c\u7b80\u5355\u7684\u6302\u8f7d","text":"<p><code>overlay</code>\u6709\u4ee5\u4e0b\u5c42\u6b21\uff1a</p> <ul> <li><code>lower directory</code> \uff1a\u57fa\u7840\u53ea\u8bfb\u6587\u4ef6\u7cfb\u7edf\u5c42</li> <li><code>upper directory</code>\uff1a\u53ef\u5199\u5c42</li> <li><code>work directory</code>\uff1a\u5185\u90e8\u5de5\u4f5c\u76ee\u5f55</li> </ul> <p>\u4e0b\u9762\u5c06\u6f14\u793a\u4f7f\u7528<code>overlay</code>\u8fdb\u884c\u7b80\u5355\u7684\u6302\u8f7d\u3002</p> <p>\u51c6\u5907\u5de5\u4f5c\uff1a</p> <pre><code>[root@ubuntu]:[~][tty:1]# mkdir overlay\n[root@ubuntu]:[~][tty:1]# cd overlay/\n[root@ubuntu]:[~/overlay][tty:1]#\n[root@ubuntu]:[~/overlay][tty:1]# mkdir lower_directory\n[root@ubuntu]:[~/overlay][tty:1]# mkdir upper_directory\n[root@ubuntu]:[~/overlay][tty:1]# mkdir work_directory\n[root@ubuntu]:[~/overlay][tty:1]# mkdir work\n[root@ubuntu]:[~/overlay][tty:1]#\n[root@ubuntu]:[~/overlay][tty:1]# echo \"123456\" &gt; lower_directory/text.txt\n[root@ubuntu]:[~/overlay][tty:1]# echo \"hello\" &gt; lower_directory/test\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u5982\u4e0a\u521b\u5efa\u4e863\u4e2a\u76ee\u5f55\uff0c\u5206\u522b\u4e3a<code>lower_directory</code>\u3001<code>upper_directory</code>\u3001<code>work_directory</code>\u4ee5\u53ca<code>work</code>\u76ee\u5f55\u3002</p> <p>\u5e76\u4e14\u5728<code>lower_directory</code>\u76ee\u5f55\u4e0b\u521b\u5efa\u4e862\u4e2a\u6587\u4ef6\uff1a<code>text.txt</code>\u548c<code>test</code>\u5206\u522b\u5199\u5165\u4e86\u5185\u5bb9\u3002</p> <p>\u4f7f\u7528<code>overlay</code>\u8fdb\u884c\u6302\u8f7d\uff1a</p> <pre><code>[root@ubuntu]:[~/overlay][tty:1]# mount -t overlay overlay -o lowerdir=lower_directory,upperdir=upper_directory,workdir=work_directory ./work\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u6302\u8f7d<code>overlay</code>\u6307\u5b9a\u4e86\u57fa\u7840\u53ea\u8bfb\u6587\u4ef6\u7cfb\u7edf\u5c42\u76ee\u5f55\u3001\u53ef\u5199\u5c42\u76ee\u5f55\u4ee5\u53ca\u5185\u90e8\u5de5\u4f5c\u76ee\u5f55\uff0c\u6700\u540e\u662f\u5c06<code>overlay</code>\u6302\u8f7d\u5230\u4e86<code>./work</code>\u4e2d\u3002</p> <p>\u67e5\u770b\u6302\u8f7d\u4fe1\u606f\uff1a</p> <pre><code>[root@ubuntu]:[~/overlay][tty:1]# df -h\nFilesystem      Size  Used Avail Use% Mounted on\ntmpfs           341M  1.2M  340M   1% /run\n/dev/sda4        92G  7.0G   81G   8% /\ntmpfs           1.7G     0  1.7G   0% /dev/shm\n...\noverlay          92G  7.0G   81G   8% /var/lib/docker/overlay2/cc5c084fbc8408885238df38f319ed6b4c30633214a40cb826b509ebaf8a37ea/merged\noverlay          92G  7.0G   81G   8% /var/lib/docker/overlay2/bafdfaa3dbd7563bd81d30ec86c03b7749a08b144304eae7c5de60922482dc5c/merged\noverlay          92G  7.0G   81G   8% /root/overlay/work\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6587\u4ef6\u7c7b\u578b\u662f<code>overlay</code>\uff0c\u5df2\u7ecf\u6302\u8f7d\u5230<code>/root/overlay/work</code>\u76ee\u5f55\u4e2d\u4e86\u3002</p> <p>\u67e5\u770b\u5404\u4e2a\u76ee\u5f55\u7684\u6587\u4ef6\uff1a</p> <pre><code>[root@ubuntu]:[~/overlay][tty:1]# tree\n.\n\u251c\u2500\u2500 lower_directory\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 text.txt\n\u251c\u2500\u2500 upper_directory\n\u251c\u2500\u2500 work\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 text.txt\n\u2514\u2500\u2500 work_directory\n    \u2514\u2500\u2500 work\n\n6 directories, 4 files\n[root@ubuntu]:[~/overlay][tty:1]# md5sum lower_directory/* work/*\nb1946ac92492d2347c6235b4d2611184  lower_directory/test\nf447b20a7fcbf53a5d5be013ea0b15af  lower_directory/text.txt\nb1946ac92492d2347c6235b4d2611184  work/test\nf447b20a7fcbf53a5d5be013ea0b15af  work/text.txt\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5176<code>work</code>\u76ee\u5f55\u548c<code>lower_directory</code>\u76ee\u5f55\u4e2d\u7684\u6587\u4ef6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5176<code>md5</code>\u4e5f\u662f\u4e00\u6837\u7684\uff0c\u8bf4\u660e<code>overlay</code>\u5df2\u7ecf\u5c06\u57fa\u7840\u7cfb\u7edf\u5c42\u7684\u6587\u4ef6\u6620\u5c04\u8fdb\u6765\u4e86\u3002</p> <p>\u6b64\u65f6\u82e5\u4fee\u6539<code>work</code>\u76ee\u5f55\u4e0b\u7684\u67d0\u4e2a\u6587\u4ef6\uff0c\u518d\u67e5\u770b\u6587\u4ef6\u4fe1\u606f\uff1a</p> <pre><code>[root@ubuntu]:[~/overlay][tty:1]# echo \"123\" &gt;&gt; work/text.txt\n[root@ubuntu]:[~/overlay][tty:1]#\n[root@ubuntu]:[~/overlay][tty:1]# tree\n.\n\u251c\u2500\u2500 lower_directory\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 text.txt\n\u251c\u2500\u2500 upper_directory\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 text.txt\n\u251c\u2500\u2500 work\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 test\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 text.txt\n\u2514\u2500\u2500 work_directory\n    \u2514\u2500\u2500 work\n\n6 directories, 5 files\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u53ef\u5199\u5c42\u4e5f\u589e\u52a0\u4e86\u4e00\u4e2a<code>text.txt</code>\uff0c\u5177\u4f53\u7684\u903b\u8f91\u662f\u5f53\u6211\u4eec\u89c6\u56fe\u4fee\u6539<code>work/text.txt</code>\u5185\u5bb9\u662f\uff0c<code>overlay</code>\u4f1a\u5148\u5c06\u53ea\u8bfb\u6587\u4ef6\u7cfb\u7edf\u5c42\u7684<code>text.txt</code>\u62f7\u8d1d\u5230<code>upper_directory</code>\u4e2d\uff0c\u7136\u540e\u518d\u4fee\u6539\u5176\u5185\u5bb9\uff0c\u5f53\u6211\u4eec\u8bfb\u53d6<code>work</code>\u76ee\u5f55\u4e0b\u5185\u5bb9\u7684\u65f6\u5019\uff0c\u5f53<code>upper_directory</code>\u76ee\u5f55\u4e2d\u6709\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u8bfb\u53d6\u8be5\u76ee\u5f55\u4e0b\u5185\u5bb9\uff0c\u6ca1\u6709\u624d\u4f1a\u5728<code>lower_directory</code>\u8fdb\u884c\u5c1d\u8bd5\u8bfb\u53d6\u3002</p> <p>\u6821\u9a8c\u4e00\u4e0b\u5404\u4e2a\u6587\u4ef6\u7684<code>md5</code>\uff1a</p> <pre><code>[root@ubuntu]:[~/overlay][tty:1]# md5sum lower_directory/text.txt work/text.txt upper_directory/text.txt\nf447b20a7fcbf53a5d5be013ea0b15af  lower_directory/text.txt\n6104fbccc189d29b24969b514bb7de5a  work/text.txt\n6104fbccc189d29b24969b514bb7de5a  upper_directory/text.txt\n[root@ubuntu]:[~/overlay][tty:1]#\n</code></pre> <p>\u901a\u8fc7\u4e0a\u8ff0\u4e09\u4e2a\u76ee\u5f55\u4e2d\u7684<code>`text.txt</code>\u7684<code>md5</code>\u503c\u53ef\u4ee5\u5224\u65ad\uff0c\u5176\u4fee\u6539\u7684\u503c\u88ab\u5b58\u5165\u5230\u4e86<code>upper_directory</code>\u4e2d\u3002</p> <p>\u200b   </p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#overlayrootfs_1","title":"\u4f7f\u7528<code>overlay</code>\u6302\u8f7d<code>rootfs</code>","text":"<p>\u60f3\u8981\u6bcf\u4e2a\u5bb9\u5668\u90fd\u83b7\u53d6\u201c\u72ec\u7acb\u201d\u7684<code>rootfs</code>\uff0c\u90a3\u5728\u521b\u5efa<code>namespace</code>\u4e4b\u524d\uff0c\u5c31\u9700\u8981\u5148\u8fdb\u884c\u6302\u8f7d\uff0c\u9700\u8981\u6307\u5b9a\u4e0d\u540c\u7684<code>lowerdir</code>\u3001<code>upperdir</code>\u4ee5\u53ca<code>workdir</code>\u3002</p> <p>\u6bcf\u4e2a\u5bb9\u5668\u542f\u52a8\u4e4b\u524d\uff0c\u90fd\u9700\u8981\u8fdb\u884c<code>overlay</code>\u7684\u6302\u8f7d\u3002</p> <p>\u5728\u6b64\u4e4b\u524d\uff0c\u9700\u8981\u4e3a\u5bb9\u5668\u521b\u5efa\u76f8\u5e94\u7684<code>overlay</code>\u76ee\u5f55\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# mkdir {upper,work,busybox_container_01}\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p><code>busybox_container_01</code>\u5c31\u662f\u4e3a\u5373\u5c06\u542f\u52a8\u7684\u5bb9\u5668\uff0c\u521b\u5efa\u7684\u6839\u76ee\u5f55\uff0c\u5176\u4ed6\u7684\uff0c\u5219\u548c\u4e0a\u8282\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5c06<code>rootfs</code>\u6302\u8f7d\u5230<code>busybox_container_01</code>\u4e2d\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# mount -t overlay overlay -o lowerdir=rootfs,upperdir=upper,workdir=work busybox_container_01\n[root@ubuntu]:[~][tty:0]#\n</code></pre> <p>\u8fd9\u91cc\u7684<code>lowerdir</code>\u9700\u8981\u4fee\u6539\u4e3a<code>rootfs</code>\u3002</p> <p>\u4f7f\u7528<code>unshare</code>\u521b\u5efa<code>namespace</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:0]# unshare -m -p -u -n -i -f /bin/bash\n(unshare) [root@ubuntu]:[~][tty:0]# mkdir -p busybox_container_01/put_old\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/busybox_container_01 /root/busybox_container_01\n(unshare) [root@ubuntu]:[~][tty:0]# mount --bind /root/busybox_container_01/put_old /root/busybox_container_01/put_old\n(unshare) [root@ubuntu]:[~][tty:0]#\n(unshare) [root@ubuntu]:[~][tty:0]# pivot_root /root/busybox_container_01 /root/busybox_container_01/put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# cd\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/mount -t proc proc /proc\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# umount -l /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n(unshare) [root@ubuntu]:[~][tty:tty]# /bin/df -h\nFilesystem                Size      Used Available Use% Mounted on\noverlay                  92.0G      6.9G     80.3G   8% /\noverlay                  92.0G      6.9G     80.3G   8% /put_old\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p>\u5982\u4e0a\u4fbf\u6210\u529f\u4e86\u3002</p> <p>\u5982\u679c\u5bb9\u5668\u4e2d\u6709\u4fee\u6539\uff0c\u4f1a\u76f8\u5e94\u7684\u4fee\u6539\u5230<code>/root/upper</code>\u5185\u5bb9\uff0c\u4f8b\u5982\uff1a</p> <pre><code>(unshare) [root@ubuntu]:[~][tty:tty]# echo 'busybox' &gt; 123.txt\n(unshare) [root@ubuntu]:[~][tty:tty]#\n</code></pre> <p>\u4f1a\u540c\u6b65\u4fee\u6539\u5230<code>upper</code>\u76ee\u5f55\u4e2d\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u5230\u539f\u59cb\u7684<code>rootfs</code>\u3002</p> <pre><code>[root@ubuntu]:[~][tty:1]# cat upper/root/123.txt\nbusybox\n[root@ubuntu]:[~][tty:1]#\n[root@ubuntu]:[~][tty:1]# ls rootfs/root/123.txt\nls: cannot access 'rootfs/root/123.txt': No such file or directory\n[root@ubuntu]:[~][tty:1]#\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5bbf\u4e3b\u673a\u4e2d\uff0c<code>rootfs/root/123.txt</code>\u5e76\u6ca1\u6709\u5b58\u5728\u8be5\u6587\u4ef6\uff0c\u800c<code>upper/root/123.txt</code>\u5219\u5b58\u5728\uff0c\u6240\u4ee5\u4f7f\u7528<code>overlay</code>\u53ef\u4ee5\u91cd\u590d\u5229\u7528<code>rootfs</code>\uff0c\u8282\u7701\u78c1\u76d8\u5b58\u50a8\u7a7a\u95f4\u3002</p>"},{"location":"2024/11/13/How_to_mount_rootfs_in_a_container.html#_4","title":"\u603b\u7ed3","text":"<p>\u82e5\u4e00\u4e2a\u8fdb\u7a0b\u4f7f\u7528<code>mount namespace</code>\u540e\uff0c\u4f1a\u4f7f\u7528\u548c\u5bbf\u4e3b\u673a\u76f8\u540c\u7684<code>rootfs</code>\uff0c\u4e3a\u4e86\u5c06\u5bb9\u5668\u548c\u5bbf\u4e3b\u673a<code>rootfs</code>\u5206\u79bb\u5f00\u6765\uff0c\u53ef\u4ee5\u4f7f\u7528<code>pivot_root</code>\u8fdb\u884c\u66f4\u6539\u5bb9\u5668\u4e2d\u7684\u6839\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u5728\u6b64\u57fa\u7840\u4e0a\u4e0a\uff0c\u82e5\u8981\u8fd0\u884c\u591a\u4e2a\u5bb9\u5668\u7684\u8bdd\uff0c\u9700\u8981\u62f7\u8d1d\u591a\u4e2a<code>rootfs</code>\u624d\u884c\uff0c\u597d\u5728\u53ef\u4ee5\u4f7f\u7528<code>overlay</code>\u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u6709\u6548\u7684\u5229\u7528<code>rootfs</code>\uff0c\u53c8\u8fbe\u5230\u4e86\u6587\u4ef6\u7cfb\u7edf\u7684\u9694\u79bb\u6027\u3002</p>"},{"location":"archive/2025.html","title":"2025","text":""},{"location":"archive/2024.html","title":"2024","text":""},{"location":"category/network.html","title":"network","text":""},{"location":"category/vim.html","title":"Vim","text":""},{"location":"category/linux.html","title":"Linux","text":""},{"location":"category/%E5%AE%B9%E5%99%A8.html","title":"\u5bb9\u5668","text":""},{"location":"category/vmware.html","title":"vmware","text":""},{"location":"category/gpg.html","title":"gpg","text":""},{"location":"category/%E7%BC%96%E8%BE%91%E5%99%A8.html","title":"\u7f16\u8f91\u5668","text":""},{"location":"category/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F.html","title":"\u6b63\u5219\u8868\u8fbe\u5f0f","text":""},{"location":"category/python.html","title":"python","text":""},{"location":"category/%E9%98%BF%E9%87%8C%E4%BA%91.html","title":"\u963f\u91cc\u4e91","text":""},{"location":"category/%E9%9A%8F%E7%AC%94.html","title":"\u968f\u7b14","text":""},{"location":"page/2/index.html","title":"Home","text":""},{"location":"archive/2024/page/2.html","title":"2024","text":""}]}